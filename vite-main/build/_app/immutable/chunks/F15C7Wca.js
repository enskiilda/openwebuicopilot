import "./DKem_M_z.js";
import "./DwLkIEu4.js";
import { t as template_effect, p as push, g as getContext, o as onMount, c as child, r as reset, e as sibling, u as untrack, a as pop, f as first_child, s as set, m as mutable_source, b as get, q as next, aE as invalidate_inner_signals, aF as mutate, h as derived_safe_equal, i as deep_read_state, k as tick, n as createEventDispatcher, I as proxy, a9 as user_effect, aV as state, l as legacy_pre_effect, j as legacy_pre_effect_reset, aG as remove_textarea_child } from "./BxIY6ir7.js";
import { s as set_text, e as event, d as delegate } from "./cBADewWV.js";
import { i as if_block } from "./BoSuMvtf.js";
import { b as from_svg, a as append, f as from_html, t as text, c as comment } from "./CAbo1QWi.js";
import { s as set_class, c as clsx, r as remove_input_defaults, a as set_attribute, d as bind_select_value, g as set_selected, h as set_style } from "./kXiCYuyj.js";
import { i as init } from "./ByqEASoO.js";
import { a as store_get, s as setup_stores } from "./BvQ5O7-v.js";
import { p as page } from "./CrvggIeO.js";
import { g as goto } from "./h-B6Md2q.js";
import { t as toast } from "./BccDN__m.js";
import { c as config, Q as showChangelog, a as models, b as settings, u as user, I as banners, M as MODEL_DOWNLOAD_POOL } from "./2Yg1sHDo.js";
import { p as getWebhookUrl, m as getVersionUpdates, u as updateWebhookUrl, q as getPipelinesList, r as updatePipelineValves, g as getModels, t as getPipelines, v as getPipelineValvesSpec, w as getPipelineValves, x as uploadPipeline, y as downloadPipeline, z as deletePipeline, a as getBackendConfig, A as getTaskConfig, B as updateTaskConfig } from "./DtDmpg9G.js";
import { p as preventDefault } from "./CGgk3ROl.js";
import { p as prop } from "./BRmGPDvq.js";
import { f as fileSaver } from "./DRcZXQDn.js";
import { U as downloadDatabase, C as CodeEditor } from "./BPxE9tzl.js";
import { E as getAllUserChats } from "./17j0UIT7.js";
import { k as getAllUsers } from "./Bi6Hlb5b.js";
import { i as importConfig, e as exportConfig, a as getBanners, s as setDefaultPromptSuggestions, b as setBanners, c as getModelsConfig, d as setModelsConfig, f as getConnectionsConfig, h as setConnectionsConfig, j as getCodeExecutionConfig, k as setCodeExecutionConfig, l as getToolServerConnections, m as setToolServerConnections } from "./DkfueU7Q.js";
import { e as each, i as index } from "./7_HZMPNF.js";
import { h as html } from "./tLAl1VVg.js";
import { b as bind_value, a as bind_files, c as bind_checked } from "./DVLuwGai.js";
import purify from "./bQFTtKkZ.js";
import { j as getAdminConfig, k as getLdapServer, m as getLdapConfig, n as updateAdminConfig, o as updateLdapConfig, p as updateLdapServer } from "./GdVmBnqS.js";
import { g as getGroups } from "./D8Q8X2hm.js";
import { S as SensitiveInput } from "./BmA2IqKa.js";
import { S as Switch_1 } from "./CakJ276w.js";
import { T as Tooltip } from "./BHXWufQb.js";
import { W as WEBUI_VERSION, e as WEBUI_BUILD_HASH, b as WEBUI_BASE_URL, a as WEBUI_API_BASE_URL } from "./DQ9UxF7k.js";
import { c as compareVersion, $ as TTS_RESPONSE_SPLIT, x as v4, z as splitStream, m as marked, i as copyToClipboard } from "./Bh-hrM1w.js";
import { T as Textarea } from "./B-P1fI-w.js";
import { S as Spinner } from "./CtnI4RVL.js";
import { a as getAudioConfig, b as getModels$1, g as getVoices, u as updateAudioConfig } from "./BgG6Mq7m.js";
import { g as getConfig, a as getImageGenerationModels, u as updateConfig, v as verifyConfigUrl } from "./hD4Sc6e1.js";
import { b as bind_this } from "./D16JuV5t.js";
import { D as Drawer } from "./CfhMM1S2.js";
import { e as getBaseModels, f as deleteAllModels, u as updateModelById, c as createNewModel, i as importModels, t as toggleModelById } from "./BGM--f6E.js";
import { X as XMark } from "./CUUSX84-.js";
import { S as Sortable } from "./xMOMEvTi.js";
import { P as PromptSuggestions, M as ModelEditor } from "./COhzI1sD.js";
import { S as Search } from "./2ixn6gs3.js";
import { C as ConfirmDialog } from "./DhVOSDv1.js";
import { M as Minus, C as Cog6, A as AddConnectionModal, a as AddToolServerModal, b as Connection } from "./CLQ6JPcA.js";
import { M as Modal } from "./DF6V1elH.js";
import { C as ChevronUp } from "./DTpd_r3Z.js";
import { C as ChevronDown } from "./CUFupyOK.js";
import { D as Download } from "./Dm1xcaSj.js";
import { d as deleteModel, a as getOllamaModels, p as pullModel, c as createModel, b as uploadModel, e as downloadModel, f as getOllamaConfig, h as updateOllamaConfig } from "./d72FSnuN.js";
import "./-BrZk0Qz.js";
import { s as slot } from "./CZEGIGsR.js";
import "./C2A39Ney.js";
import { b as Menu_content, c as Menu_item } from "./DQmZL-p0.js";
import { f as flyAndScale } from "./BuLNlPfL.js";
import { D as Dropdown } from "./NbBmD2S8.js";
import { D as DocumentDuplicate } from "./D4EXptqs.js";
import { L as Link } from "./EZxqw5-p.js";
import { E as EllipsisHorizontal } from "./BC-suBaL.js";
import { E as EyeSlash } from "./B0PhibVT.js";
import { E as Eye } from "./D6dKHJXN.js";
import { b as getOpenAIConfig, d as getOpenAIModels, u as updateOpenAIConfig } from "./Bm2W_wlw.js";
import { P as Plus } from "./F9_n4pHG.js";
import { g as getRAGConfig, r as resetVectorDB, u as updateRAGConfig, b as getEmbeddingConfig, c as updateEmbeddingConfig } from "./KnVGb4qV.js";
import { i as reindexKnowledgeFiles } from "./C_BzFfir.js";
import { d as deleteAllFiles } from "./P5gA3V2-.js";
import { f as getConfig$1, h as updateConfig$1 } from "./Dhu6d1zL.js";
import { A as AccessControl } from "./CFsG9iJ9.js";
var root$n = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"></path></svg>`);
function PencilSolid($$anchor, $$props) {
  let className = prop($$props, "className", 8, "w-4 h-4");
  prop($$props, "strokeWidth", 8, "1.5");
  var svg = root$n();
  template_effect(() => set_class(svg, 0, clsx(className())));
  append($$anchor, svg);
}
var root_1$m = from_html(`<div class="  flex w-full justify-between"><button class=" flex rounded-md py-1.5 px-3 w-full hover:bg-gray-200 dark:hover:bg-gray-800 transition" type="button"><div class=" self-center mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3Z"></path><path fill-rule="evenodd" d="M13 6H3v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V6ZM8.75 7.75a.75.75 0 0 0-1.5 0v2.69L6.03 9.22a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l2.5-2.5a.75.75 0 1 0-1.06-1.06l-1.22 1.22V7.75Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center text-sm font-medium"> </div></button></div> <button class=" flex rounded-md py-2 px-3 w-full hover:bg-gray-200 dark:hover:bg-gray-800 transition"><div class=" self-center mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3Z"></path><path fill-rule="evenodd" d="M13 6H3v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V6ZM8.75 7.75a.75.75 0 0 0-1.5 0v2.69L6.03 9.22a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l2.5-2.5a.75.75 0 1 0-1.06-1.06l-1.22 1.22V7.75Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center text-sm font-medium"> </div></button> <button class=" flex rounded-md py-2 px-3 w-full hover:bg-gray-200 dark:hover:bg-gray-800 transition"><div class=" self-center mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3Z"></path><path fill-rule="evenodd" d="M13 6H3v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V6ZM8.75 7.75a.75.75 0 0 0-1.5 0v2.69L6.03 9.22a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l2.5-2.5a.75.75 0 1 0-1.06-1.06l-1.22 1.22V7.75Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center text-sm font-medium"> </div></button>`, 1);
var root$m = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class=" space-y-3 overflow-y-scroll scrollbar-hidden h-full"><div><div class=" mb-2 text-sm font-medium"> </div> <input id="config-json-input" hidden="" type="file" accept=".json"/> <button type="button" class=" flex rounded-md py-2 px-3 w-full hover:bg-gray-200 dark:hover:bg-gray-800 transition"><div class=" self-center mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3Z"></path><path fill-rule="evenodd" d="M13 6H3v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V6ZM8.75 7.75a.75.75 0 0 0-1.5 0v2.69L6.03 9.22a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l2.5-2.5a.75.75 0 1 0-1.06-1.06l-1.22 1.22V7.75Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center text-sm font-medium"> </div></button> <button type="button" class=" flex rounded-md py-2 px-3 w-full hover:bg-gray-200 dark:hover:bg-gray-800 transition"><div class=" self-center mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3Z"></path><path fill-rule="evenodd" d="M13 6H3v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V6ZM8.75 7.75a.75.75 0 0 0-1.5 0v2.69L6.03 9.22a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l2.5-2.5a.75.75 0 1 0-1.06-1.06l-1.22 1.22V7.75Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center text-sm font-medium"> </div></button> <hr class="border-gray-50 dark:border-gray-850 my-1"/> <!></div></div></form>`);
function Database($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $config = () => store_get(config, "$config", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const { saveAs } = fileSaver;
  const i18n = getContext("i18n");
  let saveHandler = prop($$props, "saveHandler", 8);
  const exportAllUserChats = async () => {
    let blob = new Blob([JSON.stringify(await getAllUserChats(localStorage.token))], { type: "application/json" });
    saveAs(blob, `all-chats-export-${Date.now()}.json`);
  };
  const exportUsers = async () => {
    const users = await getAllUsers(localStorage.token);
    const headers = ["id", "name", "email", "role"];
    const csv = [
      headers.join(","),
      ...users.users.map((user2) => {
        return headers.map((header) => {
          if (user2[header] === null || user2[header] === void 0) {
            return "";
          }
          return `"${String(user2[header]).replace(/"/g, '""')}"`;
        }).join(",");
      })
    ].join("\n");
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    saveAs(blob, "users.csv");
  };
  onMount(async () => {
  });
  init();
  var form = root$m();
  var div = child(form);
  var div_1 = child(div);
  var div_2 = child(div_1);
  var text2 = child(div_2, true);
  reset(div_2);
  var input = sibling(div_2, 2);
  var button = sibling(input, 2);
  var div_3 = sibling(child(button), 2);
  var text_1 = child(div_3, true);
  reset(div_3);
  reset(button);
  var button_1 = sibling(button, 2);
  var div_4 = sibling(child(button_1), 2);
  var text_2 = child(div_4, true);
  reset(div_4);
  reset(button_1);
  var node = sibling(button_1, 4);
  {
    var consequent = ($$anchor2) => {
      var fragment = root_1$m();
      var div_5 = first_child(fragment);
      var button_2 = child(div_5);
      var div_6 = sibling(child(button_2), 2);
      var text_3 = child(div_6, true);
      reset(div_6);
      reset(button_2);
      reset(div_5);
      var button_3 = sibling(div_5, 2);
      var div_7 = sibling(child(button_3), 2);
      var text_4 = child(div_7, true);
      reset(div_7);
      reset(button_3);
      var button_4 = sibling(button_3, 2);
      var div_8 = sibling(child(button_4), 2);
      var text_5 = child(div_8, true);
      reset(div_8);
      reset(button_4);
      template_effect(
        ($0, $1, $2) => {
          set_text(text_3, $0);
          set_text(text_4, $1);
          set_text(text_5, $2);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("Download Database"))),
          () => ($i18n(), untrack(() => $i18n().t("Export All Chats (All Users)"))),
          () => ($i18n(), untrack(() => $i18n().t("Export Users")))
        ]
      );
      event("click", button_2, () => {
        downloadDatabase(localStorage.token).catch((error) => {
          toast.error(`${error}`);
        });
      });
      event("click", button_3, () => {
        exportAllUserChats();
      });
      event("click", button_4, () => {
        exportUsers();
      });
      append($$anchor2, fragment);
    };
    if_block(node, ($$render) => {
      if ($config(), untrack(() => {
        var _a;
        return ((_a = $config()) == null ? void 0 : _a.features.enable_admin_export) ?? true;
      })) $$render(consequent);
    });
  }
  reset(div_1);
  reset(div);
  reset(form);
  template_effect(
    ($0, $1, $2) => {
      set_text(text2, $0);
      set_text(text_1, $1);
      set_text(text_2, $2);
    },
    [
      () => ($i18n(), untrack(() => $i18n().t("Database"))),
      () => ($i18n(), untrack(() => $i18n().t("Import Config from JSON File"))),
      () => ($i18n(), untrack(() => $i18n().t("Export Config to JSON File")))
    ]
  );
  event("change", input, (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = async (e2) => {
      const res = await importConfig(localStorage.token, JSON.parse(e2.target.result)).catch((error) => {
        toast.error(`${error}`);
      });
      if (res) {
        toast.success($i18n().t("Config imported successfully"));
      }
      e2.target.value = null;
    };
    reader.readAsText(file);
  });
  event("click", button, async () => {
    document.getElementById("config-json-input").click();
  });
  event("click", button_1, async () => {
    const config2 = await exportConfig(localStorage.token);
    const blob = new Blob([JSON.stringify(config2)], { type: "application/json" });
    saveAs(blob, `config-${Date.now()}.json`);
  });
  event("submit", form, preventDefault(async () => {
    saveHandler()();
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root_3$f = from_html(`<a target="_blank"> </a>`);
var root_4$f = from_html(`<button class=" text-xs px-3 py-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-lg font-medium" type="button"> </button>`);
var root_6$b = from_html(`<div class="mt-0.5"><!></div>`);
var root_5$a = from_html(`<a href="https://docs.openwebui.com/enterprise" target="_blank" class="text-gray-500 mt-0.5"><span class=" capitalize text-black dark:text-white"> </span> registered to <span class=" capitalize text-black dark:text-white"> </span> for <span class=" font-medium text-black dark:text-white"> </span></a> <!>`, 1);
var root_7$9 = from_html(`<a class=" text-xs hover:underline" href="https://docs.openwebui.com/enterprise" target="_blank"><span class="text-gray-500"> </span></a>`);
var root_8$a = from_html(`<option> </option>`);
var root_10$8 = from_html(`<div class=" flex w-full flex-col pr-2 mb-2.5"><div class=" text-xs font-medium"> </div> <input class="w-full mt-1 text-sm dark:text-gray-300 bg-transparent outline-hidden" type="text"/> <div class="mt-2 text-xs text-gray-400 dark:text-gray-500"><a href="https://docs.openwebui.com/getting-started/api-endpoints" target="_blank" class=" text-gray-300 font-medium underline"> </a></div></div>`);
var root_9$5 = from_html(`<div class="mb-2.5 flex w-full justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <!>`, 1);
var root_11$7 = from_html(`<div class="mt-2 text-xs"><div class=" bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-3 py-2"><div><span class=" font-medium"> </span> <span><a href="https://docs.openwebui.com/getting-started/env-configuration#jwt_expires_in" target="_blank" class=" underline"> </a></span></div></div></div>`);
var root_13$6 = from_html(`<input class="w-full bg-transparent outline-hidden py-0.5" type="number"/>`);
var root_14$4 = from_html(`<input class="w-full bg-transparent outline-hidden py-0.5" required/>`);
var root_15$4 = from_html(`<input class="w-full bg-transparent outline-hidden py-0.5" required/>`);
var root_16$8 = from_html(`<input class="w-full bg-transparent outline-hidden py-0.5" required/>`);
var root_17$5 = from_html(`<input class="w-full bg-transparent outline-hidden py-0.5" required/>`);
var root_19$4 = from_html(`<input class="w-full bg-transparent outline-hidden py-0.5"/>`);
var root_18$6 = from_html(`<div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1 mt-1"> </div> <input class="w-full bg-transparent outline-hidden py-0.5"/></div></div> <div class="flex justify-between items-center text-xs"><div class=" font-medium"> </div> <div class="mt-1"><!></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div> <div class="w-full"></div></div>`, 1);
var root_12$7 = from_html(`<div class="flex flex-col gap-1"><div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <input class="w-full bg-transparent outline-hidden py-0.5" required/></div> <div class="w-full"></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <input class="w-full bg-transparent outline-hidden py-0.5" required/></div> <div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div> <div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <!></div></div> <div class="flex w-full gap-2"><div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <input class="w-full bg-transparent outline-hidden py-0.5"/></div></div> <div class="text-xs text-gray-400 dark:text-gray-500"><a class=" text-gray-300 font-medium underline" href="https://ldap.com/ldap-filters/" target="_blank"> </a></div> <div><div class="flex justify-between items-center text-sm"><div class="  font-medium"> </div> <div class="mt-1"><!></div></div> <!></div></div>`);
var root_1$l = from_html(`<div><div class="mb-3.5"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5"><div class=" mb-1 text-xs font-medium flex space-x-2 items-center"><div> </div></div> <div class="flex w-full justify-between items-center"><div class="flex flex-col text-xs text-gray-700 dark:text-gray-200"><div class="flex gap-1"><!> <!></div> <button class=" underline flex items-center space-x-1 text-xs text-gray-500 dark:text-gray-500" type="button"><div> </div></button></div> <!></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div> <div class=" text-xs text-gray-500"> </div></div> <a class="flex-shrink-0 text-xs font-medium underline" href="https://docs.openwebui.com/" target="_blank"> </a></div> <div class="mt-1"><div class="flex space-x-1"><a href="https://discord.gg/5rJgQTnV4s" target="_blank"><img alt="Discord" src="https://img.shields.io/badge/Discord-Open_WebUI-blue?logo=discord&amp;logoColor=white"/></a> <a href="https://twitter.com/OpenWebUI" target="_blank"><img alt="X (formerly Twitter) Follow" src="https://img.shields.io/twitter/follow/OpenWebUI"/></a> <a href="https://github.com/open-webui/open-webui" target="_blank"><img alt="Github Repo" src="https://img.shields.io/github/stars/open-webui/open-webui?style=social&amp;label=Star us on Github"/></a></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div> <!></div></div></div></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option></select></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option>None</option><!></select></div></div> <div class=" mb-2.5 flex w-full justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5"><div class=" self-center text-xs font-medium mb-2"> </div> <!></div> <div class="mb-2.5"><div class=" self-center text-xs font-medium mb-2"> </div> <!></div> <div class="mb-2.5 flex w-full justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <!> <div class=" mb-2.5 w-full justify-between"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div></div> <div class="flex mt-2 space-x-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text"/></div> <div class="mt-2 text-xs text-gray-400 dark:text-gray-500"> <span class=" text-gray-300 font-medium"> </span></div> <!></div> <div class=" space-y-3"><div class="mt-2 space-y-2 pr-1.5"><div class="flex justify-between items-center text-sm"><div class="  font-medium"> </div> <div class="mt-1"><!></div></div> <!></div></div></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5 flex w-full items-center justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between pr-2"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5"><div class=" self-center text-xs font-medium mb-2"> </div> <!></div> <div class="mb-2.5 w-full justify-between"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div></div> <div class="flex mt-2 space-x-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text"/></div> <div class="mt-2 text-xs text-gray-400 dark:text-gray-500"> </div></div> <div class=" w-full justify-between"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div></div> <div class="flex mt-2 space-x-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text"/></div></div></div></div>`);
var root$l = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class="space-y-3 overflow-y-scroll scrollbar-hidden h-full"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`);
function General($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $config = () => store_get(config, "$config", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let saveHandler = prop($$props, "saveHandler", 8);
  let updateAvailable = mutable_source(null);
  let version = mutable_source({ current: "", latest: "" });
  let adminConfig = mutable_source(null);
  let webhookUrl = mutable_source("");
  let groups = mutable_source([]);
  let ENABLE_LDAP = mutable_source(false);
  let LDAP_SERVER = mutable_source({
    label: "",
    host: "",
    port: "",
    attribute_for_mail: "mail",
    attribute_for_username: "uid",
    app_dn: "",
    app_dn_password: "",
    search_base: "",
    search_filters: "",
    use_tls: false,
    certificate_path: "",
    ciphers: ""
  });
  const checkForVersionUpdates = async () => {
    set(updateAvailable, null);
    set(version, await getVersionUpdates(localStorage.token).catch((error) => {
      return { current: WEBUI_VERSION, latest: WEBUI_VERSION };
    }));
    console.info(get(version));
    set(updateAvailable, compareVersion(get(version).latest, get(version).current));
    console.info(get(updateAvailable));
  };
  const updateLdapServerHandler = async () => {
    if (!get(ENABLE_LDAP)) return;
    const res = await updateLdapServer(localStorage.token, get(LDAP_SERVER)).catch((error) => {
      toast.error(`${error}`);
      return null;
    });
    if (res) {
      toast.success($i18n().t("LDAP server updated"));
    }
  };
  const updateHandler = async () => {
    set(webhookUrl, await updateWebhookUrl(localStorage.token, get(webhookUrl)));
    const res = await updateAdminConfig(localStorage.token, get(adminConfig));
    await updateLdapConfig(localStorage.token, get(ENABLE_LDAP));
    await updateLdapServerHandler();
    if (res) {
      saveHandler()();
    } else {
      toast.error($i18n().t("Failed to update settings"));
    }
  };
  onMount(async () => {
    var _a, _b;
    if ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_version_update_check) {
      checkForVersionUpdates();
    }
    await Promise.all([
      (async () => {
        set(adminConfig, await getAdminConfig(localStorage.token));
      })(),
      (async () => {
        set(webhookUrl, await getWebhookUrl(localStorage.token));
      })(),
      (async () => {
        set(LDAP_SERVER, await getLdapServer(localStorage.token));
      })(),
      (async () => {
        set(groups, await getGroups(localStorage.token));
      })()
    ]);
    const ldapConfig = await getLdapConfig(localStorage.token);
    set(ENABLE_LDAP, ldapConfig.ENABLE_LDAP);
  });
  init();
  var form = root$l();
  var div = child(form);
  var node = child(div);
  {
    var consequent_9 = ($$anchor2) => {
      var div_1 = root_1$l();
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text$1 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var div_6 = child(div_5);
      var text_1 = child(div_6, true);
      reset(div_6);
      reset(div_5);
      var div_7 = sibling(div_5, 2);
      var div_8 = child(div_7);
      var div_9 = child(div_8);
      var node_1 = child(div_9);
      Tooltip(node_1, {
        get content() {
          return WEBUI_BUILD_HASH;
        },
        children: ($$anchor3, $$slotProps) => {
          next();
          var text_2 = text();
          template_effect(() => set_text(text_2, `v${WEBUI_VERSION}`));
          append($$anchor3, text_2);
        },
        $$slots: { default: true }
      });
      var node_2 = sibling(node_1, 2);
      {
        var consequent = ($$anchor3) => {
          var a = root_3$f();
          var text_3 = child(a, true);
          reset(a);
          template_effect(
            ($0) => {
              set_attribute(a, "href", `https://github.com/open-webui/open-webui/releases/tag/v${(get(version), untrack(() => get(version).latest)) ?? ""}`);
              set_text(text_3, $0);
            },
            [
              () => (get(updateAvailable), $i18n(), get(version), untrack(() => get(updateAvailable) === null ? $i18n().t("Checking for updates...") : get(updateAvailable) ? `(v${get(version).latest} ${$i18n().t("available!")})` : $i18n().t("(latest)")))
            ]
          );
          append($$anchor3, a);
        };
        if_block(node_2, ($$render) => {
          if ($config(), untrack(() => {
            var _a, _b;
            return (_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_version_update_check;
          })) $$render(consequent);
        });
      }
      reset(div_9);
      var button = sibling(div_9, 2);
      var div_10 = child(button);
      var text_4 = child(div_10, true);
      reset(div_10);
      reset(button);
      reset(div_8);
      var node_3 = sibling(div_8, 2);
      {
        var consequent_1 = ($$anchor3) => {
          var button_1 = root_4$f();
          var text_5 = child(button_1, true);
          reset(button_1);
          template_effect(($0) => set_text(text_5, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Check for updates")))
          ]);
          event("click", button_1, () => {
            checkForVersionUpdates();
          });
          append($$anchor3, button_1);
        };
        if_block(node_3, ($$render) => {
          if ($config(), untrack(() => {
            var _a, _b;
            return (_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_version_update_check;
          })) $$render(consequent_1);
        });
      }
      reset(div_7);
      reset(div_4);
      var div_11 = sibling(div_4, 2);
      var div_12 = child(div_11);
      var div_13 = child(div_12);
      var div_14 = child(div_13);
      var text_6 = child(div_14, true);
      reset(div_14);
      var div_15 = sibling(div_14, 2);
      var text_7 = child(div_15, true);
      reset(div_15);
      reset(div_13);
      var a_1 = sibling(div_13, 2);
      var text_8 = child(a_1, true);
      reset(a_1);
      reset(div_12);
      next(2);
      reset(div_11);
      var div_16 = sibling(div_11, 2);
      var div_17 = child(div_16);
      var div_18 = child(div_17);
      var div_19 = child(div_18);
      var text_9 = child(div_19, true);
      reset(div_19);
      var node_4 = sibling(div_19, 2);
      {
        var consequent_3 = ($$anchor3) => {
          var fragment_1 = root_5$a();
          var a_2 = first_child(fragment_1);
          var span = child(a_2);
          var text_10 = child(span);
          reset(span);
          var span_1 = sibling(span, 2);
          var text_11 = child(span_1, true);
          reset(span_1);
          var span_2 = sibling(span_1, 2);
          var text_12 = child(span_2);
          reset(span_2);
          reset(a_2);
          var node_5 = sibling(a_2, 2);
          {
            var consequent_2 = ($$anchor4) => {
              var div_20 = root_6$b();
              var node_6 = child(div_20);
              html(node_6, () => (deep_read_state(purify), $config(), untrack(() => {
                var _a, _b;
                return purify.sanitize((_b = (_a = $config()) == null ? void 0 : _a.license_metadata) == null ? void 0 : _b.html);
              })));
              reset(div_20);
              append($$anchor4, div_20);
            };
            if_block(node_5, ($$render) => {
              if ($config(), untrack(() => {
                var _a, _b;
                return (_b = (_a = $config()) == null ? void 0 : _a.license_metadata) == null ? void 0 : _b.html;
              })) $$render(consequent_2);
            });
          }
          template_effect(() => {
            set_text(text_10, `${($config(), untrack(() => {
              var _a, _b;
              return (_b = (_a = $config()) == null ? void 0 : _a.license_metadata) == null ? void 0 : _b.type;
            })) ?? ""}
											license`);
            set_text(text_11, ($config(), untrack(() => {
              var _a, _b;
              return (_b = (_a = $config()) == null ? void 0 : _a.license_metadata) == null ? void 0 : _b.organization_name;
            })));
            set_text(text_12, `${($config(), untrack(() => {
              var _a, _b;
              return ((_b = (_a = $config()) == null ? void 0 : _a.license_metadata) == null ? void 0 : _b.seats) ?? "Unlimited";
            })) ?? ""} users.`);
          });
          append($$anchor3, fragment_1);
        };
        var alternate = ($$anchor3) => {
          var a_3 = root_7$9();
          var span_3 = child(a_3);
          var text_13 = child(span_3, true);
          reset(span_3);
          reset(a_3);
          template_effect(($0) => set_text(text_13, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Upgrade to a licensed plan for enhanced capabilities, including custom theming and branding, and dedicated support.")))
          ]);
          append($$anchor3, a_3);
        };
        if_block(node_4, ($$render) => {
          if ($config(), untrack(() => {
            var _a;
            return (_a = $config()) == null ? void 0 : _a.license_metadata;
          })) $$render(consequent_3);
          else $$render(alternate, false);
        });
      }
      reset(div_18);
      reset(div_17);
      reset(div_16);
      reset(div_2);
      var div_21 = sibling(div_2, 2);
      var div_22 = child(div_21);
      var text_14 = child(div_22, true);
      reset(div_22);
      var div_23 = sibling(div_22, 4);
      var div_24 = child(div_23);
      var text_15 = child(div_24, true);
      reset(div_24);
      var div_25 = sibling(div_24, 2);
      var select = child(div_25);
      template_effect(() => {
        get(adminConfig);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option = child(select);
      var text_16 = child(option, true);
      reset(option);
      option.value = option.__value = "pending";
      var option_1 = sibling(option);
      var text_17 = child(option_1, true);
      reset(option_1);
      option_1.value = option_1.__value = "user";
      var option_2 = sibling(option_1);
      var text_18 = child(option_2, true);
      reset(option_2);
      option_2.value = option_2.__value = "admin";
      reset(select);
      reset(div_25);
      reset(div_23);
      var div_26 = sibling(div_23, 2);
      var div_27 = child(div_26);
      var text_19 = child(div_27, true);
      reset(div_27);
      var div_28 = sibling(div_27, 2);
      var select_1 = child(div_28);
      template_effect(() => {
        get(adminConfig);
        invalidate_inner_signals(() => {
          $i18n();
          get(groups);
        });
      });
      var option_3 = child(select_1);
      option_3.value = option_3.__value = "";
      var node_7 = sibling(option_3);
      each(node_7, 1, () => get(groups), index, ($$anchor3, group) => {
        var option_4 = root_8$a();
        var text_20 = child(option_4, true);
        reset(option_4);
        var option_4_value = {};
        template_effect(() => {
          set_text(text_20, (get(group), untrack(() => get(group).name)));
          if (option_4_value !== (option_4_value = (get(group), untrack(() => get(group).id)))) {
            option_4.value = (option_4.__value = (get(group), untrack(() => get(group).id))) ?? "";
          }
        });
        append($$anchor3, option_4);
      });
      reset(select_1);
      reset(div_28);
      reset(div_26);
      var div_29 = sibling(div_26, 2);
      var div_30 = child(div_29);
      var text_21 = child(div_30, true);
      reset(div_30);
      var node_8 = sibling(div_30, 2);
      Switch_1(node_8, {
        get state() {
          return get(adminConfig).ENABLE_SIGNUP;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_SIGNUP = $$value);
        },
        $$legacy: true
      });
      reset(div_29);
      var div_31 = sibling(div_29, 2);
      var div_32 = child(div_31);
      var text_22 = child(div_32, true);
      reset(div_32);
      var node_9 = sibling(div_32, 2);
      Switch_1(node_9, {
        get state() {
          return get(adminConfig).SHOW_ADMIN_DETAILS;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).SHOW_ADMIN_DETAILS = $$value);
        },
        $$legacy: true
      });
      reset(div_31);
      var div_33 = sibling(div_31, 2);
      var div_34 = child(div_33);
      var text_23 = child(div_34, true);
      reset(div_34);
      var node_10 = sibling(div_34, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter a title for the pending user info overlay. Leave empty for default."))));
        Textarea(node_10, {
          get placeholder() {
            return get($0);
          },
          get value() {
            return get(adminConfig).PENDING_USER_OVERLAY_TITLE;
          },
          set value($$value) {
            mutate(adminConfig, get(adminConfig).PENDING_USER_OVERLAY_TITLE = $$value);
          },
          $$legacy: true
        });
      }
      reset(div_33);
      var div_35 = sibling(div_33, 2);
      var div_36 = child(div_35);
      var text_24 = child(div_36, true);
      reset(div_36);
      var node_11 = sibling(div_36, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter content for the pending user info overlay. Leave empty for default."))));
        Textarea(node_11, {
          get placeholder() {
            return get($0);
          },
          get value() {
            return get(adminConfig).PENDING_USER_OVERLAY_CONTENT;
          },
          set value($$value) {
            mutate(adminConfig, get(adminConfig).PENDING_USER_OVERLAY_CONTENT = $$value);
          },
          $$legacy: true
        });
      }
      reset(div_35);
      var div_37 = sibling(div_35, 2);
      var div_38 = child(div_37);
      var text_25 = child(div_38, true);
      reset(div_38);
      var node_12 = sibling(div_38, 2);
      Switch_1(node_12, {
        get state() {
          return get(adminConfig).ENABLE_API_KEYS;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_API_KEYS = $$value);
        },
        $$legacy: true
      });
      reset(div_37);
      var node_13 = sibling(div_37, 2);
      {
        var consequent_5 = ($$anchor3) => {
          var fragment_2 = root_9$5();
          var div_39 = first_child(fragment_2);
          var div_40 = child(div_39);
          var text_26 = child(div_40, true);
          reset(div_40);
          var node_14 = sibling(div_40, 2);
          Switch_1(node_14, {
            get state() {
              return get(adminConfig).ENABLE_API_KEYS_ENDPOINT_RESTRICTIONS;
            },
            set state($$value) {
              mutate(adminConfig, get(adminConfig).ENABLE_API_KEYS_ENDPOINT_RESTRICTIONS = $$value);
            },
            $$legacy: true
          });
          reset(div_39);
          var node_15 = sibling(div_39, 2);
          {
            var consequent_4 = ($$anchor4) => {
              var div_41 = root_10$8();
              var div_42 = child(div_41);
              var text_27 = child(div_42, true);
              reset(div_42);
              var input = sibling(div_42, 2);
              remove_input_defaults(input);
              set_attribute(input, "placeholder", `e.g.) /api/v1/messages, /api/v1/channels`);
              var div_43 = sibling(input, 2);
              var a_4 = child(div_43);
              var text_28 = child(a_4, true);
              reset(a_4);
              reset(div_43);
              reset(div_41);
              template_effect(
                ($0, $1) => {
                  set_text(text_27, $0);
                  set_text(text_28, $1);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Allowed Endpoints"))),
                  () => ($i18n(), untrack(() => $i18n().t("To learn more about available endpoints, visit our documentation.")))
                ]
              );
              bind_value(input, () => get(adminConfig).API_KEYS_ALLOWED_ENDPOINTS, ($$value) => mutate(adminConfig, get(adminConfig).API_KEYS_ALLOWED_ENDPOINTS = $$value));
              append($$anchor4, div_41);
            };
            if_block(node_15, ($$render) => {
              if (get(adminConfig), untrack(() => {
                var _a;
                return (_a = get(adminConfig)) == null ? void 0 : _a.ENABLE_API_KEYS_ENDPOINT_RESTRICTIONS;
              })) $$render(consequent_4);
            });
          }
          template_effect(($0) => set_text(text_26, $0), [
            () => ($i18n(), untrack(() => $i18n().t("API Key Endpoint Restrictions")))
          ]);
          append($$anchor3, fragment_2);
        };
        if_block(node_13, ($$render) => {
          if (get(adminConfig), untrack(() => {
            var _a;
            return (_a = get(adminConfig)) == null ? void 0 : _a.ENABLE_API_KEYS;
          })) $$render(consequent_5);
        });
      }
      var div_44 = sibling(node_13, 2);
      var div_45 = child(div_44);
      var div_46 = child(div_45);
      var text_29 = child(div_46, true);
      reset(div_46);
      reset(div_45);
      var div_47 = sibling(div_45, 2);
      var input_1 = child(div_47);
      remove_input_defaults(input_1);
      set_attribute(input_1, "placeholder", `e.g.) "30m","1h", "10d". `);
      reset(div_47);
      var div_48 = sibling(div_47, 2);
      var text_30 = child(div_48);
      var span_4 = sibling(text_30);
      var text_31 = child(span_4, true);
      reset(span_4);
      reset(div_48);
      var node_16 = sibling(div_48, 2);
      {
        var consequent_6 = ($$anchor3) => {
          var div_49 = root_11$7();
          var div_50 = child(div_49);
          var div_51 = child(div_50);
          var span_5 = child(div_51);
          var text_32 = child(span_5);
          reset(span_5);
          var span_6 = sibling(span_5, 2);
          var a_5 = child(span_6);
          var text_33 = child(a_5, true);
          reset(a_5);
          reset(span_6);
          reset(div_51);
          reset(div_50);
          reset(div_49);
          template_effect(
            ($0, $1) => {
              set_text(text_32, `${$0 ?? ""}:`);
              set_text(text_33, $1);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Warning"))),
              () => ($i18n(), untrack(() => $i18n().t("No expiration can pose security risks.")))
            ]
          );
          append($$anchor3, div_49);
        };
        if_block(node_16, ($$render) => {
          if (get(adminConfig), untrack(() => get(adminConfig).JWT_EXPIRES_IN === "-1")) $$render(consequent_6);
        });
      }
      reset(div_44);
      var div_52 = sibling(div_44, 2);
      var div_53 = child(div_52);
      var div_54 = child(div_53);
      var div_55 = child(div_54);
      var text_34 = child(div_55, true);
      reset(div_55);
      var div_56 = sibling(div_55, 2);
      var node_17 = child(div_56);
      Switch_1(node_17, {
        get state() {
          return get(ENABLE_LDAP);
        },
        set state($$value) {
          set(ENABLE_LDAP, $$value);
        },
        $$legacy: true
      });
      reset(div_56);
      reset(div_54);
      var node_18 = sibling(div_54, 2);
      {
        var consequent_8 = ($$anchor3) => {
          var div_57 = root_12$7();
          var div_58 = child(div_57);
          var div_59 = child(div_58);
          var div_60 = child(div_59);
          var text_35 = child(div_60, true);
          reset(div_60);
          var input_2 = sibling(div_60, 2);
          remove_input_defaults(input_2);
          reset(div_59);
          next(2);
          reset(div_58);
          var div_61 = sibling(div_58, 2);
          var div_62 = child(div_61);
          var div_63 = child(div_62);
          var text_36 = child(div_63, true);
          reset(div_63);
          var input_3 = sibling(div_63, 2);
          remove_input_defaults(input_3);
          reset(div_62);
          var div_64 = sibling(div_62, 2);
          var div_65 = child(div_64);
          var text_37 = child(div_65, true);
          reset(div_65);
          var node_19 = sibling(div_65, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Default to 389 or 636 if TLS is enabled"))));
            Tooltip(node_19, {
              placement: "top-start",
              get content() {
                return get($0);
              },
              className: "w-full",
              children: ($$anchor4, $$slotProps) => {
                var input_4 = root_13$6();
                remove_input_defaults(input_4);
                template_effect(($02) => set_attribute(input_4, "placeholder", $02), [
                  () => ($i18n(), untrack(() => $i18n().t("Enter server port")))
                ]);
                bind_value(input_4, () => get(LDAP_SERVER).port, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).port = $$value));
                append($$anchor4, input_4);
              },
              $$slots: { default: true }
            });
          }
          reset(div_64);
          reset(div_61);
          var div_66 = sibling(div_61, 2);
          var div_67 = child(div_66);
          var div_68 = child(div_67);
          var text_38 = child(div_68, true);
          reset(div_68);
          var node_20 = sibling(div_68, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("The Application Account DN you bind with for search"))));
            Tooltip(node_20, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input_5 = root_14$4();
                remove_input_defaults(input_5);
                template_effect(($02) => set_attribute(input_5, "placeholder", $02), [
                  () => ($i18n(), untrack(() => $i18n().t("Enter Application DN")))
                ]);
                bind_value(input_5, () => get(LDAP_SERVER).app_dn, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).app_dn = $$value));
                append($$anchor4, input_5);
              },
              $$slots: { default: true }
            });
          }
          reset(div_67);
          var div_69 = sibling(div_67, 2);
          var div_70 = child(div_69);
          var text_39 = child(div_70, true);
          reset(div_70);
          var node_21 = sibling(div_70, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Application DN Password"))));
            SensitiveInput(node_21, {
              get placeholder() {
                return get($0);
              },
              get value() {
                return get(LDAP_SERVER).app_dn_password;
              },
              set value($$value) {
                mutate(LDAP_SERVER, get(LDAP_SERVER).app_dn_password = $$value);
              },
              $$legacy: true
            });
          }
          reset(div_69);
          reset(div_66);
          var div_71 = sibling(div_66, 2);
          var div_72 = child(div_71);
          var div_73 = child(div_72);
          var text_40 = child(div_73, true);
          reset(div_73);
          var node_22 = sibling(div_73, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("The LDAP attribute that maps to the mail that users use to sign in."))));
            Tooltip(node_22, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input_6 = root_15$4();
                remove_input_defaults(input_6);
                template_effect(($02) => set_attribute(input_6, "placeholder", $02), [() => ($i18n(), untrack(() => $i18n().t("Example: mail")))]);
                bind_value(input_6, () => get(LDAP_SERVER).attribute_for_mail, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).attribute_for_mail = $$value));
                append($$anchor4, input_6);
              },
              $$slots: { default: true }
            });
          }
          reset(div_72);
          reset(div_71);
          var div_74 = sibling(div_71, 2);
          var div_75 = child(div_74);
          var div_76 = child(div_75);
          var text_41 = child(div_76, true);
          reset(div_76);
          var node_23 = sibling(div_76, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("The LDAP attribute that maps to the username that users use to sign in."))));
            Tooltip(node_23, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input_7 = root_16$8();
                remove_input_defaults(input_7);
                template_effect(($02) => set_attribute(input_7, "placeholder", $02), [
                  () => ($i18n(), untrack(() => $i18n().t("Example: sAMAccountName or uid or userPrincipalName")))
                ]);
                bind_value(input_7, () => get(LDAP_SERVER).attribute_for_username, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).attribute_for_username = $$value));
                append($$anchor4, input_7);
              },
              $$slots: { default: true }
            });
          }
          reset(div_75);
          reset(div_74);
          var div_77 = sibling(div_74, 2);
          var div_78 = child(div_77);
          var div_79 = child(div_78);
          var text_42 = child(div_79, true);
          reset(div_79);
          var node_24 = sibling(div_79, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("The base to search for users"))));
            Tooltip(node_24, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input_8 = root_17$5();
                remove_input_defaults(input_8);
                template_effect(($02) => set_attribute(input_8, "placeholder", $02), [
                  () => ($i18n(), untrack(() => $i18n().t("Example: ou=users,dc=foo,dc=example")))
                ]);
                bind_value(input_8, () => get(LDAP_SERVER).search_base, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).search_base = $$value));
                append($$anchor4, input_8);
              },
              $$slots: { default: true }
            });
          }
          reset(div_78);
          reset(div_77);
          var div_80 = sibling(div_77, 2);
          var div_81 = child(div_80);
          var div_82 = child(div_81);
          var text_43 = child(div_82, true);
          reset(div_82);
          var input_9 = sibling(div_82, 2);
          remove_input_defaults(input_9);
          reset(div_81);
          reset(div_80);
          var div_83 = sibling(div_80, 2);
          var a_6 = child(div_83);
          var text_44 = child(a_6, true);
          reset(a_6);
          reset(div_83);
          var div_84 = sibling(div_83, 2);
          var div_85 = child(div_84);
          var div_86 = child(div_85);
          var text_45 = child(div_86, true);
          reset(div_86);
          var div_87 = sibling(div_86, 2);
          var node_25 = child(div_87);
          Switch_1(node_25, {
            get state() {
              return get(LDAP_SERVER).use_tls;
            },
            set state($$value) {
              mutate(LDAP_SERVER, get(LDAP_SERVER).use_tls = $$value);
            },
            $$legacy: true
          });
          reset(div_87);
          reset(div_85);
          var node_26 = sibling(div_85, 2);
          {
            var consequent_7 = ($$anchor4) => {
              var fragment_3 = root_18$6();
              var div_88 = first_child(fragment_3);
              var div_89 = child(div_88);
              var div_90 = child(div_89);
              var text_46 = child(div_90, true);
              reset(div_90);
              var input_10 = sibling(div_90, 2);
              remove_input_defaults(input_10);
              reset(div_89);
              reset(div_88);
              var div_91 = sibling(div_88, 2);
              var div_92 = child(div_91);
              var text_47 = child(div_92, true);
              reset(div_92);
              var div_93 = sibling(div_92, 2);
              var node_27 = child(div_93);
              Switch_1(node_27, {
                get state() {
                  return get(LDAP_SERVER).validate_cert;
                },
                set state($$value) {
                  mutate(LDAP_SERVER, get(LDAP_SERVER).validate_cert = $$value);
                },
                $$legacy: true
              });
              reset(div_93);
              reset(div_91);
              var div_94 = sibling(div_91, 2);
              var div_95 = child(div_94);
              var div_96 = child(div_95);
              var text_48 = child(div_96, true);
              reset(div_96);
              var node_28 = sibling(div_96, 2);
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Default to ALL"))));
                Tooltip(node_28, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    var input_11 = root_19$4();
                    remove_input_defaults(input_11);
                    template_effect(($02) => set_attribute(input_11, "placeholder", $02), [() => ($i18n(), untrack(() => $i18n().t("Example: ALL")))]);
                    bind_value(input_11, () => get(LDAP_SERVER).ciphers, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).ciphers = $$value));
                    append($$anchor5, input_11);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_95);
              next(2);
              reset(div_94);
              template_effect(
                ($0, $1, $2, $3) => {
                  set_text(text_46, $0);
                  set_attribute(input_10, "placeholder", $1);
                  set_text(text_47, $2);
                  set_text(text_48, $3);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Certificate Path"))),
                  () => ($i18n(), untrack(() => $i18n().t("Enter certificate path"))),
                  () => ($i18n(), untrack(() => $i18n().t("Validate certificate"))),
                  () => ($i18n(), untrack(() => $i18n().t("Ciphers")))
                ]
              );
              bind_value(input_10, () => get(LDAP_SERVER).certificate_path, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).certificate_path = $$value));
              append($$anchor4, fragment_3);
            };
            if_block(node_26, ($$render) => {
              if (get(LDAP_SERVER), untrack(() => get(LDAP_SERVER).use_tls)) $$render(consequent_7);
            });
          }
          reset(div_84);
          reset(div_57);
          template_effect(
            ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) => {
              set_text(text_35, $0);
              set_attribute(input_2, "placeholder", $1);
              set_text(text_36, $2);
              set_attribute(input_3, "placeholder", $3);
              set_text(text_37, $4);
              set_text(text_38, $5);
              set_text(text_39, $6);
              set_text(text_40, $7);
              set_text(text_41, $8);
              set_text(text_42, $9);
              set_text(text_43, $10);
              set_attribute(input_9, "placeholder", $11);
              set_text(text_44, $12);
              set_text(text_45, $13);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Label"))),
              () => ($i18n(), untrack(() => $i18n().t("Enter server label"))),
              () => ($i18n(), untrack(() => $i18n().t("Host"))),
              () => ($i18n(), untrack(() => $i18n().t("Enter server host"))),
              () => ($i18n(), untrack(() => $i18n().t("Port"))),
              () => ($i18n(), untrack(() => $i18n().t("Application DN"))),
              () => ($i18n(), untrack(() => $i18n().t("Application DN Password"))),
              () => ($i18n(), untrack(() => $i18n().t("Attribute for Mail"))),
              () => ($i18n(), untrack(() => $i18n().t("Attribute for Username"))),
              () => ($i18n(), untrack(() => $i18n().t("Search Base"))),
              () => ($i18n(), untrack(() => $i18n().t("Search Filters"))),
              () => ($i18n(), untrack(() => $i18n().t("Example: (&(objectClass=inetOrgPerson)(uid=%s))"))),
              () => ($i18n(), untrack(() => $i18n().t("Click here for filter guides."))),
              () => ($i18n(), untrack(() => $i18n().t("TLS")))
            ]
          );
          bind_value(input_2, () => get(LDAP_SERVER).label, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).label = $$value));
          bind_value(input_3, () => get(LDAP_SERVER).host, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).host = $$value));
          bind_value(input_9, () => get(LDAP_SERVER).search_filters, ($$value) => mutate(LDAP_SERVER, get(LDAP_SERVER).search_filters = $$value));
          append($$anchor3, div_57);
        };
        if_block(node_18, ($$render) => {
          if (get(ENABLE_LDAP)) $$render(consequent_8);
        });
      }
      reset(div_53);
      reset(div_52);
      reset(div_21);
      var div_97 = sibling(div_21, 2);
      var div_98 = child(div_97);
      var text_49 = child(div_98, true);
      reset(div_98);
      var div_99 = sibling(div_98, 4);
      var div_100 = child(div_99);
      var text_50 = child(div_100, true);
      reset(div_100);
      var node_29 = sibling(div_100, 2);
      Switch_1(node_29, {
        get state() {
          return get(adminConfig).ENABLE_COMMUNITY_SHARING;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_COMMUNITY_SHARING = $$value);
        },
        $$legacy: true
      });
      reset(div_99);
      var div_101 = sibling(div_99, 2);
      var div_102 = child(div_101);
      var text_51 = child(div_102, true);
      reset(div_102);
      var node_30 = sibling(div_102, 2);
      Switch_1(node_30, {
        get state() {
          return get(adminConfig).ENABLE_MESSAGE_RATING;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_MESSAGE_RATING = $$value);
        },
        $$legacy: true
      });
      reset(div_101);
      var div_103 = sibling(div_101, 2);
      var div_104 = child(div_103);
      var text_52 = child(div_104);
      reset(div_104);
      var node_31 = sibling(div_104, 2);
      Switch_1(node_31, {
        get state() {
          return get(adminConfig).ENABLE_NOTES;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_NOTES = $$value);
        },
        $$legacy: true
      });
      reset(div_103);
      var div_105 = sibling(div_103, 2);
      var div_106 = child(div_105);
      var text_53 = child(div_106);
      reset(div_106);
      var node_32 = sibling(div_106, 2);
      Switch_1(node_32, {
        get state() {
          return get(adminConfig).ENABLE_CHANNELS;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_CHANNELS = $$value);
        },
        $$legacy: true
      });
      reset(div_105);
      var div_107 = sibling(div_105, 2);
      var div_108 = child(div_107);
      var text_54 = child(div_108, true);
      reset(div_108);
      var node_33 = sibling(div_108, 2);
      Switch_1(node_33, {
        get state() {
          return get(adminConfig).ENABLE_USER_WEBHOOKS;
        },
        set state($$value) {
          mutate(adminConfig, get(adminConfig).ENABLE_USER_WEBHOOKS = $$value);
        },
        $$legacy: true
      });
      reset(div_107);
      var div_109 = sibling(div_107, 2);
      var div_110 = child(div_109);
      var text_55 = child(div_110, true);
      reset(div_110);
      var node_34 = sibling(div_110, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter a watermark for the response. Leave empty for none."))));
        Textarea(node_34, {
          get placeholder() {
            return get($0);
          },
          get value() {
            return get(adminConfig).RESPONSE_WATERMARK;
          },
          set value($$value) {
            mutate(adminConfig, get(adminConfig).RESPONSE_WATERMARK = $$value);
          },
          $$legacy: true
        });
      }
      reset(div_109);
      var div_111 = sibling(div_109, 2);
      var div_112 = child(div_111);
      var div_113 = child(div_112);
      var text_56 = child(div_113, true);
      reset(div_113);
      reset(div_112);
      var div_114 = sibling(div_112, 2);
      var input_12 = child(div_114);
      remove_input_defaults(input_12);
      set_attribute(input_12, "placeholder", `e.g.) "http://localhost:3000"`);
      reset(div_114);
      var div_115 = sibling(div_114, 2);
      var text_57 = child(div_115, true);
      reset(div_115);
      reset(div_111);
      var div_116 = sibling(div_111, 2);
      var div_117 = child(div_116);
      var div_118 = child(div_117);
      var text_58 = child(div_118, true);
      reset(div_118);
      reset(div_117);
      var div_119 = sibling(div_117, 2);
      var input_13 = child(div_119);
      remove_input_defaults(input_13);
      set_attribute(input_13, "placeholder", `https://example.com/webhook`);
      reset(div_119);
      reset(div_116);
      reset(div_97);
      reset(div_1);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35) => {
          set_text(text$1, $0);
          set_text(text_1, $1);
          set_text(text_4, $2);
          set_text(text_6, $3);
          set_text(text_7, $4);
          set_text(text_8, $5);
          set_text(text_9, $6);
          set_text(text_14, $7);
          set_text(text_15, $8);
          set_attribute(select, "placeholder", $9);
          set_text(text_16, $10);
          set_text(text_17, $11);
          set_text(text_18, $12);
          set_text(text_19, $13);
          set_attribute(select_1, "placeholder", $14);
          set_text(text_21, $15);
          set_text(text_22, $16);
          set_text(text_23, $17);
          set_text(text_24, $18);
          set_text(text_25, $19);
          set_text(text_29, $20);
          set_text(text_30, `${$21 ?? ""} `);
          set_text(text_31, $22);
          set_text(text_34, $23);
          set_text(text_49, $24);
          set_text(text_50, $25);
          set_text(text_51, $26);
          set_text(text_52, `${$27 ?? ""} (${$28 ?? ""})`);
          set_text(text_53, `${$29 ?? ""} (${$30 ?? ""})`);
          set_text(text_54, $31);
          set_text(text_55, $32);
          set_text(text_56, $33);
          set_text(text_57, $34);
          set_text(text_58, $35);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("General"))),
          () => ($i18n(), untrack(() => $i18n().t("Version"))),
          () => ($i18n(), untrack(() => $i18n().t("See what's new"))),
          () => ($i18n(), untrack(() => $i18n().t("Help"))),
          () => ($i18n(), untrack(() => $i18n().t("Discover how to use Open WebUI and seek support from the community."))),
          () => ($i18n(), untrack(() => $i18n().t("Documentation"))),
          () => ($i18n(), untrack(() => $i18n().t("License"))),
          () => ($i18n(), untrack(() => $i18n().t("Authentication"))),
          () => ($i18n(), untrack(() => $i18n().t("Default User Role"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a role"))),
          () => ($i18n(), untrack(() => $i18n().t("pending"))),
          () => ($i18n(), untrack(() => $i18n().t("user"))),
          () => ($i18n(), untrack(() => $i18n().t("admin"))),
          () => ($i18n(), untrack(() => $i18n().t("Default Group"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a group"))),
          () => ($i18n(), untrack(() => $i18n().t("Enable New Sign Ups"))),
          () => ($i18n(), untrack(() => $i18n().t("Show Admin Details in Account Pending Overlay"))),
          () => ($i18n(), untrack(() => $i18n().t("Pending User Overlay Title"))),
          () => ($i18n(), untrack(() => $i18n().t("Pending User Overlay Content"))),
          () => ($i18n(), untrack(() => $i18n().t("Enable API Keys"))),
          () => ($i18n(), untrack(() => $i18n().t("JWT Expiration"))),
          () => ($i18n(), untrack(() => $i18n().t("Valid time units:"))),
          () => ($i18n(), untrack(() => $i18n().t("'s', 'm', 'h', 'd', 'w' or '-1' for no expiration."))),
          () => ($i18n(), untrack(() => $i18n().t("LDAP"))),
          () => ($i18n(), untrack(() => $i18n().t("Features"))),
          () => ($i18n(), untrack(() => $i18n().t("Enable Community Sharing"))),
          () => ($i18n(), untrack(() => $i18n().t("Enable Message Rating"))),
          () => ($i18n(), untrack(() => $i18n().t("Notes"))),
          () => ($i18n(), untrack(() => $i18n().t("Beta"))),
          () => ($i18n(), untrack(() => $i18n().t("Channels"))),
          () => ($i18n(), untrack(() => $i18n().t("Beta"))),
          () => ($i18n(), untrack(() => $i18n().t("User Webhooks"))),
          () => ($i18n(), untrack(() => $i18n().t("Response Watermark"))),
          () => ($i18n(), untrack(() => $i18n().t("WebUI URL"))),
          () => ($i18n(), untrack(() => $i18n().t("Enter the public URL of your WebUI. This URL will be used to generate links in the notifications."))),
          () => ($i18n(), untrack(() => $i18n().t("Webhook URL")))
        ]
      );
      event("click", button, () => {
        showChangelog.set(true);
      });
      bind_select_value(select, () => get(adminConfig).DEFAULT_USER_ROLE, ($$value) => mutate(adminConfig, get(adminConfig).DEFAULT_USER_ROLE = $$value));
      bind_select_value(select_1, () => get(adminConfig).DEFAULT_GROUP_ID, ($$value) => mutate(adminConfig, get(adminConfig).DEFAULT_GROUP_ID = $$value));
      bind_value(input_1, () => get(adminConfig).JWT_EXPIRES_IN, ($$value) => mutate(adminConfig, get(adminConfig).JWT_EXPIRES_IN = $$value));
      bind_value(input_12, () => get(adminConfig).WEBUI_URL, ($$value) => mutate(adminConfig, get(adminConfig).WEBUI_URL = $$value));
      bind_value(input_13, () => get(webhookUrl), ($$value) => set(webhookUrl, $$value));
      append($$anchor2, div_1);
    };
    if_block(node, ($$render) => {
      if (get(adminConfig) !== null) $$render(consequent_9);
    });
  }
  reset(div);
  var div_120 = sibling(div, 2);
  var button_2 = child(div_120);
  var text_59 = child(button_2, true);
  reset(button_2);
  reset(div_120);
  reset(form);
  template_effect(($0) => set_text(text_59, $0), [() => ($i18n(), untrack(() => $i18n().t("Save")))]);
  event("submit", form, preventDefault(async () => {
    updateHandler();
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root_3$e = from_html(`<option class="bg-gray-100 dark:bg-gray-700"> </option>`);
var root_6$a = from_html(`<div class="self-center"><svg class=" w-4 h-4" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY {
												transform-origin: center;
												animation: spinner_AtaB 0.75s infinite linear;
											}

											@keyframes spinner_AtaB {
												100% {
													transform: rotate(360deg);
												}
											}</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"></path><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"></path></svg></div>`);
var root_7$8 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path d="M7.25 10.25a.75.75 0 0 0 1.5 0V4.56l2.22 2.22a.75.75 0 1 0 1.06-1.06l-3.5-3.5a.75.75 0 0 0-1.06 0l-3.5 3.5a.75.75 0 0 0 1.06 1.06l2.22-2.22v5.69Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg>`);
var root_8$9 = from_html(`<div class="self-center"><svg class=" w-4 h-4" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY {
												transform-origin: center;
												animation: spinner_AtaB 0.75s infinite linear;
											}

											@keyframes spinner_AtaB {
												100% {
													transform: rotate(360deg);
												}
											}</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"></path><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"></path></svg></div>`);
var root_9$4 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 2.75a.75.75 0 0 0-1.5 0v5.69L5.03 6.22a.75.75 0 0 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 0 0-1.06-1.06L8.75 8.44V2.75Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg>`);
var root_13$5 = from_html(`<option class="bg-gray-100 dark:bg-gray-700"> </option>`);
var root_12$6 = from_html(`<div class="flex gap-2"><div class="flex-1"><select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"></select></div> <button class="px-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M5 3.25V4H2.75a.75.75 0 0 0 0 1.5h.3l.815 8.15A1.5 1.5 0 0 0 5.357 15h5.285a1.5 1.5 0 0 0 1.493-1.35l.815-8.15h.3a.75.75 0 0 0 0-1.5H11v-.75A2.25 2.25 0 0 0 8.75 1h-1.5A2.25 2.25 0 0 0 5 3.25Zm2.25-.75a.75.75 0 0 0-.75.75V4h3v-.75a.75.75 0 0 0-.75-.75h-1.5ZM6.05 6a.75.75 0 0 1 .787.713l.275 5.5a.75.75 0 0 1-1.498.075l-.275-5.5A.75.75 0 0 1 6.05 6Zm3.9 0a.75.75 0 0 1 .712.787l-.275 5.5a.75.75 0 0 1-1.498-.075l.275-5.5a.75.75 0 0 1 .786-.711Z" clip-rule="evenodd"></path></svg></button></div>`);
var root_17$4 = from_html(`<span class="ml-2 self-center"> </span>`);
var root_18$5 = from_html(`<span class="ml-2 self-center"> </span>`);
var root_21$4 = from_html(`<option> </option>`);
var root_20$6 = from_html(`<select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"></select>`);
var root_23$2 = from_html(`<div class="flex justify-between items-center"><div class="text-xs text-gray-500"> </div> <div class=" pr-2"><!></div></div>`);
var root_24$4 = from_html(`<input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off" required/>`);
var root_19$3 = from_html(`<div class="flex mt-0.5 mb-1.5 space-x-2"><div class=" flex-1"><!></div></div>`);
var root_16$7 = from_html(`<div class=" py-0.5 w-full justify-between"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <button class="p-1 px-3 text-xs flex rounded-sm transition" type="button"><!></button></div> <!></div>`);
var root_26$2 = from_html(`<div> </div>`);
var root_11$6 = from_html(`<div class="flex w-full justify-between mb-2"><div class=" self-center text-sm font-medium"> </div></div> <div class="space-y-1"><!> <div class="space-y-1"><!></div></div>`, 1);
var root_28$4 = from_html(`<div> </div>`);
var root_29$3 = from_html(`<div class="flex justify-center"><div class="my-auto"><!></div></div>`);
var root_2$h = from_html(`<div class="space-y-1"><div class="flex gap-2"><div class="flex-1"><select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"><option selected disabled class="bg-gray-100 dark:bg-gray-700"> </option><!></select></div></div></div> <div class=" my-2"><div class=" mb-2 text-sm font-medium"> </div> <div class="flex w-full"><div class="flex-1 mr-2"><input id="pipelines-upload-input" type="file" accept=".py" hidden=""/> <button class="w-full text-sm font-medium py-2 bg-transparent hover:bg-gray-100 border border-dashed dark:border-gray-850 dark:hover:bg-gray-850 text-center rounded-xl" type="button"><!></button></div> <button class="px-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition" type="button"><!></button></div></div> <div class=" my-2"><div class=" mb-2 text-sm font-medium"> </div> <div class="flex w-full"><div class="flex-1 mr-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div> <button class="px-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition" type="button"><!></button></div> <div class="mt-2 text-xs text-gray-500"><span class=" font-medium dark:text-gray-200"> </span> <span class=" font-medium dark:text-gray-400"> </span></div></div> <hr class="border-gray-100 dark:border-gray-850 my-3 w-full"/> <!>`, 1);
var root_30$4 = from_html(`<div> </div>`);
var root_1$k = from_html(`<div class="flex w-full justify-between mb-2"><div class=" self-center text-sm font-medium"> </div></div> <!>`, 1);
var root_31$4 = from_html(`<div class="flex justify-center h-full"><div class="my-auto"><!></div></div>`);
var root_32$4 = from_html(`<div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div>`);
var root$k = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class="overflow-y-scroll scrollbar-hidden h-full"><!></div> <!></form>`);
function Pipelines($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $config = () => store_get(config, "$config", $$stores);
  const $settings = () => store_get(settings, "$settings", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let saveHandler = prop($$props, "saveHandler", 8);
  let downloading = mutable_source(false);
  let uploading = mutable_source(false);
  let pipelineFiles = mutable_source();
  let PIPELINES_LIST = mutable_source(null);
  let selectedPipelinesUrlIdx = mutable_source("");
  let pipelines = mutable_source(null);
  let valves = mutable_source(null);
  let valves_spec = mutable_source(null);
  let selectedPipelineIdx = mutable_source(null);
  let pipelineDownloadUrl = mutable_source("");
  const updateHandler = async () => {
    var _a, _b, _c, _d;
    const pipeline = get(pipelines)[get(selectedPipelineIdx)];
    if (pipeline && ((pipeline == null ? void 0 : pipeline.valves) ?? false)) {
      for (const property in get(valves_spec).properties) {
        if (((_a = get(valves_spec).properties[property]) == null ? void 0 : _a.type) === "array") {
          mutate(valves, get(valves)[property] = get(valves)[property].split(",").map((v) => v.trim()));
        }
      }
      const res = await updatePipelineValves(localStorage.token, pipeline.id, get(valves), get(selectedPipelinesUrlIdx)).catch((error) => {
        toast.error(`${error}`);
      });
      if (res) {
        toast.success($i18n().t("Valves updated successfully"));
        setPipelines();
        models.set(await getModels(localStorage.token, ((_c = (_b = $config()) == null ? void 0 : _b.features) == null ? void 0 : _c.enable_direct_connections) && (((_d = $settings()) == null ? void 0 : _d.directConnections) ?? null)));
        saveHandler()();
      }
    } else {
      toast.error($i18n().t("No valves to update"));
    }
  };
  const getValves = async (idx) => {
    var _a;
    set(valves, null);
    set(valves_spec, null);
    set(valves_spec, await getPipelineValvesSpec(localStorage.token, get(pipelines)[idx].id, get(selectedPipelinesUrlIdx)));
    set(valves, await getPipelineValves(localStorage.token, get(pipelines)[idx].id, get(selectedPipelinesUrlIdx)));
    for (const property in get(valves_spec).properties) {
      if (((_a = get(valves_spec).properties[property]) == null ? void 0 : _a.type) === "array") {
        mutate(valves, get(valves)[property] = get(valves)[property].join(","));
      }
    }
  };
  const setPipelines = async () => {
    set(pipelines, null);
    set(valves, null);
    set(valves_spec, null);
    if (get(PIPELINES_LIST).length > 0) {
      console.debug(get(selectedPipelinesUrlIdx));
      set(pipelines, await getPipelines(localStorage.token, get(selectedPipelinesUrlIdx)));
      if (get(pipelines).length > 0) {
        set(selectedPipelineIdx, 0);
        await getValves(get(selectedPipelineIdx));
      }
    } else {
      set(pipelines, []);
    }
  };
  const addPipelineHandler = async () => {
    var _a, _b, _c;
    set(downloading, true);
    const res = await downloadPipeline(localStorage.token, get(pipelineDownloadUrl), get(selectedPipelinesUrlIdx)).catch((error) => {
      toast.error(`${error}`);
      return null;
    });
    if (res) {
      toast.success($i18n().t("Pipeline downloaded successfully"));
      setPipelines();
      models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
    }
    set(downloading, false);
  };
  const uploadPipelineHandler = async () => {
    var _a, _b, _c;
    set(uploading, true);
    if (get(pipelineFiles) && get(pipelineFiles).length !== 0) {
      const file = get(pipelineFiles)[0];
      console.log(file);
      const res = await uploadPipeline(localStorage.token, file, get(selectedPipelinesUrlIdx)).catch((error) => {
        console.error(error);
        toast.error($i18n().t("Something went wrong :/"));
        return null;
      });
      if (res) {
        toast.success($i18n().t("Pipeline downloaded successfully"));
        setPipelines();
        models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
      }
    } else {
      toast.error($i18n().t("No file selected"));
    }
    set(pipelineFiles, null);
    const pipelineUploadInputElement = document.getElementById("pipelines-upload-input");
    if (pipelineUploadInputElement) {
      pipelineUploadInputElement.value = null;
    }
    set(uploading, false);
  };
  const deletePipelineHandler = async () => {
    var _a, _b, _c;
    const res = await deletePipeline(localStorage.token, get(pipelines)[get(selectedPipelineIdx)].id, get(selectedPipelinesUrlIdx)).catch((error) => {
      toast.error(`${error}`);
      return null;
    });
    if (res) {
      toast.success($i18n().t("Pipeline deleted successfully"));
      setPipelines();
      models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
    }
  };
  onMount(async () => {
    set(PIPELINES_LIST, await getPipelinesList(localStorage.token));
    console.log(get(PIPELINES_LIST));
    if (get(PIPELINES_LIST).length > 0) {
      set(selectedPipelinesUrlIdx, get(PIPELINES_LIST)[0]["idx"].toString());
    }
    await setPipelines();
  });
  init();
  var form = root$k();
  var div = child(form);
  var node = child(div);
  {
    var consequent_14 = ($$anchor2) => {
      var fragment = root_1$k();
      var div_1 = first_child(fragment);
      var div_2 = child(div_1);
      var text$1 = child(div_2, true);
      reset(div_2);
      reset(div_1);
      var node_1 = sibling(div_1, 2);
      {
        var consequent_13 = ($$anchor3) => {
          var fragment_1 = root_2$h();
          var div_3 = first_child(fragment_1);
          var div_4 = child(div_3);
          var div_5 = child(div_4);
          var select = child(div_5);
          template_effect(() => {
            get(selectedPipelinesUrlIdx);
            invalidate_inner_signals(() => {
              $i18n();
              get(PIPELINES_LIST);
            });
          });
          var option_1 = child(select);
          var text_1 = child(option_1, true);
          reset(option_1);
          option_1.value = option_1.__value = "";
          var node_2 = sibling(option_1);
          each(node_2, 1, () => get(PIPELINES_LIST), index, ($$anchor4, pipelines2, idx, $$array) => {
            var option_2 = root_3$e();
            var text_2 = child(option_2, true);
            reset(option_2);
            var option_2_value = {};
            template_effect(
              ($0) => {
                set_text(text_2, (get(pipelines2), untrack(() => get(pipelines2).url)));
                if (option_2_value !== (option_2_value = $0)) {
                  option_2.value = (option_2.__value = $0) ?? "";
                }
              },
              [
                () => (get(pipelines2), untrack(() => get(pipelines2).idx.toString()))
              ]
            );
            append($$anchor4, option_2);
          });
          reset(select);
          reset(div_5);
          reset(div_4);
          reset(div_3);
          var div_6 = sibling(div_3, 2);
          var div_7 = child(div_6);
          var text_3 = child(div_7, true);
          reset(div_7);
          var div_8 = sibling(div_7, 2);
          var div_9 = child(div_8);
          var input = child(div_9);
          var button = sibling(input, 2);
          var node_3 = child(button);
          {
            var consequent = ($$anchor4) => {
              var text_4 = text();
              template_effect(() => set_text(text_4, `${(get(pipelineFiles), untrack(() => get(pipelineFiles).length > 0 ? `${get(pipelineFiles).length}` : "")) ?? ""} pipeline(s) selected.`));
              append($$anchor4, text_4);
            };
            var alternate = ($$anchor4) => {
              var text_5 = text();
              template_effect(($0) => set_text(text_5, $0), [
                () => ($i18n(), untrack(() => $i18n().t("Click here to select a py file.")))
              ]);
              append($$anchor4, text_5);
            };
            if_block(node_3, ($$render) => {
              if (get(pipelineFiles)) $$render(consequent);
              else $$render(alternate, false);
            });
          }
          reset(button);
          reset(div_9);
          var button_1 = sibling(div_9, 2);
          var node_4 = child(button_1);
          {
            var consequent_1 = ($$anchor4) => {
              var div_10 = root_6$a();
              append($$anchor4, div_10);
            };
            var alternate_1 = ($$anchor4) => {
              var svg = root_7$8();
              append($$anchor4, svg);
            };
            if_block(node_4, ($$render) => {
              if (get(uploading)) $$render(consequent_1);
              else $$render(alternate_1, false);
            });
          }
          reset(button_1);
          reset(div_8);
          reset(div_6);
          var div_11 = sibling(div_6, 2);
          var div_12 = child(div_11);
          var text_6 = child(div_12, true);
          reset(div_12);
          var div_13 = sibling(div_12, 2);
          var div_14 = child(div_13);
          var input_1 = child(div_14);
          remove_input_defaults(input_1);
          reset(div_14);
          var button_2 = sibling(div_14, 2);
          var node_5 = child(button_2);
          {
            var consequent_2 = ($$anchor4) => {
              var div_15 = root_8$9();
              append($$anchor4, div_15);
            };
            var alternate_2 = ($$anchor4) => {
              var svg_1 = root_9$4();
              append($$anchor4, svg_1);
            };
            if_block(node_5, ($$render) => {
              if (get(downloading)) $$render(consequent_2);
              else $$render(alternate_2, false);
            });
          }
          reset(button_2);
          reset(div_13);
          var div_16 = sibling(div_13, 2);
          var span = child(div_16);
          var text_7 = child(span, true);
          reset(span);
          var text_8 = sibling(span);
          var span_1 = sibling(text_8);
          var text_9 = child(span_1, true);
          reset(span_1);
          reset(div_16);
          reset(div_11);
          var node_6 = sibling(div_11, 4);
          {
            var consequent_12 = ($$anchor4) => {
              var fragment_4 = comment();
              var node_7 = first_child(fragment_4);
              {
                var consequent_10 = ($$anchor5) => {
                  var fragment_5 = root_11$6();
                  var div_17 = first_child(fragment_5);
                  var div_18 = child(div_17);
                  var text_10 = child(div_18, true);
                  reset(div_18);
                  reset(div_17);
                  var div_19 = sibling(div_17, 2);
                  var node_8 = child(div_19);
                  {
                    var consequent_3 = ($$anchor6) => {
                      var div_20 = root_12$6();
                      var div_21 = child(div_20);
                      var select_1 = child(div_21);
                      template_effect(() => {
                        get(selectedPipelineIdx);
                        invalidate_inner_signals(() => {
                          $i18n();
                          get(pipelines);
                        });
                      });
                      each(select_1, 5, () => get(pipelines), index, ($$anchor7, pipeline, idx) => {
                        var option_3 = root_13$5();
                        var text_11 = child(option_3);
                        reset(option_3);
                        option_3.value = option_3.__value = idx;
                        template_effect(() => set_text(text_11, `${(get(pipeline), untrack(() => get(pipeline).name)) ?? ""} (${(get(pipeline), untrack(() => get(pipeline).type ?? "pipe")) ?? ""})`));
                        append($$anchor7, option_3);
                      });
                      reset(select_1);
                      reset(div_21);
                      var button_3 = sibling(div_21, 2);
                      reset(div_20);
                      template_effect(($0) => set_attribute(select_1, "placeholder", $0), [
                        () => ($i18n(), untrack(() => $i18n().t("Select a pipeline")))
                      ]);
                      bind_select_value(select_1, () => get(selectedPipelineIdx), ($$value) => set(selectedPipelineIdx, $$value));
                      event("change", select_1, async () => {
                        await tick();
                        await getValves(get(selectedPipelineIdx));
                      });
                      event("click", button_3, () => {
                        deletePipelineHandler();
                      });
                      append($$anchor6, div_20);
                    };
                    if_block(node_8, ($$render) => {
                      if (get(pipelines), untrack(() => get(pipelines).length > 0)) $$render(consequent_3);
                    });
                  }
                  var div_22 = sibling(node_8, 2);
                  var node_9 = child(div_22);
                  {
                    var consequent_9 = ($$anchor6) => {
                      var fragment_6 = comment();
                      var node_10 = first_child(fragment_6);
                      {
                        var consequent_8 = ($$anchor7) => {
                          var fragment_7 = comment();
                          var node_11 = first_child(fragment_7);
                          each(
                            node_11,
                            1,
                            () => (get(valves_spec), untrack(() => Object.keys(get(valves_spec).properties))),
                            index,
                            ($$anchor8, property) => {
                              var div_23 = root_16$7();
                              var div_24 = child(div_23);
                              var div_25 = child(div_24);
                              var text_12 = child(div_25, true);
                              reset(div_25);
                              var button_4 = sibling(div_25, 2);
                              var node_12 = child(button_4);
                              {
                                var consequent_4 = ($$anchor9) => {
                                  var span_2 = root_17$4();
                                  var text_13 = child(span_2, true);
                                  reset(span_2);
                                  template_effect(($0) => set_text(text_13, $0), [() => ($i18n(), untrack(() => $i18n().t("None")))]);
                                  append($$anchor9, span_2);
                                };
                                var alternate_3 = ($$anchor9) => {
                                  var span_3 = root_18$5();
                                  var text_14 = child(span_3, true);
                                  reset(span_3);
                                  template_effect(($0) => set_text(text_14, $0), [() => ($i18n(), untrack(() => $i18n().t("Custom")))]);
                                  append($$anchor9, span_3);
                                };
                                if_block(node_12, ($$render) => {
                                  if (get(valves), get(property), untrack(() => (get(valves)[get(property)] ?? null) === null)) $$render(consequent_4);
                                  else $$render(alternate_3, false);
                                });
                              }
                              reset(button_4);
                              reset(div_24);
                              var node_13 = sibling(div_24, 2);
                              {
                                var consequent_7 = ($$anchor9) => {
                                  var div_26 = root_19$3();
                                  var div_27 = child(div_26);
                                  var node_14 = child(div_27);
                                  {
                                    var consequent_5 = ($$anchor10) => {
                                      var select_2 = root_20$6();
                                      template_effect(() => {
                                        get(valves);
                                        invalidate_inner_signals(() => {
                                          get(property);
                                          get(valves_spec);
                                        });
                                      });
                                      each(
                                        select_2,
                                        5,
                                        () => (get(valves_spec), get(property), untrack(() => get(valves_spec).properties[get(property)].enum)),
                                        index,
                                        ($$anchor11, option) => {
                                          var option_4 = root_21$4();
                                          var text_15 = child(option_4, true);
                                          reset(option_4);
                                          var option_4_value = {};
                                          template_effect(() => {
                                            set_selected(option_4, (get(option), get(valves), get(property), untrack(() => get(option) === get(valves)[get(property)])));
                                            set_text(text_15, get(option));
                                            if (option_4_value !== (option_4_value = get(option))) {
                                              option_4.value = (option_4.__value = get(option)) ?? "";
                                            }
                                          });
                                          append($$anchor11, option_4);
                                        }
                                      );
                                      reset(select_2);
                                      bind_select_value(select_2, () => get(valves)[get(property)], ($$value) => mutate(valves, get(valves)[get(property)] = $$value));
                                      append($$anchor10, select_2);
                                    };
                                    var alternate_5 = ($$anchor10) => {
                                      var fragment_8 = comment();
                                      var node_15 = first_child(fragment_8);
                                      {
                                        var consequent_6 = ($$anchor11) => {
                                          var div_28 = root_23$2();
                                          var div_29 = child(div_28);
                                          var text_16 = child(div_29, true);
                                          reset(div_29);
                                          var div_30 = sibling(div_29, 2);
                                          var node_16 = child(div_30);
                                          Switch_1(node_16, {
                                            get state() {
                                              return get(valves)[get(property)];
                                            },
                                            set state($$value) {
                                              mutate(valves, get(valves)[get(property)] = $$value);
                                            },
                                            $$legacy: true
                                          });
                                          reset(div_30);
                                          reset(div_28);
                                          template_effect(($0) => set_text(text_16, $0), [
                                            () => (get(valves), get(property), $i18n(), untrack(() => get(valves)[get(property)] ? $i18n().t("Enabled") : $i18n().t("Disabled")))
                                          ]);
                                          append($$anchor11, div_28);
                                        };
                                        var alternate_4 = ($$anchor11) => {
                                          var input_2 = root_24$4();
                                          remove_input_defaults(input_2);
                                          template_effect(() => set_attribute(input_2, "placeholder", (get(valves_spec), get(property), untrack(() => get(valves_spec).properties[get(property)].title))));
                                          bind_value(input_2, () => get(valves)[get(property)], ($$value) => mutate(valves, get(valves)[get(property)] = $$value));
                                          append($$anchor11, input_2);
                                        };
                                        if_block(
                                          node_15,
                                          ($$render) => {
                                            if (get(valves_spec), get(property), untrack(() => {
                                              var _a;
                                              return (((_a = get(valves_spec).properties[get(property)]) == null ? void 0 : _a.type) ?? null) === "boolean";
                                            })) $$render(consequent_6);
                                            else $$render(alternate_4, false);
                                          },
                                          true
                                        );
                                      }
                                      append($$anchor10, fragment_8);
                                    };
                                    if_block(node_14, ($$render) => {
                                      if (get(valves_spec), get(property), untrack(() => {
                                        var _a;
                                        return ((_a = get(valves_spec).properties[get(property)]) == null ? void 0 : _a.enum) ?? null;
                                      })) $$render(consequent_5);
                                      else $$render(alternate_5, false);
                                    });
                                  }
                                  reset(div_27);
                                  reset(div_26);
                                  append($$anchor9, div_26);
                                };
                                if_block(node_13, ($$render) => {
                                  if (get(valves), get(property), untrack(() => (get(valves)[get(property)] ?? null) !== null)) $$render(consequent_7);
                                });
                              }
                              reset(div_23);
                              template_effect(() => set_text(text_12, (get(valves_spec), get(property), untrack(() => get(valves_spec).properties[get(property)].title))));
                              event("click", button_4, () => {
                                mutate(valves, get(valves)[get(property)] = (get(valves)[get(property)] ?? null) === null ? "" : null);
                              });
                              append($$anchor8, div_23);
                            }
                          );
                          append($$anchor7, fragment_7);
                        };
                        var alternate_6 = ($$anchor7) => {
                          Spinner($$anchor7, { className: "size-5" });
                        };
                        if_block(node_10, ($$render) => {
                          if (get(valves)) $$render(consequent_8);
                          else $$render(alternate_6, false);
                        });
                      }
                      append($$anchor6, fragment_6);
                    };
                    var alternate_7 = ($$anchor6) => {
                      var div_31 = root_26$2();
                      var text_17 = child(div_31, true);
                      reset(div_31);
                      template_effect(($0) => set_text(text_17, $0), [() => ($i18n(), untrack(() => $i18n().t("No valves")))]);
                      append($$anchor6, div_31);
                    };
                    if_block(node_9, ($$render) => {
                      if (get(pipelines), get(selectedPipelineIdx), untrack(() => get(pipelines)[get(selectedPipelineIdx)].valves)) $$render(consequent_9);
                      else $$render(alternate_7, false);
                    });
                  }
                  reset(div_22);
                  reset(div_19);
                  template_effect(($0) => set_text(text_10, $0), [
                    () => ($i18n(), untrack(() => $i18n().t("Pipelines Valves")))
                  ]);
                  append($$anchor5, fragment_5);
                };
                var alternate_8 = ($$anchor5) => {
                  var fragment_10 = comment();
                  var node_17 = first_child(fragment_10);
                  {
                    var consequent_11 = ($$anchor6) => {
                      var div_32 = root_28$4();
                      var text_18 = child(div_32, true);
                      reset(div_32);
                      template_effect(($0) => set_text(text_18, $0), [
                        () => ($i18n(), untrack(() => $i18n().t("Pipelines Not Detected")))
                      ]);
                      append($$anchor6, div_32);
                    };
                    if_block(
                      node_17,
                      ($$render) => {
                        if (get(pipelines), untrack(() => get(pipelines).length === 0)) $$render(consequent_11);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_10);
                };
                if_block(node_7, ($$render) => {
                  if (get(pipelines), untrack(() => get(pipelines).length > 0)) $$render(consequent_10);
                  else $$render(alternate_8, false);
                });
              }
              append($$anchor4, fragment_4);
            };
            var alternate_9 = ($$anchor4) => {
              var div_33 = root_29$3();
              var div_34 = child(div_33);
              var node_18 = child(div_34);
              Spinner(node_18, { className: "size-4" });
              reset(div_34);
              reset(div_33);
              append($$anchor4, div_33);
            };
            if_block(node_6, ($$render) => {
              if (get(pipelines) !== null) $$render(consequent_12);
              else $$render(alternate_9, false);
            });
          }
          template_effect(
            ($0, $1, $2, $3, $4, $5, $6, $7) => {
              set_attribute(select, "placeholder", $0);
              set_text(text_1, $1);
              set_text(text_3, $2);
              button_1.disabled = get(uploading);
              set_text(text_6, $3);
              set_attribute(input_1, "placeholder", $4);
              button_2.disabled = get(downloading);
              set_text(text_7, $5);
              set_text(text_8, ` ${$6 ?? ""} `);
              set_text(text_9, $7);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Select a pipeline url"))),
              () => ($i18n(), untrack(() => $i18n().t("Select a pipeline url"))),
              () => ($i18n(), untrack(() => $i18n().t("Upload Pipeline"))),
              () => ($i18n(), untrack(() => $i18n().t("Install from Github URL"))),
              () => ($i18n(), untrack(() => $i18n().t("Enter Github Raw URL"))),
              () => ($i18n(), untrack(() => $i18n().t("Warning:"))),
              () => ($i18n(), untrack(() => $i18n().t("Pipelines are a plugin system with arbitrary code execution "))),
              () => ($i18n(), untrack(() => $i18n().t("don't fetch random pipelines from sources you don't trust.")))
            ]
          );
          bind_select_value(select, () => get(selectedPipelinesUrlIdx), ($$value) => set(selectedPipelinesUrlIdx, $$value));
          event("change", select, async () => {
            await tick();
            await setPipelines();
          });
          bind_files(input, () => get(pipelineFiles), ($$value) => set(pipelineFiles, $$value));
          event("click", button, () => {
            var _a;
            (_a = document.getElementById("pipelines-upload-input")) == null ? void 0 : _a.click();
          });
          event("click", button_1, () => {
            uploadPipelineHandler();
          });
          bind_value(input_1, () => get(pipelineDownloadUrl), ($$value) => set(pipelineDownloadUrl, $$value));
          event("click", button_2, () => {
            addPipelineHandler();
          });
          append($$anchor3, fragment_1);
        };
        var alternate_10 = ($$anchor3) => {
          var div_35 = root_30$4();
          var text_19 = child(div_35, true);
          reset(div_35);
          template_effect(($0) => set_text(text_19, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Pipelines Not Detected")))
          ]);
          append($$anchor3, div_35);
        };
        if_block(node_1, ($$render) => {
          if (get(PIPELINES_LIST), untrack(() => get(PIPELINES_LIST).length > 0)) $$render(consequent_13);
          else $$render(alternate_10, false);
        });
      }
      template_effect(($0) => set_text(text$1, $0), [
        () => ($i18n(), untrack(() => $i18n().t("Manage Pipelines")))
      ]);
      append($$anchor2, fragment);
    };
    var alternate_11 = ($$anchor2) => {
      var div_36 = root_31$4();
      var div_37 = child(div_36);
      var node_19 = child(div_37);
      Spinner(node_19, { className: "size-6" });
      reset(div_37);
      reset(div_36);
      append($$anchor2, div_36);
    };
    if_block(node, ($$render) => {
      if (get(PIPELINES_LIST) !== null) $$render(consequent_14);
      else $$render(alternate_11, false);
    });
  }
  reset(div);
  var node_20 = sibling(div, 2);
  {
    var consequent_15 = ($$anchor2) => {
      var div_38 = root_32$4();
      var button_5 = child(div_38);
      var text_20 = child(button_5, true);
      reset(button_5);
      reset(div_38);
      template_effect(($0) => set_text(text_20, $0), [() => ($i18n(), untrack(() => $i18n().t("Save")))]);
      append($$anchor2, div_38);
    };
    if_block(node_20, ($$render) => {
      if (get(PIPELINES_LIST), untrack(() => get(PIPELINES_LIST) !== null && get(PIPELINES_LIST).length > 0)) $$render(consequent_15);
    });
  }
  reset(form);
  event("submit", form, preventDefault(async () => {
    updateHandler();
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root_1$j = from_html(`<div class="mb-2"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div>`);
var root_2$g = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><input class="flex-1 w-full bg-transparent outline-hidden" required/> <!></div></div> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="model-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="model-list"><option></option></datalist></div></div></div>`, 1);
var root_4$e = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><!></div></div> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" hover:underline dark:text-gray-200 text-gray-800" href="https://developers.deepgram.com/docs/models" target="_blank"> </a></div></div>`, 1);
var root_6$9 = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><!></div> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div></div>`);
var root_8$8 = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><input class="flex-1 w-full bg-transparent outline-hidden" required/> <!></div></div> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" placeholder="voxtral-mini-latest"/></div></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" hover:underline dark:text-gray-200 text-gray-800" href="https://docs.mistral.ai/capabilities/audio_transcription" target="_blank"> </a></div></div> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class="flex items-center justify-between mb-2"><div class="text-xs font-medium"> </div> <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer"/> <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div></label></div> <div class="text-xs text-gray-400 dark:text-gray-500"> </div></div>`, 1);
var root_11$5 = from_html(`<div class="self-center"><!></div>`);
var root_12$5 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 2.75a.75.75 0 0 0-1.5 0v5.69L5.03 6.22a.75.75 0 0 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 0 0-1.06-1.06L8.75 8.44V2.75Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg>`);
var root_10$7 = from_html(`<div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1 mr-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div> <button class="px-2.5 bg-gray-50 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition"><!></button></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" hover:underline dark:text-gray-200 text-gray-800" href="https://github.com/SYSTRAN/faster-whisper" target="_blank"> </a></div></div>`);
var root_13$4 = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><input class="flex-1 w-full bg-transparent outline-hidden" required/> <!></div></div>`);
var root_15$3 = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><!></div></div>`);
var root_17$3 = from_html(`<div><div class="mt-1 flex gap-2 mb-1"><!></div> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div> <div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div></div>`);
var root_19$2 = from_html(`<option class="bg-gray-100 dark:bg-gray-700"> </option>`);
var root_18$4 = from_html(`<div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"><option> </option><!></select></div></div></div>`);
var root_21$3 = from_html(`<div><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="model-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="model-list"><option></option></datalist></div></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" hover:underline dark:text-gray-200 text-gray-800" href="https://github.com/microsoft/SpeechT5" target="_blank"> </a> To see the available CMU Arctic speaker embeddings, <a class=" hover:underline dark:text-gray-200 text-gray-800" href="https://huggingface.co/datasets/Matthijs/cmu-arctic-xvectors" target="_blank"> </a></div></div>`);
var root_24$3 = from_html(`<option> </option>`);
var root_25$2 = from_html(`<option class="bg-gray-50 dark:bg-gray-700"></option>`);
var root_23$1 = from_html(`<div class=" flex gap-2"><div class="w-full"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="voice-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="voice-list"></datalist></div></div></div> <div class="w-full"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="tts-model-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="tts-model-list"></datalist></div></div></div></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"><div class="w-full"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div>`, 1);
var root_28$3 = from_html(`<option> </option>`);
var root_29$2 = from_html(`<option class="bg-gray-50 dark:bg-gray-700"></option>`);
var root_27$2 = from_html(`<div class=" flex gap-2"><div class="w-full"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="voice-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="voice-list"></datalist></div></div></div> <div class="w-full"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="tts-model-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="tts-model-list"></datalist></div></div></div></div>`);
var root_32$3 = from_html(`<option> </option>`);
var root_31$3 = from_html(`<div class=" flex gap-2"><div class="w-full"><div class=" mb-1.5 text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input list="voice-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="voice-list"></datalist></div></div></div> <div class="w-full"><div class=" mb-1.5 text-xs font-medium"> <a href="https://learn.microsoft.com/en-us/azure/ai-services/speech-service/rest-text-to-speech?tabs=streaming#audio-outputs" target="_blank"><small> </small></a></div> <div class="flex w-full"><div class="flex-1"><input list="tts-model-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div></div></div></div>`);
var root_33$2 = from_html(`<option> </option>`);
var root$j = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class=" space-y-3 overflow-y-scroll scrollbar-hidden h-full"><div class="flex flex-col gap-3"><div><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <!> <div class="mb-2 py-0.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 cursor-pointer w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option><option> </option><option> </option><option> </option></select></div></div> <!></div> <div><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2 py-0.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class=" dark:bg-gray-900 w-fit pr-8 cursor-pointer rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option><option> </option><option> </option></select></div></div> <!> <div class="mb-2"><!></div> <div class="pt-0.5 flex w-full justify-between"><div class="self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 cursor-pointer rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right"></select></div></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"> </div></div></div></div> <div class="flex justify-end text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`);
function Audio($$anchor, $$props) {
  push($$props, false);
  const $config = () => store_get(config, "$config", $$stores);
  const $settings = () => store_get(settings, "$settings", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const dispatch = createEventDispatcher();
  const i18n = getContext("i18n");
  let saveHandler = prop($$props, "saveHandler", 8);
  let TTS_OPENAI_API_BASE_URL = mutable_source("");
  let TTS_OPENAI_API_KEY = mutable_source("");
  let TTS_API_KEY = mutable_source("");
  let TTS_ENGINE = mutable_source("");
  let TTS_MODEL = mutable_source("");
  let TTS_VOICE = mutable_source("");
  let TTS_OPENAI_PARAMS = mutable_source("");
  let TTS_SPLIT_ON = mutable_source(TTS_RESPONSE_SPLIT.PUNCTUATION);
  let TTS_AZURE_SPEECH_REGION = mutable_source("");
  let TTS_AZURE_SPEECH_BASE_URL = mutable_source("");
  let TTS_AZURE_SPEECH_OUTPUT_FORMAT = mutable_source("");
  let STT_OPENAI_API_BASE_URL = mutable_source("");
  let STT_OPENAI_API_KEY = mutable_source("");
  let STT_ENGINE = mutable_source("");
  let STT_MODEL = mutable_source("");
  let STT_SUPPORTED_CONTENT_TYPES = mutable_source("");
  let STT_WHISPER_MODEL = mutable_source("");
  let STT_AZURE_API_KEY = mutable_source("");
  let STT_AZURE_REGION = mutable_source("");
  let STT_AZURE_LOCALES = mutable_source("");
  let STT_AZURE_BASE_URL = mutable_source("");
  let STT_AZURE_MAX_SPEAKERS = mutable_source("");
  let STT_DEEPGRAM_API_KEY = mutable_source("");
  let STT_MISTRAL_API_KEY = mutable_source("");
  let STT_MISTRAL_API_BASE_URL = mutable_source("");
  let STT_MISTRAL_USE_CHAT_COMPLETIONS = mutable_source(false);
  let STT_WHISPER_MODEL_LOADING = mutable_source(false);
  let voices = mutable_source([]);
  let models2 = mutable_source([]);
  const getModels2 = async () => {
    var _a, _b, _c;
    if (get(TTS_ENGINE) === "") {
      set(models2, []);
    } else {
      const res = await getModels$1(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)).catch((e) => {
        toast.error(`${e}`);
      });
      if (res) {
        console.log(res);
        set(models2, res.models);
      }
    }
  };
  const getVoices$1 = async () => {
    if (get(TTS_ENGINE) === "") {
      const getVoicesLoop = setInterval(
        () => {
          set(voices, speechSynthesis.getVoices());
          if (get(voices).length > 0) {
            clearInterval(getVoicesLoop);
            get(voices).sort((a, b) => a.name.localeCompare(b.name, $i18n().resolvedLanguage));
          }
        },
        100
      );
    } else {
      const res = await getVoices(localStorage.token).catch((e) => {
        toast.error(`${e}`);
      });
      if (res) {
        console.log(res);
        set(voices, res.voices);
        get(voices).sort((a, b) => a.name.localeCompare(b.name, $i18n().resolvedLanguage));
      }
    }
  };
  const updateConfigHandler = async () => {
    let openaiParams = {};
    try {
      openaiParams = get(TTS_OPENAI_PARAMS) ? JSON.parse(get(TTS_OPENAI_PARAMS)) : {};
      set(TTS_OPENAI_PARAMS, JSON.stringify(openaiParams, null, 2));
    } catch (e) {
      toast.error($i18n().t("Invalid JSON format for Parameters"));
      return;
    }
    const res = await updateAudioConfig(localStorage.token, {
      tts: {
        OPENAI_API_BASE_URL: get(TTS_OPENAI_API_BASE_URL),
        OPENAI_API_KEY: get(TTS_OPENAI_API_KEY),
        OPENAI_PARAMS: openaiParams,
        API_KEY: get(TTS_API_KEY),
        ENGINE: get(TTS_ENGINE),
        MODEL: get(TTS_MODEL),
        VOICE: get(TTS_VOICE),
        AZURE_SPEECH_REGION: get(TTS_AZURE_SPEECH_REGION),
        AZURE_SPEECH_BASE_URL: get(TTS_AZURE_SPEECH_BASE_URL),
        AZURE_SPEECH_OUTPUT_FORMAT: get(TTS_AZURE_SPEECH_OUTPUT_FORMAT),
        SPLIT_ON: get(TTS_SPLIT_ON)
      },
      stt: {
        OPENAI_API_BASE_URL: get(STT_OPENAI_API_BASE_URL),
        OPENAI_API_KEY: get(STT_OPENAI_API_KEY),
        ENGINE: get(STT_ENGINE),
        MODEL: get(STT_MODEL),
        SUPPORTED_CONTENT_TYPES: get(STT_SUPPORTED_CONTENT_TYPES).split(","),
        WHISPER_MODEL: get(STT_WHISPER_MODEL),
        DEEPGRAM_API_KEY: get(STT_DEEPGRAM_API_KEY),
        AZURE_API_KEY: get(STT_AZURE_API_KEY),
        AZURE_REGION: get(STT_AZURE_REGION),
        AZURE_LOCALES: get(STT_AZURE_LOCALES),
        AZURE_BASE_URL: get(STT_AZURE_BASE_URL),
        AZURE_MAX_SPEAKERS: get(STT_AZURE_MAX_SPEAKERS),
        MISTRAL_API_KEY: get(STT_MISTRAL_API_KEY),
        MISTRAL_API_BASE_URL: get(STT_MISTRAL_API_BASE_URL),
        MISTRAL_USE_CHAT_COMPLETIONS: get(STT_MISTRAL_USE_CHAT_COMPLETIONS)
      }
    });
    if (res) {
      saveHandler()();
      config.set(await getBackendConfig());
    }
  };
  const sttModelUpdateHandler = async () => {
    set(STT_WHISPER_MODEL_LOADING, true);
    await updateConfigHandler();
    set(STT_WHISPER_MODEL_LOADING, false);
  };
  onMount(async () => {
    var _a, _b;
    const res = await getAudioConfig(localStorage.token);
    if (res) {
      console.log(res);
      set(TTS_OPENAI_API_BASE_URL, res.tts.OPENAI_API_BASE_URL);
      set(TTS_OPENAI_API_KEY, res.tts.OPENAI_API_KEY);
      set(TTS_OPENAI_PARAMS, JSON.stringify(((_a = res == null ? void 0 : res.tts) == null ? void 0 : _a.OPENAI_PARAMS) ?? "", null, 2));
      set(TTS_API_KEY, res.tts.API_KEY);
      set(TTS_ENGINE, res.tts.ENGINE);
      set(TTS_MODEL, res.tts.MODEL);
      set(TTS_VOICE, res.tts.VOICE);
      set(TTS_SPLIT_ON, res.tts.SPLIT_ON || TTS_RESPONSE_SPLIT.PUNCTUATION);
      set(TTS_AZURE_SPEECH_REGION, res.tts.AZURE_SPEECH_REGION);
      set(TTS_AZURE_SPEECH_BASE_URL, res.tts.AZURE_SPEECH_BASE_URL);
      set(TTS_AZURE_SPEECH_OUTPUT_FORMAT, res.tts.AZURE_SPEECH_OUTPUT_FORMAT);
      set(STT_OPENAI_API_BASE_URL, res.stt.OPENAI_API_BASE_URL);
      set(STT_OPENAI_API_KEY, res.stt.OPENAI_API_KEY);
      set(STT_ENGINE, res.stt.ENGINE);
      set(STT_MODEL, res.stt.MODEL);
      set(STT_SUPPORTED_CONTENT_TYPES, (((_b = res == null ? void 0 : res.stt) == null ? void 0 : _b.SUPPORTED_CONTENT_TYPES) ?? []).join(","));
      set(STT_WHISPER_MODEL, res.stt.WHISPER_MODEL);
      set(STT_AZURE_API_KEY, res.stt.AZURE_API_KEY);
      set(STT_AZURE_REGION, res.stt.AZURE_REGION);
      set(STT_AZURE_LOCALES, res.stt.AZURE_LOCALES);
      set(STT_AZURE_BASE_URL, res.stt.AZURE_BASE_URL);
      set(STT_AZURE_MAX_SPEAKERS, res.stt.AZURE_MAX_SPEAKERS);
      set(STT_DEEPGRAM_API_KEY, res.stt.DEEPGRAM_API_KEY);
      set(STT_MISTRAL_API_KEY, res.stt.MISTRAL_API_KEY);
      set(STT_MISTRAL_API_BASE_URL, res.stt.MISTRAL_API_BASE_URL);
      set(STT_MISTRAL_USE_CHAT_COMPLETIONS, res.stt.MISTRAL_USE_CHAT_COMPLETIONS);
    }
    await getVoices$1();
    await getModels2();
  });
  init();
  var form = root$j();
  var div = child(form);
  var div_1 = child(div);
  var div_2 = child(div_1);
  var div_3 = child(div_2);
  var text2 = child(div_3, true);
  reset(div_3);
  var node = sibling(div_3, 4);
  {
    var consequent = ($$anchor2) => {
      var div_4 = root_1$j();
      var div_5 = child(div_4);
      var text_1 = child(div_5, true);
      reset(div_5);
      var div_6 = sibling(div_5, 2);
      var div_7 = child(div_6);
      var input = child(div_7);
      remove_input_defaults(input);
      reset(div_7);
      reset(div_6);
      reset(div_4);
      template_effect(
        ($0, $1) => {
          set_text(text_1, $0);
          set_attribute(input, "placeholder", $1);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("Supported MIME Types"))),
          () => ($i18n(), untrack(() => $i18n().t("e.g., audio/wav,audio/mpeg,video/* (leave blank for defaults)")))
        ]
      );
      bind_value(input, () => get(STT_SUPPORTED_CONTENT_TYPES), ($$value) => set(STT_SUPPORTED_CONTENT_TYPES, $$value));
      append($$anchor2, div_4);
    };
    if_block(node, ($$render) => {
      if (get(STT_ENGINE) !== "web") $$render(consequent);
    });
  }
  var div_8 = sibling(node, 2);
  var div_9 = child(div_8);
  var text_2 = child(div_9, true);
  reset(div_9);
  var div_10 = sibling(div_9, 2);
  var select = child(div_10);
  template_effect(() => {
    get(STT_ENGINE);
    invalidate_inner_signals(() => {
      $i18n();
    });
  });
  var option = child(select);
  var text_3 = child(option, true);
  reset(option);
  option.value = option.__value = "";
  var option_1 = sibling(option);
  var text_4 = child(option_1, true);
  reset(option_1);
  option_1.value = option_1.__value = "openai";
  var option_2 = sibling(option_1);
  var text_5 = child(option_2, true);
  reset(option_2);
  option_2.value = option_2.__value = "web";
  var option_3 = sibling(option_2);
  var text_6 = child(option_3, true);
  reset(option_3);
  option_3.value = option_3.__value = "deepgram";
  var option_4 = sibling(option_3);
  var text_7 = child(option_4, true);
  reset(option_4);
  option_4.value = option_4.__value = "azure";
  var option_5 = sibling(option_4);
  var text_8 = child(option_5, true);
  reset(option_5);
  option_5.value = option_5.__value = "mistral";
  reset(select);
  reset(div_10);
  reset(div_8);
  var node_1 = sibling(div_8, 2);
  {
    var consequent_1 = ($$anchor2) => {
      var fragment = root_2$g();
      var div_11 = first_child(fragment);
      var div_12 = child(div_11);
      var input_1 = child(div_12);
      remove_input_defaults(input_1);
      var node_2 = sibling(input_1, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
        SensitiveInput(node_2, {
          get placeholder() {
            return get($0);
          },
          get value() {
            return get(STT_OPENAI_API_KEY);
          },
          set value($$value) {
            set(STT_OPENAI_API_KEY, $$value);
          },
          $$legacy: true
        });
      }
      reset(div_12);
      reset(div_11);
      var div_13 = sibling(div_11, 4);
      var div_14 = child(div_13);
      var text_9 = child(div_14, true);
      reset(div_14);
      var div_15 = sibling(div_14, 2);
      var div_16 = child(div_15);
      var input_2 = child(div_16);
      remove_input_defaults(input_2);
      var datalist = sibling(input_2, 2);
      var option_6 = child(datalist);
      option_6.value = option_6.__value = "whisper-1";
      reset(datalist);
      reset(div_16);
      reset(div_15);
      reset(div_13);
      template_effect(
        ($0, $1, $2) => {
          set_attribute(input_1, "placeholder", $0);
          set_text(text_9, $1);
          set_attribute(input_2, "placeholder", $2);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("API Base URL"))),
          () => ($i18n(), untrack(() => $i18n().t("STT Model"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a model")))
        ]
      );
      bind_value(input_1, () => get(STT_OPENAI_API_BASE_URL), ($$value) => set(STT_OPENAI_API_BASE_URL, $$value));
      bind_value(input_2, () => get(STT_MODEL), ($$value) => set(STT_MODEL, $$value));
      append($$anchor2, fragment);
    };
    var alternate_4 = ($$anchor2) => {
      var fragment_1 = comment();
      var node_3 = first_child(fragment_1);
      {
        var consequent_2 = ($$anchor3) => {
          var fragment_2 = root_4$e();
          var div_17 = first_child(fragment_2);
          var div_18 = child(div_17);
          var node_4 = child(div_18);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
            SensitiveInput(node_4, {
              get placeholder() {
                return get($0);
              },
              get value() {
                return get(STT_DEEPGRAM_API_KEY);
              },
              set value($$value) {
                set(STT_DEEPGRAM_API_KEY, $$value);
              },
              $$legacy: true
            });
          }
          reset(div_18);
          reset(div_17);
          var div_19 = sibling(div_17, 4);
          var div_20 = child(div_19);
          var text_10 = child(div_20, true);
          reset(div_20);
          var div_21 = sibling(div_20, 2);
          var div_22 = child(div_21);
          var input_3 = child(div_22);
          remove_input_defaults(input_3);
          reset(div_22);
          reset(div_21);
          var div_23 = sibling(div_21, 2);
          var text_11 = child(div_23);
          var a_1 = sibling(text_11);
          var text_12 = child(a_1, true);
          reset(a_1);
          reset(div_23);
          reset(div_19);
          template_effect(
            ($0, $1, $2, $3) => {
              set_text(text_10, $0);
              set_attribute(input_3, "placeholder", $1);
              set_text(text_11, `${$2 ?? ""} `);
              set_text(text_12, $3);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("STT Model"))),
              () => ($i18n(), untrack(() => $i18n().t("Select a model (optional)"))),
              () => ($i18n(), untrack(() => $i18n().t("Leave model field empty to use the default model."))),
              () => ($i18n(), untrack(() => $i18n().t("Click here to see available models.")))
            ]
          );
          bind_value(input_3, () => get(STT_MODEL), ($$value) => set(STT_MODEL, $$value));
          append($$anchor3, fragment_2);
        };
        var alternate_3 = ($$anchor3) => {
          var fragment_3 = comment();
          var node_5 = first_child(fragment_3);
          {
            var consequent_3 = ($$anchor4) => {
              var div_24 = root_6$9();
              var div_25 = child(div_24);
              var node_6 = child(div_25);
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
                SensitiveInput(node_6, {
                  get placeholder() {
                    return get($0);
                  },
                  required: true,
                  get value() {
                    return get(STT_AZURE_API_KEY);
                  },
                  set value($$value) {
                    set(STT_AZURE_API_KEY, $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_25);
              var div_26 = sibling(div_25, 4);
              var div_27 = child(div_26);
              var text_13 = child(div_27, true);
              reset(div_27);
              var div_28 = sibling(div_27, 2);
              var div_29 = child(div_28);
              var input_4 = child(div_29);
              remove_input_defaults(input_4);
              reset(div_29);
              reset(div_28);
              reset(div_26);
              var div_30 = sibling(div_26, 2);
              var div_31 = child(div_30);
              var text_14 = child(div_31, true);
              reset(div_31);
              var div_32 = sibling(div_31, 2);
              var div_33 = child(div_32);
              var input_5 = child(div_33);
              remove_input_defaults(input_5);
              reset(div_33);
              reset(div_32);
              reset(div_30);
              var div_34 = sibling(div_30, 2);
              var div_35 = child(div_34);
              var text_15 = child(div_35, true);
              reset(div_35);
              var div_36 = sibling(div_35, 2);
              var div_37 = child(div_36);
              var input_6 = child(div_37);
              remove_input_defaults(input_6);
              reset(div_37);
              reset(div_36);
              reset(div_34);
              var div_38 = sibling(div_34, 2);
              var div_39 = child(div_38);
              var text_16 = child(div_39, true);
              reset(div_39);
              var div_40 = sibling(div_39, 2);
              var div_41 = child(div_40);
              var input_7 = child(div_41);
              remove_input_defaults(input_7);
              reset(div_41);
              reset(div_40);
              reset(div_38);
              reset(div_24);
              template_effect(
                ($0, $1, $2, $3, $4, $5, $6, $7) => {
                  set_text(text_13, $0);
                  set_attribute(input_4, "placeholder", $1);
                  set_text(text_14, $2);
                  set_attribute(input_5, "placeholder", $3);
                  set_text(text_15, $4);
                  set_attribute(input_6, "placeholder", $5);
                  set_text(text_16, $6);
                  set_attribute(input_7, "placeholder", $7);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Azure Region"))),
                  () => ($i18n(), untrack(() => $i18n().t("e.g., westus (leave blank for eastus)"))),
                  () => ($i18n(), untrack(() => $i18n().t("Language Locales"))),
                  () => ($i18n(), untrack(() => $i18n().t("e.g., en-US,ja-JP (leave blank for auto-detect)"))),
                  () => ($i18n(), untrack(() => $i18n().t("Endpoint URL"))),
                  () => ($i18n(), untrack(() => $i18n().t("(leave blank for to use commercial endpoint)"))),
                  () => ($i18n(), untrack(() => $i18n().t("Max Speakers"))),
                  () => ($i18n(), untrack(() => $i18n().t("e.g., 3, 4, 5 (leave blank for default)")))
                ]
              );
              bind_value(input_4, () => get(STT_AZURE_REGION), ($$value) => set(STT_AZURE_REGION, $$value));
              bind_value(input_5, () => get(STT_AZURE_LOCALES), ($$value) => set(STT_AZURE_LOCALES, $$value));
              bind_value(input_6, () => get(STT_AZURE_BASE_URL), ($$value) => set(STT_AZURE_BASE_URL, $$value));
              bind_value(input_7, () => get(STT_AZURE_MAX_SPEAKERS), ($$value) => set(STT_AZURE_MAX_SPEAKERS, $$value));
              append($$anchor4, div_24);
            };
            var alternate_2 = ($$anchor4) => {
              var fragment_4 = comment();
              var node_7 = first_child(fragment_4);
              {
                var consequent_4 = ($$anchor5) => {
                  var fragment_5 = root_8$8();
                  var div_42 = first_child(fragment_5);
                  var div_43 = child(div_42);
                  var input_8 = child(div_43);
                  remove_input_defaults(input_8);
                  var node_8 = sibling(input_8, 2);
                  {
                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
                    SensitiveInput(node_8, {
                      get placeholder() {
                        return get($0);
                      },
                      get value() {
                        return get(STT_MISTRAL_API_KEY);
                      },
                      set value($$value) {
                        set(STT_MISTRAL_API_KEY, $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_43);
                  reset(div_42);
                  var div_44 = sibling(div_42, 4);
                  var div_45 = child(div_44);
                  var text_17 = child(div_45, true);
                  reset(div_45);
                  var div_46 = sibling(div_45, 2);
                  var div_47 = child(div_46);
                  var input_9 = child(div_47);
                  remove_input_defaults(input_9);
                  reset(div_47);
                  reset(div_46);
                  var div_48 = sibling(div_46, 2);
                  var text_18 = child(div_48);
                  var a_2 = sibling(text_18);
                  var text_19 = child(a_2, true);
                  reset(a_2);
                  reset(div_48);
                  reset(div_44);
                  var div_49 = sibling(div_44, 4);
                  var div_50 = child(div_49);
                  var div_51 = child(div_50);
                  var text_20 = child(div_51, true);
                  reset(div_51);
                  var label = sibling(div_51, 2);
                  var input_10 = child(label);
                  remove_input_defaults(input_10);
                  next(2);
                  reset(label);
                  reset(div_50);
                  var div_52 = sibling(div_50, 2);
                  var text_21 = child(div_52, true);
                  reset(div_52);
                  reset(div_49);
                  template_effect(
                    ($0, $1, $2, $3, $4, $5) => {
                      set_attribute(input_8, "placeholder", $0);
                      set_text(text_17, $1);
                      set_text(text_18, `${$2 ?? ""} `);
                      set_text(text_19, $3);
                      set_text(text_20, $4);
                      set_text(text_21, $5);
                    },
                    [
                      () => ($i18n(), untrack(() => $i18n().t("API Base URL"))),
                      () => ($i18n(), untrack(() => $i18n().t("STT Model"))),
                      () => ($i18n(), untrack(() => $i18n().t("Leave empty to use the default model (voxtral-mini-latest)."))),
                      () => ($i18n(), untrack(() => $i18n().t("Learn more about Voxtral transcription."))),
                      () => ($i18n(), untrack(() => $i18n().t("Use Chat Completions API"))),
                      () => ($i18n(), untrack(() => $i18n().t("Use /v1/chat/completions endpoint instead of /v1/audio/transcriptions for potentially better accuracy.")))
                    ]
                  );
                  bind_value(input_8, () => get(STT_MISTRAL_API_BASE_URL), ($$value) => set(STT_MISTRAL_API_BASE_URL, $$value));
                  bind_value(input_9, () => get(STT_MODEL), ($$value) => set(STT_MODEL, $$value));
                  bind_checked(input_10, () => get(STT_MISTRAL_USE_CHAT_COMPLETIONS), ($$value) => set(STT_MISTRAL_USE_CHAT_COMPLETIONS, $$value));
                  append($$anchor5, fragment_5);
                };
                var alternate_1 = ($$anchor5) => {
                  var fragment_6 = comment();
                  var node_9 = first_child(fragment_6);
                  {
                    var consequent_6 = ($$anchor6) => {
                      var div_53 = root_10$7();
                      var div_54 = child(div_53);
                      var text_22 = child(div_54, true);
                      reset(div_54);
                      var div_55 = sibling(div_54, 2);
                      var div_56 = child(div_55);
                      var input_11 = child(div_56);
                      remove_input_defaults(input_11);
                      reset(div_56);
                      var button = sibling(div_56, 2);
                      var node_10 = child(button);
                      {
                        var consequent_5 = ($$anchor7) => {
                          var div_57 = root_11$5();
                          var node_11 = child(div_57);
                          Spinner(node_11, {});
                          reset(div_57);
                          append($$anchor7, div_57);
                        };
                        var alternate = ($$anchor7) => {
                          var svg = root_12$5();
                          append($$anchor7, svg);
                        };
                        if_block(node_10, ($$render) => {
                          if (get(STT_WHISPER_MODEL_LOADING)) $$render(consequent_5);
                          else $$render(alternate, false);
                        });
                      }
                      reset(button);
                      reset(div_55);
                      var div_58 = sibling(div_55, 2);
                      var text_23 = child(div_58);
                      var a_3 = sibling(text_23);
                      var text_24 = child(a_3, true);
                      reset(a_3);
                      reset(div_58);
                      reset(div_53);
                      template_effect(
                        ($0, $1, $2, $3) => {
                          set_text(text_22, $0);
                          set_attribute(input_11, "placeholder", $1);
                          button.disabled = get(STT_WHISPER_MODEL_LOADING);
                          set_text(text_23, `${$2 ?? ""} `);
                          set_text(text_24, $3);
                        },
                        [
                          () => ($i18n(), untrack(() => $i18n().t("STT Model"))),
                          () => ($i18n(), untrack(() => $i18n().t("Set whisper model"))),
                          () => ($i18n(), untrack(() => $i18n().t(`Open WebUI uses faster-whisper internally.`))),
                          () => ($i18n(), untrack(() => $i18n().t(`Click here to learn more about faster-whisper and see the available models.`)))
                        ]
                      );
                      bind_value(input_11, () => get(STT_WHISPER_MODEL), ($$value) => set(STT_WHISPER_MODEL, $$value));
                      event("click", button, () => {
                        sttModelUpdateHandler();
                      });
                      append($$anchor6, div_53);
                    };
                    if_block(
                      node_9,
                      ($$render) => {
                        if (get(STT_ENGINE) === "") $$render(consequent_6);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_6);
                };
                if_block(
                  node_7,
                  ($$render) => {
                    if (get(STT_ENGINE) === "mistral") $$render(consequent_4);
                    else $$render(alternate_1, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_4);
            };
            if_block(
              node_5,
              ($$render) => {
                if (get(STT_ENGINE) === "azure") $$render(consequent_3);
                else $$render(alternate_2, false);
              },
              true
            );
          }
          append($$anchor3, fragment_3);
        };
        if_block(
          node_3,
          ($$render) => {
            if (get(STT_ENGINE) === "deepgram") $$render(consequent_2);
            else $$render(alternate_3, false);
          },
          true
        );
      }
      append($$anchor2, fragment_1);
    };
    if_block(node_1, ($$render) => {
      if (get(STT_ENGINE) === "openai") $$render(consequent_1);
      else $$render(alternate_4, false);
    });
  }
  reset(div_2);
  var div_59 = sibling(div_2, 2);
  var div_60 = child(div_59);
  var text_25 = child(div_60, true);
  reset(div_60);
  var div_61 = sibling(div_60, 4);
  var div_62 = child(div_61);
  var text_26 = child(div_62, true);
  reset(div_62);
  var div_63 = sibling(div_62, 2);
  var select_1 = child(div_63);
  template_effect(() => {
    get(TTS_ENGINE);
    invalidate_inner_signals(() => {
      $i18n();
      get(TTS_VOICE);
      get(TTS_MODEL);
    });
  });
  var option_7 = child(select_1);
  var text_27 = child(option_7, true);
  reset(option_7);
  option_7.value = option_7.__value = "";
  var option_8 = sibling(option_7);
  var text_28 = child(option_8);
  reset(option_8);
  option_8.value = option_8.__value = "transformers";
  var option_9 = sibling(option_8);
  var text_29 = child(option_9, true);
  reset(option_9);
  option_9.value = option_9.__value = "openai";
  var option_10 = sibling(option_9);
  var text_30 = child(option_10, true);
  reset(option_10);
  option_10.value = option_10.__value = "elevenlabs";
  var option_11 = sibling(option_10);
  var text_31 = child(option_11, true);
  reset(option_11);
  option_11.value = option_11.__value = "azure";
  reset(select_1);
  reset(div_63);
  reset(div_61);
  var node_12 = sibling(div_61, 2);
  {
    var consequent_7 = ($$anchor2) => {
      var div_64 = root_13$4();
      var div_65 = child(div_64);
      var input_12 = child(div_65);
      remove_input_defaults(input_12);
      var node_13 = sibling(input_12, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
        SensitiveInput(node_13, {
          get placeholder() {
            return get($0);
          },
          get value() {
            return get(TTS_OPENAI_API_KEY);
          },
          set value($$value) {
            set(TTS_OPENAI_API_KEY, $$value);
          },
          $$legacy: true
        });
      }
      reset(div_65);
      reset(div_64);
      template_effect(($0) => set_attribute(input_12, "placeholder", $0), [() => ($i18n(), untrack(() => $i18n().t("API Base URL")))]);
      bind_value(input_12, () => get(TTS_OPENAI_API_BASE_URL), ($$value) => set(TTS_OPENAI_API_BASE_URL, $$value));
      append($$anchor2, div_64);
    };
    var alternate_6 = ($$anchor2) => {
      var fragment_7 = comment();
      var node_14 = first_child(fragment_7);
      {
        var consequent_8 = ($$anchor3) => {
          var div_66 = root_15$3();
          var div_67 = child(div_66);
          var node_15 = child(div_67);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
            SensitiveInput(node_15, {
              get placeholder() {
                return get($0);
              },
              required: true,
              get value() {
                return get(TTS_API_KEY);
              },
              set value($$value) {
                set(TTS_API_KEY, $$value);
              },
              $$legacy: true
            });
          }
          reset(div_67);
          reset(div_66);
          append($$anchor3, div_66);
        };
        var alternate_5 = ($$anchor3) => {
          var fragment_8 = comment();
          var node_16 = first_child(fragment_8);
          {
            var consequent_9 = ($$anchor4) => {
              var div_68 = root_17$3();
              var div_69 = child(div_68);
              var node_17 = child(div_69);
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("API Key"))));
                SensitiveInput(node_17, {
                  get placeholder() {
                    return get($0);
                  },
                  required: true,
                  get value() {
                    return get(TTS_API_KEY);
                  },
                  set value($$value) {
                    set(TTS_API_KEY, $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_69);
              var div_70 = sibling(div_69, 4);
              var div_71 = child(div_70);
              var text_32 = child(div_71, true);
              reset(div_71);
              var div_72 = sibling(div_71, 2);
              var div_73 = child(div_72);
              var input_13 = child(div_73);
              remove_input_defaults(input_13);
              reset(div_73);
              reset(div_72);
              reset(div_70);
              var div_74 = sibling(div_70, 2);
              var div_75 = child(div_74);
              var text_33 = child(div_75, true);
              reset(div_75);
              var div_76 = sibling(div_75, 2);
              var div_77 = child(div_76);
              var input_14 = child(div_77);
              remove_input_defaults(input_14);
              reset(div_77);
              reset(div_76);
              reset(div_74);
              reset(div_68);
              template_effect(
                ($0, $1, $2, $3) => {
                  set_text(text_32, $0);
                  set_attribute(input_13, "placeholder", $1);
                  set_text(text_33, $2);
                  set_attribute(input_14, "placeholder", $3);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Azure Region"))),
                  () => ($i18n(), untrack(() => $i18n().t("e.g., westus (leave blank for eastus)"))),
                  () => ($i18n(), untrack(() => $i18n().t("Endpoint URL"))),
                  () => ($i18n(), untrack(() => $i18n().t("(leave blank for to use commercial endpoint)")))
                ]
              );
              bind_value(input_13, () => get(TTS_AZURE_SPEECH_REGION), ($$value) => set(TTS_AZURE_SPEECH_REGION, $$value));
              bind_value(input_14, () => get(TTS_AZURE_SPEECH_BASE_URL), ($$value) => set(TTS_AZURE_SPEECH_BASE_URL, $$value));
              append($$anchor4, div_68);
            };
            if_block(
              node_16,
              ($$render) => {
                if (get(TTS_ENGINE) === "azure") $$render(consequent_9);
              },
              true
            );
          }
          append($$anchor3, fragment_8);
        };
        if_block(
          node_14,
          ($$render) => {
            if (get(TTS_ENGINE) === "elevenlabs") $$render(consequent_8);
            else $$render(alternate_5, false);
          },
          true
        );
      }
      append($$anchor2, fragment_7);
    };
    if_block(node_12, ($$render) => {
      if (get(TTS_ENGINE) === "openai") $$render(consequent_7);
      else $$render(alternate_6, false);
    });
  }
  var div_78 = sibling(node_12, 2);
  var node_18 = child(div_78);
  {
    var consequent_10 = ($$anchor2) => {
      var div_79 = root_18$4();
      var div_80 = child(div_79);
      var text_34 = child(div_80, true);
      reset(div_80);
      var div_81 = sibling(div_80, 2);
      var div_82 = child(div_81);
      var select_2 = child(div_82);
      template_effect(() => {
        get(TTS_VOICE);
        invalidate_inner_signals(() => {
          $i18n();
          get(voices);
        });
      });
      var option_12 = child(select_2);
      var text_35 = child(option_12, true);
      reset(option_12);
      option_12.value = option_12.__value = "";
      var node_19 = sibling(option_12);
      each(node_19, 1, () => get(voices), index, ($$anchor3, voice) => {
        var option_13 = root_19$2();
        var text_36 = child(option_13, true);
        reset(option_13);
        var option_13_value = {};
        template_effect(() => {
          set_selected(option_13, (get(TTS_VOICE), get(voice), untrack(() => get(TTS_VOICE) === get(voice).voiceURI)));
          set_text(text_36, (get(voice), untrack(() => get(voice).name)));
          if (option_13_value !== (option_13_value = (get(voice), untrack(() => get(voice).voiceURI)))) {
            option_13.value = (option_13.__value = (get(voice), untrack(() => get(voice).voiceURI))) ?? "";
          }
        });
        append($$anchor3, option_13);
      });
      reset(select_2);
      reset(div_82);
      reset(div_81);
      reset(div_79);
      template_effect(
        ($0, $1) => {
          set_text(text_34, $0);
          set_selected(option_12, get(TTS_VOICE) !== "");
          set_text(text_35, $1);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("TTS Voice"))),
          () => ($i18n(), untrack(() => $i18n().t("Default")))
        ]
      );
      bind_select_value(select_2, () => get(TTS_VOICE), ($$value) => set(TTS_VOICE, $$value));
      append($$anchor2, div_79);
    };
    var alternate_10 = ($$anchor2) => {
      var fragment_9 = comment();
      var node_20 = first_child(fragment_9);
      {
        var consequent_11 = ($$anchor3) => {
          var div_83 = root_21$3();
          var div_84 = child(div_83);
          var text_37 = child(div_84, true);
          reset(div_84);
          var div_85 = sibling(div_84, 2);
          var div_86 = child(div_85);
          var input_15 = child(div_86);
          remove_input_defaults(input_15);
          var datalist_1 = sibling(input_15, 2);
          var option_14 = child(datalist_1);
          option_14.value = option_14.__value = "tts-1";
          reset(datalist_1);
          reset(div_86);
          reset(div_85);
          var div_87 = sibling(div_85, 2);
          var text_38 = child(div_87);
          var a_4 = sibling(text_38);
          var text_39 = child(a_4);
          reset(a_4);
          var a_5 = sibling(a_4, 2);
          var text_40 = child(a_5);
          reset(a_5);
          reset(div_87);
          reset(div_83);
          template_effect(
            ($0, $1, $2, $3, $4) => {
              set_text(text_37, $0);
              set_attribute(input_15, "placeholder", $1);
              set_text(text_38, `${$2 ?? ""}

								To learn more about SpeechT5, `);
              set_text(text_39, `${$3 ?? ""}.`);
              set_text(text_40, `${$4 ?? ""}.`);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("TTS Model"))),
              () => ($i18n(), untrack(() => $i18n().t("CMU ARCTIC speaker embedding name"))),
              () => ($i18n(), untrack(() => $i18n().t(`Open WebUI uses SpeechT5 and CMU Arctic speaker embeddings.`))),
              () => ($i18n(), untrack(() => $i18n().t(`click here`, { name: "SpeechT5" }))),
              () => ($i18n(), untrack(() => $i18n().t(`click here`)))
            ]
          );
          bind_value(input_15, () => get(TTS_MODEL), ($$value) => set(TTS_MODEL, $$value));
          append($$anchor3, div_83);
        };
        var alternate_9 = ($$anchor3) => {
          var fragment_10 = comment();
          var node_21 = first_child(fragment_10);
          {
            var consequent_12 = ($$anchor4) => {
              var fragment_11 = root_23$1();
              var div_88 = first_child(fragment_11);
              var div_89 = child(div_88);
              var div_90 = child(div_89);
              var text_41 = child(div_90, true);
              reset(div_90);
              var div_91 = sibling(div_90, 2);
              var div_92 = child(div_91);
              var input_16 = child(div_92);
              remove_input_defaults(input_16);
              var datalist_2 = sibling(input_16, 2);
              each(datalist_2, 5, () => get(voices), index, ($$anchor5, voice) => {
                var option_15 = root_24$3();
                var text_42 = child(option_15, true);
                reset(option_15);
                var option_15_value = {};
                template_effect(() => {
                  set_text(text_42, (get(voice), untrack(() => get(voice).name)));
                  if (option_15_value !== (option_15_value = (get(voice), untrack(() => get(voice).id)))) {
                    option_15.value = (option_15.__value = (get(voice), untrack(() => get(voice).id))) ?? "";
                  }
                });
                append($$anchor5, option_15);
              });
              reset(datalist_2);
              reset(div_92);
              reset(div_91);
              reset(div_89);
              var div_93 = sibling(div_89, 2);
              var div_94 = child(div_93);
              var text_43 = child(div_94, true);
              reset(div_94);
              var div_95 = sibling(div_94, 2);
              var div_96 = child(div_95);
              var input_17 = child(div_96);
              remove_input_defaults(input_17);
              var datalist_3 = sibling(input_17, 2);
              each(datalist_3, 5, () => get(models2), index, ($$anchor5, model) => {
                var option_16 = root_25$2();
                var option_16_value = {};
                template_effect(() => {
                  if (option_16_value !== (option_16_value = (get(model), untrack(() => get(model).id)))) {
                    option_16.value = (option_16.__value = (get(model), untrack(() => get(model).id))) ?? "";
                  }
                });
                append($$anchor5, option_16);
              });
              reset(datalist_3);
              reset(div_96);
              reset(div_95);
              reset(div_93);
              reset(div_88);
              var div_97 = sibling(div_88, 2);
              var div_98 = child(div_97);
              var div_99 = child(div_98);
              var text_44 = child(div_99, true);
              reset(div_99);
              var div_100 = sibling(div_99, 2);
              var div_101 = child(div_100);
              var node_22 = child(div_101);
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter additional parameters in JSON format"))));
                Textarea(node_22, {
                  className: "w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden",
                  get placeholder() {
                    return get($0);
                  },
                  minSize: 100,
                  get value() {
                    return get(TTS_OPENAI_PARAMS);
                  },
                  set value($$value) {
                    set(TTS_OPENAI_PARAMS, $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_101);
              reset(div_100);
              reset(div_98);
              reset(div_97);
              template_effect(
                ($0, $1, $2, $3, $4) => {
                  set_text(text_41, $0);
                  set_attribute(input_16, "placeholder", $1);
                  set_text(text_43, $2);
                  set_attribute(input_17, "placeholder", $3);
                  set_text(text_44, $4);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("TTS Voice"))),
                  () => ($i18n(), untrack(() => $i18n().t("Select a voice"))),
                  () => ($i18n(), untrack(() => $i18n().t("TTS Model"))),
                  () => ($i18n(), untrack(() => $i18n().t("Select a model"))),
                  () => ($i18n(), untrack(() => $i18n().t("Additional Parameters")))
                ]
              );
              bind_value(input_16, () => get(TTS_VOICE), ($$value) => set(TTS_VOICE, $$value));
              bind_value(input_17, () => get(TTS_MODEL), ($$value) => set(TTS_MODEL, $$value));
              append($$anchor4, fragment_11);
            };
            var alternate_8 = ($$anchor4) => {
              var fragment_12 = comment();
              var node_23 = first_child(fragment_12);
              {
                var consequent_13 = ($$anchor5) => {
                  var div_102 = root_27$2();
                  var div_103 = child(div_102);
                  var div_104 = child(div_103);
                  var text_45 = child(div_104, true);
                  reset(div_104);
                  var div_105 = sibling(div_104, 2);
                  var div_106 = child(div_105);
                  var input_18 = child(div_106);
                  remove_input_defaults(input_18);
                  var datalist_4 = sibling(input_18, 2);
                  each(datalist_4, 5, () => get(voices), index, ($$anchor6, voice) => {
                    var option_17 = root_28$3();
                    var text_46 = child(option_17, true);
                    reset(option_17);
                    var option_17_value = {};
                    template_effect(() => {
                      set_text(text_46, (get(voice), untrack(() => get(voice).name)));
                      if (option_17_value !== (option_17_value = (get(voice), untrack(() => get(voice).id)))) {
                        option_17.value = (option_17.__value = (get(voice), untrack(() => get(voice).id))) ?? "";
                      }
                    });
                    append($$anchor6, option_17);
                  });
                  reset(datalist_4);
                  reset(div_106);
                  reset(div_105);
                  reset(div_103);
                  var div_107 = sibling(div_103, 2);
                  var div_108 = child(div_107);
                  var text_47 = child(div_108, true);
                  reset(div_108);
                  var div_109 = sibling(div_108, 2);
                  var div_110 = child(div_109);
                  var input_19 = child(div_110);
                  remove_input_defaults(input_19);
                  var datalist_5 = sibling(input_19, 2);
                  each(datalist_5, 5, () => get(models2), index, ($$anchor6, model) => {
                    var option_18 = root_29$2();
                    var option_18_value = {};
                    template_effect(() => {
                      if (option_18_value !== (option_18_value = (get(model), untrack(() => get(model).id)))) {
                        option_18.value = (option_18.__value = (get(model), untrack(() => get(model).id))) ?? "";
                      }
                    });
                    append($$anchor6, option_18);
                  });
                  reset(datalist_5);
                  reset(div_110);
                  reset(div_109);
                  reset(div_107);
                  reset(div_102);
                  template_effect(
                    ($0, $1, $2, $3) => {
                      set_text(text_45, $0);
                      set_attribute(input_18, "placeholder", $1);
                      set_text(text_47, $2);
                      set_attribute(input_19, "placeholder", $3);
                    },
                    [
                      () => ($i18n(), untrack(() => $i18n().t("TTS Voice"))),
                      () => ($i18n(), untrack(() => $i18n().t("Select a voice"))),
                      () => ($i18n(), untrack(() => $i18n().t("TTS Model"))),
                      () => ($i18n(), untrack(() => $i18n().t("Select a model")))
                    ]
                  );
                  bind_value(input_18, () => get(TTS_VOICE), ($$value) => set(TTS_VOICE, $$value));
                  bind_value(input_19, () => get(TTS_MODEL), ($$value) => set(TTS_MODEL, $$value));
                  append($$anchor5, div_102);
                };
                var alternate_7 = ($$anchor5) => {
                  var fragment_13 = comment();
                  var node_24 = first_child(fragment_13);
                  {
                    var consequent_14 = ($$anchor6) => {
                      var div_111 = root_31$3();
                      var div_112 = child(div_111);
                      var div_113 = child(div_112);
                      var text_48 = child(div_113, true);
                      reset(div_113);
                      var div_114 = sibling(div_113, 2);
                      var div_115 = child(div_114);
                      var input_20 = child(div_115);
                      remove_input_defaults(input_20);
                      var datalist_6 = sibling(input_20, 2);
                      each(datalist_6, 5, () => get(voices), index, ($$anchor7, voice) => {
                        var option_19 = root_32$3();
                        var text_49 = child(option_19, true);
                        reset(option_19);
                        var option_19_value = {};
                        template_effect(() => {
                          set_text(text_49, (get(voice), untrack(() => get(voice).name)));
                          if (option_19_value !== (option_19_value = (get(voice), untrack(() => get(voice).id)))) {
                            option_19.value = (option_19.__value = (get(voice), untrack(() => get(voice).id))) ?? "";
                          }
                        });
                        append($$anchor7, option_19);
                      });
                      reset(datalist_6);
                      reset(div_115);
                      reset(div_114);
                      reset(div_112);
                      var div_116 = sibling(div_112, 2);
                      var div_117 = child(div_116);
                      var text_50 = child(div_117);
                      var a_6 = sibling(text_50);
                      var small = child(a_6);
                      var text_51 = child(small, true);
                      reset(small);
                      reset(a_6);
                      reset(div_117);
                      var div_118 = sibling(div_117, 2);
                      var div_119 = child(div_118);
                      var input_21 = child(div_119);
                      remove_input_defaults(input_21);
                      reset(div_119);
                      reset(div_118);
                      reset(div_116);
                      reset(div_111);
                      template_effect(
                        ($0, $1, $2, $3, $4) => {
                          set_text(text_48, $0);
                          set_attribute(input_20, "placeholder", $1);
                          set_text(text_50, `${$2 ?? ""} `);
                          set_text(text_51, $3);
                          set_attribute(input_21, "placeholder", $4);
                        },
                        [
                          () => ($i18n(), untrack(() => $i18n().t("TTS Voice"))),
                          () => ($i18n(), untrack(() => $i18n().t("Select a voice"))),
                          () => ($i18n(), untrack(() => $i18n().t("Output format"))),
                          () => ($i18n(), untrack(() => $i18n().t("Available list"))),
                          () => ($i18n(), untrack(() => $i18n().t("Select an output format")))
                        ]
                      );
                      bind_value(input_20, () => get(TTS_VOICE), ($$value) => set(TTS_VOICE, $$value));
                      bind_value(input_21, () => get(TTS_AZURE_SPEECH_OUTPUT_FORMAT), ($$value) => set(TTS_AZURE_SPEECH_OUTPUT_FORMAT, $$value));
                      append($$anchor6, div_111);
                    };
                    if_block(
                      node_24,
                      ($$render) => {
                        if (get(TTS_ENGINE) === "azure") $$render(consequent_14);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_13);
                };
                if_block(
                  node_23,
                  ($$render) => {
                    if (get(TTS_ENGINE) === "elevenlabs") $$render(consequent_13);
                    else $$render(alternate_7, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_12);
            };
            if_block(
              node_21,
              ($$render) => {
                if (get(TTS_ENGINE) === "openai") $$render(consequent_12);
                else $$render(alternate_8, false);
              },
              true
            );
          }
          append($$anchor3, fragment_10);
        };
        if_block(
          node_20,
          ($$render) => {
            if (get(TTS_ENGINE) === "transformers") $$render(consequent_11);
            else $$render(alternate_9, false);
          },
          true
        );
      }
      append($$anchor2, fragment_9);
    };
    if_block(node_18, ($$render) => {
      if (get(TTS_ENGINE) === "") $$render(consequent_10);
      else $$render(alternate_10, false);
    });
  }
  reset(div_78);
  var div_120 = sibling(div_78, 2);
  var div_121 = child(div_120);
  var text_52 = child(div_121, true);
  reset(div_121);
  var div_122 = sibling(div_121, 2);
  var select_3 = child(div_122);
  template_effect(() => {
    get(TTS_SPLIT_ON);
    invalidate_inner_signals(() => {
      $i18n();
    });
  });
  each(
    select_3,
    5,
    () => (deep_read_state(TTS_RESPONSE_SPLIT), untrack(() => Object.values(TTS_RESPONSE_SPLIT))),
    index,
    ($$anchor2, split) => {
      var option_20 = root_33$2();
      var text_53 = child(option_20, true);
      reset(option_20);
      var option_20_value = {};
      template_effect(
        ($0) => {
          set_text(text_53, $0);
          if (option_20_value !== (option_20_value = get(split))) {
            option_20.value = (option_20.__value = get(split)) ?? "";
          }
        },
        [
          () => ($i18n(), get(split), untrack(() => $i18n().t(get(split).charAt(0).toUpperCase() + get(split).slice(1))))
        ]
      );
      append($$anchor2, option_20);
    }
  );
  reset(select_3);
  reset(div_122);
  reset(div_120);
  var div_123 = sibling(div_120, 2);
  var text_54 = child(div_123, true);
  reset(div_123);
  reset(div_59);
  reset(div_1);
  reset(div);
  var div_124 = sibling(div, 2);
  var button_1 = child(div_124);
  var text_55 = child(button_1, true);
  reset(button_1);
  reset(div_124);
  reset(form);
  template_effect(
    ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21) => {
      set_text(text2, $0);
      set_text(text_2, $1);
      set_attribute(select, "placeholder", $2);
      set_text(text_3, $3);
      set_text(text_4, $4);
      set_text(text_5, $5);
      set_text(text_6, $6);
      set_text(text_7, $7);
      set_text(text_8, $8);
      set_text(text_25, $9);
      set_text(text_26, $10);
      set_attribute(select_1, "placeholder", $11);
      set_text(text_27, $12);
      set_text(text_28, `${$13 ?? ""} (${$14 ?? ""})`);
      set_text(text_29, $15);
      set_text(text_30, $16);
      set_text(text_31, $17);
      set_text(text_52, $18);
      set_attribute(select_3, "aria-label", $19);
      set_text(text_54, $20);
      set_text(text_55, $21);
    },
    [
      () => ($i18n(), untrack(() => $i18n().t("Speech-to-Text"))),
      () => ($i18n(), untrack(() => $i18n().t("Speech-to-Text Engine"))),
      () => ($i18n(), untrack(() => $i18n().t("Select an engine"))),
      () => ($i18n(), untrack(() => $i18n().t("Whisper (Local)"))),
      () => ($i18n(), untrack(() => $i18n().t("OpenAI"))),
      () => ($i18n(), untrack(() => $i18n().t("Web API"))),
      () => ($i18n(), untrack(() => $i18n().t("Deepgram"))),
      () => ($i18n(), untrack(() => $i18n().t("Azure AI Speech"))),
      () => ($i18n(), untrack(() => $i18n().t("MistralAI"))),
      () => ($i18n(), untrack(() => $i18n().t("Text-to-Speech"))),
      () => ($i18n(), untrack(() => $i18n().t("Text-to-Speech Engine"))),
      () => ($i18n(), untrack(() => $i18n().t("Select a mode"))),
      () => ($i18n(), untrack(() => $i18n().t("Web API"))),
      () => ($i18n(), untrack(() => $i18n().t("Transformers"))),
      () => ($i18n(), untrack(() => $i18n().t("Local"))),
      () => ($i18n(), untrack(() => $i18n().t("OpenAI"))),
      () => ($i18n(), untrack(() => $i18n().t("ElevenLabs"))),
      () => ($i18n(), untrack(() => $i18n().t("Azure AI Speech"))),
      () => ($i18n(), untrack(() => $i18n().t("Response splitting"))),
      () => ($i18n(), untrack(() => $i18n().t("Select how to split message text for TTS requests"))),
      () => ($i18n(), untrack(() => $i18n().t("Control how message text is split for TTS requests. 'Punctuation' splits into sentences, 'paragraphs' splits into paragraphs, and 'none' keeps the message as a single string."))),
      () => ($i18n(), untrack(() => $i18n().t("Save")))
    ]
  );
  bind_select_value(select, () => get(STT_ENGINE), ($$value) => set(STT_ENGINE, $$value));
  bind_select_value(select_1, () => get(TTS_ENGINE), ($$value) => set(TTS_ENGINE, $$value));
  event("change", select_1, async (e) => {
    var _a;
    await updateConfigHandler();
    await getVoices$1();
    await getModels2();
    if (((_a = e.target) == null ? void 0 : _a.value) === "openai") {
      set(TTS_VOICE, "alloy");
      set(TTS_MODEL, "tts-1");
    } else {
      set(TTS_VOICE, "");
      set(TTS_MODEL, "");
    }
  });
  bind_select_value(select_3, () => get(TTS_SPLIT_ON), ($$value) => set(TTS_SPLIT_ON, $$value));
  event("submit", form, preventDefault(async () => {
    await updateConfigHandler();
    dispatch("save");
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root_1$i = from_html(`<div class="flex h-full flex-col"><div class=" sticky top-0 z-30 flex justify-between bg-white px-4.5 pt-3 pb-3 dark:bg-gray-900 dark:text-gray-100"><div class=" font-primary self-center text-lg font-medium"> </div> <button class="self-center" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg></button></div> <div class="flex h-full w-full flex-1 flex-col md:flex-row md:space-x-4 dark:text-gray-200 overflow-y-auto"><div class=" flex h-full w-full flex-col sm:flex-row sm:justify-center sm:space-x-6"><!></div></div></div>`);
function CodeEditorModal($$anchor, $$props) {
  push($$props, true);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let show = prop($$props, "show", 15), value2 = prop($$props, "value", 15), lang = prop($$props, "lang", 3, "python"), onChange = prop($$props, "onChange", 3, () => {
  }), onSave = prop($$props, "onSave", 3, () => {
  });
  let boilerplate = ``;
  let codeEditor = state(null);
  let _content = proxy(value2());
  user_effect(() => {
    if (_content) {
      value2(_content);
    }
  });
  Drawer($$anchor, {
    get show() {
      return show();
    },
    set show($$value) {
      show($$value);
    },
    children: ($$anchor2, $$slotProps) => {
      var div = root_1$i();
      var div_1 = child(div);
      var div_2 = child(div_1);
      var text2 = child(div_2, true);
      reset(div_2);
      var button = sibling(div_2, 2);
      button.__click = () => {
        show(false);
      };
      reset(div_1);
      var div_3 = sibling(div_1, 2);
      var div_4 = child(div_3);
      var node = child(div_4);
      bind_this(
        CodeEditor(node, {
          get value() {
            return value2();
          },
          boilerplate,
          get lang() {
            return lang();
          },
          get onChange() {
            return onChange();
          },
          get onSave() {
            return onSave();
          }
        }),
        ($$value) => set(codeEditor, $$value, true),
        () => get(codeEditor)
      );
      reset(div_4);
      reset(div_3);
      reset(div);
      template_effect(($0) => set_text(text2, $0), [() => $i18n().t("Code Editor")]);
      append($$anchor2, div);
    },
    $$slots: { default: true }
  });
  pop();
  $$cleanup();
}
delegate(["click"]);
var root_4$d = from_html(`<option> </option>`);
var root_3$d = from_html(`<input list="model-list" class=" text-right text-sm bg-transparent outline-hidden max-w-full w-52" required/> <datalist id="model-list"></datalist>`, 1);
var root_5$9 = from_html(`<input class="  text-right text-sm bg-transparent outline-hidden max-w-full w-52"/>`);
var root_7$7 = from_html(`<input class=" text-right text-sm bg-transparent outline-hidden" required/>`);
var root_6$8 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <!></div></div>`);
var root_2$f = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div class="shrink-0"> </div></div> <!></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div class="shrink-0"> </div></div> <!></div></div> <!> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <!></div></div>`, 1);
var root_8$7 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div></div> <div class="mt-1.5 flex w-full"><div class="flex-1 mr-2"><!></div></div></div>`, 1);
var root_10$6 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1 mr-2"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div> <button class="  transition" type="button" aria-label="verify connection"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z" clip-rule="evenodd"></path></svg></button></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" text-gray-300 font-medium" href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/3734" target="_blank"> </a></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" text-gray-300 font-medium" href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/13993" target="_blank"> </a></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div></div> <div class="mt-1.5 flex w-full"><div class="flex-1 mr-2"><!></div></div></div>`, 1);
var root_13$3 = from_html(`<button class="text-xs text-gray-700 dark:text-gray-400 underline" type="button"> </button>`);
var root_14$3 = from_html(`<button class="text-xs text-gray-700 dark:text-gray-400 underline" type="button"> </button>`);
var root_17$2 = from_html(`<input class="py-1 w-24 text-xs bg-transparent outline-hidden" required/>`);
var root_18$3 = from_html(`<input class="w-full py-1 text-xs bg-transparent outline-hidden"/>`);
var root_16$6 = from_html(`<div class="flex w-full flex-col"><div class="shrink-0"><div class=" capitalize line-clamp-1 w-20 text-gray-400 dark:text-gray-500"> </div></div> <div class="flex mt-0.5 items-center"><div><!></div> <div class="px-2 text-gray-400 dark:text-gray-500">:</div> <div class="w-full"><!></div></div></div>`);
var root_15$2 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div></div> <div class="mt-1 text-xs flex flex-col gap-1.5"></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> </div></div>`);
var root_12$4 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1 mr-2"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div> <button class="  rounded-lg transition" type="button" aria-label="verify connection"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z" clip-rule="evenodd"></path></svg></button></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div> <div class="mb-2.5"><input id="upload-comfyui-workflow-input" hidden="" type="file" accept=".json"/> <div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1 mr-2 justify-end flex gap-1"><!> <!></div></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"><!> </div></div> <!>`, 1);
var root_20$5 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <select class=" dark:bg-gray-900 w-fit pr-8 cursor-pointer rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option>predict</option><option>generateContent</option></select></div></div>`, 1);
var root_23 = from_html(`<option> </option>`);
var root_22$3 = from_html(`<input list="model-list" class="text-right text-sm bg-transparent outline-hidden max-w-full w-52"/> <datalist id="model-list"></datalist>`, 1);
var root_24$2 = from_html(`<input class="text-right text-sm bg-transparent outline-hidden max-w-full w-52"/>`);
var root_21$2 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div class="shrink-0"> </div></div> <!></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div class="shrink-0"> </div></div> <!></div></div>`, 1);
var root_25$1 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div></div></div></div>`, 1);
var root_28$2 = from_html(`<button class="text-xs text-gray-700 dark:text-gray-400 underline" type="button"> </button>`);
var root_29$1 = from_html(`<button class="text-xs text-gray-700 dark:text-gray-400 underline" type="button"> </button>`);
var root_32$2 = from_html(`<input class="py-1 w-24 text-xs bg-transparent outline-hidden" required/>`);
var root_33$1 = from_html(`<input class="w-full py-1 text-xs bg-transparent outline-hidden"/>`);
var root_31$2 = from_html(`<div class="flex w-full flex-col"><div class="shrink-0"><div class=" capitalize line-clamp-1 w-20 text-gray-400 dark:text-gray-500"> </div></div> <div class="flex mt-0.5 items-center"><div><!></div> <div class="px-2 text-gray-400 dark:text-gray-500">:</div> <div class="w-full"><!></div></div></div>`);
var root_30$3 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div></div> <div class="mt-1 text-xs flex flex-col gap-1.5"></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> </div></div>`);
var root_27$1 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1 mr-2"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div> <button class="  transition" type="button" aria-label="verify connection"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z" clip-rule="evenodd"></path></svg></button></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div> <div class="mb-2.5"><input id="upload-comfyui-edit-workflow-input" hidden="" type="file" accept=".json"/> <div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1 mr-2 justify-end flex gap-1"><!> <!></div></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"><!> </div></div> <!>`, 1);
var root_35$1 = from_html(`<div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm bg-transparent outline-hidden text-right"/></div></div></div></div> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2 shrink-0"><div> </div></div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div>`, 1);
var root_1$h = from_html(`<div><div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <!></div></div></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <!> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <select class=" dark:bg-gray-900 w-fit pr-8 cursor-pointer rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option><option> </option></select></div></div> <!></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <!></div></div> <!> <div class="mb-2.5"><div class="flex w-full justify-between items-center"><div class="text-xs pr-2"><div> </div></div> <select class=" dark:bg-gray-900 w-fit pr-8 cursor-pointer rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option></select></div></div> <!></div></div>`);
var root_36$3 = from_html(`<div class="ml-2 self-center"><!></div>`);
var root$i = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class=" space-y-3 overflow-y-scroll scrollbar-hidden pr-2"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button type="submit"> <!></button></div></form>`);
function Images($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $user = () => store_get(user, "$user", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const dispatch = createEventDispatcher();
  const i18n = getContext("i18n");
  let loading = mutable_source(false);
  let models2 = mutable_source(null);
  let config$1 = mutable_source(null);
  let showComfyUIWorkflowEditor = mutable_source(false);
  let REQUIRED_WORKFLOW_NODES = mutable_source([
    { type: "prompt", key: "text", node_ids: "" },
    { type: "model", key: "ckpt_name", node_ids: "" },
    { type: "width", key: "width", node_ids: "" },
    { type: "height", key: "height", node_ids: "" },
    { type: "steps", key: "steps", node_ids: "" },
    { type: "seed", key: "seed", node_ids: "" }
  ]);
  let showComfyUIEditWorkflowEditor = mutable_source(false);
  let REQUIRED_EDIT_WORKFLOW_NODES = mutable_source([
    { type: "image", key: "image", node_ids: "" },
    { type: "prompt", key: "prompt", node_ids: "" },
    { type: "model", key: "unet_name", node_ids: "" },
    { type: "width", key: "width", node_ids: "" },
    { type: "height", key: "height", node_ids: "" }
  ]);
  const getModels2 = async () => {
    set(models2, await getImageGenerationModels(localStorage.token).catch((error) => {
      toast.error(`${error}`);
      return null;
    }));
  };
  const updateConfigHandler = async () => {
    if (get(config$1).IMAGE_GENERATION_ENGINE === "automatic1111" && get(config$1).AUTOMATIC1111_BASE_URL === "") {
      toast.error($i18n().t("AUTOMATIC1111 Base URL is required."));
      mutate(config$1, get(config$1).ENABLE_IMAGE_GENERATION = false);
      return null;
    } else if (get(config$1).IMAGE_GENERATION_ENGINE === "comfyui" && get(config$1).COMFYUI_BASE_URL === "") {
      toast.error($i18n().t("ComfyUI Base URL is required."));
      mutate(config$1, get(config$1).ENABLE_IMAGE_GENERATION = false);
      return null;
    } else if (get(config$1).IMAGE_GENERATION_ENGINE === "openai" && get(config$1).IMAGES_OPENAI_API_KEY === "") {
      toast.error($i18n().t("OpenAI API Key is required."));
      mutate(config$1, get(config$1).ENABLE_IMAGE_GENERATION = false);
      return null;
    } else if (get(config$1).IMAGE_GENERATION_ENGINE === "gemini" && get(config$1).IMAGES_GEMINI_API_KEY === "") {
      toast.error($i18n().t("Gemini API Key is required."));
      mutate(config$1, get(config$1).ENABLE_IMAGE_GENERATION = false);
      return null;
    }
    const res = await updateConfig(localStorage.token, {
      ...get(config$1),
      AUTOMATIC1111_PARAMS: typeof get(config$1).AUTOMATIC1111_PARAMS === "string" && get(config$1).AUTOMATIC1111_PARAMS.trim() !== "" ? JSON.parse(get(config$1).AUTOMATIC1111_PARAMS) : {},
      IMAGES_OPENAI_API_PARAMS: typeof get(config$1).IMAGES_OPENAI_API_PARAMS === "string" && get(config$1).IMAGES_OPENAI_API_PARAMS.trim() !== "" ? JSON.parse(get(config$1).IMAGES_OPENAI_API_PARAMS) : {}
    }).catch((error) => {
      toast.error(`${error}`);
      return null;
    });
    if (res) {
      if (res.ENABLE_IMAGE_GENERATION) {
        config.set(await getBackendConfig());
        getModels2();
      }
      return res;
    }
    return null;
  };
  const validateJSON = (json) => {
    try {
      const obj = JSON.parse(json);
      if (obj && typeof obj === "object") {
        return true;
      }
    } catch (e) {
    }
    return false;
  };
  const saveHandler = async () => {
    var _a, _b, _c, _d;
    set(loading, true);
    if ((_a = get(config$1)) == null ? void 0 : _a.COMFYUI_WORKFLOW) {
      if (!validateJSON((_b = get(config$1)) == null ? void 0 : _b.COMFYUI_WORKFLOW)) {
        toast.error($i18n().t("Invalid JSON format for ComfyUI Workflow."));
        set(loading, false);
        return;
      }
      mutate(config$1, get(config$1).COMFYUI_WORKFLOW_NODES = get(REQUIRED_WORKFLOW_NODES).map((node) => {
        return {
          type: node.type,
          key: node.key,
          node_ids: node.node_ids.trim() === "" ? [] : node.node_ids.split(",").map((id) => id.trim())
        };
      }));
    }
    if ((_c = get(config$1)) == null ? void 0 : _c.IMAGES_EDIT_COMFYUI_WORKFLOW) {
      if (!validateJSON((_d = get(config$1)) == null ? void 0 : _d.IMAGES_EDIT_COMFYUI_WORKFLOW)) {
        toast.error($i18n().t("Invalid JSON format for ComfyUI Edit Workflow."));
        set(loading, false);
        return;
      }
      mutate(config$1, get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW_NODES = get(REQUIRED_EDIT_WORKFLOW_NODES).map((node) => {
        return {
          type: node.type,
          key: node.key,
          node_ids: node.node_ids.trim() === "" ? [] : node.node_ids.split(",").map((id) => id.trim())
        };
      }));
    }
    const res = await updateConfigHandler();
    if (res) {
      dispatch("save");
    }
    set(loading, false);
  };
  onMount(async () => {
    var _a;
    if (((_a = $user()) == null ? void 0 : _a.role) === "admin") {
      const res = await getConfig(localStorage.token).catch((error) => {
        toast.error(`${error}`);
        return null;
      });
      if (res) {
        set(config$1, res);
      }
      if (get(config$1).ENABLE_IMAGE_GENERATION) {
        getModels2();
      }
      if (get(config$1).COMFYUI_WORKFLOW) {
        try {
          mutate(config$1, get(config$1).COMFYUI_WORKFLOW = JSON.stringify(JSON.parse(get(config$1).COMFYUI_WORKFLOW), null, 2));
        } catch (e) {
          console.error(e);
        }
      }
      set(REQUIRED_WORKFLOW_NODES, get(REQUIRED_WORKFLOW_NODES).map((node) => {
        const n = get(config$1).COMFYUI_WORKFLOW_NODES.find((n2) => n2.type === node.type) ?? node;
        console.debug(n);
        return {
          type: n.type,
          key: n.key,
          node_ids: typeof n.node_ids === "string" ? n.node_ids : n.node_ids.join(",")
        };
      }));
      if (get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW) {
        try {
          mutate(config$1, get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW = JSON.stringify(JSON.parse(get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW), null, 2));
        } catch (e) {
          console.error(e);
        }
      }
      mutate(config$1, get(config$1).IMAGES_OPENAI_API_PARAMS = typeof get(config$1).IMAGES_OPENAI_API_PARAMS === "object" ? JSON.stringify(get(config$1).IMAGES_OPENAI_API_PARAMS ?? {}, null, 2) : get(config$1).IMAGES_OPENAI_API_PARAMS);
      mutate(config$1, get(config$1).AUTOMATIC1111_PARAMS = typeof get(config$1).AUTOMATIC1111_PARAMS === "object" ? JSON.stringify(get(config$1).AUTOMATIC1111_PARAMS ?? {}, null, 2) : get(config$1).AUTOMATIC1111_PARAMS);
      set(REQUIRED_EDIT_WORKFLOW_NODES, get(REQUIRED_EDIT_WORKFLOW_NODES).map((node) => {
        const n = get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW_NODES.find((n2) => n2.type === node.type) ?? node;
        console.debug(n);
        return {
          type: n.type,
          key: n.key,
          node_ids: typeof n.node_ids === "string" ? n.node_ids : n.node_ids.join(",")
        };
      }));
    }
  });
  init();
  var form = root$i();
  var div = child(form);
  var node_1 = child(div);
  {
    var consequent_14 = ($$anchor2) => {
      var div_1 = root_1$h();
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text2 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var div_6 = child(div_5);
      var div_7 = child(div_6);
      var text_1 = child(div_7, true);
      reset(div_7);
      reset(div_6);
      var node_2 = sibling(div_6, 2);
      Switch_1(node_2, {
        get state() {
          return get(config$1).ENABLE_IMAGE_GENERATION;
        },
        set state($$value) {
          mutate(config$1, get(config$1).ENABLE_IMAGE_GENERATION = $$value);
        },
        $$legacy: true
      });
      reset(div_5);
      reset(div_4);
      reset(div_2);
      var div_8 = sibling(div_2, 2);
      var div_9 = child(div_8);
      var text_2 = child(div_9, true);
      reset(div_9);
      var node_3 = sibling(div_9, 4);
      {
        var consequent_1 = ($$anchor3) => {
          var fragment = root_2$f();
          var div_10 = first_child(fragment);
          var div_11 = child(div_10);
          var div_12 = child(div_11);
          var div_13 = child(div_12);
          var text_3 = child(div_13, true);
          reset(div_13);
          reset(div_12);
          var node_4 = sibling(div_12, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Enter Model ID"));
            Tooltip(node_4, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var fragment_1 = root_3$d();
                var input = first_child(fragment_1);
                remove_input_defaults(input);
                var datalist = sibling(input, 2);
                each(datalist, 5, () => get(models2) ?? [], index, ($$anchor5, model) => {
                  var option = root_4$d();
                  var text_4 = child(option, true);
                  reset(option);
                  var option_value = {};
                  template_effect(() => {
                    set_text(text_4, get(model).name);
                    if (option_value !== (option_value = get(model).id)) {
                      option.value = (option.__value = get(model).id) ?? "";
                    }
                  });
                  append($$anchor5, option);
                });
                reset(datalist);
                template_effect(($02) => set_attribute(input, "placeholder", $02), [() => $i18n().t("Select a model")]);
                bind_value(input, () => get(config$1).IMAGE_GENERATION_MODEL, ($$value) => mutate(config$1, get(config$1).IMAGE_GENERATION_MODEL = $$value));
                append($$anchor4, fragment_1);
              },
              $$slots: { default: true }
            });
          }
          reset(div_11);
          reset(div_10);
          var div_14 = sibling(div_10, 2);
          var div_15 = child(div_14);
          var div_16 = child(div_15);
          var div_17 = child(div_16);
          var text_5 = child(div_17, true);
          reset(div_17);
          reset(div_16);
          var node_5 = sibling(div_16, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Enter Image Size (e.g. 512x512)"));
            Tooltip(node_5, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input_1 = root_5$9();
                remove_input_defaults(input_1);
                template_effect(($02) => set_attribute(input_1, "placeholder", $02), [() => $i18n().t("Enter Image Size (e.g. 512x512)")]);
                bind_value(input_1, () => get(config$1).IMAGE_SIZE, ($$value) => mutate(config$1, get(config$1).IMAGE_SIZE = $$value));
                append($$anchor4, input_1);
              },
              $$slots: { default: true }
            });
          }
          reset(div_15);
          reset(div_14);
          var node_6 = sibling(div_14, 2);
          {
            var consequent = ($$anchor4) => {
              var div_18 = root_6$8();
              var div_19 = child(div_18);
              var div_20 = child(div_19);
              var div_21 = child(div_20);
              var text_6 = child(div_21, true);
              reset(div_21);
              reset(div_20);
              var node_7 = sibling(div_20, 2);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Enter Number of Steps (e.g. 50)"));
                Tooltip(node_7, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    var input_2 = root_7$7();
                    remove_input_defaults(input_2);
                    template_effect(($02) => set_attribute(input_2, "placeholder", $02), [() => $i18n().t("Enter Number of Steps (e.g. 50)")]);
                    bind_value(input_2, () => get(config$1).IMAGE_STEPS, ($$value) => mutate(config$1, get(config$1).IMAGE_STEPS = $$value));
                    append($$anchor5, input_2);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_19);
              reset(div_18);
              template_effect(($0) => set_text(text_6, $0), [() => $i18n().t("Steps")]);
              append($$anchor4, div_18);
            };
            if_block(node_6, ($$render) => {
              var _a;
              if (["comfyui", "automatic1111", ""].includes((_a = get(config$1)) == null ? void 0 : _a.IMAGE_GENERATION_ENGINE)) $$render(consequent);
            });
          }
          var div_22 = sibling(node_6, 2);
          var div_23 = child(div_22);
          var div_24 = child(div_23);
          var div_25 = child(div_24);
          var text_7 = child(div_25, true);
          reset(div_25);
          reset(div_24);
          var node_8 = sibling(div_24, 2);
          Switch_1(node_8, {
            get state() {
              return get(config$1).ENABLE_IMAGE_PROMPT_GENERATION;
            },
            set state($$value) {
              mutate(config$1, get(config$1).ENABLE_IMAGE_PROMPT_GENERATION = $$value);
            },
            $$legacy: true
          });
          reset(div_23);
          reset(div_22);
          template_effect(
            ($0, $1, $2) => {
              set_text(text_3, $0);
              set_text(text_5, $1);
              set_text(text_7, $2);
            },
            [
              () => $i18n().t("Model"),
              () => $i18n().t("Image Size"),
              () => $i18n().t("Image Prompt Generation")
            ]
          );
          append($$anchor3, fragment);
        };
        if_block(node_3, ($$render) => {
          if (get(config$1).ENABLE_IMAGE_GENERATION) $$render(consequent_1);
        });
      }
      var div_26 = sibling(node_3, 2);
      var div_27 = child(div_26);
      var div_28 = child(div_27);
      var div_29 = child(div_28);
      var text_8 = child(div_29, true);
      reset(div_29);
      reset(div_28);
      var select = sibling(div_28, 2);
      template_effect(() => {
        get(config$1);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option_1 = child(select);
      var text_9 = child(option_1, true);
      reset(option_1);
      option_1.value = option_1.__value = "openai";
      var option_2 = sibling(option_1);
      var text_10 = child(option_2, true);
      reset(option_2);
      option_2.value = option_2.__value = "comfyui";
      var option_3 = sibling(option_2);
      var text_11 = child(option_3, true);
      reset(option_3);
      option_3.value = option_3.__value = "automatic1111";
      var option_4 = sibling(option_3);
      var text_12 = child(option_4, true);
      reset(option_4);
      option_4.value = option_4.__value = "gemini";
      reset(select);
      reset(div_27);
      reset(div_26);
      var node_9 = sibling(div_26, 2);
      {
        var consequent_2 = ($$anchor3) => {
          var fragment_2 = root_8$7();
          var div_30 = first_child(fragment_2);
          var div_31 = child(div_30);
          var div_32 = child(div_31);
          var div_33 = child(div_32);
          var text_13 = child(div_33, true);
          reset(div_33);
          reset(div_32);
          var div_34 = sibling(div_32, 2);
          var div_35 = child(div_34);
          var input_3 = child(div_35);
          remove_input_defaults(input_3);
          reset(div_35);
          reset(div_34);
          reset(div_31);
          reset(div_30);
          var div_36 = sibling(div_30, 2);
          var div_37 = child(div_36);
          var div_38 = child(div_37);
          var div_39 = child(div_38);
          var text_14 = child(div_39, true);
          reset(div_39);
          reset(div_38);
          var div_40 = sibling(div_38, 2);
          var div_41 = child(div_40);
          var node_10 = child(div_41);
          {
            let $0 = derived_safe_equal(() => $i18n().t("API Key"));
            SensitiveInput(node_10, {
              inputClassName: "text-right w-full",
              get placeholder() {
                return get($0);
              },
              required: false,
              get value() {
                return get(config$1).IMAGES_OPENAI_API_KEY;
              },
              set value($$value) {
                mutate(config$1, get(config$1).IMAGES_OPENAI_API_KEY = $$value);
              },
              $$legacy: true
            });
          }
          reset(div_41);
          reset(div_40);
          reset(div_37);
          reset(div_36);
          var div_42 = sibling(div_36, 2);
          var div_43 = child(div_42);
          var div_44 = child(div_43);
          var div_45 = child(div_44);
          var text_15 = child(div_45, true);
          reset(div_45);
          reset(div_44);
          var div_46 = sibling(div_44, 2);
          var div_47 = child(div_46);
          var input_4 = child(div_47);
          remove_input_defaults(input_4);
          reset(div_47);
          reset(div_46);
          reset(div_43);
          reset(div_42);
          var div_48 = sibling(div_42, 2);
          var div_49 = child(div_48);
          var div_50 = child(div_49);
          var div_51 = child(div_50);
          var text_16 = child(div_51, true);
          reset(div_51);
          reset(div_50);
          reset(div_49);
          var div_52 = sibling(div_49, 2);
          var div_53 = child(div_52);
          var node_11 = child(div_53);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Enter additional parameters in JSON format"));
            Textarea(node_11, {
              className: "rounded-lg w-full py-2 px-3 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden",
              get placeholder() {
                return get($0);
              },
              minSize: 100,
              get value() {
                return get(config$1).IMAGES_OPENAI_API_PARAMS;
              },
              set value($$value) {
                mutate(config$1, get(config$1).IMAGES_OPENAI_API_PARAMS = $$value);
              },
              $$legacy: true
            });
          }
          reset(div_53);
          reset(div_52);
          reset(div_48);
          template_effect(
            ($0, $1, $2, $3, $4, $5) => {
              set_text(text_13, $0);
              set_attribute(input_3, "placeholder", $1);
              set_text(text_14, $2);
              set_text(text_15, $3);
              set_attribute(input_4, "placeholder", $4);
              set_text(text_16, $5);
            },
            [
              () => $i18n().t("OpenAI API Base URL"),
              () => $i18n().t("API Base URL"),
              () => $i18n().t("OpenAI API Key"),
              () => $i18n().t("OpenAI API Version"),
              () => $i18n().t("API Version"),
              () => $i18n().t("Additional Parameters")
            ]
          );
          bind_value(input_3, () => get(config$1).IMAGES_OPENAI_API_BASE_URL, ($$value) => mutate(config$1, get(config$1).IMAGES_OPENAI_API_BASE_URL = $$value));
          bind_value(input_4, () => get(config$1).IMAGES_OPENAI_API_VERSION, ($$value) => mutate(config$1, get(config$1).IMAGES_OPENAI_API_VERSION = $$value));
          append($$anchor3, fragment_2);
        };
        var alternate_2 = ($$anchor3) => {
          var fragment_3 = comment();
          var node_12 = first_child(fragment_3);
          {
            var consequent_3 = ($$anchor4) => {
              var fragment_4 = root_10$6();
              var div_54 = first_child(fragment_4);
              var div_55 = child(div_54);
              var div_56 = child(div_55);
              var div_57 = child(div_56);
              var text_17 = child(div_57, true);
              reset(div_57);
              reset(div_56);
              var div_58 = sibling(div_56, 2);
              var div_59 = child(div_58);
              var input_5 = child(div_59);
              remove_input_defaults(input_5);
              reset(div_59);
              var button = sibling(div_59, 2);
              reset(div_58);
              reset(div_55);
              var div_60 = sibling(div_55, 2);
              var text_18 = child(div_60);
              var a = sibling(text_18);
              var text_19 = child(a, true);
              reset(a);
              reset(div_60);
              reset(div_54);
              var div_61 = sibling(div_54, 2);
              var div_62 = child(div_61);
              var div_63 = child(div_62);
              var div_64 = child(div_63);
              var text_20 = child(div_64, true);
              reset(div_64);
              reset(div_63);
              var div_65 = sibling(div_63, 2);
              var div_66 = child(div_65);
              var node_13 = child(div_66);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Enter api auth string (e.g. username:password)"));
                SensitiveInput(node_13, {
                  inputClassName: "text-right w-full",
                  get placeholder() {
                    return get($0);
                  },
                  required: false,
                  get value() {
                    return get(config$1).AUTOMATIC1111_API_AUTH;
                  },
                  set value($$value) {
                    mutate(config$1, get(config$1).AUTOMATIC1111_API_AUTH = $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_66);
              reset(div_65);
              reset(div_62);
              var div_67 = sibling(div_62, 2);
              var text_21 = child(div_67);
              var a_1 = sibling(text_21);
              var text_22 = child(a_1, true);
              reset(a_1);
              reset(div_67);
              reset(div_61);
              var div_68 = sibling(div_61, 2);
              var div_69 = child(div_68);
              var div_70 = child(div_69);
              var div_71 = child(div_70);
              var text_23 = child(div_71, true);
              reset(div_71);
              reset(div_70);
              reset(div_69);
              var div_72 = sibling(div_69, 2);
              var div_73 = child(div_72);
              var node_14 = child(div_73);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Enter additional parameters in JSON format"));
                Textarea(node_14, {
                  className: "rounded-lg w-full py-2 px-3 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden",
                  get placeholder() {
                    return get($0);
                  },
                  minSize: 100,
                  get value() {
                    return get(config$1).AUTOMATIC1111_PARAMS;
                  },
                  set value($$value) {
                    mutate(config$1, get(config$1).AUTOMATIC1111_PARAMS = $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_73);
              reset(div_72);
              reset(div_68);
              template_effect(
                ($0, $1, $2, $3, $4, $5, $6, $7) => {
                  set_text(text_17, $0);
                  set_attribute(input_5, "placeholder", $1);
                  set_text(text_18, `${$2 ?? ""} `);
                  set_text(text_19, $3);
                  set_text(text_20, $4);
                  set_text(text_21, `${$5 ?? ""} `);
                  set_text(text_22, $6);
                  set_text(text_23, $7);
                },
                [
                  () => $i18n().t("AUTOMATIC1111 Base URL"),
                  () => $i18n().t("Enter URL (e.g. http://127.0.0.1:7860/)"),
                  () => $i18n().t("Include `--api` flag when running stable-diffusion-webui"),
                  () => $i18n().t("(e.g. `sh webui.sh --api`)"),
                  () => $i18n().t("AUTOMATIC1111 Api Auth String"),
                  () => $i18n().t("Include `--api-auth` flag when running stable-diffusion-webui"),
                  () => $i18n().t("(e.g. `sh webui.sh --api --api-auth username_password`)").replace("_", ":"),
                  () => $i18n().t("Additional Parameters")
                ]
              );
              bind_value(input_5, () => get(config$1).AUTOMATIC1111_BASE_URL, ($$value) => mutate(config$1, get(config$1).AUTOMATIC1111_BASE_URL = $$value));
              event("click", button, async () => {
                await updateConfigHandler();
                const res = await verifyConfigUrl(localStorage.token).catch((error) => {
                  toast.error(`${error}`);
                  return null;
                });
                if (res) {
                  toast.success($i18n().t("Server connection verified"));
                }
              });
              append($$anchor4, fragment_4);
            };
            var alternate_1 = ($$anchor4) => {
              var fragment_5 = comment();
              var node_15 = first_child(fragment_5);
              {
                var consequent_6 = ($$anchor5) => {
                  var fragment_6 = root_12$4();
                  var div_74 = first_child(fragment_6);
                  var div_75 = child(div_74);
                  var div_76 = child(div_75);
                  var div_77 = child(div_76);
                  var text_24 = child(div_77, true);
                  reset(div_77);
                  reset(div_76);
                  var div_78 = sibling(div_76, 2);
                  var div_79 = child(div_78);
                  var input_6 = child(div_79);
                  remove_input_defaults(input_6);
                  reset(div_79);
                  var button_1 = sibling(div_79, 2);
                  reset(div_78);
                  reset(div_75);
                  reset(div_74);
                  var div_80 = sibling(div_74, 2);
                  var div_81 = child(div_80);
                  var div_82 = child(div_81);
                  var div_83 = child(div_82);
                  var text_25 = child(div_83, true);
                  reset(div_83);
                  reset(div_82);
                  var div_84 = sibling(div_82, 2);
                  var div_85 = child(div_84);
                  var node_16 = child(div_85);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("sk-1234"));
                    SensitiveInput(node_16, {
                      inputClassName: "text-right w-full",
                      get placeholder() {
                        return get($0);
                      },
                      required: false,
                      get value() {
                        return get(config$1).COMFYUI_API_KEY;
                      },
                      set value($$value) {
                        mutate(config$1, get(config$1).COMFYUI_API_KEY = $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_85);
                  reset(div_84);
                  reset(div_81);
                  reset(div_80);
                  var div_86 = sibling(div_80, 2);
                  var input_7 = child(div_86);
                  var div_87 = sibling(input_7, 2);
                  var div_88 = child(div_87);
                  var div_89 = child(div_88);
                  var text_26 = child(div_89, true);
                  reset(div_89);
                  reset(div_88);
                  var div_90 = sibling(div_88, 2);
                  var div_91 = child(div_90);
                  var node_17 = child(div_91);
                  {
                    var consequent_4 = ($$anchor6) => {
                      var button_2 = root_13$3();
                      var text_27 = child(button_2, true);
                      reset(button_2);
                      template_effect(
                        ($0, $1) => {
                          set_attribute(button_2, "aria-label", $0);
                          set_text(text_27, $1);
                        },
                        [
                          () => $i18n().t("Edit workflow.json content"),
                          () => $i18n().t("Edit")
                        ]
                      );
                      event("click", button_2, () => {
                        set(showComfyUIWorkflowEditor, true);
                      });
                      append($$anchor6, button_2);
                    };
                    if_block(node_17, ($$render) => {
                      if (get(config$1).COMFYUI_WORKFLOW) $$render(consequent_4);
                    });
                  }
                  var node_18 = sibling(node_17, 2);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("Click here to upload a workflow.json file."));
                    Tooltip(node_18, {
                      get content() {
                        return get($0);
                      },
                      children: ($$anchor6, $$slotProps) => {
                        var button_3 = root_14$3();
                        var text_28 = child(button_3, true);
                        reset(button_3);
                        template_effect(
                          ($02, $1) => {
                            set_attribute(button_3, "aria-label", $02);
                            set_text(text_28, $1);
                          },
                          [
                            () => $i18n().t("Click here to upload a workflow.json file."),
                            () => $i18n().t("Upload")
                          ]
                        );
                        event("click", button_3, () => {
                          var _a;
                          (_a = document.getElementById("upload-comfyui-workflow-input")) == null ? void 0 : _a.click();
                        });
                        append($$anchor6, button_3);
                      },
                      $$slots: { default: true }
                    });
                  }
                  reset(div_91);
                  reset(div_90);
                  reset(div_87);
                  var div_92 = sibling(div_87, 2);
                  var node_19 = child(div_92);
                  CodeEditorModal(node_19, {
                    get value() {
                      return get(config$1).COMFYUI_WORKFLOW;
                    },
                    lang: "json",
                    onChange: (e) => {
                      mutate(config$1, get(config$1).COMFYUI_WORKFLOW = e);
                    },
                    onSave: () => {
                      console.log("Saved");
                    },
                    get show() {
                      return get(showComfyUIWorkflowEditor);
                    },
                    set show($$value) {
                      set(showComfyUIWorkflowEditor, $$value);
                    },
                    $$legacy: true
                  });
                  var text_29 = sibling(node_19);
                  reset(div_92);
                  reset(div_86);
                  var node_20 = sibling(div_86, 2);
                  {
                    var consequent_5 = ($$anchor6) => {
                      var div_93 = root_15$2();
                      var div_94 = child(div_93);
                      var div_95 = child(div_94);
                      var div_96 = child(div_95);
                      var text_30 = child(div_96, true);
                      reset(div_96);
                      reset(div_95);
                      reset(div_94);
                      var div_97 = sibling(div_94, 2);
                      each(div_97, 5, () => get(REQUIRED_WORKFLOW_NODES), index, ($$anchor7, node, $$index_1) => {
                        var div_98 = root_16$6();
                        var div_99 = child(div_98);
                        var div_100 = child(div_99);
                        var text_31 = child(div_100);
                        reset(div_100);
                        reset(div_99);
                        var div_101 = sibling(div_99, 2);
                        var div_102 = child(div_101);
                        var node_21 = child(div_102);
                        {
                          let $0 = derived_safe_equal(() => $i18n().t("Input Key (e.g. text, unet_name, steps)"));
                          Tooltip(node_21, {
                            get content() {
                              return get($0);
                            },
                            children: ($$anchor8, $$slotProps) => {
                              var input_8 = root_17$2();
                              remove_input_defaults(input_8);
                              template_effect(($02) => set_attribute(input_8, "placeholder", $02), [() => $i18n().t("Key")]);
                              bind_value(input_8, () => get(node).key, ($$value) => (get(node).key = $$value, invalidate_inner_signals(() => get(REQUIRED_WORKFLOW_NODES))));
                              append($$anchor8, input_8);
                            },
                            $$slots: { default: true }
                          });
                        }
                        reset(div_102);
                        var div_103 = sibling(div_102, 4);
                        var node_22 = child(div_103);
                        {
                          let $0 = derived_safe_equal(() => $i18n().t("Comma separated Node Ids (e.g. 1 or 1,2)"));
                          Tooltip(node_22, {
                            get content() {
                              return get($0);
                            },
                            placement: "top-start",
                            children: ($$anchor8, $$slotProps) => {
                              var input_9 = root_18$3();
                              remove_input_defaults(input_9);
                              template_effect(($02) => set_attribute(input_9, "placeholder", $02), [() => $i18n().t("Node Ids")]);
                              bind_value(input_9, () => get(node).node_ids, ($$value) => (get(node).node_ids = $$value, invalidate_inner_signals(() => get(REQUIRED_WORKFLOW_NODES))));
                              append($$anchor8, input_9);
                            },
                            $$slots: { default: true }
                          });
                        }
                        reset(div_103);
                        reset(div_101);
                        reset(div_98);
                        template_effect(() => set_text(text_31, `${get(node).type ?? ""}${get(node).type === "prompt" ? "*" : ""}`));
                        append($$anchor7, div_98);
                      });
                      reset(div_97);
                      var div_104 = sibling(div_97, 2);
                      var text_32 = child(div_104, true);
                      reset(div_104);
                      reset(div_93);
                      template_effect(
                        ($0, $1) => {
                          set_text(text_30, $0);
                          set_text(text_32, $1);
                        },
                        [
                          () => $i18n().t("ComfyUI Workflow Nodes"),
                          () => $i18n().t("*Prompt node ID(s) are required for image generation")
                        ]
                      );
                      append($$anchor6, div_93);
                    };
                    if_block(node_20, ($$render) => {
                      if (get(config$1).COMFYUI_WORKFLOW) $$render(consequent_5);
                    });
                  }
                  template_effect(
                    ($0, $1, $2, $3, $4) => {
                      set_text(text_24, $0);
                      set_attribute(input_6, "placeholder", $1);
                      set_text(text_25, $2);
                      set_text(text_26, $3);
                      set_text(text_29, ` ${$4 ?? ""}`);
                    },
                    [
                      () => $i18n().t("ComfyUI Base URL"),
                      () => $i18n().t("Enter URL (e.g. http://127.0.0.1:7860/)"),
                      () => $i18n().t("ComfyUI API Key"),
                      () => $i18n().t("ComfyUI Workflow"),
                      () => $i18n().t("Make sure to export a workflow.json file as API format from ComfyUI.")
                    ]
                  );
                  bind_value(input_6, () => get(config$1).COMFYUI_BASE_URL, ($$value) => mutate(config$1, get(config$1).COMFYUI_BASE_URL = $$value));
                  event("click", button_1, async () => {
                    await updateConfigHandler();
                    const res = await verifyConfigUrl(localStorage.token).catch((error) => {
                      toast.error(`${error}`);
                      return null;
                    });
                    if (res) {
                      toast.success($i18n().t("Server connection verified"));
                    }
                  });
                  event("change", input_7, (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e2) => {
                      mutate(config$1, get(config$1).COMFYUI_WORKFLOW = e2.target.result);
                      e2.target.value = null;
                    };
                    reader.readAsText(file);
                  });
                  append($$anchor5, fragment_6);
                };
                var alternate = ($$anchor5) => {
                  var fragment_7 = comment();
                  var node_23 = first_child(fragment_7);
                  {
                    var consequent_7 = ($$anchor6) => {
                      var fragment_8 = root_20$5();
                      var div_105 = first_child(fragment_8);
                      var div_106 = child(div_105);
                      var div_107 = child(div_106);
                      var div_108 = child(div_107);
                      var text_33 = child(div_108, true);
                      reset(div_108);
                      reset(div_107);
                      var div_109 = sibling(div_107, 2);
                      var div_110 = child(div_109);
                      var input_10 = child(div_110);
                      remove_input_defaults(input_10);
                      reset(div_110);
                      reset(div_109);
                      reset(div_106);
                      reset(div_105);
                      var div_111 = sibling(div_105, 2);
                      var div_112 = child(div_111);
                      var div_113 = child(div_112);
                      var div_114 = child(div_113);
                      var text_34 = child(div_114, true);
                      reset(div_114);
                      reset(div_113);
                      var div_115 = sibling(div_113, 2);
                      var div_116 = child(div_115);
                      var node_24 = child(div_116);
                      {
                        let $0 = derived_safe_equal(() => $i18n().t("API Key"));
                        SensitiveInput(node_24, {
                          inputClassName: "text-right w-full",
                          get placeholder() {
                            return get($0);
                          },
                          required: true,
                          get value() {
                            return get(config$1).IMAGES_GEMINI_API_KEY;
                          },
                          set value($$value) {
                            mutate(config$1, get(config$1).IMAGES_GEMINI_API_KEY = $$value);
                          },
                          $$legacy: true
                        });
                      }
                      reset(div_116);
                      reset(div_115);
                      reset(div_112);
                      reset(div_111);
                      var div_117 = sibling(div_111, 2);
                      var div_118 = child(div_117);
                      var div_119 = child(div_118);
                      var div_120 = child(div_119);
                      var text_35 = child(div_120, true);
                      reset(div_120);
                      reset(div_119);
                      var select_1 = sibling(div_119, 2);
                      template_effect(() => {
                        get(config$1);
                        invalidate_inner_signals(() => {
                          $i18n();
                        });
                      });
                      var option_5 = child(select_1);
                      option_5.value = option_5.__value = "predict";
                      var option_6 = sibling(option_5);
                      option_6.value = option_6.__value = "generateContent";
                      reset(select_1);
                      reset(div_118);
                      reset(div_117);
                      template_effect(
                        ($0, $1, $2, $3, $4) => {
                          set_text(text_33, $0);
                          set_attribute(input_10, "placeholder", $1);
                          set_text(text_34, $2);
                          set_text(text_35, $3);
                          set_attribute(select_1, "placeholder", $4);
                        },
                        [
                          () => $i18n().t("Gemini Base URL"),
                          () => $i18n().t("API Base URL"),
                          () => $i18n().t("Gemini API Key"),
                          () => $i18n().t("Gemini Endpoint Method"),
                          () => $i18n().t("Select Method")
                        ]
                      );
                      bind_value(input_10, () => get(config$1).IMAGES_GEMINI_API_BASE_URL, ($$value) => mutate(config$1, get(config$1).IMAGES_GEMINI_API_BASE_URL = $$value));
                      bind_select_value(select_1, () => get(config$1).IMAGES_GEMINI_ENDPOINT_METHOD, ($$value) => mutate(config$1, get(config$1).IMAGES_GEMINI_ENDPOINT_METHOD = $$value));
                      append($$anchor6, fragment_8);
                    };
                    if_block(
                      node_23,
                      ($$render) => {
                        var _a;
                        if (((_a = get(config$1)) == null ? void 0 : _a.IMAGE_GENERATION_ENGINE) === "gemini") $$render(consequent_7);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_7);
                };
                if_block(
                  node_15,
                  ($$render) => {
                    var _a;
                    if (((_a = get(config$1)) == null ? void 0 : _a.IMAGE_GENERATION_ENGINE) === "comfyui") $$render(consequent_6);
                    else $$render(alternate, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_5);
            };
            if_block(
              node_12,
              ($$render) => {
                var _a;
                if ((((_a = get(config$1)) == null ? void 0 : _a.IMAGE_GENERATION_ENGINE) ?? "automatic1111") === "automatic1111") $$render(consequent_3);
                else $$render(alternate_1, false);
              },
              true
            );
          }
          append($$anchor3, fragment_3);
        };
        if_block(node_9, ($$render) => {
          var _a;
          if (((_a = get(config$1)) == null ? void 0 : _a.IMAGE_GENERATION_ENGINE) === "openai") $$render(consequent_2);
          else $$render(alternate_2, false);
        });
      }
      reset(div_8);
      var div_121 = sibling(div_8, 2);
      var div_122 = child(div_121);
      var text_36 = child(div_122, true);
      reset(div_122);
      var div_123 = sibling(div_122, 4);
      var div_124 = child(div_123);
      var div_125 = child(div_124);
      var div_126 = child(div_125);
      var text_37 = child(div_126, true);
      reset(div_126);
      reset(div_125);
      var node_25 = sibling(div_125, 2);
      Switch_1(node_25, {
        get state() {
          return get(config$1).ENABLE_IMAGE_EDIT;
        },
        set state($$value) {
          mutate(config$1, get(config$1).ENABLE_IMAGE_EDIT = $$value);
        },
        $$legacy: true
      });
      reset(div_124);
      reset(div_123);
      var node_26 = sibling(div_123, 2);
      {
        var consequent_8 = ($$anchor3) => {
          var fragment_9 = root_21$2();
          var div_127 = first_child(fragment_9);
          var div_128 = child(div_127);
          var div_129 = child(div_128);
          var div_130 = child(div_129);
          var text_38 = child(div_130, true);
          reset(div_130);
          reset(div_129);
          var node_27 = sibling(div_129, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Enter Model ID"));
            Tooltip(node_27, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var fragment_10 = root_22$3();
                var input_11 = first_child(fragment_10);
                remove_input_defaults(input_11);
                var datalist_1 = sibling(input_11, 2);
                each(datalist_1, 5, () => get(models2) ?? [], index, ($$anchor5, model) => {
                  var option_7 = root_23();
                  var text_39 = child(option_7, true);
                  reset(option_7);
                  var option_7_value = {};
                  template_effect(() => {
                    set_text(text_39, get(model).name);
                    if (option_7_value !== (option_7_value = get(model).id)) {
                      option_7.value = (option_7.__value = get(model).id) ?? "";
                    }
                  });
                  append($$anchor5, option_7);
                });
                reset(datalist_1);
                template_effect(($02) => set_attribute(input_11, "placeholder", $02), [() => $i18n().t("Select a model")]);
                bind_value(input_11, () => get(config$1).IMAGE_EDIT_MODEL, ($$value) => mutate(config$1, get(config$1).IMAGE_EDIT_MODEL = $$value));
                append($$anchor4, fragment_10);
              },
              $$slots: { default: true }
            });
          }
          reset(div_128);
          reset(div_127);
          var div_131 = sibling(div_127, 2);
          var div_132 = child(div_131);
          var div_133 = child(div_132);
          var div_134 = child(div_133);
          var text_40 = child(div_134, true);
          reset(div_134);
          reset(div_133);
          var node_28 = sibling(div_133, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Enter Image Size (e.g. 512x512)"));
            Tooltip(node_28, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input_12 = root_24$2();
                remove_input_defaults(input_12);
                template_effect(($02) => set_attribute(input_12, "placeholder", $02), [() => $i18n().t("Enter Image Size (e.g. 512x512)")]);
                bind_value(input_12, () => get(config$1).IMAGE_EDIT_SIZE, ($$value) => mutate(config$1, get(config$1).IMAGE_EDIT_SIZE = $$value));
                append($$anchor4, input_12);
              },
              $$slots: { default: true }
            });
          }
          reset(div_132);
          reset(div_131);
          template_effect(
            ($0, $1) => {
              set_text(text_38, $0);
              set_text(text_40, $1);
            },
            [() => $i18n().t("Model"), () => $i18n().t("Image Size")]
          );
          append($$anchor3, fragment_9);
        };
        if_block(node_26, ($$render) => {
          var _a, _b;
          if (((_a = get(config$1)) == null ? void 0 : _a.ENABLE_IMAGE_GENERATION) && ((_b = get(config$1)) == null ? void 0 : _b.ENABLE_IMAGE_EDIT)) $$render(consequent_8);
        });
      }
      var div_135 = sibling(node_26, 2);
      var div_136 = child(div_135);
      var div_137 = child(div_136);
      var div_138 = child(div_137);
      var text_41 = child(div_138, true);
      reset(div_138);
      reset(div_137);
      var select_2 = sibling(div_137, 2);
      template_effect(() => {
        get(config$1);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option_8 = child(select_2);
      var text_42 = child(option_8, true);
      reset(option_8);
      option_8.value = option_8.__value = "openai";
      var option_9 = sibling(option_8);
      var text_43 = child(option_9, true);
      reset(option_9);
      option_9.value = option_9.__value = "comfyui";
      var option_10 = sibling(option_9);
      var text_44 = child(option_10, true);
      reset(option_10);
      option_10.value = option_10.__value = "gemini";
      reset(select_2);
      reset(div_136);
      reset(div_135);
      var node_29 = sibling(div_135, 2);
      {
        var consequent_9 = ($$anchor3) => {
          var fragment_11 = root_25$1();
          var div_139 = first_child(fragment_11);
          var div_140 = child(div_139);
          var div_141 = child(div_140);
          var div_142 = child(div_141);
          var text_45 = child(div_142, true);
          reset(div_142);
          reset(div_141);
          var div_143 = sibling(div_141, 2);
          var div_144 = child(div_143);
          var input_13 = child(div_144);
          remove_input_defaults(input_13);
          reset(div_144);
          reset(div_143);
          reset(div_140);
          reset(div_139);
          var div_145 = sibling(div_139, 2);
          var div_146 = child(div_145);
          var div_147 = child(div_146);
          var div_148 = child(div_147);
          var text_46 = child(div_148, true);
          reset(div_148);
          reset(div_147);
          var div_149 = sibling(div_147, 2);
          var div_150 = child(div_149);
          var node_30 = child(div_150);
          {
            let $0 = derived_safe_equal(() => $i18n().t("API Key"));
            SensitiveInput(node_30, {
              inputClassName: "text-right w-full",
              get placeholder() {
                return get($0);
              },
              required: false,
              get value() {
                return get(config$1).IMAGES_EDIT_OPENAI_API_KEY;
              },
              set value($$value) {
                mutate(config$1, get(config$1).IMAGES_EDIT_OPENAI_API_KEY = $$value);
              },
              $$legacy: true
            });
          }
          reset(div_150);
          reset(div_149);
          reset(div_146);
          reset(div_145);
          var div_151 = sibling(div_145, 2);
          var div_152 = child(div_151);
          var div_153 = child(div_152);
          var div_154 = child(div_153);
          var text_47 = child(div_154, true);
          reset(div_154);
          reset(div_153);
          var div_155 = sibling(div_153, 2);
          var div_156 = child(div_155);
          var input_14 = child(div_156);
          remove_input_defaults(input_14);
          reset(div_156);
          reset(div_155);
          reset(div_152);
          reset(div_151);
          template_effect(
            ($0, $1, $2, $3, $4) => {
              set_text(text_45, $0);
              set_attribute(input_13, "placeholder", $1);
              set_text(text_46, $2);
              set_text(text_47, $3);
              set_attribute(input_14, "placeholder", $4);
            },
            [
              () => $i18n().t("OpenAI API Base URL"),
              () => $i18n().t("API Base URL"),
              () => $i18n().t("OpenAI API Key"),
              () => $i18n().t("OpenAI API Version"),
              () => $i18n().t("API Version")
            ]
          );
          bind_value(input_13, () => get(config$1).IMAGES_EDIT_OPENAI_API_BASE_URL, ($$value) => mutate(config$1, get(config$1).IMAGES_EDIT_OPENAI_API_BASE_URL = $$value));
          bind_value(input_14, () => get(config$1).IMAGES_EDIT_OPENAI_API_VERSION, ($$value) => mutate(config$1, get(config$1).IMAGES_EDIT_OPENAI_API_VERSION = $$value));
          append($$anchor3, fragment_11);
        };
        var alternate_4 = ($$anchor3) => {
          var fragment_12 = comment();
          var node_31 = first_child(fragment_12);
          {
            var consequent_12 = ($$anchor4) => {
              var fragment_13 = root_27$1();
              var div_157 = first_child(fragment_13);
              var div_158 = child(div_157);
              var div_159 = child(div_158);
              var div_160 = child(div_159);
              var text_48 = child(div_160, true);
              reset(div_160);
              reset(div_159);
              var div_161 = sibling(div_159, 2);
              var div_162 = child(div_161);
              var input_15 = child(div_162);
              remove_input_defaults(input_15);
              reset(div_162);
              var button_4 = sibling(div_162, 2);
              reset(div_161);
              reset(div_158);
              reset(div_157);
              var div_163 = sibling(div_157, 2);
              var div_164 = child(div_163);
              var div_165 = child(div_164);
              var div_166 = child(div_165);
              var text_49 = child(div_166, true);
              reset(div_166);
              reset(div_165);
              var div_167 = sibling(div_165, 2);
              var div_168 = child(div_167);
              var node_32 = child(div_168);
              {
                let $0 = derived_safe_equal(() => $i18n().t("sk-1234"));
                SensitiveInput(node_32, {
                  inputClassName: "text-right w-full",
                  get placeholder() {
                    return get($0);
                  },
                  required: false,
                  get value() {
                    return get(config$1).IMAGES_EDIT_COMFYUI_API_KEY;
                  },
                  set value($$value) {
                    mutate(config$1, get(config$1).IMAGES_EDIT_COMFYUI_API_KEY = $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_168);
              reset(div_167);
              reset(div_164);
              reset(div_163);
              var div_169 = sibling(div_163, 2);
              var input_16 = child(div_169);
              var div_170 = sibling(input_16, 2);
              var div_171 = child(div_170);
              var div_172 = child(div_171);
              var text_50 = child(div_172, true);
              reset(div_172);
              reset(div_171);
              var div_173 = sibling(div_171, 2);
              var div_174 = child(div_173);
              var node_33 = child(div_174);
              {
                var consequent_10 = ($$anchor5) => {
                  var button_5 = root_28$2();
                  var text_51 = child(button_5, true);
                  reset(button_5);
                  template_effect(
                    ($0, $1) => {
                      set_attribute(button_5, "aria-label", $0);
                      set_text(text_51, $1);
                    },
                    [
                      () => $i18n().t("Edit workflow.json content"),
                      () => $i18n().t("Edit")
                    ]
                  );
                  event("click", button_5, () => {
                    set(showComfyUIEditWorkflowEditor, true);
                  });
                  append($$anchor5, button_5);
                };
                if_block(node_33, ($$render) => {
                  if (get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW) $$render(consequent_10);
                });
              }
              var node_34 = sibling(node_33, 2);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Click here to upload a workflow.json file."));
                Tooltip(node_34, {
                  get content() {
                    return get($0);
                  },
                  children: ($$anchor5, $$slotProps) => {
                    var button_6 = root_29$1();
                    var text_52 = child(button_6, true);
                    reset(button_6);
                    template_effect(
                      ($02, $1) => {
                        set_attribute(button_6, "aria-label", $02);
                        set_text(text_52, $1);
                      },
                      [
                        () => $i18n().t("Click here to upload a workflow.json file."),
                        () => $i18n().t("Upload")
                      ]
                    );
                    event("click", button_6, () => {
                      var _a;
                      (_a = document.getElementById("upload-comfyui-edit-workflow-input")) == null ? void 0 : _a.click();
                    });
                    append($$anchor5, button_6);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_174);
              reset(div_173);
              reset(div_170);
              var div_175 = sibling(div_170, 2);
              var node_35 = child(div_175);
              CodeEditorModal(node_35, {
                get value() {
                  return get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW;
                },
                lang: "json",
                onChange: (e) => {
                  mutate(config$1, get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW = e);
                },
                onSave: () => {
                  console.log("Saved");
                },
                get show() {
                  return get(showComfyUIEditWorkflowEditor);
                },
                set show($$value) {
                  set(showComfyUIEditWorkflowEditor, $$value);
                },
                $$legacy: true
              });
              var text_53 = sibling(node_35);
              reset(div_175);
              reset(div_169);
              var node_36 = sibling(div_169, 2);
              {
                var consequent_11 = ($$anchor5) => {
                  var div_176 = root_30$3();
                  var div_177 = child(div_176);
                  var div_178 = child(div_177);
                  var div_179 = child(div_178);
                  var text_54 = child(div_179, true);
                  reset(div_179);
                  reset(div_178);
                  reset(div_177);
                  var div_180 = sibling(div_177, 2);
                  each(div_180, 5, () => get(REQUIRED_EDIT_WORKFLOW_NODES), index, ($$anchor6, node, $$index_3) => {
                    var div_181 = root_31$2();
                    var div_182 = child(div_181);
                    var div_183 = child(div_182);
                    var text_55 = child(div_183);
                    reset(div_183);
                    reset(div_182);
                    var div_184 = sibling(div_182, 2);
                    var div_185 = child(div_184);
                    var node_37 = child(div_185);
                    {
                      let $0 = derived_safe_equal(() => $i18n().t("Input Key (e.g. text, unet_name, steps)"));
                      Tooltip(node_37, {
                        get content() {
                          return get($0);
                        },
                        children: ($$anchor7, $$slotProps) => {
                          var input_17 = root_32$2();
                          remove_input_defaults(input_17);
                          template_effect(($02) => set_attribute(input_17, "placeholder", $02), [() => $i18n().t("Key")]);
                          bind_value(input_17, () => get(node).key, ($$value) => (get(node).key = $$value, invalidate_inner_signals(() => get(REQUIRED_EDIT_WORKFLOW_NODES))));
                          append($$anchor7, input_17);
                        },
                        $$slots: { default: true }
                      });
                    }
                    reset(div_185);
                    var div_186 = sibling(div_185, 4);
                    var node_38 = child(div_186);
                    {
                      let $0 = derived_safe_equal(() => $i18n().t("Comma separated Node Ids (e.g. 1 or 1,2)"));
                      Tooltip(node_38, {
                        get content() {
                          return get($0);
                        },
                        placement: "top-start",
                        children: ($$anchor7, $$slotProps) => {
                          var input_18 = root_33$1();
                          remove_input_defaults(input_18);
                          template_effect(($02) => set_attribute(input_18, "placeholder", $02), [() => $i18n().t("Node Ids")]);
                          bind_value(input_18, () => get(node).node_ids, ($$value) => (get(node).node_ids = $$value, invalidate_inner_signals(() => get(REQUIRED_EDIT_WORKFLOW_NODES))));
                          append($$anchor7, input_18);
                        },
                        $$slots: { default: true }
                      });
                    }
                    reset(div_186);
                    reset(div_184);
                    reset(div_181);
                    template_effect(($0) => set_text(text_55, `${get(node).type ?? ""}${$0 ?? ""}`), [
                      () => ["prompt", "image"].includes(get(node).type) ? "*" : ""
                    ]);
                    append($$anchor6, div_181);
                  });
                  reset(div_180);
                  var div_187 = sibling(div_180, 2);
                  var text_56 = child(div_187, true);
                  reset(div_187);
                  reset(div_176);
                  template_effect(
                    ($0, $1) => {
                      set_text(text_54, $0);
                      set_text(text_56, $1);
                    },
                    [
                      () => $i18n().t("ComfyUI Workflow Nodes"),
                      () => $i18n().t("*Prompt node ID(s) are required for image generation")
                    ]
                  );
                  append($$anchor5, div_176);
                };
                if_block(node_36, ($$render) => {
                  if (get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW) $$render(consequent_11);
                });
              }
              template_effect(
                ($0, $1, $2, $3, $4) => {
                  set_text(text_48, $0);
                  set_attribute(input_15, "placeholder", $1);
                  set_text(text_49, $2);
                  set_text(text_50, $3);
                  set_text(text_53, ` ${$4 ?? ""}`);
                },
                [
                  () => $i18n().t("ComfyUI Base URL"),
                  () => $i18n().t("Enter URL (e.g. http://127.0.0.1:7860/)"),
                  () => $i18n().t("ComfyUI API Key"),
                  () => $i18n().t("ComfyUI Workflow"),
                  () => $i18n().t("Make sure to export a workflow.json file as API format from ComfyUI.")
                ]
              );
              bind_value(input_15, () => get(config$1).IMAGES_EDIT_COMFYUI_BASE_URL, ($$value) => mutate(config$1, get(config$1).IMAGES_EDIT_COMFYUI_BASE_URL = $$value));
              event("click", button_4, async () => {
                await updateConfigHandler();
                const res = await verifyConfigUrl(localStorage.token).catch((error) => {
                  toast.error(`${error}`);
                  return null;
                });
                if (res) {
                  toast.success($i18n().t("Server connection verified"));
                }
              });
              event("change", input_16, (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (e2) => {
                  mutate(config$1, get(config$1).IMAGES_EDIT_COMFYUI_WORKFLOW = e2.target.result);
                  e2.target.value = null;
                };
                reader.readAsText(file);
              });
              append($$anchor4, fragment_13);
            };
            var alternate_3 = ($$anchor4) => {
              var fragment_14 = comment();
              var node_39 = first_child(fragment_14);
              {
                var consequent_13 = ($$anchor5) => {
                  var fragment_15 = root_35$1();
                  var div_188 = first_child(fragment_15);
                  var div_189 = child(div_188);
                  var div_190 = child(div_189);
                  var div_191 = child(div_190);
                  var text_57 = child(div_191, true);
                  reset(div_191);
                  reset(div_190);
                  var div_192 = sibling(div_190, 2);
                  var div_193 = child(div_192);
                  var input_19 = child(div_193);
                  remove_input_defaults(input_19);
                  reset(div_193);
                  reset(div_192);
                  reset(div_189);
                  reset(div_188);
                  var div_194 = sibling(div_188, 2);
                  var div_195 = child(div_194);
                  var div_196 = child(div_195);
                  var div_197 = child(div_196);
                  var text_58 = child(div_197, true);
                  reset(div_197);
                  reset(div_196);
                  var div_198 = sibling(div_196, 2);
                  var div_199 = child(div_198);
                  var node_40 = child(div_199);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("API Key"));
                    SensitiveInput(node_40, {
                      inputClassName: "text-right w-full",
                      get placeholder() {
                        return get($0);
                      },
                      required: true,
                      get value() {
                        return get(config$1).IMAGES_EDIT_GEMINI_API_KEY;
                      },
                      set value($$value) {
                        mutate(config$1, get(config$1).IMAGES_EDIT_GEMINI_API_KEY = $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_199);
                  reset(div_198);
                  reset(div_195);
                  reset(div_194);
                  template_effect(
                    ($0, $1, $2) => {
                      set_text(text_57, $0);
                      set_attribute(input_19, "placeholder", $1);
                      set_text(text_58, $2);
                    },
                    [
                      () => $i18n().t("Gemini Base URL"),
                      () => $i18n().t("API Base URL"),
                      () => $i18n().t("Gemini API Key")
                    ]
                  );
                  bind_value(input_19, () => get(config$1).IMAGES_EDIT_GEMINI_API_BASE_URL, ($$value) => mutate(config$1, get(config$1).IMAGES_EDIT_GEMINI_API_BASE_URL = $$value));
                  append($$anchor5, fragment_15);
                };
                if_block(
                  node_39,
                  ($$render) => {
                    var _a;
                    if (((_a = get(config$1)) == null ? void 0 : _a.IMAGE_EDIT_ENGINE) === "gemini") $$render(consequent_13);
                  },
                  true
                );
              }
              append($$anchor4, fragment_14);
            };
            if_block(
              node_31,
              ($$render) => {
                var _a;
                if (((_a = get(config$1)) == null ? void 0 : _a.IMAGE_EDIT_ENGINE) === "comfyui") $$render(consequent_12);
                else $$render(alternate_3, false);
              },
              true
            );
          }
          append($$anchor3, fragment_12);
        };
        if_block(node_29, ($$render) => {
          var _a;
          if (((_a = get(config$1)) == null ? void 0 : _a.IMAGE_EDIT_ENGINE) === "openai") $$render(consequent_9);
          else $$render(alternate_4, false);
        });
      }
      reset(div_121);
      reset(div_1);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) => {
          set_text(text2, $0);
          set_text(text_1, $1);
          set_text(text_2, $2);
          set_text(text_8, $3);
          set_attribute(select, "placeholder", $4);
          set_text(text_9, $5);
          set_text(text_10, $6);
          set_text(text_11, $7);
          set_text(text_12, $8);
          set_text(text_36, $9);
          set_text(text_37, $10);
          set_text(text_41, $11);
          set_attribute(select_2, "placeholder", $12);
          set_text(text_42, $13);
          set_text(text_43, $14);
          set_text(text_44, $15);
        },
        [
          () => $i18n().t("General"),
          () => $i18n().t("Image Generation"),
          () => $i18n().t("Create Image"),
          () => $i18n().t("Image Generation Engine"),
          () => $i18n().t("Select Engine"),
          () => $i18n().t("Default (Open AI)"),
          () => $i18n().t("ComfyUI"),
          () => $i18n().t("Automatic1111"),
          () => $i18n().t("Gemini"),
          () => $i18n().t("Edit Image"),
          () => $i18n().t("Image Edit"),
          () => $i18n().t("Image Edit Engine"),
          () => $i18n().t("Select Engine"),
          () => $i18n().t("Default (Open AI)"),
          () => $i18n().t("ComfyUI"),
          () => $i18n().t("Gemini")
        ]
      );
      bind_select_value(select, () => get(config$1).IMAGE_GENERATION_ENGINE, ($$value) => mutate(config$1, get(config$1).IMAGE_GENERATION_ENGINE = $$value));
      bind_select_value(select_2, () => get(config$1).IMAGE_EDIT_ENGINE, ($$value) => mutate(config$1, get(config$1).IMAGE_EDIT_ENGINE = $$value));
      append($$anchor2, div_1);
    };
    if_block(node_1, ($$render) => {
      if (get(config$1)) $$render(consequent_14);
    });
  }
  reset(div);
  var div_200 = sibling(div, 2);
  var button_7 = child(div_200);
  var text_59 = child(button_7);
  var node_41 = sibling(text_59);
  {
    var consequent_15 = ($$anchor2) => {
      var div_201 = root_36$3();
      var node_42 = child(div_201);
      Spinner(node_42, {});
      reset(div_201);
      append($$anchor2, div_201);
    };
    if_block(node_41, ($$render) => {
      if (get(loading)) $$render(consequent_15);
    });
  }
  reset(button_7);
  reset(div_200);
  reset(form);
  template_effect(
    ($0) => {
      set_class(button_7, 1, `px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full flex flex-row space-x-1 items-center ${get(loading) ? " cursor-not-allowed" : ""}`);
      button_7.disabled = get(loading);
      set_text(text_59, `${$0 ?? ""} `);
    },
    [() => $i18n().t("Save")]
  );
  event("submit", form, preventDefault(async () => {
    saveHandler();
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root$h = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"></path></svg>`);
function EllipsisVertical($$anchor, $$props) {
  let className = prop($$props, "className", 8, "w-4 h-4");
  let strokeWidth = prop($$props, "strokeWidth", 8, "1.5");
  var svg = root$h();
  template_effect(() => {
    set_attribute(svg, "stroke-width", strokeWidth());
    set_class(svg, 0, clsx(className()));
  });
  append($$anchor, svg);
}
var root_2$e = from_html(`<option selected disabled class="text-gray-900"> </option>`);
var root_1$g = from_html(`<div class=" flex justify-between items-start -ml-1"><!> <div class="flex flex-row flex-1 gap-2 items-start"><select class="w-fit capitalize rounded-xl text-xs bg-transparent outline-hidden pl-1 pr-5" required><!><option class="text-gray-900"> </option><option class="text-gray-900"> </option><option class="text-gray-900"> </option><option class="text-gray-900"> </option></select> <!> <div class="relative -left-2"><!></div></div> <button class="pr-3" type="button"><!></button></div>`);
var root$g = from_html(`<div></div>`);
function Banners($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let banners2 = prop($$props, "banners", 28, () => []);
  let sortable = null;
  let bannerListElement = mutable_source(null);
  const positionChangeHandler = () => {
    const bannerIdOrder = Array.from(get(bannerListElement).children).map((child2) => child2.id.replace("banner-item-", ""));
    banners2(bannerIdOrder.map((id) => {
      const index2 = banners2().findIndex((banner) => banner.id === id);
      return banners2()[index2];
    }));
  };
  const init$1 = () => {
    if (sortable) {
      sortable.destroy();
    }
    if (get(bannerListElement)) {
      sortable = new Sortable(get(bannerListElement), {
        animation: 150,
        handle: ".item-handle",
        onUpdate: async (event2) => {
          positionChangeHandler();
        }
      });
    }
  };
  legacy_pre_effect(() => deep_read_state(banners2()), () => {
    if (banners2()) {
      init$1();
    }
  });
  legacy_pre_effect_reset();
  init();
  var div = root$g();
  each(div, 7, banners2, (banner) => banner.id, ($$anchor2, banner, bannerIdx) => {
    var div_1 = root_1$g();
    var node = child(div_1);
    EllipsisVertical(node, { className: "size-4 cursor-move item-handle" });
    var div_2 = sibling(node, 2);
    var select = child(div_2);
    template_effect(() => {
      get(banner);
      invalidate_inner_signals(() => {
        $i18n();
      });
    });
    var node_1 = child(select);
    {
      var consequent = ($$anchor3) => {
        var option = root_2$e();
        var text2 = child(option, true);
        reset(option);
        option.value = option.__value = "";
        template_effect(($0) => set_text(text2, $0), [() => ($i18n(), untrack(() => $i18n().t("Type")))]);
        append($$anchor3, option);
      };
      if_block(node_1, ($$render) => {
        if (get(banner), untrack(() => get(banner).type == "")) $$render(consequent);
      });
    }
    var option_1 = sibling(node_1);
    var text_1 = child(option_1, true);
    reset(option_1);
    option_1.value = option_1.__value = "info";
    var option_2 = sibling(option_1);
    var text_2 = child(option_2, true);
    reset(option_2);
    option_2.value = option_2.__value = "warning";
    var option_3 = sibling(option_2);
    var text_3 = child(option_3, true);
    reset(option_3);
    option_3.value = option_3.__value = "error";
    var option_4 = sibling(option_3);
    var text_4 = child(option_4, true);
    reset(option_4);
    option_4.value = option_4.__value = "success";
    reset(select);
    var node_2 = sibling(select, 2);
    {
      let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Content"))));
      Textarea(node_2, {
        className: "mr-2 text-xs w-full bg-transparent outline-hidden resize-none",
        get placeholder() {
          return get($0);
        },
        maxSize: 100,
        get value() {
          return get(banner).content;
        },
        set value($$value) {
          get(banner).content = $$value, invalidate_inner_signals(() => banners2());
        },
        $$legacy: true
      });
    }
    var div_3 = sibling(node_2, 2);
    var node_3 = child(div_3);
    {
      let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Remember Dismissal"))));
      Tooltip(node_3, {
        get content() {
          return get($0);
        },
        className: "flex h-fit items-center",
        children: ($$anchor3, $$slotProps) => {
          Switch_1($$anchor3, {
            get state() {
              return get(banner).dismissible;
            },
            set state($$value) {
              get(banner).dismissible = $$value, invalidate_inner_signals(() => banners2());
            },
            $$legacy: true
          });
        },
        $$slots: { default: true }
      });
    }
    reset(div_3);
    reset(div_2);
    var button = sibling(div_2, 2);
    var node_4 = child(button);
    XMark(node_4, { className: "size-4" });
    reset(button);
    reset(div_1);
    template_effect(
      ($0, $1, $2, $3) => {
        set_attribute(div_1, "id", `banner-item-${(get(banner), untrack(() => get(banner).id)) ?? ""}`);
        set_text(text_1, $0);
        set_text(text_2, $1);
        set_text(text_3, $2);
        set_text(text_4, $3);
      },
      [
        () => ($i18n(), untrack(() => $i18n().t("Info"))),
        () => ($i18n(), untrack(() => $i18n().t("Warning"))),
        () => ($i18n(), untrack(() => $i18n().t("Error"))),
        () => ($i18n(), untrack(() => $i18n().t("Success")))
      ]
    );
    bind_select_value(select, () => get(banner).type, ($$value) => (get(banner).type = $$value, invalidate_inner_signals(() => banners2())));
    event("click", button, () => {
      banners2().splice(get(bannerIdx), 1);
      banners2(banners2());
    });
    append($$anchor2, div_1);
  });
  reset(div);
  bind_this(div, ($$value) => set(bannerListElement, $$value), () => get(bannerListElement));
  template_effect(() => set_class(div, 1, ` flex flex-col gap-3 ${(deep_read_state(banners2()), untrack(() => {
    var _a;
    return ((_a = banners2()) == null ? void 0 : _a.length) > 0 ? "mt-2" : "";
  })) ?? ""}`));
  append($$anchor, div);
  pop();
  $$cleanup();
}
var root_2$d = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>`);
var root_3$c = from_html(`<option class="bg-gray-100 dark:bg-gray-700"> </option>`);
var root_4$c = from_html(`<option class="bg-gray-100 dark:bg-gray-700"> </option>`);
var root_5$8 = from_html(`<div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div>`);
var root_7$6 = from_html(`<div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div>`);
var root_9$3 = from_html(`<div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div>`);
var root_11$4 = from_html(`<div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div>`);
var root_16$5 = from_html(`<input class="w-full outline-hidden bg-transparent"/>`);
var root_15$1 = from_html(`<div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div>`);
var root_20$4 = from_html(`<div class="text-xs text-left w-full mt-2"> </div>`);
var root_19$1 = from_html(`<!> <!>`, 1);
var root_1$f = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class="  overflow-y-scroll scrollbar-hidden h-full pr-1.5"><div class="mb-3.5"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class=" mb-2 font-medium flex items-center"><div class=" text-xs mr-1"> </div> <!></div> <div class=" mb-2.5 flex w-full gap-2"><div class="flex-1"><div class=" text-xs mb-1"> </div> <select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"><option selected> </option><!></select></div> <div class="flex-1"><div class=" text-xs mb-1"> </div> <select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"><option selected> </option><!></select></div></div> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <!> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <!> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <!> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <!> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div> <div class="mb-2.5 flex w-full items-center justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div> <!> <div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div> <div class="mb-2.5"><div class=" mb-1 text-xs font-medium"> </div> <!></div></div> <div class="mb-3.5"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5"><div class="flex w-full justify-between"><div class=" self-center text-xs"> </div> <button class="p-1 px-3 text-xs flex rounded-sm transition" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"></path></svg></button></div> <!></div> <!></div></div> <div class="flex justify-end text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`);
var root_21$1 = from_html(`<div class=" h-full w-full flex justify-center items-center"><!></div>`);
function Interface($$anchor, $$props) {
  push($$props, false);
  const $config = () => store_get(config, "$config", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $user = () => store_get(user, "$user", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const { saveAs } = fileSaver;
  const dispatch = createEventDispatcher();
  const i18n = getContext("i18n");
  let taskConfig = mutable_source({
    TASK_MODEL: "",
    TASK_MODEL_EXTERNAL: "",
    ENABLE_TITLE_GENERATION: true,
    TITLE_GENERATION_PROMPT_TEMPLATE: "",
    ENABLE_FOLLOW_UP_GENERATION: true,
    FOLLOW_UP_GENERATION_PROMPT_TEMPLATE: "",
    IMAGE_PROMPT_GENERATION_PROMPT_TEMPLATE: "",
    ENABLE_AUTOCOMPLETE_GENERATION: true,
    AUTOCOMPLETE_GENERATION_INPUT_MAX_LENGTH: -1,
    TAGS_GENERATION_PROMPT_TEMPLATE: "",
    ENABLE_TAGS_GENERATION: true,
    ENABLE_SEARCH_QUERY_GENERATION: true,
    ENABLE_RETRIEVAL_QUERY_GENERATION: true,
    QUERY_GENERATION_PROMPT_TEMPLATE: "",
    TOOLS_FUNCTION_CALLING_PROMPT_TEMPLATE: "",
    VOICE_MODE_PROMPT_TEMPLATE: ""
  });
  let promptSuggestions = mutable_source([]);
  let banners$1 = mutable_source([]);
  const updateInterfaceHandler = async () => {
    set(taskConfig, await updateTaskConfig(localStorage.token, get(taskConfig)));
    set(promptSuggestions, get(promptSuggestions).filter((p) => p.content !== ""));
    set(promptSuggestions, await setDefaultPromptSuggestions(localStorage.token, get(promptSuggestions)));
    await updateBanners();
    await config.set(await getBackendConfig());
  };
  const updateBanners = async () => {
    banners.set(await setBanners(localStorage.token, get(banners$1)));
  };
  let workspaceModels = null;
  let baseModels = null;
  let models2 = mutable_source(null);
  const init$1 = async () => {
    var _a;
    set(taskConfig, await getTaskConfig(localStorage.token));
    set(promptSuggestions, ((_a = $config()) == null ? void 0 : _a.default_prompt_suggestions) ?? []);
    set(banners$1, await getBanners(localStorage.token));
    workspaceModels = await getBaseModels(localStorage.token);
    baseModels = await getModels(localStorage.token, null, false);
    set(models2, baseModels.map((m) => {
      const workspaceModel = workspaceModels.find((wm) => wm.id === m.id);
      if (workspaceModel) {
        return { ...m, ...workspaceModel };
      } else {
        return { ...m, id: m.id, name: m.name, is_active: true };
      }
    }));
    console.debug("models", get(models2));
  };
  onMount(async () => {
    await init$1();
  });
  init();
  var fragment = comment();
  var node = first_child(fragment);
  {
    var consequent_7 = ($$anchor2) => {
      var form = root_1$f();
      var div = child(form);
      var div_1 = child(div);
      var div_2 = child(div_1);
      var text2 = child(div_2, true);
      reset(div_2);
      var div_3 = sibling(div_2, 4);
      var div_4 = child(div_3);
      var text_1 = child(div_4, true);
      reset(div_4);
      var node_1 = sibling(div_4, 2);
      {
        let $0 = derived_safe_equal(() => $i18n().t("A task model is used when performing tasks such as generating titles for chats and web search queries"));
        Tooltip(node_1, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            var svg = root_2$d();
            append($$anchor3, svg);
          },
          $$slots: { default: true }
        });
      }
      reset(div_3);
      var div_5 = sibling(div_3, 2);
      var div_6 = child(div_5);
      var div_7 = child(div_6);
      var text_2 = child(div_7, true);
      reset(div_7);
      var select = sibling(div_7, 2);
      template_effect(() => {
        get(taskConfig);
        invalidate_inner_signals(() => {
          $i18n();
          get(models2);
        });
      });
      var option = child(select);
      var text_3 = child(option, true);
      reset(option);
      option.value = option.__value = "";
      var node_2 = sibling(option);
      each(node_2, 1, () => get(models2), index, ($$anchor3, model) => {
        var option_1 = root_3$c();
        var text_4 = child(option_1);
        reset(option_1);
        var option_1_value = {};
        template_effect(
          ($0) => {
            set_text(text_4, `${get(model).name ?? ""}
									${$0 ?? ""}`);
            if (option_1_value !== (option_1_value = get(model).id)) {
              option_1.value = (option_1.__value = get(model).id) ?? "";
            }
          },
          [
            () => {
              var _a;
              return ((_a = get(model)) == null ? void 0 : _a.connection_type) === "local" ? `(${$i18n().t("Local")})` : "";
            }
          ]
        );
        append($$anchor3, option_1);
      });
      reset(select);
      reset(div_6);
      var div_8 = sibling(div_6, 2);
      var div_9 = child(div_8);
      var text_5 = child(div_9, true);
      reset(div_9);
      var select_1 = sibling(div_9, 2);
      template_effect(() => {
        get(taskConfig);
        invalidate_inner_signals(() => {
          $i18n();
          get(models2);
        });
      });
      var option_2 = child(select_1);
      var text_6 = child(option_2, true);
      reset(option_2);
      option_2.value = option_2.__value = "";
      var node_3 = sibling(option_2);
      each(node_3, 1, () => get(models2), index, ($$anchor3, model) => {
        var option_3 = root_4$c();
        var text_7 = child(option_3);
        reset(option_3);
        var option_3_value = {};
        template_effect(
          ($0) => {
            set_text(text_7, `${get(model).name ?? ""}
									${$0 ?? ""}`);
            if (option_3_value !== (option_3_value = get(model).id)) {
              option_3.value = (option_3.__value = get(model).id) ?? "";
            }
          },
          [
            () => {
              var _a;
              return ((_a = get(model)) == null ? void 0 : _a.connection_type) === "local" ? `(${$i18n().t("Local")})` : "";
            }
          ]
        );
        append($$anchor3, option_3);
      });
      reset(select_1);
      reset(div_8);
      reset(div_5);
      var div_10 = sibling(div_5, 2);
      var div_11 = child(div_10);
      var text_8 = child(div_11, true);
      reset(div_11);
      var node_4 = sibling(div_11, 2);
      Switch_1(node_4, {
        get state() {
          return get(taskConfig).ENABLE_TITLE_GENERATION;
        },
        set state($$value) {
          mutate(taskConfig, get(taskConfig).ENABLE_TITLE_GENERATION = $$value);
        },
        $$legacy: true
      });
      reset(div_10);
      var node_5 = sibling(div_10, 2);
      {
        var consequent = ($$anchor3) => {
          var div_12 = root_5$8();
          var div_13 = child(div_12);
          var text_9 = child(div_13, true);
          reset(div_13);
          var node_6 = sibling(div_13, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
            Tooltip(node_6, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                {
                  let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
                  Textarea($$anchor4, {
                    get placeholder() {
                      return get($02);
                    },
                    get value() {
                      return get(taskConfig).TITLE_GENERATION_PROMPT_TEMPLATE;
                    },
                    set value($$value) {
                      mutate(taskConfig, get(taskConfig).TITLE_GENERATION_PROMPT_TEMPLATE = $$value);
                    },
                    $$legacy: true
                  });
                }
              },
              $$slots: { default: true }
            });
          }
          reset(div_12);
          template_effect(($0) => set_text(text_9, $0), [() => $i18n().t("Title Generation Prompt")]);
          append($$anchor3, div_12);
        };
        if_block(node_5, ($$render) => {
          if (get(taskConfig).ENABLE_TITLE_GENERATION) $$render(consequent);
        });
      }
      var div_14 = sibling(node_5, 2);
      var div_15 = child(div_14);
      var text_10 = child(div_15, true);
      reset(div_15);
      var node_7 = sibling(div_15, 2);
      {
        let $0 = derived_safe_equal(() => get(taskConfig).VOICE_MODE_PROMPT_TEMPLATE != null);
        Switch_1(node_7, {
          get state() {
            return get($0);
          },
          $$events: {
            change: (e) => {
              if (e.detail) {
                mutate(taskConfig, get(taskConfig).VOICE_MODE_PROMPT_TEMPLATE = "");
              } else {
                mutate(taskConfig, get(taskConfig).VOICE_MODE_PROMPT_TEMPLATE = null);
              }
            }
          }
        });
      }
      reset(div_14);
      var node_8 = sibling(div_14, 2);
      {
        var consequent_1 = ($$anchor3) => {
          var div_16 = root_7$6();
          var div_17 = child(div_16);
          var text_11 = child(div_17, true);
          reset(div_17);
          var node_9 = sibling(div_17, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
            Tooltip(node_9, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                {
                  let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
                  Textarea($$anchor4, {
                    get placeholder() {
                      return get($02);
                    },
                    get value() {
                      return get(taskConfig).VOICE_MODE_PROMPT_TEMPLATE;
                    },
                    set value($$value) {
                      mutate(taskConfig, get(taskConfig).VOICE_MODE_PROMPT_TEMPLATE = $$value);
                    },
                    $$legacy: true
                  });
                }
              },
              $$slots: { default: true }
            });
          }
          reset(div_16);
          template_effect(($0) => set_text(text_11, $0), [() => $i18n().t("Voice Mode Prompt")]);
          append($$anchor3, div_16);
        };
        if_block(node_8, ($$render) => {
          if (get(taskConfig).VOICE_MODE_PROMPT_TEMPLATE != null) $$render(consequent_1);
        });
      }
      var div_18 = sibling(node_8, 2);
      var div_19 = child(div_18);
      var text_12 = child(div_19, true);
      reset(div_19);
      var node_10 = sibling(div_19, 2);
      Switch_1(node_10, {
        get state() {
          return get(taskConfig).ENABLE_FOLLOW_UP_GENERATION;
        },
        set state($$value) {
          mutate(taskConfig, get(taskConfig).ENABLE_FOLLOW_UP_GENERATION = $$value);
        },
        $$legacy: true
      });
      reset(div_18);
      var node_11 = sibling(div_18, 2);
      {
        var consequent_2 = ($$anchor3) => {
          var div_20 = root_9$3();
          var div_21 = child(div_20);
          var text_13 = child(div_21, true);
          reset(div_21);
          var node_12 = sibling(div_21, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
            Tooltip(node_12, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                {
                  let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
                  Textarea($$anchor4, {
                    get placeholder() {
                      return get($02);
                    },
                    get value() {
                      return get(taskConfig).FOLLOW_UP_GENERATION_PROMPT_TEMPLATE;
                    },
                    set value($$value) {
                      mutate(taskConfig, get(taskConfig).FOLLOW_UP_GENERATION_PROMPT_TEMPLATE = $$value);
                    },
                    $$legacy: true
                  });
                }
              },
              $$slots: { default: true }
            });
          }
          reset(div_20);
          template_effect(($0) => set_text(text_13, $0), [() => $i18n().t("Follow Up Generation Prompt")]);
          append($$anchor3, div_20);
        };
        if_block(node_11, ($$render) => {
          if (get(taskConfig).ENABLE_FOLLOW_UP_GENERATION) $$render(consequent_2);
        });
      }
      var div_22 = sibling(node_11, 2);
      var div_23 = child(div_22);
      var text_14 = child(div_23, true);
      reset(div_23);
      var node_13 = sibling(div_23, 2);
      Switch_1(node_13, {
        get state() {
          return get(taskConfig).ENABLE_TAGS_GENERATION;
        },
        set state($$value) {
          mutate(taskConfig, get(taskConfig).ENABLE_TAGS_GENERATION = $$value);
        },
        $$legacy: true
      });
      reset(div_22);
      var node_14 = sibling(div_22, 2);
      {
        var consequent_3 = ($$anchor3) => {
          var div_24 = root_11$4();
          var div_25 = child(div_24);
          var text_15 = child(div_25, true);
          reset(div_25);
          var node_15 = sibling(div_25, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
            Tooltip(node_15, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                {
                  let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
                  Textarea($$anchor4, {
                    get placeholder() {
                      return get($02);
                    },
                    get value() {
                      return get(taskConfig).TAGS_GENERATION_PROMPT_TEMPLATE;
                    },
                    set value($$value) {
                      mutate(taskConfig, get(taskConfig).TAGS_GENERATION_PROMPT_TEMPLATE = $$value);
                    },
                    $$legacy: true
                  });
                }
              },
              $$slots: { default: true }
            });
          }
          reset(div_24);
          template_effect(($0) => set_text(text_15, $0), [() => $i18n().t("Tags Generation Prompt")]);
          append($$anchor3, div_24);
        };
        if_block(node_14, ($$render) => {
          if (get(taskConfig).ENABLE_TAGS_GENERATION) $$render(consequent_3);
        });
      }
      var div_26 = sibling(node_14, 2);
      var div_27 = child(div_26);
      var text_16 = child(div_27, true);
      reset(div_27);
      var node_16 = sibling(div_27, 2);
      Switch_1(node_16, {
        get state() {
          return get(taskConfig).ENABLE_RETRIEVAL_QUERY_GENERATION;
        },
        set state($$value) {
          mutate(taskConfig, get(taskConfig).ENABLE_RETRIEVAL_QUERY_GENERATION = $$value);
        },
        $$legacy: true
      });
      reset(div_26);
      var div_28 = sibling(div_26, 2);
      var div_29 = child(div_28);
      var text_17 = child(div_29, true);
      reset(div_29);
      var node_17 = sibling(div_29, 2);
      Switch_1(node_17, {
        get state() {
          return get(taskConfig).ENABLE_SEARCH_QUERY_GENERATION;
        },
        set state($$value) {
          mutate(taskConfig, get(taskConfig).ENABLE_SEARCH_QUERY_GENERATION = $$value);
        },
        $$legacy: true
      });
      reset(div_28);
      var div_30 = sibling(div_28, 2);
      var div_31 = child(div_30);
      var text_18 = child(div_31, true);
      reset(div_31);
      var node_18 = sibling(div_31, 2);
      {
        let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
        Tooltip(node_18, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            {
              let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
              Textarea($$anchor3, {
                get placeholder() {
                  return get($02);
                },
                get value() {
                  return get(taskConfig).QUERY_GENERATION_PROMPT_TEMPLATE;
                },
                set value($$value) {
                  mutate(taskConfig, get(taskConfig).QUERY_GENERATION_PROMPT_TEMPLATE = $$value);
                },
                $$legacy: true
              });
            }
          },
          $$slots: { default: true }
        });
      }
      reset(div_30);
      var div_32 = sibling(div_30, 2);
      var div_33 = child(div_32);
      var text_19 = child(div_33, true);
      reset(div_33);
      var node_19 = sibling(div_33, 2);
      {
        let $0 = derived_safe_equal(() => $i18n().t("Enable autocomplete generation for chat messages"));
        Tooltip(node_19, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            Switch_1($$anchor3, {
              get state() {
                return get(taskConfig).ENABLE_AUTOCOMPLETE_GENERATION;
              },
              set state($$value) {
                mutate(taskConfig, get(taskConfig).ENABLE_AUTOCOMPLETE_GENERATION = $$value);
              },
              $$legacy: true
            });
          },
          $$slots: { default: true }
        });
      }
      reset(div_32);
      var node_20 = sibling(div_32, 2);
      {
        var consequent_4 = ($$anchor3) => {
          var div_34 = root_15$1();
          var div_35 = child(div_34);
          var text_20 = child(div_35, true);
          reset(div_35);
          var node_21 = sibling(div_35, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Character limit for autocomplete generation input"));
            Tooltip(node_21, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                var input = root_16$5();
                remove_input_defaults(input);
                template_effect(($02) => set_attribute(input, "placeholder", $02), [
                  () => $i18n().t("-1 for no limit, or a positive integer for a specific limit")
                ]);
                bind_value(input, () => get(taskConfig).AUTOCOMPLETE_GENERATION_INPUT_MAX_LENGTH, ($$value) => mutate(taskConfig, get(taskConfig).AUTOCOMPLETE_GENERATION_INPUT_MAX_LENGTH = $$value));
                append($$anchor4, input);
              },
              $$slots: { default: true }
            });
          }
          reset(div_34);
          template_effect(($0) => set_text(text_20, $0), [() => $i18n().t("Autocomplete Generation Input Max Length")]);
          append($$anchor3, div_34);
        };
        if_block(node_20, ($$render) => {
          if (get(taskConfig).ENABLE_AUTOCOMPLETE_GENERATION) $$render(consequent_4);
        });
      }
      var div_36 = sibling(node_20, 2);
      var div_37 = child(div_36);
      var text_21 = child(div_37, true);
      reset(div_37);
      var node_22 = sibling(div_37, 2);
      {
        let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
        Tooltip(node_22, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            {
              let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
              Textarea($$anchor3, {
                get placeholder() {
                  return get($02);
                },
                get value() {
                  return get(taskConfig).IMAGE_PROMPT_GENERATION_PROMPT_TEMPLATE;
                },
                set value($$value) {
                  mutate(taskConfig, get(taskConfig).IMAGE_PROMPT_GENERATION_PROMPT_TEMPLATE = $$value);
                },
                $$legacy: true
              });
            }
          },
          $$slots: { default: true }
        });
      }
      reset(div_36);
      var div_38 = sibling(div_36, 2);
      var div_39 = child(div_38);
      var text_22 = child(div_39, true);
      reset(div_39);
      var node_23 = sibling(div_39, 2);
      {
        let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
        Tooltip(node_23, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            {
              let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
              Textarea($$anchor3, {
                get placeholder() {
                  return get($02);
                },
                get value() {
                  return get(taskConfig).TOOLS_FUNCTION_CALLING_PROMPT_TEMPLATE;
                },
                set value($$value) {
                  mutate(taskConfig, get(taskConfig).TOOLS_FUNCTION_CALLING_PROMPT_TEMPLATE = $$value);
                },
                $$legacy: true
              });
            }
          },
          $$slots: { default: true }
        });
      }
      reset(div_38);
      reset(div_1);
      var div_40 = sibling(div_1, 2);
      var div_41 = child(div_40);
      var text_23 = child(div_41, true);
      reset(div_41);
      var div_42 = sibling(div_41, 4);
      var div_43 = child(div_42);
      var div_44 = child(div_43);
      var text_24 = child(div_44, true);
      reset(div_44);
      var button = sibling(div_44, 2);
      reset(div_43);
      var node_24 = sibling(div_43, 2);
      Banners(node_24, {
        get banners() {
          return get(banners$1);
        },
        set banners($$value) {
          set(banners$1, $$value);
        },
        $$legacy: true
      });
      reset(div_42);
      var node_25 = sibling(div_42, 2);
      {
        var consequent_6 = ($$anchor3) => {
          var fragment_9 = root_19$1();
          var node_26 = first_child(fragment_9);
          PromptSuggestions(node_26, {
            get promptSuggestions() {
              return get(promptSuggestions);
            },
            set promptSuggestions($$value) {
              set(promptSuggestions, $$value);
            },
            $$legacy: true
          });
          var node_27 = sibling(node_26, 2);
          {
            var consequent_5 = ($$anchor4) => {
              var div_45 = root_20$4();
              var text_25 = child(div_45, true);
              reset(div_45);
              template_effect(($0) => set_text(text_25, $0), [
                () => $i18n().t("Adjusting these settings will apply changes universally to all users.")
              ]);
              append($$anchor4, div_45);
            };
            if_block(node_27, ($$render) => {
              if (get(promptSuggestions).length > 0) $$render(consequent_5);
            });
          }
          append($$anchor3, fragment_9);
        };
        if_block(node_25, ($$render) => {
          var _a;
          if (((_a = $user()) == null ? void 0 : _a.role) === "admin") $$render(consequent_6);
        });
      }
      reset(div_40);
      reset(div);
      var div_46 = sibling(div, 2);
      var button_1 = child(div_46);
      var text_26 = child(button_1, true);
      reset(button_1);
      reset(div_46);
      reset(form);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20) => {
          set_text(text2, $0);
          set_text(text_1, $1);
          set_text(text_2, $2);
          set_attribute(select, "placeholder", $3);
          set_text(text_3, $4);
          set_text(text_5, $5);
          set_attribute(select_1, "placeholder", $6);
          set_text(text_6, $7);
          set_text(text_8, $8);
          set_text(text_10, $9);
          set_text(text_12, $10);
          set_text(text_14, $11);
          set_text(text_16, $12);
          set_text(text_17, $13);
          set_text(text_18, $14);
          set_text(text_19, $15);
          set_text(text_21, $16);
          set_text(text_22, $17);
          set_text(text_23, $18);
          set_text(text_24, $19);
          set_text(text_26, $20);
        },
        [
          () => $i18n().t("Tasks"),
          () => $i18n().t("Task Model"),
          () => $i18n().t("Local Task Model"),
          () => $i18n().t("Select a model"),
          () => $i18n().t("Current Model"),
          () => $i18n().t("External Task Model"),
          () => $i18n().t("Select a model"),
          () => $i18n().t("Current Model"),
          () => $i18n().t("Title Generation"),
          () => $i18n().t("Voice Mode Custom Prompt"),
          () => $i18n().t("Follow Up Generation"),
          () => $i18n().t("Tags Generation"),
          () => $i18n().t("Retrieval Query Generation"),
          () => $i18n().t("Web Search Query Generation"),
          () => $i18n().t("Query Generation Prompt"),
          () => $i18n().t("Autocomplete Generation"),
          () => $i18n().t("Image Prompt Generation Prompt"),
          () => $i18n().t("Tools Function Calling Prompt"),
          () => $i18n().t("UI"),
          () => $i18n().t("Banners"),
          () => $i18n().t("Save")
        ]
      );
      bind_select_value(select, () => get(taskConfig).TASK_MODEL, ($$value) => mutate(taskConfig, get(taskConfig).TASK_MODEL = $$value));
      event("change", select, () => {
        if (get(taskConfig).TASK_MODEL) {
          const model = get(models2).find((m) => m.id === get(taskConfig).TASK_MODEL);
          if (model) {
            if ((model == null ? void 0 : model.access_control) !== null) {
              toast.error($i18n().t("This model is not publicly available. Please select another model."));
            }
            mutate(taskConfig, get(taskConfig).TASK_MODEL = model.id);
          } else {
            mutate(taskConfig, get(taskConfig).TASK_MODEL = "");
          }
        }
      });
      bind_select_value(select_1, () => get(taskConfig).TASK_MODEL_EXTERNAL, ($$value) => mutate(taskConfig, get(taskConfig).TASK_MODEL_EXTERNAL = $$value));
      event("change", select_1, () => {
        if (get(taskConfig).TASK_MODEL_EXTERNAL) {
          const model = get(models2).find((m) => m.id === get(taskConfig).TASK_MODEL_EXTERNAL);
          if (model) {
            if ((model == null ? void 0 : model.access_control) !== null) {
              toast.error($i18n().t("This model is not publicly available. Please select another model."));
            }
            mutate(taskConfig, get(taskConfig).TASK_MODEL_EXTERNAL = model.id);
          } else {
            mutate(taskConfig, get(taskConfig).TASK_MODEL_EXTERNAL = "");
          }
        }
      });
      event("click", button, () => {
        if (get(banners$1).length === 0 || get(banners$1).at(-1).content !== "") {
          set(banners$1, [
            ...get(banners$1),
            {
              id: v4(),
              type: "",
              title: "",
              content: "",
              dismissible: true,
              timestamp: Math.floor(Date.now() / 1e3)
            }
          ]);
        }
      });
      event("submit", form, preventDefault(() => {
        updateInterfaceHandler();
        dispatch("save");
      }));
      append($$anchor2, form);
    };
    var alternate = ($$anchor2) => {
      var div_47 = root_21$1();
      var node_28 = child(div_47);
      Spinner(node_28, { className: "size-5" });
      reset(div_47);
      append($$anchor2, div_47);
    };
    if_block(node, ($$render) => {
      if (get(models2) !== null && get(taskConfig)) $$render(consequent_7);
      else $$render(alternate, false);
    });
  }
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_3$b = from_html(`<div class="flex items-center gap-1"><!> <div class=" text-sm flex-1 py-1 rounded-lg"><!></div></div>`);
var root_2$c = from_html(`<div class=" flex gap-2 w-full justify-between items-center"><!></div>`);
var root_1$e = from_html(`<div class="flex flex-col -translate-x-1"></div>`);
var root_6$7 = from_html(`<div class="text-gray-500 text-xs text-center py-2"> </div>`);
function ModelList($$anchor, $$props) {
  push($$props, false);
  const $models = () => store_get(models, "$models", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let modelIds = prop($$props, "modelIds", 28, () => []);
  let sortable = null;
  let modelListElement = mutable_source(null);
  const positionChangeHandler = () => {
    const modelList = Array.from(get(modelListElement).children).map((child2) => child2.id.replace("model-item-", ""));
    modelIds(modelList);
  };
  const init$1 = () => {
    if (sortable) {
      sortable.destroy();
    }
    if (get(modelListElement)) {
      sortable = new Sortable(get(modelListElement), {
        animation: 150,
        handle: ".model-item-handle",
        onUpdate: async (event2) => {
          positionChangeHandler();
        }
      });
    }
  };
  legacy_pre_effect(() => deep_read_state(modelIds()), () => {
    if (modelIds()) {
      init$1();
    }
  });
  legacy_pre_effect_reset();
  init();
  var fragment = comment();
  var node = first_child(fragment);
  {
    var consequent_1 = ($$anchor2) => {
      var div = root_1$e();
      each(div, 7, modelIds, (modelId, modelIdx) => `${modelId}-${modelIdx}`, ($$anchor3, modelId) => {
        var div_1 = root_2$c();
        var node_1 = child(div_1);
        Tooltip(node_1, {
          get content() {
            return get(modelId);
          },
          placement: "top-start",
          children: ($$anchor4, $$slotProps) => {
            var div_2 = root_3$b();
            var node_2 = child(div_2);
            EllipsisVertical(node_2, { className: "size-4 cursor-move model-item-handle" });
            var div_3 = sibling(node_2, 2);
            var node_3 = child(div_3);
            {
              var consequent = ($$anchor5) => {
                var text$1 = text();
                template_effect(($0) => set_text(text$1, $0), [
                  () => ($models(), get(modelId), untrack(() => $models().find((model) => model.id === get(modelId)).name))
                ]);
                append($$anchor5, text$1);
              };
              var alternate = ($$anchor5) => {
                var text_1 = text();
                template_effect(() => set_text(text_1, get(modelId)));
                append($$anchor5, text_1);
              };
              if_block(node_3, ($$render) => {
                if ($models(), get(modelId), untrack(() => $models().find((model) => model.id === get(modelId)))) $$render(consequent);
                else $$render(alternate, false);
              });
            }
            reset(div_3);
            reset(div_2);
            append($$anchor4, div_2);
          },
          $$slots: { default: true }
        });
        reset(div_1);
        template_effect(() => set_attribute(div_1, "id", `model-item-${get(modelId) ?? ""}`));
        append($$anchor3, div_1);
      });
      reset(div);
      bind_this(div, ($$value) => set(modelListElement, $$value), () => get(modelListElement));
      append($$anchor2, div);
    };
    var alternate_1 = ($$anchor2) => {
      var div_4 = root_6$7();
      var text_2 = child(div_4, true);
      reset(div_4);
      template_effect(($0) => set_text(text_2, $0), [
        () => ($i18n(), untrack(() => $i18n().t("No models found")))
      ]);
      append($$anchor2, div_4);
    };
    if_block(node, ($$render) => {
      if (deep_read_state(modelIds()), untrack(() => modelIds().length > 0)) $$render(consequent_1);
      else $$render(alternate_1, false);
    });
  }
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_2$b = from_html(`<option class="bg-gray-50 dark:bg-gray-700"> </option>`);
var root_4$b = from_html(`<div class=" flex gap-2 w-full justify-between items-center"><div class=" text-sm flex-1 py-1 rounded-lg"> </div> <div class="shrink-0"><button type="button"><!></button></div></div>`);
var root_3$a = from_html(`<div class="flex flex-col"></div>`);
var root_5$7 = from_html(`<div class="text-gray-500 text-xs text-center py-2"> </div>`);
var root$f = from_html(`<div><div class="flex flex-col w-full"><div class="mb-1 flex justify-between"><div class="text-xs text-gray-500"> </div></div> <div class="flex items-center -mr-1"><select><option> </option><!></select></div> <!></div></div>`);
function ModelSelector($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let title = prop($$props, "title", 8, "");
  let models2 = prop($$props, "models", 24, () => []);
  let modelIds = prop($$props, "modelIds", 28, () => []);
  let selectedModelId = mutable_source("");
  init();
  var div = root$f();
  var div_1 = child(div);
  var div_2 = child(div_1);
  var div_3 = child(div_2);
  var text2 = child(div_3, true);
  reset(div_3);
  reset(div_2);
  var div_4 = sibling(div_2, 2);
  var select = child(div_4);
  template_effect(() => {
    get(selectedModelId);
    invalidate_inner_signals(() => {
      modelIds();
      $i18n();
      models2();
    });
  });
  var option = child(select);
  var text_1 = child(option, true);
  reset(option);
  option.value = option.__value = "";
  var node = sibling(option);
  each(node, 1, models2, index, ($$anchor2, model) => {
    var fragment = comment();
    var node_1 = first_child(fragment);
    {
      var consequent = ($$anchor3) => {
        var option_1 = root_2$b();
        var text_2 = child(option_1, true);
        reset(option_1);
        var option_1_value = {};
        template_effect(() => {
          set_text(text_2, (get(model), untrack(() => get(model).name)));
          if (option_1_value !== (option_1_value = (get(model), untrack(() => get(model).id)))) {
            option_1.value = (option_1.__value = (get(model), untrack(() => get(model).id))) ?? "";
          }
        });
        append($$anchor3, option_1);
      };
      if_block(node_1, ($$render) => {
        if (deep_read_state(modelIds()), get(model), untrack(() => !modelIds().includes(get(model).id))) $$render(consequent);
      });
    }
    append($$anchor2, fragment);
  });
  reset(select);
  reset(div_4);
  var node_2 = sibling(div_4, 2);
  {
    var consequent_1 = ($$anchor2) => {
      var div_5 = root_3$a();
      each(div_5, 5, modelIds, index, ($$anchor3, modelId, modelIdx) => {
        var div_6 = root_4$b();
        var div_7 = child(div_6);
        var text_3 = child(div_7, true);
        reset(div_7);
        var div_8 = sibling(div_7, 2);
        var button = child(div_8);
        var node_3 = child(button);
        Minus(node_3, { strokeWidth: "2", className: "size-3.5" });
        reset(button);
        reset(div_8);
        reset(div_6);
        template_effect(($0) => set_text(text_3, $0), [
          () => (deep_read_state(models2()), get(modelId), untrack(() => {
            var _a;
            return (_a = models2().find((model) => model.id === get(modelId))) == null ? void 0 : _a.name;
          }))
        ]);
        event("click", button, () => {
          modelIds(modelIds().filter((_, idx) => idx !== modelIdx));
        });
        append($$anchor3, div_6);
      });
      reset(div_5);
      append($$anchor2, div_5);
    };
    var alternate = ($$anchor2) => {
      var div_9 = root_5$7();
      var text_4 = child(div_9, true);
      reset(div_9);
      template_effect(($0) => set_text(text_4, $0), [
        () => ($i18n(), untrack(() => $i18n().t("No models selected")))
      ]);
      append($$anchor2, div_9);
    };
    if_block(node_2, ($$render) => {
      if (deep_read_state(modelIds()), untrack(() => modelIds().length > 0)) $$render(consequent_1);
      else $$render(alternate, false);
    });
  }
  reset(div_1);
  reset(div);
  template_effect(
    ($0) => {
      set_text(text2, title());
      set_class(select, 1, `w-full py-1 text-sm rounded-lg bg-transparent ${get(selectedModelId) ? "" : "text-gray-500"} placeholder:text-gray-300 dark:placeholder:text-gray-700 outline-hidden`);
      set_text(text_1, $0);
    },
    [
      () => ($i18n(), untrack(() => $i18n().t("Select a model")))
    ]
  );
  bind_select_value(select, () => get(selectedModelId), ($$value) => set(selectedModelId, $$value));
  event("change", select, () => {
    if (get(selectedModelId) && !modelIds().includes(get(selectedModelId))) {
      modelIds([...modelIds(), get(selectedModelId)]);
    }
    set(selectedModelId, "");
  });
  append($$anchor, div);
  pop();
  $$cleanup();
}
var root_7$5 = from_html(`<div class=" flex gap-2 w-full justify-between items-center"><div class=" text-sm flex-1 py-1 rounded-lg"> </div> <div class="shrink-0"><button type="button"><!></button></div></div>`);
var root_6$6 = from_html(`<div class="flex flex-col"></div>`);
var root_8$6 = from_html(`<div class="text-gray-500 text-xs text-center py-2"> </div>`);
var root_9$2 = from_html(`<option class="bg-gray-50 dark:bg-gray-700"> </option>`);
var root_10$5 = from_html(`<button class="px-3.5 py-1.5 text-sm font-medium dark:bg-black dark:hover:bg-gray-950 dark:text-white bg-white text-black hover:bg-gray-100 transition rounded-full flex flex-row space-x-1 items-center" type="button"> </button>`);
var root_11$3 = from_html(`<div class="ml-2 self-center"><!></div>`);
var root_1$d = from_html(`<div><div class=" flex justify-between dark:text-gray-100 px-5 pt-4 pb-2"><div class=" text-lg font-medium self-center font-primary"><!></div> <button class="self-center"><!></button></div> <div class="flex flex-col md:flex-row w-full px-4 pb-4 md:space-x-4 dark:text-gray-200"><div class=" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"><form class="flex flex-col w-full"><div class="px-1"><div class="flex justify-center pb-3"><input type="file" hidden="" accept="image/*"/> <button class="relative rounded-full w-fit h-fit shrink-0" type="button"><img class="size-16 rounded-full object-cover shrink-0" alt="Profile"/> <div class="absolute flex justify-center rounded-full bottom-0 left-0 right-0 top-0 h-full w-full overflow-hidden bg-gray-700 bg-fixed opacity-0 transition duration-300 ease-in-out hover:opacity-50"><div class="my-auto text-white"><!></div></div></button></div> <div class="flex gap-2"><div class="flex flex-col w-full"><div class=" mb-0.5 text-xs text-gray-500"> </div> <div class="flex-1"><input class="w-full text-sm bg-transparent placeholder:text-gray-300 dark:placeholder:text-gray-700 outline-hidden" type="text" autocomplete="off" required/></div></div> <div class="flex flex-col w-full"><div class=" mb-0.5 text-xs text-gray-500"> </div> <div class="flex-1"><input class="w-full text-sm bg-transparent placeholder:text-gray-300 dark:placeholder:text-gray-700 outline-hidden" type="text" autocomplete="off" required/></div></div></div> <div class="flex flex-col w-full mt-2"><div class=" mb-1 text-xs text-gray-500"> </div> <div class="flex-1"><input class="w-full text-sm bg-transparent placeholder:text-gray-300 dark:placeholder:text-gray-700 outline-hidden" type="text" autocomplete="off"/></div></div> <hr class=" border-gray-100 dark:border-gray-700/10 my-2.5 w-full"/> <div class="my-2 -mx-2"><div class="px-4 py-3 bg-gray-50 dark:bg-gray-950 rounded-3xl"><!></div></div> <hr class=" border-gray-100 dark:border-gray-700/10 my-2.5 w-full"/> <div class="flex flex-col w-full"><div class="mb-1 flex justify-between"><div class="text-xs text-gray-500"> </div> <div><button class=" text-xs text-gray-500" type="button"><!></button></div></div> <!></div> <hr class=" border-gray-100 dark:border-gray-700/10 my-2.5 w-full"/> <div class="flex items-center"><select><option> </option><!></select> <div><button type="button"><!></button></div></div></div> <div class="flex justify-end pt-3 text-sm font-medium gap-1.5"><!> <button type="submit"> <!></button></div></form></div></div></div>`);
var root$e = from_html(`<!> <!>`, 1);
function ArenaModelModal($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $models = () => store_get(models, "$models", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  const dispatch = createEventDispatcher();
  let show = prop($$props, "show", 12, false);
  let edit = prop($$props, "edit", 8, false);
  let model = prop($$props, "model", 8, null);
  let name = mutable_source("");
  let id = mutable_source("");
  const generateId = () => {
    if (!edit()) {
      set(id, get(name).toLowerCase().replace(/[^a-z0-9]/g, "-").replace(/-+/g, "-").replace(/^-|-$/g, ""));
    }
  };
  let profileImageUrl = mutable_source(`${WEBUI_BASE_URL}/favicon.png`);
  let description = mutable_source("");
  let selectedModelId = mutable_source("");
  let modelIds = mutable_source([]);
  let filterMode = mutable_source("include");
  let accessControl = mutable_source({});
  let imageInputElement = mutable_source();
  let loading = mutable_source(false);
  let showDeleteConfirmDialog = mutable_source(false);
  const addModelHandler = () => {
    if (get(selectedModelId)) {
      set(modelIds, [...get(modelIds), get(selectedModelId)]);
      set(selectedModelId, "");
    }
  };
  const submitHandler = () => {
    set(loading, true);
    if (!get(name) || !get(id)) {
      set(loading, false);
      toast.error($i18n().t("Name and ID are required, please fill them out"));
      return;
    }
    if (!edit()) {
      if ($models().find((model3) => model3.name === get(name))) {
        set(loading, false);
        set(name, "");
        toast.error($i18n().t("Model name already exists, please choose a different one"));
        return;
      }
    }
    const model2 = {
      id: get(id),
      name: get(name),
      meta: {
        profile_image_url: get(profileImageUrl),
        description: get(description) || null,
        model_ids: get(modelIds).length > 0 ? get(modelIds) : null,
        filter_mode: get(modelIds).length > 0 ? get(filterMode) ? get(filterMode) : null : null,
        access_control: get(accessControl)
      }
    };
    dispatch("submit", model2);
    set(loading, false);
    show(false);
    set(name, "");
    set(id, "");
    set(profileImageUrl, `${WEBUI_BASE_URL}/favicon.png`);
    set(description, "");
    set(modelIds, []);
    set(selectedModelId, "");
  };
  const initModel = () => {
    var _a;
    if (model()) {
      set(name, model().name);
      set(id, model().id);
      set(profileImageUrl, model().meta.profile_image_url);
      set(description, model().meta.description);
      set(modelIds, model().meta.model_ids || []);
      set(filterMode, ((_a = model().meta) == null ? void 0 : _a.filter_mode) ?? "include");
      set(accessControl, "access_control" in model().meta ? model().meta.access_control : {});
    }
  };
  onMount(() => {
    initModel();
  });
  legacy_pre_effect(() => get(name), () => {
    if (get(name)) {
      generateId();
    }
  });
  legacy_pre_effect(() => deep_read_state(show()), () => {
    if (show()) {
      initModel();
    }
  });
  legacy_pre_effect_reset();
  init();
  var fragment = root$e();
  var node = first_child(fragment);
  ConfirmDialog(node, {
    get show() {
      return get(showDeleteConfirmDialog);
    },
    set show($$value) {
      set(showDeleteConfirmDialog, $$value);
    },
    $$events: {
      confirm: () => {
        dispatch("delete", model());
        show(false);
      }
    },
    $$legacy: true
  });
  var node_1 = sibling(node, 2);
  Modal(node_1, {
    size: "sm",
    get show() {
      return show();
    },
    set show($$value) {
      show($$value);
    },
    children: ($$anchor2, $$slotProps) => {
      var div = root_1$d();
      var div_1 = child(div);
      var div_2 = child(div_1);
      var node_2 = child(div_2);
      {
        var consequent = ($$anchor3) => {
          var text$1 = text();
          template_effect(($0) => set_text(text$1, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Edit Arena Model")))
          ]);
          append($$anchor3, text$1);
        };
        var alternate = ($$anchor3) => {
          var text_1 = text();
          template_effect(($0) => set_text(text_1, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Add Arena Model")))
          ]);
          append($$anchor3, text_1);
        };
        if_block(node_2, ($$render) => {
          if (edit()) $$render(consequent);
          else $$render(alternate, false);
        });
      }
      reset(div_2);
      var button = sibling(div_2, 2);
      var node_3 = child(button);
      XMark(node_3, { className: "size-5" });
      reset(button);
      reset(div_1);
      var div_3 = sibling(div_1, 2);
      var div_4 = child(div_3);
      var form = child(div_4);
      var div_5 = child(form);
      var div_6 = child(div_5);
      var input = child(div_6);
      bind_this(input, ($$value) => set(imageInputElement, $$value), () => get(imageInputElement));
      var button_1 = sibling(input, 2);
      var img_1 = child(button_1);
      var div_7 = sibling(img_1, 2);
      var div_8 = child(div_7);
      var node_4 = child(div_8);
      PencilSolid(node_4, { className: "size-4" });
      reset(div_8);
      reset(div_7);
      reset(button_1);
      reset(div_6);
      var div_9 = sibling(div_6, 2);
      var div_10 = child(div_9);
      var div_11 = child(div_10);
      var text_2 = child(div_11, true);
      reset(div_11);
      var div_12 = sibling(div_11, 2);
      var input_1 = child(div_12);
      remove_input_defaults(input_1);
      reset(div_12);
      reset(div_10);
      var div_13 = sibling(div_10, 2);
      var div_14 = child(div_13);
      var text_3 = child(div_14, true);
      reset(div_14);
      var div_15 = sibling(div_14, 2);
      var input_2 = child(div_15);
      remove_input_defaults(input_2);
      reset(div_15);
      reset(div_13);
      reset(div_9);
      var div_16 = sibling(div_9, 2);
      var div_17 = child(div_16);
      var text_4 = child(div_17, true);
      reset(div_17);
      var div_18 = sibling(div_17, 2);
      var input_3 = child(div_18);
      remove_input_defaults(input_3);
      reset(div_18);
      reset(div_16);
      var div_19 = sibling(div_16, 4);
      var div_20 = child(div_19);
      var node_5 = child(div_20);
      AccessControl(node_5, {
        get accessControl() {
          return get(accessControl);
        },
        set accessControl($$value) {
          set(accessControl, $$value);
        },
        $$legacy: true
      });
      reset(div_20);
      reset(div_19);
      var div_21 = sibling(div_19, 4);
      var div_22 = child(div_21);
      var div_23 = child(div_22);
      var text_5 = child(div_23, true);
      reset(div_23);
      var div_24 = sibling(div_23, 2);
      var button_2 = child(div_24);
      var node_6 = child(button_2);
      {
        var consequent_1 = ($$anchor3) => {
          var text_6 = text();
          template_effect(($0) => set_text(text_6, $0), [() => ($i18n(), untrack(() => $i18n().t("Include")))]);
          append($$anchor3, text_6);
        };
        var alternate_1 = ($$anchor3) => {
          var text_7 = text();
          template_effect(($0) => set_text(text_7, $0), [() => ($i18n(), untrack(() => $i18n().t("Exclude")))]);
          append($$anchor3, text_7);
        };
        if_block(node_6, ($$render) => {
          if (get(filterMode) === "include") $$render(consequent_1);
          else $$render(alternate_1, false);
        });
      }
      reset(button_2);
      reset(div_24);
      reset(div_22);
      var node_7 = sibling(div_22, 2);
      {
        var consequent_2 = ($$anchor3) => {
          var div_25 = root_6$6();
          each(div_25, 5, () => get(modelIds), index, ($$anchor4, modelId, modelIdx) => {
            var div_26 = root_7$5();
            var div_27 = child(div_26);
            var text_8 = child(div_27, true);
            reset(div_27);
            var div_28 = sibling(div_27, 2);
            var button_3 = child(div_28);
            var node_8 = child(button_3);
            Minus(node_8, { strokeWidth: "2", className: "size-3.5" });
            reset(button_3);
            reset(div_28);
            reset(div_26);
            template_effect(($0) => set_text(text_8, $0), [
              () => ($models(), get(modelId), untrack(() => {
                var _a;
                return (_a = $models().find((model2) => model2.id === get(modelId))) == null ? void 0 : _a.name;
              }))
            ]);
            event("click", button_3, () => {
              set(modelIds, get(modelIds).filter((_, idx) => idx !== modelIdx));
            });
            append($$anchor4, div_26);
          });
          reset(div_25);
          append($$anchor3, div_25);
        };
        var alternate_2 = ($$anchor3) => {
          var div_29 = root_8$6();
          var text_9 = child(div_29, true);
          reset(div_29);
          template_effect(($0) => set_text(text_9, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Leave empty to include all models or select specific models")))
          ]);
          append($$anchor3, div_29);
        };
        if_block(node_7, ($$render) => {
          if (get(modelIds), untrack(() => get(modelIds).length > 0)) $$render(consequent_2);
          else $$render(alternate_2, false);
        });
      }
      reset(div_21);
      var div_30 = sibling(div_21, 4);
      var select = child(div_30);
      template_effect(() => {
        get(selectedModelId);
        invalidate_inner_signals(() => {
          $i18n();
          $models();
        });
      });
      var option = child(select);
      var text_10 = child(option, true);
      reset(option);
      option.value = option.__value = "";
      var node_9 = sibling(option);
      each(
        node_9,
        1,
        () => ($models(), untrack(() => $models().filter((m) => (m == null ? void 0 : m.owned_by) !== "arena"))),
        index,
        ($$anchor3, model2, $$index_1, $$array) => {
          var option_1 = root_9$2();
          var text_11 = child(option_1, true);
          reset(option_1);
          var option_1_value = {};
          template_effect(() => {
            set_text(text_11, (get(model2), untrack(() => get(model2).name)));
            if (option_1_value !== (option_1_value = (get(model2), untrack(() => get(model2).id)))) {
              option_1.value = (option_1.__value = (get(model2), untrack(() => get(model2).id))) ?? "";
            }
          });
          append($$anchor3, option_1);
        }
      );
      reset(select);
      var div_31 = sibling(select, 2);
      var button_4 = child(div_31);
      var node_10 = child(button_4);
      Plus(node_10, { className: "size-3.5", strokeWidth: "2" });
      reset(button_4);
      reset(div_31);
      reset(div_30);
      reset(div_5);
      var div_32 = sibling(div_5, 2);
      var node_11 = child(div_32);
      {
        var consequent_3 = ($$anchor3) => {
          var button_5 = root_10$5();
          var text_12 = child(button_5, true);
          reset(button_5);
          template_effect(($0) => set_text(text_12, $0), [() => ($i18n(), untrack(() => $i18n().t("Delete")))]);
          event("click", button_5, () => {
            set(showDeleteConfirmDialog, true);
          });
          append($$anchor3, button_5);
        };
        if_block(node_11, ($$render) => {
          if (edit()) $$render(consequent_3);
        });
      }
      var button_6 = sibling(node_11, 2);
      var text_13 = child(button_6);
      var node_12 = sibling(text_13);
      {
        var consequent_4 = ($$anchor3) => {
          var div_33 = root_11$3();
          var node_13 = child(div_33);
          Spinner(node_13, {});
          reset(div_33);
          append($$anchor3, div_33);
        };
        if_block(node_12, ($$render) => {
          if (get(loading)) $$render(consequent_4);
        });
      }
      reset(button_6);
      reset(div_32);
      reset(form);
      reset(div_4);
      reset(div_3);
      reset(div);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8) => {
          set_attribute(img_1, "src", get(profileImageUrl));
          set_text(text_2, $0);
          set_attribute(input_1, "placeholder", $1);
          set_text(text_3, $2);
          set_attribute(input_2, "placeholder", $3);
          input_2.disabled = edit();
          set_text(text_4, $4);
          set_attribute(input_3, "placeholder", $5);
          set_text(text_5, $6);
          set_class(select, 1, `w-full py-1 text-sm rounded-lg bg-transparent ${get(selectedModelId) ? "" : "text-gray-500"} placeholder:text-gray-300 dark:placeholder:text-gray-700 outline-hidden`);
          set_text(text_10, $7);
          set_class(button_6, 1, `px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-950 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full flex flex-row space-x-1 items-center ${get(loading) ? " cursor-not-allowed" : ""}`);
          button_6.disabled = get(loading);
          set_text(text_13, `${$8 ?? ""} `);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("Name"))),
          () => ($i18n(), untrack(() => $i18n().t("Model Name"))),
          () => ($i18n(), untrack(() => $i18n().t("ID"))),
          () => ($i18n(), untrack(() => $i18n().t("Model ID"))),
          () => ($i18n(), untrack(() => $i18n().t("Description"))),
          () => ($i18n(), untrack(() => $i18n().t("Enter description"))),
          () => ($i18n(), untrack(() => $i18n().t("Models"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a model"))),
          () => ($i18n(), untrack(() => $i18n().t("Save")))
        ]
      );
      event("click", button, () => {
        show(false);
      });
      event("change", input, (e) => {
        const files = e.target.files ?? [];
        let reader = new FileReader();
        reader.onload = (event2) => {
          let originalImageUrl = `${event2.target.result}`;
          const img = new Image();
          img.src = originalImageUrl;
          img.onload = function() {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const aspectRatio = img.width / img.height;
            let newWidth, newHeight;
            if (aspectRatio > 1) {
              newWidth = 250 * aspectRatio;
              newHeight = 250;
            } else {
              newWidth = 250;
              newHeight = 250 / aspectRatio;
            }
            canvas.width = 250;
            canvas.height = 250;
            const offsetX = (250 - newWidth) / 2;
            const offsetY = (250 - newHeight) / 2;
            ctx.drawImage(img, offsetX, offsetY, newWidth, newHeight);
            const compressedSrc = canvas.toDataURL("image/jpeg");
            set(profileImageUrl, compressedSrc);
            e.target.files = null;
          };
        };
        if (files.length > 0 && ["image/gif", "image/webp", "image/jpeg", "image/png"].includes(files[0]["type"])) {
          reader.readAsDataURL(files[0]);
        }
      });
      event("click", button_1, () => {
        get(imageInputElement).click();
      });
      bind_value(input_1, () => get(name), ($$value) => set(name, $$value));
      bind_value(input_2, () => get(id), ($$value) => set(id, $$value));
      bind_value(input_3, () => get(description), ($$value) => set(description, $$value));
      event("click", button_2, () => {
        set(filterMode, get(filterMode) === "include" ? "exclude" : "include");
      });
      bind_select_value(select, () => get(selectedModelId), ($$value) => set(selectedModelId, $$value));
      event("click", button_4, () => {
        addModelHandler();
      });
      event("submit", form, preventDefault(() => {
        submitHandler();
      }));
      append($$anchor2, div);
    },
    $$slots: { default: true },
    $$legacy: true
  });
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root$d = from_html(`<!> <div class="py-0.5"><div class="flex justify-between items-center mb-1"><div class="flex flex-col flex-1"><div class="flex gap-2.5 items-center"><img class="size-8 rounded-full object-cover shrink-0"/> <div class="w-full flex flex-col"><div class="flex items-center gap-1"><div class=" line-clamp-1"> </div></div> <div class="flex items-center gap-1"><div class=" text-xs w-full text-gray-500 bg-transparent line-clamp-1"> </div></div></div></div></div> <div class="flex items-center"><button class="self-center w-fit text-sm p-1.5 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-xl" type="button"><!></button></div></div></div>`, 1);
function Model($$anchor, $$props) {
  push($$props, false);
  const dispatch = createEventDispatcher();
  getContext("i18n");
  let model = prop($$props, "model", 8);
  let showModel = mutable_source(false);
  init();
  var fragment = root$d();
  var node = first_child(fragment);
  ArenaModelModal(node, {
    edit: true,
    get model() {
      return model();
    },
    get show() {
      return get(showModel);
    },
    set show($$value) {
      set(showModel, $$value);
    },
    $$events: {
      submit: async (e) => {
        dispatch("edit", e.detail);
      },
      delete: async () => {
        dispatch("delete");
      }
    },
    $$legacy: true
  });
  var div = sibling(node, 2);
  var div_1 = child(div);
  var div_2 = child(div_1);
  var div_3 = child(div_2);
  var img = child(div_3);
  var div_4 = sibling(img, 2);
  var div_5 = child(div_4);
  var div_6 = child(div_5);
  var text2 = child(div_6, true);
  reset(div_6);
  reset(div_5);
  var div_7 = sibling(div_5, 2);
  var div_8 = child(div_7);
  var text_1 = child(div_8, true);
  reset(div_8);
  reset(div_7);
  reset(div_4);
  reset(div_3);
  reset(div_2);
  var div_9 = sibling(div_2, 2);
  var button = child(div_9);
  var node_1 = child(button);
  Cog6(node_1, {});
  reset(button);
  reset(div_9);
  reset(div_1);
  reset(div);
  template_effect(() => {
    set_attribute(img, "src", (deep_read_state(WEBUI_API_BASE_URL), deep_read_state(model()), untrack(() => `${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model().id}`)));
    set_attribute(img, "alt", (deep_read_state(model()), untrack(() => model().name)));
    set_text(text2, (deep_read_state(model()), untrack(() => model().name)));
    set_text(text_1, (deep_read_state(model()), untrack(() => {
      var _a, _b;
      return ((_b = (_a = model()) == null ? void 0 : _a.meta) == null ? void 0 : _b.description) ?? model().id;
    })));
  });
  event("click", button, () => {
    set(showModel, true);
  });
  append($$anchor, fragment);
  pop();
}
var root_3$9 = from_html(`<span class="font-normal self-center"><!></span>`);
var root_6$5 = from_html(`<span class="invisible"><!></span>`);
var root_7$4 = from_html(`<button class="px-3.5 py-1.5 text-sm font-medium dark:bg-black dark:hover:bg-gray-950 dark:text-white bg-white text-black hover:bg-gray-100 transition rounded-full flex flex-row space-x-1 items-center" type="button"> </button>`);
var root_8$5 = from_html(`<div class="ml-2 self-center"><!></div>`);
var root_2$a = from_html(`<form class="flex flex-col w-full"><div><div class="flex flex-col w-full"><button class="mb-1 flex gap-2" type="button"><div class="text-xs text-gray-500"> </div> <!></button> <!></div></div> <hr class=" border-gray-100 dark:border-gray-700/10 my-2.5 w-full"/> <!> <hr class=" border-gray-100 dark:border-gray-700/10 my-2.5 w-full"/> <!> <div class="flex justify-between pt-3 text-sm font-medium gap-1.5"><!> <button type="submit"> <!></button></div></form>`);
var root_9$1 = from_html(`<div><!></div>`);
var root_1$c = from_html(`<div><div class=" flex justify-between dark:text-gray-100 px-5 pt-4 pb-2"><div class=" text-lg font-medium self-center font-primary"> </div> <button class="self-center"><!></button></div> <div class="flex flex-col md:flex-row w-full px-5 pb-4 md:space-x-4 dark:text-gray-200"><div class=" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"><!></div></div></div>`);
var root$c = from_html(`<!> <!>`, 1);
function ConfigureModelsModal($$anchor, $$props) {
  push($$props, false);
  const $models = () => store_get(models, "$models", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  createEventDispatcher();
  let show = prop($$props, "show", 12, false);
  let initHandler = prop($$props, "initHandler", 8, () => {
  });
  let config2 = mutable_source(null);
  let defaultModelIds = mutable_source([]);
  let defaultPinnedModelIds = mutable_source([]);
  let modelIds = mutable_source([]);
  let sortKey = mutable_source("");
  let sortOrder = mutable_source("");
  let loading = mutable_source(false);
  let showResetModal = mutable_source(false);
  const init$1 = async () => {
    var _a, _b, _c, _d;
    set(config2, await getModelsConfig(localStorage.token));
    if ((_a = get(config2)) == null ? void 0 : _a.DEFAULT_MODELS) {
      set(defaultModelIds, (_b = get(config2)) == null ? void 0 : _b.DEFAULT_MODELS.split(",").filter((id) => id));
    } else {
      set(defaultModelIds, []);
    }
    if ((_c = get(config2)) == null ? void 0 : _c.DEFAULT_PINNED_MODELS) {
      set(defaultPinnedModelIds, (_d = get(config2)) == null ? void 0 : _d.DEFAULT_PINNED_MODELS.split(",").filter((id) => id));
    } else {
      set(defaultPinnedModelIds, []);
    }
    const modelOrderList = get(config2).MODEL_ORDER_LIST || [];
    const allModelIds = $models().map((model) => model.id);
    const orderedSet = new Set(modelOrderList);
    set(modelIds, [
      // Add all IDs from MODEL_ORDER_LIST that exist in allModelIds
      ...modelOrderList.filter((id) => orderedSet.has(id) && allModelIds.includes(id)),
      // Add remaining IDs not in MODEL_ORDER_LIST, sorted alphabetically
      ...allModelIds.filter((id) => !orderedSet.has(id)).sort((a, b) => a.localeCompare(b))
    ]);
    set(sortKey, "");
    set(sortOrder, "");
  };
  const submitHandler = async () => {
    set(loading, true);
    const res = await setModelsConfig(localStorage.token, {
      DEFAULT_MODELS: get(defaultModelIds).join(","),
      DEFAULT_PINNED_MODELS: get(defaultPinnedModelIds).join(","),
      MODEL_ORDER_LIST: get(modelIds)
    });
    if (res) {
      toast.success($i18n().t("Models configuration saved successfully"));
      initHandler()();
      show(false);
    } else {
      toast.error($i18n().t("Failed to save models configuration"));
    }
    set(loading, false);
  };
  onMount(async () => {
    init$1();
  });
  legacy_pre_effect(() => deep_read_state(show()), () => {
    if (show()) {
      init$1();
    }
  });
  legacy_pre_effect_reset();
  init();
  var fragment = root$c();
  var node = first_child(fragment);
  {
    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Reset All Models"))));
    let $1 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("This will delete all models including custom models and cannot be undone."))));
    ConfirmDialog(node, {
      get title() {
        return get($0);
      },
      get message() {
        return get($1);
      },
      onConfirm: async () => {
        const res = deleteAllModels(localStorage.token);
        if (res) {
          toast.success($i18n().t("All models deleted successfully"));
          initHandler()();
        }
      },
      get show() {
        return get(showResetModal);
      },
      set show($$value) {
        set(showResetModal, $$value);
      },
      $$legacy: true
    });
  }
  var node_1 = sibling(node, 2);
  Modal(node_1, {
    size: "sm",
    get show() {
      return show();
    },
    set show($$value) {
      show($$value);
    },
    children: ($$anchor2, $$slotProps) => {
      var div = root_1$c();
      var div_1 = child(div);
      var div_2 = child(div_1);
      var text2 = child(div_2, true);
      reset(div_2);
      var button = sibling(div_2, 2);
      var node_2 = child(button);
      XMark(node_2, { className: "size-5" });
      reset(button);
      reset(div_1);
      var div_3 = sibling(div_1, 2);
      var div_4 = child(div_3);
      var node_3 = child(div_4);
      {
        var consequent_3 = ($$anchor3) => {
          var form = root_2$a();
          var div_5 = child(form);
          var div_6 = child(div_5);
          var button_1 = child(div_6);
          var div_7 = child(button_1);
          var text_1 = child(div_7, true);
          reset(div_7);
          var node_4 = sibling(div_7, 2);
          {
            var consequent_1 = ($$anchor4) => {
              var span = root_3$9();
              var node_5 = child(span);
              {
                var consequent = ($$anchor5) => {
                  ChevronUp($$anchor5, { className: "size-3" });
                };
                var alternate = ($$anchor5) => {
                  ChevronDown($$anchor5, { className: "size-3" });
                };
                if_block(node_5, ($$render) => {
                  if (get(sortOrder) === "asc") $$render(consequent);
                  else $$render(alternate, false);
                });
              }
              reset(span);
              append($$anchor4, span);
            };
            var alternate_1 = ($$anchor4) => {
              var span_1 = root_6$5();
              var node_6 = child(span_1);
              ChevronUp(node_6, { className: "size-3" });
              reset(span_1);
              append($$anchor4, span_1);
            };
            if_block(node_4, ($$render) => {
              if (get(sortKey) === "model") $$render(consequent_1);
              else $$render(alternate_1, false);
            });
          }
          reset(button_1);
          var node_7 = sibling(button_1, 2);
          ModelList(node_7, {
            get modelIds() {
              return get(modelIds);
            },
            set modelIds($$value) {
              set(modelIds, $$value);
            },
            $$legacy: true
          });
          reset(div_6);
          reset(div_5);
          var node_8 = sibling(div_5, 4);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Default Models"))));
            ModelSelector(node_8, {
              get title() {
                return get($0);
              },
              get models() {
                return $models();
              },
              get modelIds() {
                return get(defaultModelIds);
              },
              set modelIds($$value) {
                set(defaultModelIds, $$value);
              },
              $$legacy: true
            });
          }
          var node_9 = sibling(node_8, 4);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Default Pinned Models"))));
            ModelSelector(node_9, {
              get title() {
                return get($0);
              },
              get models() {
                return $models();
              },
              get modelIds() {
                return get(defaultPinnedModelIds);
              },
              set modelIds($$value) {
                set(defaultPinnedModelIds, $$value);
              },
              $$legacy: true
            });
          }
          var div_8 = sibling(node_9, 2);
          var node_10 = child(div_8);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("This will delete all models including custom models"))));
            Tooltip(node_10, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps2) => {
                var button_2 = root_7$4();
                var text_2 = child(button_2, true);
                reset(button_2);
                template_effect(($02) => set_text(text_2, $02), [
                  () => ($i18n(), untrack(() => $i18n().t("Reset All Models")))
                ]);
                event("click", button_2, () => {
                  set(showResetModal, true);
                });
                append($$anchor4, button_2);
              },
              $$slots: { default: true }
            });
          }
          var button_3 = sibling(node_10, 2);
          var text_3 = child(button_3);
          var node_11 = sibling(text_3);
          {
            var consequent_2 = ($$anchor4) => {
              var div_9 = root_8$5();
              var node_12 = child(div_9);
              Spinner(node_12, {});
              reset(div_9);
              append($$anchor4, div_9);
            };
            if_block(node_11, ($$render) => {
              if (get(loading)) $$render(consequent_2);
            });
          }
          reset(button_3);
          reset(div_8);
          reset(form);
          template_effect(
            ($0, $1) => {
              set_text(text_1, $0);
              set_class(button_3, 1, `px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full flex flex-row space-x-1 items-center ${get(loading) ? " cursor-not-allowed" : ""}`);
              button_3.disabled = get(loading);
              set_text(text_3, `${$1 ?? ""} `);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Reorder Models"))),
              () => ($i18n(), untrack(() => $i18n().t("Save")))
            ]
          );
          event("click", button_1, () => {
            set(sortKey, "model");
            if (get(sortOrder) === "asc") {
              set(sortOrder, "desc");
            } else {
              set(sortOrder, "asc");
            }
            set(modelIds, get(modelIds).filter((id) => id !== "").sort((a, b) => {
              var _a, _b;
              const nameA = ((_a = $models().find((model) => model.id === a)) == null ? void 0 : _a.name) || a;
              const nameB = ((_b = $models().find((model) => model.id === b)) == null ? void 0 : _b.name) || b;
              return get(sortOrder) === "desc" ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
            }));
          });
          event("submit", form, preventDefault(() => {
            submitHandler();
          }));
          append($$anchor3, form);
        };
        var alternate_2 = ($$anchor3) => {
          var div_10 = root_9$1();
          var node_13 = child(div_10);
          Spinner(node_13, { className: "size-5" });
          reset(div_10);
          append($$anchor3, div_10);
        };
        if_block(node_3, ($$render) => {
          if (get(config2)) $$render(consequent_3);
          else $$render(alternate_2, false);
        });
      }
      reset(div_4);
      reset(div_3);
      reset(div);
      template_effect(($0) => set_text(text2, $0), [() => ($i18n(), untrack(() => $i18n().t("Settings")))]);
      event("click", button, () => {
        show(false);
      });
      append($$anchor2, div);
    },
    $$slots: { default: true },
    $$legacy: true
  });
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_2$9 = from_html(`<button class="flex gap-2 items-center bg-transparent rounded-lg transition"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M7 1a.75.75 0 0 1 .75.75V6h-1.5V1.75A.75.75 0 0 1 7 1ZM6.25 6v2.94L5.03 7.72a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l2.5-2.5a.75.75 0 1 0-1.06-1.06L7.75 8.94V6H10a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2.25Z"></path><path d="M4.268 14A2 2 0 0 0 6 15h6a2 2 0 0 0 2-2v-3a2 2 0 0 0-1-1.732V11a3 3 0 0 1-3 3H4.268Z"></path></svg></button>`);
var root_4$a = from_html(`<div class="self-center"><svg class=" w-4 h-4" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY {
													transform-origin: center;
													animation: spinner_AtaB 0.75s infinite linear;
												}

												@keyframes spinner_AtaB {
													100% {
														transform: rotate(360deg);
													}
												}</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"></path><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"></path></svg></div>`);
var root_5$6 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 2.75a.75.75 0 0 0-1.5 0v5.69L5.03 6.22a.75.75 0 0 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 0 0-1.06-1.06L8.75 8.44V2.75Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg>`);
var root_3$8 = from_html(`<button class="px-2.5 bg-gray-50 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition"><!></button>`);
var root_7$3 = from_html(`<button class="text-gray-800 dark:text-gray-100"><svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"></path></svg></button>`);
var root_6$4 = from_html(`<div class="text-xs flex justify-between items-center"><div> </div> <!></div>`);
var root_11$2 = from_html(`<button class="text-gray-800 dark:text-gray-100"><svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"></path></svg></button>`);
var root_12$3 = from_html(`<div class="mt-1 text-xs dark:text-gray-500" style="font-size: 0.5rem;"> </div>`);
var root_10$4 = from_html(`<div class="flex flex-col"><div class="font-medium mb-1"> </div> <div><div class="flex flex-row justify-between space-x-4 pr-2"><div class=" flex-1"><div class="dark:bg-gray-600 bg-gray-500 text-xs font-medium text-gray-100 text-center p-0.5 leading-none rounded-full"> </div></div> <!></div> <!></div></div>`);
var root_13$2 = from_html(`<option disabled selected> </option>`);
var root_14$2 = from_html(`<option class="bg-gray-50 dark:bg-gray-700"> </option>`);
var root_15 = from_html(`<button class="px-2.5 bg-gray-50 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M5 3.25V4H2.75a.75.75 0 0 0 0 1.5h.3l.815 8.15A1.5 1.5 0 0 0 5.357 15h5.285a1.5 1.5 0 0 0 1.493-1.35l.815-8.15h.3a.75.75 0 0 0 0-1.5H11v-.75A2.25 2.25 0 0 0 8.75 1h-1.5A2.25 2.25 0 0 0 5 3.25Zm2.25-.75a.75.75 0 0 0-.75.75V4h3v-.75a.75.75 0 0 0-.75-.75h-1.5ZM6.05 6a.75.75 0 0 1 .787.713l.275 5.5a.75.75 0 0 1-1.498.075l-.275-5.5A.75.75 0 0 1 6.05 6Zm3.9 0a.75.75 0 0 1 .712.787l-.275 5.5a.75.75 0 0 1-1.498-.075l.275-5.5a.75.75 0 0 1 .786-.711Z" clip-rule="evenodd"></path></svg></button>`);
var root_16$4 = from_html(`<button class="px-2.5 py-2.5 bg-gray-50 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg transition disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path d="M7.25 10.25a.75.75 0 0 0 1.5 0V4.56l2.22 2.22a.75.75 0 1 0 1.06-1.06l-3.5-3.5a.75.75 0 0 0-1.06 0l-3.5 3.5a.75.75 0 0 0 1.06 1.06l2.22-2.22v5.69Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg></button>`);
var root_18$2 = from_html(`<div class="mt-1 text-xs dark:text-gray-500" style="font-size: 0.5rem;"> </div>`);
var root_17$1 = from_html(`<div class="flex flex-col mt-1"><div class="font-medium mb-1"></div> <div><div class="flex flex-row justify-between space-x-4 pr-2"><div class=" flex-1"><div class="dark:bg-gray-600 bg-gray-500 text-xs font-medium text-gray-100 text-center p-0.5 leading-none rounded-full"> </div></div></div> <!></div></div>`);
var root_20$3 = from_html(`<span class="ml-2 self-center"> </span>`);
var root_21 = from_html(`<span class="ml-2 self-center"> </span>`);
var root_22$2 = from_html(`<div><input id="model-upload-input" type="file" accept=".gguf,.safetensors" required hidden=""/> <button type="button" class="w-full rounded-lg text-left py-2 px-4 bg-gray-50 dark:text-gray-300 dark:bg-gray-850"><!></button></div>`);
var root_25 = from_html(`<div><input type="url" required/></div>`);
var root_28$1 = from_html(`<div class="self-center"><svg class=" w-4 h-4" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY {
															transform-origin: center;
															animation: spinner_AtaB 0.75s infinite linear;
														}

														@keyframes spinner_AtaB {
															100% {
																transform: rotate(360deg);
															}
														}</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"></path><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"></path></svg></div>`);
var root_29 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M7.25 10.25a.75.75 0 0 0 1.5 0V4.56l2.22 2.22a.75.75 0 1 0 1.06-1.06l-3.5-3.5a.75.75 0 0 0-1.06 0l-3.5 3.5a.75.75 0 0 0 1.06 1.06l2.22-2.22v5.69Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg>`);
var root_27 = from_html(`<button class="px-2.5 bg-gray-50 hover:bg-gray-200 text-gray-800 dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-gray-100 rounded-lg disabled:cursor-not-allowed transition" type="submit"><!></button>`);
var root_30$2 = from_html(`<div><div><div class=" my-2.5 text-sm font-medium"> </div> <textarea class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-100 dark:bg-gray-850 outline-hidden resize-none" rows="6"></textarea></div></div>`);
var root_31$1 = from_html(`<div class="mt-2"><div class=" mb-2 text-xs"> </div> <div class="w-full rounded-full dark:bg-gray-800"><div class="dark:bg-gray-600 bg-gray-500 text-xs font-medium text-gray-100 text-center p-0.5 leading-none rounded-full" style="width: 100%"> </div></div> <div class="mt-1 text-xs dark:text-gray-500" style="font-size: 0.5rem;"> </div></div>`);
var root_33 = from_html(`<div class="mt-2"><div class=" mb-2 text-xs"> </div> <div class="w-full rounded-full dark:bg-gray-800"><div class="dark:bg-gray-600 bg-gray-500 text-xs font-medium text-gray-100 text-center p-0.5 leading-none rounded-full"> </div></div> <div class="mt-1 text-xs dark:text-gray-500" style="font-size: 0.5rem;"> </div></div>`);
var root_19 = from_html(`<form><div class=" mb-2 flex w-full justify-between"><div class="  text-sm font-medium"> </div> <button class="p-1 px-3 text-xs flex rounded-sm transition" type="button"><!></button></div> <div class="flex w-full mb-1.5"><div class="flex flex-col w-full"><!></div> <!></div> <!> <div class=" mt-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" text-gray-500 dark:text-gray-300 font-medium underline" href="https://huggingface.co/models?search=gguf" target="_blank"> </a></div> <!></form>`);
var root_1$b = from_html(`<div class=" flex flex-col w-full"><div><div class="space-y-2"><div><div class=" mb-2 text-sm font-medium flex items-center gap-1.5"><div> </div> <div><!></div></div> <div class="flex w-full"><div class="flex-1 mr-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div> <!></div> <div class="mt-2 mb-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" text-gray-500 dark:text-gray-300 font-medium underline" href="https://ollama.com/library" target="_blank"> </a></div> <!> <!></div> <div><div class=" mb-2 text-sm font-medium"> </div> <div class="flex w-full"><div class="flex-1 mr-2 pr-1.5 rounded-lg bg-gray-50 dark:text-gray-300 dark:bg-gray-850"><select class="w-full py-2 px-4 text-sm outline-hidden bg-transparent"><!><!></select></div> <!></div></div> <div><div class=" mb-2 text-sm font-medium"> </div> <div class="flex w-full"><div class="flex-1 mr-2 flex flex-col gap-2"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <textarea class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-100 dark:bg-gray-850 outline-hidden resize-none scrollbar-hidden" rows="6"></textarea></div> <div class="flex self-start"><!></div></div> <!></div> <div class="pt-1"><div class="flex justify-between items-center text-xs"><div class=" text-sm font-medium"> </div> <button class=" text-xs font-medium text-gray-500" type="button"> </button></div></div> <!></div></div></div>`);
var root_35 = from_html(`<div class="flex justify-center items-center w-full h-full text-xs py-3"> </div>`);
var root_36$2 = from_html(`<div class="flex justify-center items-center w-full h-full py-3"><!></div>`);
var root$b = from_html(`<!> <!>`, 1);
function ManageOllama($$anchor, $$props) {
  push($$props, false);
  const $MODEL_DOWNLOAD_POOL = () => store_get(MODEL_DOWNLOAD_POOL, "$MODEL_DOWNLOAD_POOL", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $config = () => store_get(config, "$config", $$stores);
  const $settings = () => store_get(settings, "$settings", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let modelUploadInputElement = mutable_source();
  let showModelDeleteConfirm = mutable_source(false);
  let loading = mutable_source(true);
  let urlIdx = prop($$props, "urlIdx", 8, null);
  let ollamaModels = mutable_source([]);
  let updateModelId = mutable_source(null);
  let updateProgress = mutable_source(null);
  let updateModelsControllers = {};
  let updateCancelled = false;
  let showExperimentalOllama = mutable_source(false);
  const MAX_PARALLEL_DOWNLOADS = 3;
  let modelLoading = mutable_source(false);
  let modelTag = mutable_source("");
  let createModelLoading = mutable_source(false);
  let createModelName = mutable_source("");
  let createModelObject = mutable_source("");
  let createModelDigest = mutable_source("");
  let createModelPullProgress = mutable_source(null);
  let digest = "";
  let pullProgress = null;
  let modelUploadMode = mutable_source("file");
  let modelInputFile = mutable_source(null);
  let modelFileUrl = mutable_source("");
  let modelFileContent = mutable_source(`TEMPLATE """{{ .System }}
USER: {{ .Prompt }}
ASSISTANT: """
PARAMETER num_ctx 4096
PARAMETER stop "</s>"
PARAMETER stop "USER:"
PARAMETER stop "ASSISTANT:"`);
  let modelFileDigest = mutable_source("");
  let uploadProgress = mutable_source(null);
  let uploadMessage = mutable_source("");
  let deleteModelTag = mutable_source("");
  const updateModelsHandler = async () => {
    updateCancelled = false;
    toast.info("Checking for model updates...");
    for (const model of get(ollamaModels)) {
      if (updateCancelled) {
        break;
      }
      console.debug(model);
      set(updateModelId, model.id);
      const [res, controller] = await pullModel(localStorage.token, model.id, urlIdx()).catch((error) => {
        if (error.name !== "AbortError") {
          toast.error(`${error}`);
        }
        return [null, null];
      });
      updateModelsControllers = { ...updateModelsControllers, [model.id]: controller };
      if (res) {
        const reader = res.body.pipeThrough(new TextDecoderStream()).pipeThrough(splitStream("\n")).getReader();
        while (true) {
          try {
            const { value: value2, done } = await reader.read();
            if (done) break;
            let lines = value2.split("\n");
            for (const line of lines) {
              if (line !== "") {
                let data = JSON.parse(line);
                console.log(data);
                if (data.error) {
                  throw data.error;
                }
                if (data.detail) {
                  throw data.detail;
                }
                if (data.status) {
                  if (data.digest) {
                    set(updateProgress, 0);
                    if (data.completed) {
                      set(updateProgress, Math.round(data.completed / data.total * 1e3) / 10);
                    } else {
                      set(updateProgress, 100);
                    }
                  }
                }
              }
            }
          } catch (err) {
            if (err.name !== "AbortError") {
              console.error(err);
            }
            break;
          }
        }
      }
      delete updateModelsControllers[model.id];
      updateModelsControllers = { ...updateModelsControllers };
    }
    if (updateCancelled) {
      toast.info("Model update cancelled");
    } else {
      toast.success("All models are up to date");
    }
    set(updateModelId, null);
    set(updateProgress, null);
  };
  const pullModelHandler = async () => {
    var _a, _b, _c, _d;
    const sanitizedModelTag = get(modelTag).trim().replace(/^ollama\s+(run|pull)\s+/, "");
    console.log($MODEL_DOWNLOAD_POOL());
    if ($MODEL_DOWNLOAD_POOL()[sanitizedModelTag]) {
      toast.error($i18n().t(`Model '{{modelTag}}' is already in queue for downloading.`, { modelTag: sanitizedModelTag }));
      return;
    }
    if (Object.keys($MODEL_DOWNLOAD_POOL()).length === MAX_PARALLEL_DOWNLOADS) {
      toast.error($i18n().t("Maximum of 3 models can be downloaded simultaneously. Please try again later."));
      return;
    }
    set(modelLoading, true);
    const [res, controller] = await pullModel(localStorage.token, sanitizedModelTag, urlIdx()).catch((error) => {
      if (error.name !== "AbortError") {
        toast.error(`${error}`);
      }
      return [null, null];
    });
    if (res) {
      const reader = res.body.pipeThrough(new TextDecoderStream()).pipeThrough(splitStream("\n")).getReader();
      MODEL_DOWNLOAD_POOL.set({
        ...$MODEL_DOWNLOAD_POOL(),
        [sanitizedModelTag]: {
          ...$MODEL_DOWNLOAD_POOL()[sanitizedModelTag],
          abortController: controller,
          reader,
          done: false
        }
      });
      while (true) {
        try {
          const { value: value2, done } = await reader.read();
          if (done) break;
          let lines = value2.split("\n");
          for (const line of lines) {
            if (line !== "") {
              let data = JSON.parse(line);
              console.log(data);
              if (data.error) {
                throw data.error;
              }
              if (data.detail) {
                throw data.detail;
              }
              if (data.status) {
                if (data.digest) {
                  let downloadProgress = 0;
                  if (data.completed) {
                    downloadProgress = Math.round(data.completed / data.total * 1e3) / 10;
                  } else {
                    downloadProgress = 100;
                  }
                  MODEL_DOWNLOAD_POOL.set({
                    ...$MODEL_DOWNLOAD_POOL(),
                    [sanitizedModelTag]: {
                      ...$MODEL_DOWNLOAD_POOL()[sanitizedModelTag],
                      pullProgress: downloadProgress,
                      digest: data.digest
                    }
                  });
                } else {
                  MODEL_DOWNLOAD_POOL.set({
                    ...$MODEL_DOWNLOAD_POOL(),
                    [sanitizedModelTag]: {
                      ...$MODEL_DOWNLOAD_POOL()[sanitizedModelTag],
                      done: data.status === "success"
                    }
                  });
                }
              }
            }
          }
        } catch (err) {
          if (err.name !== "AbortError") {
            console.error(err);
            if (typeof err !== "string") {
              err = err.message;
            }
            toast.error(`${err}`);
          } else {
            break;
          }
        }
      }
      console.log($MODEL_DOWNLOAD_POOL()[sanitizedModelTag]);
      if ((_a = $MODEL_DOWNLOAD_POOL()[sanitizedModelTag]) == null ? void 0 : _a.done) {
        toast.success($i18n().t(`Model '{{modelName}}' has been successfully downloaded.`, { modelName: sanitizedModelTag }));
        models.set(await getModels(localStorage.token, ((_c = (_b = $config()) == null ? void 0 : _b.features) == null ? void 0 : _c.enable_direct_connections) && (((_d = $settings()) == null ? void 0 : _d.directConnections) ?? null)));
      } else {
        toast.error($i18n().t("Download canceled"));
      }
      delete $MODEL_DOWNLOAD_POOL()[sanitizedModelTag];
      MODEL_DOWNLOAD_POOL.set({ ...$MODEL_DOWNLOAD_POOL() });
    }
    set(modelTag, "");
    set(modelLoading, false);
  };
  const uploadModelHandler = async () => {
    var _a, _b, _c;
    set(modelLoading, true);
    let uploaded = false;
    let fileResponse = null;
    let name = "";
    if (get(modelUploadMode) === "file") {
      const file = get(modelInputFile) ? get(modelInputFile)[0] : null;
      if (file) {
        set(uploadMessage, "Uploading...");
        fileResponse = await uploadModel(localStorage.token, file, urlIdx()).catch((error) => {
          toast.error(`${error}`);
          return null;
        });
      }
    } else {
      set(uploadProgress, 0);
      fileResponse = await downloadModel(localStorage.token, get(modelFileUrl), urlIdx()).catch((error) => {
        toast.error(`${error}`);
        return null;
      });
    }
    if (fileResponse && fileResponse.ok) {
      const reader = fileResponse.body.pipeThrough(new TextDecoderStream()).pipeThrough(splitStream("\n")).getReader();
      while (true) {
        const { value: value2, done } = await reader.read();
        if (done) break;
        try {
          let lines = value2.split("\n");
          for (const line of lines) {
            if (line !== "") {
              let data = JSON.parse(line.replace(/^data: /, ""));
              if (data.progress) {
                if (get(uploadMessage)) {
                  set(uploadMessage, "");
                }
                set(uploadProgress, data.progress);
              }
              if (data.error) {
                throw data.error;
              }
              if (data.done) {
                set(modelFileDigest, data.blob);
                name = data.name;
                uploaded = true;
              }
            }
          }
        } catch (err) {
          console.error(err);
        }
      }
    } else {
      const error = await (fileResponse == null ? void 0 : fileResponse.json());
      toast.error((error == null ? void 0 : error.detail) ?? error);
    }
    if (uploaded) {
      const res = await createModel(localStorage.token, `${name}:latest`, `FROM @${get(modelFileDigest)}
${get(modelFileContent)}`);
      if (res && res.ok) {
        const reader = res.body.pipeThrough(new TextDecoderStream()).pipeThrough(splitStream("\n")).getReader();
        while (true) {
          const { value: value2, done } = await reader.read();
          if (done) break;
          try {
            let lines = value2.split("\n");
            for (const line of lines) {
              if (line !== "") {
                console.log(line);
                let data = JSON.parse(line);
                console.log(data);
                if (data.error) {
                  throw data.error;
                }
                if (data.detail) {
                  throw data.detail;
                }
                if (data.status) {
                  if (!data.digest && !data.status.includes("writing") && !data.status.includes("sha256")) {
                    toast.success(data.status);
                  } else {
                    if (data.digest) {
                      digest = data.digest;
                      if (data.completed) {
                        pullProgress = Math.round(data.completed / data.total * 1e3) / 10;
                      } else {
                        pullProgress = 100;
                      }
                    }
                  }
                }
              }
            }
          } catch (err) {
            console.error(err);
            toast.error(`${err}`);
          }
        }
      }
    }
    set(modelFileUrl, "");
    if (get(modelUploadInputElement)) {
      mutate(modelUploadInputElement, get(modelUploadInputElement).value = "");
    }
    set(modelInputFile, null);
    set(modelLoading, false);
    set(uploadProgress, null);
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  const deleteModelHandler = async () => {
    var _a, _b, _c;
    const res = await deleteModel(localStorage.token, get(deleteModelTag), urlIdx()).catch((error) => {
      toast.error(`${error}`);
    });
    if (res) {
      toast.success($i18n().t(`Deleted {{deleteModelTag}}`, { deleteModelTag: get(deleteModelTag) }));
    }
    set(deleteModelTag, "");
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  const cancelUpdateModelHandler = async (model) => {
    const controller = updateModelsControllers[model];
    if (controller) {
      controller.abort();
      updateCancelled = true;
    }
  };
  const cancelModelPullHandler = async (model) => {
    const { reader, abortController } = $MODEL_DOWNLOAD_POOL()[model];
    if (abortController) {
      abortController.abort();
    }
    if (reader) {
      await reader.cancel();
      delete $MODEL_DOWNLOAD_POOL()[model];
      MODEL_DOWNLOAD_POOL.set({ ...$MODEL_DOWNLOAD_POOL() });
      await deleteModel(localStorage.token, model);
      toast.success($i18n().t("{{model}} download has been canceled", { model }));
    }
  };
  const createModelHandler = async () => {
    var _a, _b, _c;
    set(createModelLoading, true);
    let modelObject = {};
    try {
      modelObject = JSON.parse(get(createModelObject));
    } catch (error) {
      toast.error(`${error}`);
      set(createModelLoading, false);
      return;
    }
    const res = await createModel(localStorage.token, { model: get(createModelName), ...modelObject }, urlIdx()).catch((error) => {
      toast.error(`${error}`);
      return null;
    });
    if (res && res.ok) {
      const reader = res.body.pipeThrough(new TextDecoderStream()).pipeThrough(splitStream("\n")).getReader();
      while (true) {
        const { value: value2, done } = await reader.read();
        if (done) break;
        try {
          let lines = value2.split("\n");
          for (const line of lines) {
            if (line !== "") {
              console.log(line);
              let data = JSON.parse(line);
              console.log(data);
              if (data.error) {
                throw data.error;
              }
              if (data.detail) {
                throw data.detail;
              }
              if (data.status) {
                if (!data.digest && !data.status.includes("writing") && !data.status.includes("sha256")) {
                  toast.success(data.status);
                } else {
                  if (data.digest) {
                    set(createModelDigest, data.digest);
                    if (data.completed) {
                      set(createModelPullProgress, Math.round(data.completed / data.total * 1e3) / 10);
                    } else {
                      set(createModelPullProgress, 100);
                    }
                  }
                }
              }
            }
          }
        } catch (err) {
          console.error(err);
          toast.error(`${err}`);
        }
      }
    }
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
    set(createModelLoading, false);
    set(createModelName, "");
    set(createModelObject, "");
    set(createModelDigest, "");
    set(createModelPullProgress, null);
  };
  const init$1 = async () => {
    set(loading, true);
    set(ollamaModels, await getOllamaModels(localStorage.token, urlIdx()).catch((error) => {
      toast.error(`${error}`);
      return null;
    }));
    if (get(ollamaModels)) {
      set(loading, false);
    }
  };
  legacy_pre_effect(() => deep_read_state(urlIdx()), () => {
    if (urlIdx() !== null) {
      init$1();
    }
  });
  legacy_pre_effect_reset();
  init();
  var fragment = root$b();
  var node = first_child(fragment);
  ConfirmDialog(node, {
    get show() {
      return get(showModelDeleteConfirm);
    },
    set show($$value) {
      set(showModelDeleteConfirm, $$value);
    },
    $$events: {
      confirm: () => {
        deleteModelHandler();
      }
    },
    $$legacy: true
  });
  var node_1 = sibling(node, 2);
  {
    var consequent_17 = ($$anchor2) => {
      var div = root_1$b();
      var div_1 = child(div);
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var div_4 = child(div_3);
      var div_5 = child(div_4);
      var text$1 = child(div_5, true);
      reset(div_5);
      var div_6 = sibling(div_5, 2);
      var node_2 = child(div_6);
      Tooltip(node_2, {
        content: "Update All Models",
        placement: "top",
        children: ($$anchor3, $$slotProps) => {
          var button = root_2$9();
          event("click", button, () => {
            updateModelsHandler();
          });
          append($$anchor3, button);
        },
        $$slots: { default: true }
      });
      reset(div_6);
      reset(div_4);
      var div_7 = sibling(div_4, 2);
      var div_8 = child(div_7);
      var input = child(div_8);
      remove_input_defaults(input);
      reset(div_8);
      var node_3 = sibling(div_8, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Pull Model"))));
        Tooltip(node_3, {
          get content() {
            return get($0);
          },
          placement: "top",
          children: ($$anchor3, $$slotProps) => {
            var button_1 = root_3$8();
            var node_4 = child(button_1);
            {
              var consequent = ($$anchor4) => {
                var div_9 = root_4$a();
                append($$anchor4, div_9);
              };
              var alternate = ($$anchor4) => {
                var svg = root_5$6();
                append($$anchor4, svg);
              };
              if_block(node_4, ($$render) => {
                if (get(modelLoading)) $$render(consequent);
                else $$render(alternate, false);
              });
            }
            reset(button_1);
            template_effect(($02) => button_1.disabled = $02, [
              () => (get(modelLoading), get(modelTag), untrack(() => get(modelLoading) || get(modelTag).trim() === ""))
            ]);
            event("click", button_1, () => {
              pullModelHandler();
            });
            append($$anchor3, button_1);
          },
          $$slots: { default: true }
        });
      }
      reset(div_7);
      var div_10 = sibling(div_7, 2);
      var text_1 = child(div_10);
      var a = sibling(text_1);
      var text_2 = child(a, true);
      reset(a);
      reset(div_10);
      var node_5 = sibling(div_10, 2);
      {
        var consequent_1 = ($$anchor3) => {
          var div_11 = root_6$4();
          var div_12 = child(div_11);
          var text_3 = child(div_12);
          reset(div_12);
          var node_6 = sibling(div_12, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Cancel"))));
            Tooltip(node_6, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var button_2 = root_7$3();
                event("click", button_2, () => {
                  cancelUpdateModelHandler(get(updateModelId));
                });
                append($$anchor4, button_2);
              },
              $$slots: { default: true }
            });
          }
          reset(div_11);
          template_effect(() => set_text(text_3, `Updating "${get(updateModelId) ?? ""}" ${get(updateProgress) ? `(${get(updateProgress)}%)` : ""}`));
          append($$anchor3, div_11);
        };
        if_block(node_5, ($$render) => {
          if (get(updateModelId)) $$render(consequent_1);
        });
      }
      var node_7 = sibling(node_5, 2);
      {
        var consequent_4 = ($$anchor3) => {
          var fragment_1 = comment();
          var node_8 = first_child(fragment_1);
          each(
            node_8,
            1,
            () => ($MODEL_DOWNLOAD_POOL(), untrack(() => Object.keys($MODEL_DOWNLOAD_POOL()))),
            index,
            ($$anchor4, model) => {
              var fragment_2 = comment();
              var node_9 = first_child(fragment_2);
              {
                var consequent_3 = ($$anchor5) => {
                  var div_13 = root_10$4();
                  var div_14 = child(div_13);
                  var text_4 = child(div_14, true);
                  reset(div_14);
                  var div_15 = sibling(div_14, 2);
                  var div_16 = child(div_15);
                  var div_17 = child(div_16);
                  var div_18 = child(div_17);
                  var text_5 = child(div_18);
                  reset(div_18);
                  reset(div_17);
                  var node_10 = sibling(div_17, 2);
                  {
                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Cancel"))));
                    Tooltip(node_10, {
                      get content() {
                        return get($0);
                      },
                      children: ($$anchor6, $$slotProps) => {
                        var button_3 = root_11$2();
                        event("click", button_3, () => {
                          cancelModelPullHandler(get(model));
                        });
                        append($$anchor6, button_3);
                      },
                      $$slots: { default: true }
                    });
                  }
                  reset(div_16);
                  var node_11 = sibling(div_16, 2);
                  {
                    var consequent_2 = ($$anchor6) => {
                      var div_19 = root_12$3();
                      var text_6 = child(div_19, true);
                      reset(div_19);
                      template_effect(() => set_text(text_6, ($MODEL_DOWNLOAD_POOL(), get(model), untrack(() => $MODEL_DOWNLOAD_POOL()[get(model)].digest))));
                      append($$anchor6, div_19);
                    };
                    if_block(node_11, ($$render) => {
                      if ($MODEL_DOWNLOAD_POOL(), get(model), untrack(() => "digest" in $MODEL_DOWNLOAD_POOL()[get(model)])) $$render(consequent_2);
                    });
                  }
                  reset(div_15);
                  reset(div_13);
                  template_effect(
                    ($0) => {
                      set_text(text_4, get(model));
                      set_style(div_18, `width: ${$0 ?? ""}%`);
                      set_text(text_5, `${($MODEL_DOWNLOAD_POOL(), get(model), untrack(() => $MODEL_DOWNLOAD_POOL()[get(model)].pullProgress ?? 0)) ?? ""}%`);
                    },
                    [
                      () => ($MODEL_DOWNLOAD_POOL(), get(model), untrack(() => Math.max(15, $MODEL_DOWNLOAD_POOL()[get(model)].pullProgress ?? 0)))
                    ]
                  );
                  append($$anchor5, div_13);
                };
                if_block(node_9, ($$render) => {
                  if ($MODEL_DOWNLOAD_POOL(), get(model), untrack(() => "pullProgress" in $MODEL_DOWNLOAD_POOL()[get(model)])) $$render(consequent_3);
                });
              }
              append($$anchor4, fragment_2);
            }
          );
          append($$anchor3, fragment_1);
        };
        if_block(node_7, ($$render) => {
          if ($MODEL_DOWNLOAD_POOL(), untrack(() => Object.keys($MODEL_DOWNLOAD_POOL()).length > 0)) $$render(consequent_4);
        });
      }
      reset(div_3);
      var div_20 = sibling(div_3, 2);
      var div_21 = child(div_20);
      var text_7 = child(div_21, true);
      reset(div_21);
      var div_22 = sibling(div_21, 2);
      var div_23 = child(div_22);
      var select = child(div_23);
      template_effect(() => {
        get(deleteModelTag);
        invalidate_inner_signals(() => {
          $i18n();
          get(ollamaModels);
        });
      });
      var node_12 = child(select);
      {
        var consequent_5 = ($$anchor3) => {
          var option = root_13$2();
          var text_8 = child(option, true);
          reset(option);
          option.value = option.__value = "";
          template_effect(($0) => set_text(text_8, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Select a model")))
          ]);
          append($$anchor3, option);
        };
        if_block(node_12, ($$render) => {
          if (!get(deleteModelTag)) $$render(consequent_5);
        });
      }
      var node_13 = sibling(node_12);
      each(node_13, 1, () => get(ollamaModels), index, ($$anchor3, model) => {
        var option_1 = root_14$2();
        var text_9 = child(option_1, true);
        reset(option_1);
        var option_1_value = {};
        template_effect(
          ($0) => {
            set_text(text_9, $0);
            if (option_1_value !== (option_1_value = (get(model), untrack(() => get(model).id)))) {
              option_1.value = (option_1.__value = (get(model), untrack(() => get(model).id))) ?? "";
            }
          },
          [
            () => (get(model), untrack(() => get(model).name + " (" + (get(model).size / 1024 ** 3).toFixed(1) + " GB)"))
          ]
        );
        append($$anchor3, option_1);
      });
      reset(select);
      reset(div_23);
      var node_14 = sibling(div_23, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Delete Model"))));
        Tooltip(node_14, {
          get content() {
            return get($0);
          },
          placement: "top",
          children: ($$anchor3, $$slotProps) => {
            var button_4 = root_15();
            template_effect(() => button_4.disabled = get(deleteModelTag) === "");
            event("click", button_4, () => {
              set(showModelDeleteConfirm, true);
            });
            append($$anchor3, button_4);
          },
          $$slots: { default: true }
        });
      }
      reset(div_22);
      reset(div_20);
      var div_24 = sibling(div_20, 2);
      var div_25 = child(div_24);
      var text_10 = child(div_25, true);
      reset(div_25);
      var div_26 = sibling(div_25, 2);
      var div_27 = child(div_26);
      var input_1 = child(div_27);
      remove_input_defaults(input_1);
      var textarea = sibling(input_1, 2);
      remove_textarea_child(textarea);
      set_attribute(textarea, "placeholder", `e.g. {"model": "my-modelfile", "from": "ollama:7b"})`);
      reset(div_27);
      var div_28 = sibling(div_27, 2);
      var node_15 = child(div_28);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Create Model"))));
        Tooltip(node_15, {
          get content() {
            return get($0);
          },
          placement: "top",
          children: ($$anchor3, $$slotProps) => {
            var button_5 = root_16$4();
            template_effect(($02) => button_5.disabled = $02, [
              () => (get(createModelLoading), get(createModelName), get(createModelObject), untrack(() => get(createModelLoading) || get(createModelName).trim() === "" || get(createModelObject).trim() === ""))
            ]);
            event("click", button_5, () => {
              createModelHandler();
            });
            append($$anchor3, button_5);
          },
          $$slots: { default: true }
        });
      }
      reset(div_28);
      reset(div_26);
      var node_16 = sibling(div_26, 2);
      {
        var consequent_7 = ($$anchor3) => {
          var div_29 = root_17$1();
          var div_30 = child(div_29);
          div_30.textContent = createModelTag;
          var div_31 = sibling(div_30, 2);
          var div_32 = child(div_31);
          var div_33 = child(div_32);
          var div_34 = child(div_33);
          var text_11 = child(div_34);
          reset(div_34);
          reset(div_33);
          reset(div_32);
          var node_17 = sibling(div_32, 2);
          {
            var consequent_6 = ($$anchor4) => {
              var div_35 = root_18$2();
              var text_12 = child(div_35, true);
              reset(div_35);
              template_effect(() => set_text(text_12, get(createModelDigest)));
              append($$anchor4, div_35);
            };
            if_block(node_17, ($$render) => {
              if (get(createModelDigest)) $$render(consequent_6);
            });
          }
          reset(div_31);
          reset(div_29);
          template_effect(
            ($0) => {
              set_style(div_34, `width: ${$0 ?? ""}%`);
              set_text(text_11, `${get(createModelPullProgress) ?? 0 ?? ""}%`);
            },
            [
              () => (get(createModelPullProgress), untrack(() => Math.max(15, get(createModelPullProgress) ?? 0)))
            ]
          );
          append($$anchor3, div_29);
        };
        if_block(node_16, ($$render) => {
          if (get(createModelDigest) !== "") $$render(consequent_7);
        });
      }
      reset(div_24);
      var div_36 = sibling(div_24, 2);
      var div_37 = child(div_36);
      var div_38 = child(div_37);
      var text_13 = child(div_38, true);
      reset(div_38);
      var button_6 = sibling(div_38, 2);
      var text_14 = child(button_6, true);
      reset(button_6);
      reset(div_37);
      reset(div_36);
      var node_18 = sibling(div_36, 2);
      {
        var consequent_16 = ($$anchor3) => {
          var form = root_19();
          var div_39 = child(form);
          var div_40 = child(div_39);
          var text_15 = child(div_40, true);
          reset(div_40);
          var button_7 = sibling(div_40, 2);
          var node_19 = child(button_7);
          {
            var consequent_8 = ($$anchor4) => {
              var span = root_20$3();
              var text_16 = child(span, true);
              reset(span);
              template_effect(($0) => set_text(text_16, $0), [() => ($i18n(), untrack(() => $i18n().t("File Mode")))]);
              append($$anchor4, span);
            };
            var alternate_1 = ($$anchor4) => {
              var span_1 = root_21();
              var text_17 = child(span_1, true);
              reset(span_1);
              template_effect(($0) => set_text(text_17, $0), [() => ($i18n(), untrack(() => $i18n().t("URL Mode")))]);
              append($$anchor4, span_1);
            };
            if_block(node_19, ($$render) => {
              if (get(modelUploadMode) === "file") $$render(consequent_8);
              else $$render(alternate_1, false);
            });
          }
          reset(button_7);
          reset(div_39);
          var div_41 = sibling(div_39, 2);
          var div_42 = child(div_41);
          var node_20 = child(div_42);
          {
            var consequent_10 = ($$anchor4) => {
              var div_43 = root_22$2();
              var input_2 = child(div_43);
              bind_this(input_2, ($$value) => set(modelUploadInputElement, $$value), () => get(modelUploadInputElement));
              var button_8 = sibling(input_2, 2);
              var node_21 = child(button_8);
              {
                var consequent_9 = ($$anchor5) => {
                  var text_18 = text();
                  template_effect(() => set_text(text_18, (get(modelInputFile), untrack(() => get(modelInputFile)[0].name))));
                  append($$anchor5, text_18);
                };
                var alternate_2 = ($$anchor5) => {
                  var text_19 = text();
                  template_effect(($0) => set_text(text_19, $0), [
                    () => ($i18n(), untrack(() => $i18n().t("Click here to select")))
                  ]);
                  append($$anchor5, text_19);
                };
                if_block(node_21, ($$render) => {
                  if (get(modelInputFile), untrack(() => get(modelInputFile) && get(modelInputFile).length > 0)) $$render(consequent_9);
                  else $$render(alternate_2, false);
                });
              }
              reset(button_8);
              reset(div_43);
              template_effect(() => set_class(div_43, 1, `flex-1 ${(get(modelInputFile), untrack(() => get(modelInputFile) && get(modelInputFile).length > 0 ? "mr-2" : "")) ?? ""}`));
              bind_files(input_2, () => get(modelInputFile), ($$value) => set(modelInputFile, $$value));
              event("change", input_2, () => {
                console.log(get(modelInputFile));
              });
              event("click", button_8, () => {
                get(modelUploadInputElement).click();
              });
              append($$anchor4, div_43);
            };
            var alternate_3 = ($$anchor4) => {
              var div_44 = root_25();
              var input_3 = child(div_44);
              remove_input_defaults(input_3);
              reset(div_44);
              template_effect(
                ($0) => {
                  set_class(div_44, 1, `flex-1 ${get(modelFileUrl) !== "" ? "mr-2" : ""}`);
                  set_class(input_3, 1, `w-full rounded-lg text-left py-2 px-4 bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden ${get(modelFileUrl) !== "" ? "mr-2" : ""}`);
                  set_attribute(input_3, "placeholder", $0);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Type Hugging Face Resolve (Download) URL")))
                ]
              );
              bind_value(input_3, () => get(modelFileUrl), ($$value) => set(modelFileUrl, $$value));
              append($$anchor4, div_44);
            };
            if_block(node_20, ($$render) => {
              if (get(modelUploadMode) === "file") $$render(consequent_10);
              else $$render(alternate_3, false);
            });
          }
          reset(div_42);
          var node_22 = sibling(div_42, 2);
          {
            var consequent_12 = ($$anchor4) => {
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Upload Model"))));
                Tooltip($$anchor4, {
                  get content() {
                    return get($0);
                  },
                  placement: "top",
                  children: ($$anchor5, $$slotProps) => {
                    var button_9 = root_27();
                    var node_23 = child(button_9);
                    {
                      var consequent_11 = ($$anchor6) => {
                        var div_45 = root_28$1();
                        append($$anchor6, div_45);
                      };
                      var alternate_4 = ($$anchor6) => {
                        var svg_1 = root_29();
                        append($$anchor6, svg_1);
                      };
                      if_block(node_23, ($$render) => {
                        if (get(modelLoading)) $$render(consequent_11);
                        else $$render(alternate_4, false);
                      });
                    }
                    reset(button_9);
                    template_effect(() => button_9.disabled = get(modelLoading));
                    append($$anchor5, button_9);
                  },
                  $$slots: { default: true }
                });
              }
            };
            if_block(node_22, ($$render) => {
              if (get(modelUploadMode), get(modelInputFile), get(modelFileUrl), untrack(() => get(modelUploadMode) === "file" && get(modelInputFile) && get(modelInputFile).length > 0 || get(modelUploadMode) === "url" && get(modelFileUrl) !== "")) $$render(consequent_12);
            });
          }
          reset(div_41);
          var node_24 = sibling(div_41, 2);
          {
            var consequent_13 = ($$anchor4) => {
              var div_46 = root_30$2();
              var div_47 = child(div_46);
              var div_48 = child(div_47);
              var text_20 = child(div_48, true);
              reset(div_48);
              var textarea_1 = sibling(div_48, 2);
              remove_textarea_child(textarea_1);
              reset(div_47);
              reset(div_46);
              template_effect(($0) => set_text(text_20, $0), [
                () => ($i18n(), untrack(() => $i18n().t("Modelfile Content")))
              ]);
              bind_value(textarea_1, () => get(modelFileContent), ($$value) => set(modelFileContent, $$value));
              append($$anchor4, div_46);
            };
            if_block(node_24, ($$render) => {
              if (get(modelUploadMode), get(modelInputFile), get(modelFileUrl), untrack(() => get(modelUploadMode) === "file" && get(modelInputFile) && get(modelInputFile).length > 0 || get(modelUploadMode) === "url" && get(modelFileUrl) !== "")) $$render(consequent_13);
            });
          }
          var div_49 = sibling(node_24, 2);
          var text_21 = child(div_49);
          var a_1 = sibling(text_21);
          var text_22 = child(a_1, true);
          reset(a_1);
          reset(div_49);
          var node_25 = sibling(div_49, 2);
          {
            var consequent_14 = ($$anchor4) => {
              var div_50 = root_31$1();
              var div_51 = child(div_50);
              var text_23 = child(div_51, true);
              reset(div_51);
              var div_52 = sibling(div_51, 2);
              var div_53 = child(div_52);
              var text_24 = child(div_53, true);
              reset(div_53);
              reset(div_52);
              var div_54 = sibling(div_52, 2);
              var text_25 = child(div_54, true);
              reset(div_54);
              reset(div_50);
              template_effect(
                ($0) => {
                  set_text(text_23, $0);
                  set_text(text_24, get(uploadMessage));
                  set_text(text_25, get(modelFileDigest));
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Upload Progress")))
                ]
              );
              append($$anchor4, div_50);
            };
            var alternate_5 = ($$anchor4) => {
              var fragment_6 = comment();
              var node_26 = first_child(fragment_6);
              {
                var consequent_15 = ($$anchor5) => {
                  var div_55 = root_33();
                  var div_56 = child(div_55);
                  var text_26 = child(div_56, true);
                  reset(div_56);
                  var div_57 = sibling(div_56, 2);
                  var div_58 = child(div_57);
                  var text_27 = child(div_58);
                  reset(div_58);
                  reset(div_57);
                  var div_59 = sibling(div_57, 2);
                  var text_28 = child(div_59, true);
                  reset(div_59);
                  reset(div_55);
                  template_effect(
                    ($0, $1) => {
                      set_text(text_26, $0);
                      set_style(div_58, `width: ${$1 ?? ""}%`);
                      set_text(text_27, `${get(uploadProgress) ?? 0 ?? ""}%`);
                      set_text(text_28, get(modelFileDigest));
                    },
                    [
                      () => ($i18n(), untrack(() => $i18n().t("Upload Progress"))),
                      () => (get(uploadProgress), untrack(() => Math.max(15, get(uploadProgress) ?? 0)))
                    ]
                  );
                  append($$anchor5, div_55);
                };
                if_block(
                  node_26,
                  ($$render) => {
                    if (get(uploadProgress) !== null) $$render(consequent_15);
                  },
                  true
                );
              }
              append($$anchor4, fragment_6);
            };
            if_block(node_25, ($$render) => {
              if (get(uploadMessage)) $$render(consequent_14);
              else $$render(alternate_5, false);
            });
          }
          reset(form);
          template_effect(
            ($0, $1, $2) => {
              set_text(text_15, $0);
              set_text(text_21, `${$1 ?? ""} `);
              set_text(text_22, $2);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Upload a GGUF model"))),
              () => ($i18n(), untrack(() => $i18n().t("To access the GGUF models available for downloading,"))),
              () => ($i18n(), untrack(() => $i18n().t("click here.")))
            ]
          );
          event("click", button_7, () => {
            if (get(modelUploadMode) === "file") {
              set(modelUploadMode, "url");
            } else {
              set(modelUploadMode, "file");
            }
          });
          event("submit", form, preventDefault(() => {
            uploadModelHandler();
          }));
          append($$anchor3, form);
        };
        if_block(node_18, ($$render) => {
          if (get(showExperimentalOllama)) $$render(consequent_16);
        });
      }
      reset(div_2);
      reset(div_1);
      reset(div);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9) => {
          set_text(text$1, $0);
          set_attribute(input, "placeholder", $1);
          set_text(text_1, `${$2 ?? ""} `);
          set_text(text_2, $3);
          set_text(text_7, $4);
          set_attribute(select, "placeholder", $5);
          set_text(text_10, $6);
          set_attribute(input_1, "placeholder", $7);
          input_1.disabled = get(createModelLoading);
          textarea.disabled = get(createModelLoading);
          set_text(text_13, $8);
          set_text(text_14, $9);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("Pull a model from Ollama.com"))),
          () => ($i18n(), untrack(() => $i18n().t("Enter model tag (e.g. {{modelTag}})", { modelTag: "mistral:7b" }))),
          () => ($i18n(), untrack(() => $i18n().t("To access the available model names for downloading,"))),
          () => ($i18n(), untrack(() => $i18n().t("click here."))),
          () => ($i18n(), untrack(() => $i18n().t("Delete a model"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a model"))),
          () => ($i18n(), untrack(() => $i18n().t("Create a model"))),
          () => ($i18n(), untrack(() => $i18n().t("Enter model tag (e.g. {{modelTag}})", { modelTag: "my-modelfile" }))),
          () => ($i18n(), untrack(() => $i18n().t("Experimental"))),
          () => (get(showExperimentalOllama), $i18n(), untrack(() => get(showExperimentalOllama) ? $i18n().t("Hide") : $i18n().t("Show")))
        ]
      );
      bind_value(input, () => get(modelTag), ($$value) => set(modelTag, $$value));
      bind_select_value(select, () => get(deleteModelTag), ($$value) => set(deleteModelTag, $$value));
      bind_value(input_1, () => get(createModelName), ($$value) => set(createModelName, $$value));
      bind_value(textarea, () => get(createModelObject), ($$value) => set(createModelObject, $$value));
      event("click", button_6, () => {
        set(showExperimentalOllama, !get(showExperimentalOllama));
      });
      append($$anchor2, div);
    };
    var alternate_7 = ($$anchor2) => {
      var fragment_7 = comment();
      var node_27 = first_child(fragment_7);
      {
        var consequent_18 = ($$anchor3) => {
          var div_60 = root_35();
          var text_29 = child(div_60, true);
          reset(div_60);
          template_effect(($0) => set_text(text_29, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Failed to fetch models")))
          ]);
          append($$anchor3, div_60);
        };
        var alternate_6 = ($$anchor3) => {
          var div_61 = root_36$2();
          var node_28 = child(div_61);
          Spinner(node_28, { className: "size-5" });
          reset(div_61);
          append($$anchor3, div_61);
        };
        if_block(
          node_27,
          ($$render) => {
            if (get(ollamaModels) === null) $$render(consequent_18);
            else $$render(alternate_6, false);
          },
          true
        );
      }
      append($$anchor2, fragment_7);
    };
    if_block(node_1, ($$render) => {
      if (!get(loading)) $$render(consequent_17);
      else $$render(alternate_7, false);
    });
  }
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_2$8 = from_html(`<option> </option>`);
var root_1$a = from_html(`<div class="flex-1 mb-2.5 pr-1.5 rounded-lg bg-gray-50 dark:text-gray-300 dark:bg-gray-850"><select class="w-full py-2 px-4 text-sm outline-hidden bg-transparent"></select></div> <!>`, 1);
function ManageMultipleOllama($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let ollamaConfig = prop($$props, "ollamaConfig", 8, null);
  let selectedUrlIdx = mutable_source(0);
  init();
  var fragment = comment();
  var node = first_child(fragment);
  {
    var consequent = ($$anchor2) => {
      var fragment_1 = root_1$a();
      var div = first_child(fragment_1);
      var select = child(div);
      template_effect(() => {
        get(selectedUrlIdx);
        invalidate_inner_signals(() => {
          $i18n();
          ollamaConfig();
        });
      });
      each(
        select,
        5,
        () => (deep_read_state(ollamaConfig()), untrack(() => ollamaConfig().OLLAMA_BASE_URLS)),
        index,
        ($$anchor3, url2, idx) => {
          var option = root_2$8();
          var text2 = child(option, true);
          reset(option);
          option.value = option.__value = idx;
          template_effect(() => set_text(text2, get(url2)));
          append($$anchor3, option);
        }
      );
      reset(select);
      reset(div);
      var node_1 = sibling(div, 2);
      ManageOllama(node_1, {
        get urlIdx() {
          return get(selectedUrlIdx);
        }
      });
      template_effect(($0) => set_attribute(select, "placeholder", $0), [
        () => ($i18n(), untrack(() => $i18n().t("Select an Ollama instance")))
      ]);
      bind_select_value(select, () => get(selectedUrlIdx), ($$value) => set(selectedUrlIdx, $$value));
      append($$anchor2, fragment_1);
    };
    if_block(node, ($$render) => {
      if (ollamaConfig()) $$render(consequent);
    });
  }
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_2$7 = from_html(`<div class=" py-5 text-gray-400 text-xs"><div> </div></div>`);
var root_4$9 = from_html(`<div class=" flex w-full flex-col"><div class="flex gap-1 scrollbar-none overflow-x-auto w-fit text-center text-sm font-medium rounded-full bg-transparent dark:text-gray-200"><button> </button></div> <div class=" px-1.5 py-1"><!></div></div>`);
var root_6$3 = from_html(`<div class=" py-5"><!></div>`);
var root_1$9 = from_html(`<div><div class=" flex justify-between dark:text-gray-100 px-5 pt-4"><div class=" text-lg font-medium self-center font-primary"> </div> <button class="self-center"><!></button></div> <div class="flex flex-col md:flex-row w-full px-3 pb-4 md:space-x-4 dark:text-gray-200"><div class=" flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"><!></div></div></div>`);
function ManageModelsModal($$anchor, $$props) {
  push($$props, false);
  const $user = () => store_get(user, "$user", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  createEventDispatcher();
  let show = prop($$props, "show", 12, false);
  let selected = mutable_source(null);
  let ollamaConfig = mutable_source(null);
  onMount(async () => {
    var _a;
    if (((_a = $user()) == null ? void 0 : _a.role) === "admin") {
      await Promise.all([
        (async () => {
          set(ollamaConfig, await getOllamaConfig(localStorage.token));
        })()
      ]);
      if (get(ollamaConfig)) {
        set(selected, "ollama");
        return;
      }
      set(selected, "");
    }
  });
  init();
  Modal($$anchor, {
    size: "sm",
    get show() {
      return show();
    },
    set show($$value) {
      show($$value);
    },
    children: ($$anchor2, $$slotProps) => {
      var div = root_1$9();
      var div_1 = child(div);
      var div_2 = child(div_1);
      var text2 = child(div_2, true);
      reset(div_2);
      var button = sibling(div_2, 2);
      var node = child(button);
      XMark(node, { className: "size-5" });
      reset(button);
      reset(div_1);
      var div_3 = sibling(div_1, 2);
      var div_4 = child(div_3);
      var node_1 = child(div_4);
      {
        var consequent = ($$anchor3) => {
          var div_5 = root_2$7();
          var div_6 = child(div_5);
          var text_1 = child(div_6, true);
          reset(div_6);
          reset(div_5);
          template_effect(($0) => set_text(text_1, $0), [
            () => ($i18n(), untrack(() => $i18n().t("No inference engine with management support found")))
          ]);
          append($$anchor3, div_5);
        };
        var alternate_1 = ($$anchor3) => {
          var fragment_1 = comment();
          var node_2 = first_child(fragment_1);
          {
            var consequent_2 = ($$anchor4) => {
              var div_7 = root_4$9();
              var div_8 = child(div_7);
              var button_1 = child(div_8);
              var text_2 = child(button_1, true);
              reset(button_1);
              reset(div_8);
              var div_9 = sibling(div_8, 2);
              var node_3 = child(div_9);
              {
                var consequent_1 = ($$anchor5) => {
                  ManageMultipleOllama($$anchor5, {
                    get ollamaConfig() {
                      return get(ollamaConfig);
                    }
                  });
                };
                if_block(node_3, ($$render) => {
                  if (get(selected) === "ollama") $$render(consequent_1);
                });
              }
              reset(div_9);
              reset(div_7);
              template_effect(
                ($0) => {
                  set_class(button_1, 1, `min-w-fit p-1.5 ${get(selected) === "ollama" ? "" : "text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"} transition`);
                  set_text(text_2, $0);
                },
                [() => ($i18n(), untrack(() => $i18n().t("Ollama")))]
              );
              event("click", button_1, () => {
                set(selected, "ollama");
              });
              append($$anchor4, div_7);
            };
            var alternate = ($$anchor4) => {
              var div_10 = root_6$3();
              var node_4 = child(div_10);
              Spinner(node_4, {});
              reset(div_10);
              append($$anchor4, div_10);
            };
            if_block(
              node_2,
              ($$render) => {
                if (get(selected) !== null) $$render(consequent_2);
                else $$render(alternate, false);
              },
              true
            );
          }
          append($$anchor3, fragment_1);
        };
        if_block(node_1, ($$render) => {
          if (get(selected) === "") $$render(consequent);
          else $$render(alternate_1, false);
        });
      }
      reset(div_4);
      reset(div_3);
      reset(div);
      template_effect(($0) => set_text(text2, $0), [() => ($i18n(), untrack(() => $i18n().t("Manage Models")))]);
      event("click", button, () => {
        show(false);
      });
      append($$anchor2, div);
    },
    $$slots: { default: true },
    $$legacy: true
  });
  pop();
  $$cleanup();
}
var root_6$2 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"></path></svg>`);
var root_7$2 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`);
var root_5$5 = from_html(`<!> <div class="flex items-center"><!></div>`, 1);
var root_10$3 = from_html(`<!> <div class="flex items-center"> </div>`, 1);
var root_11$1 = from_html(`<!> <div class="flex items-center"> </div>`, 1);
var root_12$2 = from_html(`<!> <div class="flex items-center"> </div>`, 1);
var root_4$8 = from_html(`<!> <!> <!> <!>`, 1);
var root_3$7 = from_html(`<div slot="content"><!></div>`);
function ModelMenu($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  prop($$props, "user", 8);
  let model = prop($$props, "model", 8);
  let exportHandler = prop($$props, "exportHandler", 8);
  let hideHandler = prop($$props, "hideHandler", 8);
  let copyLinkHandler = prop($$props, "copyLinkHandler", 8);
  let cloneHandler = prop($$props, "cloneHandler", 8);
  let onClose = prop($$props, "onClose", 8);
  let show = mutable_source(false);
  init();
  Dropdown($$anchor, {
    get show() {
      return get(show);
    },
    set show($$value) {
      set(show, $$value);
    },
    $$events: {
      change: (e) => {
        if (e.detail === false) {
          onClose()();
        }
      }
    },
    children: ($$anchor2, $$slotProps) => {
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("More"))));
        Tooltip($$anchor2, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps2) => {
            var fragment_2 = comment();
            var node = first_child(fragment_2);
            slot(node, $$props, "default", {}, null);
            append($$anchor3, fragment_2);
          },
          $$slots: { default: true }
        });
      }
    },
    $$slots: {
      default: true,
      content: ($$anchor2, $$slotProps) => {
        var div = root_3$7();
        var node_1 = child(div);
        Menu_content(node_1, {
          class: "w-full max-w-[170px] rounded-xl p-1 border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-sm",
          sideOffset: -2,
          side: "bottom",
          align: "start",
          get transition() {
            return flyAndScale;
          },
          children: ($$anchor3, $$slotProps2) => {
            var fragment_3 = root_4$8();
            var node_2 = first_child(fragment_3);
            Menu_item(node_2, {
              class: "flex  gap-2  items-center px-3 py-1.5 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",
              $$events: {
                click: () => {
                  hideHandler()();
                }
              },
              children: ($$anchor4, $$slotProps3) => {
                var fragment_4 = root_5$5();
                var node_3 = first_child(fragment_4);
                {
                  var consequent = ($$anchor5) => {
                    var svg = root_6$2();
                    append($$anchor5, svg);
                  };
                  var alternate = ($$anchor5) => {
                    var svg_1 = root_7$2();
                    append($$anchor5, svg_1);
                  };
                  if_block(node_3, ($$render) => {
                    if (deep_read_state(model()), untrack(() => {
                      var _a, _b;
                      return ((_b = (_a = model()) == null ? void 0 : _a.meta) == null ? void 0 : _b.hidden) ?? false;
                    })) $$render(consequent);
                    else $$render(alternate, false);
                  });
                }
                var div_1 = sibling(node_3, 2);
                var node_4 = child(div_1);
                {
                  var consequent_1 = ($$anchor5) => {
                    var text$1 = text();
                    template_effect(($0) => set_text(text$1, $0), [() => ($i18n(), untrack(() => $i18n().t("Show Model")))]);
                    append($$anchor5, text$1);
                  };
                  var alternate_1 = ($$anchor5) => {
                    var text_1 = text();
                    template_effect(($0) => set_text(text_1, $0), [() => ($i18n(), untrack(() => $i18n().t("Hide Model")))]);
                    append($$anchor5, text_1);
                  };
                  if_block(node_4, ($$render) => {
                    if (deep_read_state(model()), untrack(() => {
                      var _a, _b;
                      return ((_b = (_a = model()) == null ? void 0 : _a.meta) == null ? void 0 : _b.hidden) ?? false;
                    })) $$render(consequent_1);
                    else $$render(alternate_1, false);
                  });
                }
                reset(div_1);
                append($$anchor4, fragment_4);
              },
              $$slots: { default: true }
            });
            var node_5 = sibling(node_2, 2);
            Menu_item(node_5, {
              class: "flex gap-2 items-center px-3 py-1.5 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",
              $$events: {
                click: () => {
                  copyLinkHandler()();
                }
              },
              children: ($$anchor4, $$slotProps3) => {
                var fragment_7 = root_10$3();
                var node_6 = first_child(fragment_7);
                Link(node_6, {});
                var div_2 = sibling(node_6, 2);
                var text_2 = child(div_2, true);
                reset(div_2);
                template_effect(($0) => set_text(text_2, $0), [() => ($i18n(), untrack(() => $i18n().t("Copy Link")))]);
                append($$anchor4, fragment_7);
              },
              $$slots: { default: true }
            });
            var node_7 = sibling(node_5, 2);
            Menu_item(node_7, {
              class: "flex gap-2 items-center px-3 py-1.5 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",
              $$events: {
                click: () => {
                  cloneHandler()();
                }
              },
              children: ($$anchor4, $$slotProps3) => {
                var fragment_8 = root_11$1();
                var node_8 = first_child(fragment_8);
                DocumentDuplicate(node_8, {});
                var div_3 = sibling(node_8, 2);
                var text_3 = child(div_3, true);
                reset(div_3);
                template_effect(($0) => set_text(text_3, $0), [() => ($i18n(), untrack(() => $i18n().t("Clone")))]);
                append($$anchor4, fragment_8);
              },
              $$slots: { default: true }
            });
            var node_9 = sibling(node_7, 2);
            Menu_item(node_9, {
              class: "flex gap-2 items-center px-3 py-1.5 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",
              $$events: {
                click: () => {
                  exportHandler()();
                }
              },
              children: ($$anchor4, $$slotProps3) => {
                var fragment_9 = root_12$2();
                var node_10 = first_child(fragment_9);
                Download(node_10, {});
                var div_4 = sibling(node_10, 2);
                var text_4 = child(div_4, true);
                reset(div_4);
                template_effect(($0) => set_text(text_4, $0), [() => ($i18n(), untrack(() => $i18n().t("Export")))]);
                append($$anchor4, fragment_9);
              },
              $$slots: { default: true }
            });
            append($$anchor3, fragment_3);
          },
          $$slots: { default: true }
        });
        reset(div);
        append($$anchor2, div);
      }
    },
    $$legacy: true
  });
  pop();
  $$cleanup();
}
var root_3$6 = from_html(`<button class=" p-1 rounded-full flex gap-1 items-center" type="button"><!></button>`);
var root_4$7 = from_html(`<button class=" p-1 rounded-full flex gap-1 items-center" type="button"><!></button>`);
var root_5$4 = from_html(`<div class="self-center pl-1.5 translate-y-[0.5px] rounded-l-xl bg-transparent"><button class="p-0.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-900 transition"><!></button></div>`);
var root_8$4 = from_html(`<div class="  font-semibold line-clamp-1"> </div>`);
var root_10$2 = from_html(`<button class="self-center w-fit text-sm px-2 py-2 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-xl" type="button"><!></button>`);
var root_14$1 = from_html(`<button class="self-center w-fit text-sm p-1.5 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-xl" type="button"><!></button>`);
var root_13$1 = from_html(`<button class="self-center w-fit text-sm px-2 py-2 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-xl" type="button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"></path></svg></button> <!> <div class="ml-1"><!></div>`, 1);
var root_7$1 = from_html(`<div><button class=" flex flex-1 text-left space-x-3.5 cursor-pointer w-full" type="button"><div class=" self-center w-8"><div><img alt="modelfile profile" class=" rounded-full w-full h-auto object-cover"/></div></div> <div><!> <div class=" text-xs overflow-hidden text-ellipsis line-clamp-1 text-gray-500"><span class=" line-clamp-1"> </span></div></div></button> <div class="flex flex-row gap-0.5 items-center self-center"><!></div></div>`);
var root_16$3 = from_html(`<div class="flex flex-col items-center justify-center w-full h-20"><div class="text-gray-500 dark:text-gray-400 text-xs"> </div></div>`);
var root_17 = from_html(`<div class=" flex justify-end w-full mb-3"><div class="flex space-x-1"><input id="models-import-input" type="file" accept=".json" hidden=""/> <button class="flex text-xs items-center space-x-1 px-3 py-1.5 rounded-xl bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-200 transition"><!> <div class=" self-center mr-2 font-medium line-clamp-1"> </div> <div class=" self-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path fill-rule="evenodd" d="M4 2a1.5 1.5 0 0 0-1.5 1.5v9A1.5 1.5 0 0 0 4 14h8a1.5 1.5 0 0 0 1.5-1.5V6.621a1.5 1.5 0 0 0-.44-1.06L9.94 2.439A1.5 1.5 0 0 0 8.878 2H4Zm4 9.5a.75.75 0 0 1-.75-.75V8.06l-.72.72a.75.75 0 0 1-1.06-1.06l2-2a.75.75 0 0 1 1.06 0l2 2a.75.75 0 1 1-1.06 1.06l-.72-.72v2.69a.75.75 0 0 1-.75.75Z" clip-rule="evenodd"></path></svg></div></button> <button class="flex text-xs items-center space-x-1 px-3 py-1.5 rounded-xl bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-200 transition"><div class=" self-center mr-2 font-medium line-clamp-1"> </div> <div class=" self-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path fill-rule="evenodd" d="M4 2a1.5 1.5 0 0 0-1.5 1.5v9A1.5 1.5 0 0 0 4 14h8a1.5 1.5 0 0 0 1.5-1.5V6.621a1.5 1.5 0 0 0-.44-1.06L9.94 2.439A1.5 1.5 0 0 0 8.878 2H4Zm4 3.5a.75.75 0 0 1 .75.75v2.69l.72-.72a.75.75 0 1 1 1.06 1.06l-2 2a.75.75 0 0 1-1.06 0l-2-2a.75.75 0 0 1 1.06-1.06l.72.72V6.25A.75.75 0 0 1 8 5.5Z" clip-rule="evenodd"></path></svg></div></button></div></div>`);
var root_2$6 = from_html(`<div class="flex flex-col gap-1 mt-1.5 mb-2"><div class="flex justify-between items-center"><div class="flex items-center md:self-center text-xl font-medium px-0.5 gap-2"> <span class="text-lg font-medium text-gray-500 dark:text-gray-300"> </span></div> <div class="flex items-center gap-1.5"><!> <!></div></div> <div class=" flex flex-1 items-center w-full space-x-2"><div class="flex flex-1 items-center"><div class=" self-center ml-1 mr-3"><!></div> <input class=" w-full text-sm py-1 rounded-r-xl outline-hidden bg-transparent"/> <!></div></div></div> <div class=" my-2 mb-5" id="model-list"><!></div> <!>`, 1);
var root_20$2 = from_html(`<div class=" h-full w-full flex justify-center items-center"><!></div>`);
var root$a = from_html(`<!> <!> <!>`, 1);
function Models($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $config = () => store_get(config, "$config", $$stores);
  const $settings = () => store_get(settings, "$settings", $$stores);
  const $page = () => store_get(page, "$page", $$stores);
  const $user = () => store_get(user, "$user", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const { saveAs } = fileSaver;
  const i18n = getContext("i18n");
  let shiftKey = mutable_source(false);
  let modelsImportInProgress = mutable_source(false);
  let importFiles = mutable_source();
  let modelsImportInputElement = mutable_source();
  let models$1 = mutable_source(null);
  let workspaceModels = null;
  let baseModels = null;
  let filteredModels = mutable_source([]);
  let selectedModelId = mutable_source(null);
  let showConfigModal = mutable_source(false);
  let showManageModal = mutable_source(false);
  let searchValue = mutable_source("");
  const downloadModels = async (models2) => {
    let blob = new Blob([JSON.stringify(models2)], { type: "application/json" });
    saveAs(blob, `models-export-${Date.now()}.json`);
  };
  const init$1 = async () => {
    set(models$1, null);
    workspaceModels = await getBaseModels(localStorage.token);
    baseModels = await getModels(localStorage.token, null, true);
    set(models$1, baseModels.map((m) => {
      const workspaceModel = workspaceModels.find((wm) => wm.id === m.id);
      if (workspaceModel) {
        return { ...m, ...workspaceModel };
      } else {
        return { ...m, id: m.id, name: m.name, is_active: true };
      }
    }));
  };
  const upsertModelHandler = async (model) => {
    var _a, _b, _c;
    model.base_model_id = null;
    if (workspaceModels.find((m) => m.id === model.id)) {
      const res = await updateModelById(localStorage.token, model.id, model).catch((error) => {
        return null;
      });
      if (res) {
        toast.success($i18n().t("Model updated successfully"));
      }
    } else {
      const res = await createNewModel(localStorage.token, {
        meta: {},
        id: model.id,
        name: model.name,
        base_model_id: null,
        params: {},
        access_control: {},
        ...model
      }).catch((error) => {
        return null;
      });
      if (res) {
        toast.success($i18n().t("Model updated successfully"));
      }
    }
    await init$1();
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  const toggleModelHandler = async (model) => {
    var _a, _b, _c;
    if (!Object.keys(model).includes("base_model_id")) {
      await createNewModel(localStorage.token, {
        id: model.id,
        name: model.name,
        base_model_id: null,
        meta: {},
        params: {},
        access_control: {},
        is_active: model.is_active
      }).catch((error) => {
        return null;
      });
    } else {
      await toggleModelById(localStorage.token, model.id);
    }
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  const hideModelHandler = async (model) => {
    var _a;
    model.meta = { ...model.meta, hidden: !(((_a = model == null ? void 0 : model.meta) == null ? void 0 : _a.hidden) ?? false) };
    console.debug(model);
    toast.success(model.meta.hidden ? $i18n().t(`Model {{name}} is now hidden`, { name: model.id }) : $i18n().t(`Model {{name}} is now visible`, { name: model.id }));
    upsertModelHandler(model);
  };
  const copyLinkHandler = async (model) => {
    const baseUrl = window.location.origin;
    const res = await copyToClipboard(`${baseUrl}/?model=${encodeURIComponent(model.id)}`);
    if (res) {
      toast.success($i18n().t("Copied link to clipboard"));
    } else {
      toast.error($i18n().t("Failed to copy link"));
    }
  };
  const cloneHandler = async (model) => {
    sessionStorage.model = JSON.stringify({
      ...model,
      base_model_id: model.id,
      id: `${model.id}-clone`,
      name: `${model.name} (Clone)`
    });
    goto("/workspace/models/create");
  };
  const exportModelHandler = async (model) => {
    let blob = new Blob([JSON.stringify([model])], { type: "application/json" });
    saveAs(blob, `${model.id}-${Date.now()}.json`);
  };
  onMount(async () => {
    await init$1();
    const id = $page().url.searchParams.get("id");
    if (id) {
      set(selectedModelId, id);
    }
    const onKeyDown = (event2) => {
      if (event2.key === "Shift") {
        set(shiftKey, true);
      }
    };
    const onKeyUp = (event2) => {
      if (event2.key === "Shift") {
        set(shiftKey, false);
      }
    };
    const onBlur = () => {
      set(shiftKey, false);
    };
    window.addEventListener("keydown", onKeyDown);
    window.addEventListener("keyup", onKeyUp);
    window.addEventListener("blur-sm", onBlur);
    return () => {
      window.removeEventListener("keydown", onKeyDown);
      window.removeEventListener("keyup", onKeyUp);
      window.removeEventListener("blur-sm", onBlur);
    };
  });
  legacy_pre_effect(() => (get(models$1), get(searchValue)), () => {
    if (get(models$1)) {
      set(filteredModels, get(models$1).filter((m) => get(searchValue) === "" || m.name.toLowerCase().includes(get(searchValue).toLowerCase())).sort((a, b) => {
        return ((a == null ? void 0 : a.name) ?? (a == null ? void 0 : a.id) ?? "").localeCompare((b == null ? void 0 : b.name) ?? (b == null ? void 0 : b.id) ?? "");
      }));
    }
  });
  legacy_pre_effect_reset();
  init();
  var fragment = root$a();
  var node = first_child(fragment);
  ConfigureModelsModal(node, {
    initHandler: (
      // await init();
      init$1
    ),
    get show() {
      return get(showConfigModal);
    },
    set show($$value) {
      set(showConfigModal, $$value);
    },
    $$legacy: true
  });
  var node_1 = sibling(node, 2);
  ManageModelsModal(node_1, {
    get show() {
      return get(showManageModal);
    },
    set show($$value) {
      set(showManageModal, $$value);
    },
    $$legacy: true
  });
  var node_2 = sibling(node_1, 2);
  {
    var consequent_7 = ($$anchor2) => {
      var fragment_1 = comment();
      var node_3 = first_child(fragment_1);
      {
        var consequent_6 = ($$anchor3) => {
          var fragment_2 = root_2$6();
          var div = first_child(fragment_2);
          var div_1 = child(div);
          var div_2 = child(div_1);
          var text2 = child(div_2);
          var span = sibling(text2);
          var text_1 = child(span, true);
          reset(span);
          reset(div_2);
          var div_3 = sibling(div_2, 2);
          var node_4 = child(div_3);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Manage Models"))));
            Tooltip(node_4, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var button = root_3$6();
                var node_5 = child(button);
                Download(node_5, {});
                reset(button);
                event("click", button, () => {
                  set(showManageModal, true);
                });
                append($$anchor4, button);
              },
              $$slots: { default: true }
            });
          }
          var node_6 = sibling(node_4, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Settings"))));
            Tooltip(node_6, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var button_1 = root_4$7();
                var node_7 = child(button_1);
                Cog6(node_7, {});
                reset(button_1);
                event("click", button_1, () => {
                  set(showConfigModal, true);
                });
                append($$anchor4, button_1);
              },
              $$slots: { default: true }
            });
          }
          reset(div_3);
          reset(div_1);
          var div_4 = sibling(div_1, 2);
          var div_5 = child(div_4);
          var div_6 = child(div_5);
          var node_8 = child(div_6);
          Search(node_8, { className: "size-3.5" });
          reset(div_6);
          var input = sibling(div_6, 2);
          remove_input_defaults(input);
          var node_9 = sibling(input, 2);
          {
            var consequent = ($$anchor4) => {
              var div_7 = root_5$4();
              var button_2 = child(div_7);
              var node_10 = child(button_2);
              XMark(node_10, { className: "size-3", strokeWidth: "2" });
              reset(button_2);
              reset(div_7);
              event("click", button_2, () => {
                set(searchValue, "");
              });
              append($$anchor4, div_7);
            };
            if_block(node_9, ($$render) => {
              if (get(searchValue)) $$render(consequent);
            });
          }
          reset(div_5);
          reset(div_4);
          reset(div);
          var div_8 = sibling(div, 2);
          var node_11 = child(div_8);
          {
            var consequent_3 = ($$anchor4) => {
              var fragment_3 = comment();
              var node_12 = first_child(fragment_3);
              each(node_12, 3, () => get(filteredModels), (model, modelIdx) => `${model.id}-${modelIdx}`, ($$anchor5, model, modelIdx) => {
                var div_9 = root_7$1();
                var button_3 = child(div_9);
                var div_10 = child(button_3);
                var div_11 = child(div_10);
                var img = child(div_11);
                reset(div_11);
                reset(div_10);
                var div_12 = sibling(div_10, 2);
                var node_13 = child(div_12);
                {
                  let $0 = derived_safe_equal(() => (deep_read_state(marked), get(model), untrack(() => {
                    var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j;
                    return marked.parse(!!((_b = (_a = get(model)) == null ? void 0 : _a.meta) == null ? void 0 : _b.description) ? (_d = (_c = get(model)) == null ? void 0 : _c.meta) == null ? void 0 : _d.description : ((_f = (_e = get(model)) == null ? void 0 : _e.ollama) == null ? void 0 : _f.digest) ? `${(_h = (_g = get(model)) == null ? void 0 : _g.ollama) == null ? void 0 : _h.digest} **(${(_j = (_i = get(model)) == null ? void 0 : _i.ollama) == null ? void 0 : _j.modified_at})**` : get(model).id);
                  })));
                  Tooltip(node_13, {
                    get content() {
                      return get($0);
                    },
                    className: " w-fit",
                    placement: "top-start",
                    children: ($$anchor6, $$slotProps) => {
                      var div_13 = root_8$4();
                      var text_2 = child(div_13, true);
                      reset(div_13);
                      template_effect(() => set_text(text_2, (get(model), untrack(() => get(model).name))));
                      append($$anchor6, div_13);
                    },
                    $$slots: { default: true }
                  });
                }
                var div_14 = sibling(node_13, 2);
                var span_1 = child(div_14);
                var text_3 = child(span_1, true);
                reset(span_1);
                reset(div_14);
                reset(div_12);
                reset(button_3);
                var div_15 = sibling(button_3, 2);
                var node_14 = child(div_15);
                {
                  var consequent_2 = ($$anchor6) => {
                    {
                      let $0 = derived_safe_equal(() => (get(model), $i18n(), untrack(() => {
                        var _a, _b;
                        return ((_b = (_a = get(model)) == null ? void 0 : _a.meta) == null ? void 0 : _b.hidden) ? $i18n().t("Show") : $i18n().t("Hide");
                      })));
                      Tooltip($$anchor6, {
                        get content() {
                          return get($0);
                        },
                        children: ($$anchor7, $$slotProps) => {
                          var button_4 = root_10$2();
                          var node_15 = child(button_4);
                          {
                            var consequent_1 = ($$anchor8) => {
                              EyeSlash($$anchor8, {});
                            };
                            var alternate = ($$anchor8) => {
                              Eye($$anchor8, {});
                            };
                            if_block(node_15, ($$render) => {
                              if (get(model), untrack(() => {
                                var _a, _b;
                                return (_b = (_a = get(model)) == null ? void 0 : _a.meta) == null ? void 0 : _b.hidden;
                              })) $$render(consequent_1);
                              else $$render(alternate, false);
                            });
                          }
                          reset(button_4);
                          event("click", button_4, () => {
                            hideModelHandler(get(model));
                          });
                          append($$anchor7, button_4);
                        },
                        $$slots: { default: true }
                      });
                    }
                  };
                  var alternate_1 = ($$anchor6) => {
                    var fragment_7 = root_13$1();
                    var button_5 = first_child(fragment_7);
                    var node_16 = sibling(button_5, 2);
                    ModelMenu(node_16, {
                      get user() {
                        return $user();
                      },
                      get model() {
                        return get(model);
                      },
                      exportHandler: () => {
                        exportModelHandler(get(model));
                      },
                      hideHandler: () => {
                        hideModelHandler(get(model));
                      },
                      copyLinkHandler: () => {
                        copyLinkHandler(get(model));
                      },
                      cloneHandler: () => {
                        cloneHandler(get(model));
                      },
                      onClose: () => {
                      },
                      children: ($$anchor7, $$slotProps) => {
                        var button_6 = root_14$1();
                        var node_17 = child(button_6);
                        EllipsisHorizontal(node_17, { className: "size-5" });
                        reset(button_6);
                        append($$anchor7, button_6);
                      },
                      $$slots: { default: true }
                    });
                    var div_16 = sibling(node_16, 2);
                    var node_18 = child(div_16);
                    {
                      let $0 = derived_safe_equal(() => (get(model), $i18n(), untrack(() => {
                        var _a;
                        return ((_a = get(model)) == null ? void 0 : _a.is_active) ?? true ? $i18n().t("Enabled") : $i18n().t("Disabled");
                      })));
                      Tooltip(node_18, {
                        get content() {
                          return get($0);
                        },
                        children: ($$anchor7, $$slotProps) => {
                          Switch_1($$anchor7, {
                            get state() {
                              return get(model).is_active;
                            },
                            set state($$value) {
                              get(model).is_active = $$value, invalidate_inner_signals(() => get(filteredModels));
                            },
                            $$events: {
                              change: async () => {
                                toggleModelHandler(get(model));
                              }
                            },
                            $$legacy: true
                          });
                        },
                        $$slots: { default: true }
                      });
                    }
                    reset(div_16);
                    event("click", button_5, () => {
                      set(selectedModelId, get(model).id);
                    });
                    append($$anchor6, fragment_7);
                  };
                  if_block(node_14, ($$render) => {
                    if (get(shiftKey)) $$render(consequent_2);
                    else $$render(alternate_1, false);
                  });
                }
                reset(div_15);
                reset(div_9);
                template_effect(() => {
                  set_class(div_9, 1, ` flex space-x-4 cursor-pointer w-full px-3 py-2 dark:hover:bg-white/5 hover:bg-black/5 rounded-lg transition ${(get(model), untrack(() => {
                    var _a, _b;
                    return ((_b = (_a = get(model)) == null ? void 0 : _a.meta) == null ? void 0 : _b.hidden) ? "opacity-50 dark:opacity-50" : "";
                  })) ?? ""}`);
                  set_attribute(div_9, "id", `model-item-${(get(model), untrack(() => get(model).id)) ?? ""}`);
                  set_class(div_11, 1, ` rounded-full object-cover ${(get(model), untrack(() => {
                    var _a;
                    return ((_a = get(model)) == null ? void 0 : _a.is_active) ?? true ? "" : "opacity-50 dark:opacity-50";
                  })) ?? ""} `);
                  set_attribute(img, "src", (deep_read_state(WEBUI_API_BASE_URL), get(model), untrack(() => `${WEBUI_API_BASE_URL}/models/model/profile/image?id=${get(model).id}`)));
                  set_class(div_12, 1, ` flex-1 self-center ${(get(model), untrack(() => {
                    var _a;
                    return ((_a = get(model)) == null ? void 0 : _a.is_active) ?? true ? "" : "text-gray-500";
                  })) ?? ""}`);
                  set_text(text_3, (get(model), untrack(() => {
                    var _a, _b, _c, _d, _e, _f, _g, _h;
                    return !!((_b = (_a = get(model)) == null ? void 0 : _a.meta) == null ? void 0 : _b.description) ? (_d = (_c = get(model)) == null ? void 0 : _c.meta) == null ? void 0 : _d.description : ((_f = (_e = get(model)) == null ? void 0 : _e.ollama) == null ? void 0 : _f.digest) ? `${get(model).id} (${(_h = (_g = get(model)) == null ? void 0 : _g.ollama) == null ? void 0 : _h.digest})` : get(model).id;
                  })));
                });
                event("click", button_3, () => {
                  set(selectedModelId, get(model).id);
                });
                append($$anchor5, div_9);
              });
              append($$anchor4, fragment_3);
            };
            var alternate_2 = ($$anchor4) => {
              var div_17 = root_16$3();
              var div_18 = child(div_17);
              var text_4 = child(div_18, true);
              reset(div_18);
              reset(div_17);
              template_effect(($0) => set_text(text_4, $0), [
                () => ($i18n(), untrack(() => $i18n().t("No models found")))
              ]);
              append($$anchor4, div_17);
            };
            if_block(node_11, ($$render) => {
              if (get(models$1), untrack(() => get(models$1).length > 0)) $$render(consequent_3);
              else $$render(alternate_2, false);
            });
          }
          reset(div_8);
          var node_19 = sibling(div_8, 2);
          {
            var consequent_5 = ($$anchor4) => {
              var div_19 = root_17();
              var div_20 = child(div_19);
              var input_1 = child(div_20);
              bind_this(input_1, ($$value) => set(modelsImportInputElement, $$value), () => get(modelsImportInputElement));
              var button_7 = sibling(input_1, 2);
              var node_20 = child(button_7);
              {
                var consequent_4 = ($$anchor5) => {
                  Spinner($$anchor5, { className: "size-3" });
                };
                if_block(node_20, ($$render) => {
                  if (get(modelsImportInProgress)) $$render(consequent_4);
                });
              }
              var div_21 = sibling(node_20, 2);
              var text_5 = child(div_21, true);
              reset(div_21);
              next(2);
              reset(button_7);
              var button_8 = sibling(button_7, 2);
              var div_22 = child(button_8);
              var text_6 = child(div_22);
              reset(div_22);
              next(2);
              reset(button_8);
              reset(div_20);
              reset(div_19);
              template_effect(
                ($0, $1) => {
                  button_7.disabled = get(modelsImportInProgress);
                  set_text(text_5, $0);
                  set_text(text_6, `${$1 ?? ""} (${(get(models$1), untrack(() => get(models$1).length)) ?? ""})`);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Import Presets"))),
                  () => ($i18n(), untrack(() => $i18n().t("Export Presets")))
                ]
              );
              bind_files(input_1, () => get(importFiles), ($$value) => set(importFiles, $$value));
              event("change", input_1, () => {
                if (get(importFiles).length > 0) {
                  const reader = new FileReader();
                  reader.onload = async (event2) => {
                    set(modelsImportInProgress, true);
                    try {
                      const models2 = JSON.parse(String(event2.target.result));
                      const res = await importModels(localStorage.token, models2);
                      if (res) {
                        toast.success($i18n().t("Models imported successfully"));
                        await init$1();
                      } else {
                        toast.error($i18n().t("Failed to import models"));
                      }
                    } catch (e) {
                      toast.error((e == null ? void 0 : e.detail) ?? $i18n().t("Invalid JSON file"));
                      console.error(e);
                    }
                    set(modelsImportInProgress, false);
                  };
                  reader.readAsText(get(importFiles)[0]);
                }
              });
              event("click", button_7, () => {
                get(modelsImportInputElement).click();
              });
              event("click", button_8, async () => {
                downloadModels(get(models$1));
              });
              append($$anchor4, div_19);
            };
            if_block(node_19, ($$render) => {
              if ($user(), untrack(() => {
                var _a;
                return ((_a = $user()) == null ? void 0 : _a.role) === "admin";
              })) $$render(consequent_5);
            });
          }
          template_effect(
            ($0, $1) => {
              set_text(text2, `${$0 ?? ""} `);
              set_text(text_1, (get(filteredModels), untrack(() => get(filteredModels).length)));
              set_attribute(input, "placeholder", $1);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Models"))),
              () => ($i18n(), untrack(() => $i18n().t("Search Models")))
            ]
          );
          bind_value(input, () => get(searchValue), ($$value) => set(searchValue, $$value));
          append($$anchor3, fragment_2);
        };
        var alternate_3 = ($$anchor3) => {
          {
            let $0 = derived_safe_equal(() => (get(models$1), get(selectedModelId), untrack(() => get(models$1).find((m) => m.id === get(selectedModelId)))));
            ModelEditor($$anchor3, {
              edit: true,
              get model() {
                return get($0);
              },
              preset: false,
              onSubmit: (model) => {
                console.log(model);
                upsertModelHandler(model);
                set(selectedModelId, null);
              },
              onBack: () => {
                set(selectedModelId, null);
              }
            });
          }
        };
        if_block(node_3, ($$render) => {
          if (get(selectedModelId) === null) $$render(consequent_6);
          else $$render(alternate_3, false);
        });
      }
      append($$anchor2, fragment_1);
    };
    var alternate_4 = ($$anchor2) => {
      var div_23 = root_20$2();
      var node_21 = child(div_23);
      Spinner(node_21, { className: "size-5" });
      reset(div_23);
      append($$anchor2, div_23);
    };
    if_block(node_2, ($$render) => {
      if (get(models$1) !== null) $$render(consequent_7);
      else $$render(alternate_4, false);
    });
  }
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
const PACKET_TYPES = /* @__PURE__ */ Object.create(null);
PACKET_TYPES["open"] = "0";
PACKET_TYPES["close"] = "1";
PACKET_TYPES["ping"] = "2";
PACKET_TYPES["pong"] = "3";
PACKET_TYPES["message"] = "4";
PACKET_TYPES["upgrade"] = "5";
PACKET_TYPES["noop"] = "6";
const PACKET_TYPES_REVERSE = /* @__PURE__ */ Object.create(null);
Object.keys(PACKET_TYPES).forEach((key) => {
  PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;
});
const ERROR_PACKET = { type: "error", data: "parser error" };
const withNativeBlob$1 = typeof Blob === "function" || typeof Blob !== "undefined" && Object.prototype.toString.call(Blob) === "[object BlobConstructor]";
const withNativeArrayBuffer$2 = typeof ArrayBuffer === "function";
const isView$1 = (obj) => {
  return typeof ArrayBuffer.isView === "function" ? ArrayBuffer.isView(obj) : obj && obj.buffer instanceof ArrayBuffer;
};
const encodePacket = ({ type, data }, supportsBinary, callback) => {
  if (withNativeBlob$1 && data instanceof Blob) {
    if (supportsBinary) {
      return callback(data);
    } else {
      return encodeBlobAsBase64(data, callback);
    }
  } else if (withNativeArrayBuffer$2 && (data instanceof ArrayBuffer || isView$1(data))) {
    if (supportsBinary) {
      return callback(data);
    } else {
      return encodeBlobAsBase64(new Blob([data]), callback);
    }
  }
  return callback(PACKET_TYPES[type] + (data || ""));
};
const encodeBlobAsBase64 = (data, callback) => {
  const fileReader = new FileReader();
  fileReader.onload = function() {
    const content = fileReader.result.split(",")[1];
    callback("b" + (content || ""));
  };
  return fileReader.readAsDataURL(data);
};
function toArray(data) {
  if (data instanceof Uint8Array) {
    return data;
  } else if (data instanceof ArrayBuffer) {
    return new Uint8Array(data);
  } else {
    return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);
  }
}
let TEXT_ENCODER;
function encodePacketToBinary(packet, callback) {
  if (withNativeBlob$1 && packet.data instanceof Blob) {
    return packet.data.arrayBuffer().then(toArray).then(callback);
  } else if (withNativeArrayBuffer$2 && (packet.data instanceof ArrayBuffer || isView$1(packet.data))) {
    return callback(toArray(packet.data));
  }
  encodePacket(packet, false, (encoded) => {
    if (!TEXT_ENCODER) {
      TEXT_ENCODER = new TextEncoder();
    }
    callback(TEXT_ENCODER.encode(encoded));
  });
}
const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
const lookup$1 = typeof Uint8Array === "undefined" ? [] : new Uint8Array(256);
for (let i = 0; i < chars.length; i++) {
  lookup$1[chars.charCodeAt(i)] = i;
}
const decode$1 = (base64) => {
  let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;
  if (base64[base64.length - 1] === "=") {
    bufferLength--;
    if (base64[base64.length - 2] === "=") {
      bufferLength--;
    }
  }
  const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);
  for (i = 0; i < len; i += 4) {
    encoded1 = lookup$1[base64.charCodeAt(i)];
    encoded2 = lookup$1[base64.charCodeAt(i + 1)];
    encoded3 = lookup$1[base64.charCodeAt(i + 2)];
    encoded4 = lookup$1[base64.charCodeAt(i + 3)];
    bytes[p++] = encoded1 << 2 | encoded2 >> 4;
    bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;
    bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;
  }
  return arraybuffer;
};
const withNativeArrayBuffer$1 = typeof ArrayBuffer === "function";
const decodePacket = (encodedPacket, binaryType) => {
  if (typeof encodedPacket !== "string") {
    return {
      type: "message",
      data: mapBinary(encodedPacket, binaryType)
    };
  }
  const type = encodedPacket.charAt(0);
  if (type === "b") {
    return {
      type: "message",
      data: decodeBase64Packet(encodedPacket.substring(1), binaryType)
    };
  }
  const packetType = PACKET_TYPES_REVERSE[type];
  if (!packetType) {
    return ERROR_PACKET;
  }
  return encodedPacket.length > 1 ? {
    type: PACKET_TYPES_REVERSE[type],
    data: encodedPacket.substring(1)
  } : {
    type: PACKET_TYPES_REVERSE[type]
  };
};
const decodeBase64Packet = (data, binaryType) => {
  if (withNativeArrayBuffer$1) {
    const decoded = decode$1(data);
    return mapBinary(decoded, binaryType);
  } else {
    return { base64: true, data };
  }
};
const mapBinary = (data, binaryType) => {
  switch (binaryType) {
    case "blob":
      if (data instanceof Blob) {
        return data;
      } else {
        return new Blob([data]);
      }
    case "arraybuffer":
    default:
      if (data instanceof ArrayBuffer) {
        return data;
      } else {
        return data.buffer;
      }
  }
};
const SEPARATOR = String.fromCharCode(30);
const encodePayload = (packets, callback) => {
  const length = packets.length;
  const encodedPackets = new Array(length);
  let count = 0;
  packets.forEach((packet, i) => {
    encodePacket(packet, false, (encodedPacket) => {
      encodedPackets[i] = encodedPacket;
      if (++count === length) {
        callback(encodedPackets.join(SEPARATOR));
      }
    });
  });
};
const decodePayload = (encodedPayload, binaryType) => {
  const encodedPackets = encodedPayload.split(SEPARATOR);
  const packets = [];
  for (let i = 0; i < encodedPackets.length; i++) {
    const decodedPacket = decodePacket(encodedPackets[i], binaryType);
    packets.push(decodedPacket);
    if (decodedPacket.type === "error") {
      break;
    }
  }
  return packets;
};
function createPacketEncoderStream() {
  return new TransformStream({
    transform(packet, controller) {
      encodePacketToBinary(packet, (encodedPacket) => {
        const payloadLength = encodedPacket.length;
        let header;
        if (payloadLength < 126) {
          header = new Uint8Array(1);
          new DataView(header.buffer).setUint8(0, payloadLength);
        } else if (payloadLength < 65536) {
          header = new Uint8Array(3);
          const view = new DataView(header.buffer);
          view.setUint8(0, 126);
          view.setUint16(1, payloadLength);
        } else {
          header = new Uint8Array(9);
          const view = new DataView(header.buffer);
          view.setUint8(0, 127);
          view.setBigUint64(1, BigInt(payloadLength));
        }
        if (packet.data && typeof packet.data !== "string") {
          header[0] |= 128;
        }
        controller.enqueue(header);
        controller.enqueue(encodedPacket);
      });
    }
  });
}
let TEXT_DECODER;
function totalLength(chunks) {
  return chunks.reduce((acc, chunk) => acc + chunk.length, 0);
}
function concatChunks(chunks, size) {
  if (chunks[0].length === size) {
    return chunks.shift();
  }
  const buffer = new Uint8Array(size);
  let j = 0;
  for (let i = 0; i < size; i++) {
    buffer[i] = chunks[0][j++];
    if (j === chunks[0].length) {
      chunks.shift();
      j = 0;
    }
  }
  if (chunks.length && j < chunks[0].length) {
    chunks[0] = chunks[0].slice(j);
  }
  return buffer;
}
function createPacketDecoderStream(maxPayload, binaryType) {
  if (!TEXT_DECODER) {
    TEXT_DECODER = new TextDecoder();
  }
  const chunks = [];
  let state2 = 0;
  let expectedLength = -1;
  let isBinary2 = false;
  return new TransformStream({
    transform(chunk, controller) {
      chunks.push(chunk);
      while (true) {
        if (state2 === 0) {
          if (totalLength(chunks) < 1) {
            break;
          }
          const header = concatChunks(chunks, 1);
          isBinary2 = (header[0] & 128) === 128;
          expectedLength = header[0] & 127;
          if (expectedLength < 126) {
            state2 = 3;
          } else if (expectedLength === 126) {
            state2 = 1;
          } else {
            state2 = 2;
          }
        } else if (state2 === 1) {
          if (totalLength(chunks) < 2) {
            break;
          }
          const headerArray = concatChunks(chunks, 2);
          expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);
          state2 = 3;
        } else if (state2 === 2) {
          if (totalLength(chunks) < 8) {
            break;
          }
          const headerArray = concatChunks(chunks, 8);
          const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);
          const n = view.getUint32(0);
          if (n > Math.pow(2, 53 - 32) - 1) {
            controller.enqueue(ERROR_PACKET);
            break;
          }
          expectedLength = n * Math.pow(2, 32) + view.getUint32(4);
          state2 = 3;
        } else {
          if (totalLength(chunks) < expectedLength) {
            break;
          }
          const data = concatChunks(chunks, expectedLength);
          controller.enqueue(decodePacket(isBinary2 ? data : TEXT_DECODER.decode(data), binaryType));
          state2 = 0;
        }
        if (expectedLength === 0 || expectedLength > maxPayload) {
          controller.enqueue(ERROR_PACKET);
          break;
        }
      }
    }
  });
}
const protocol$1 = 4;
function Emitter(obj) {
  if (obj) return mixin(obj);
}
function mixin(obj) {
  for (var key in Emitter.prototype) {
    obj[key] = Emitter.prototype[key];
  }
  return obj;
}
Emitter.prototype.on = Emitter.prototype.addEventListener = function(event2, fn) {
  this._callbacks = this._callbacks || {};
  (this._callbacks["$" + event2] = this._callbacks["$" + event2] || []).push(fn);
  return this;
};
Emitter.prototype.once = function(event2, fn) {
  function on2() {
    this.off(event2, on2);
    fn.apply(this, arguments);
  }
  on2.fn = fn;
  this.on(event2, on2);
  return this;
};
Emitter.prototype.off = Emitter.prototype.removeListener = Emitter.prototype.removeAllListeners = Emitter.prototype.removeEventListener = function(event2, fn) {
  this._callbacks = this._callbacks || {};
  if (0 == arguments.length) {
    this._callbacks = {};
    return this;
  }
  var callbacks = this._callbacks["$" + event2];
  if (!callbacks) return this;
  if (1 == arguments.length) {
    delete this._callbacks["$" + event2];
    return this;
  }
  var cb;
  for (var i = 0; i < callbacks.length; i++) {
    cb = callbacks[i];
    if (cb === fn || cb.fn === fn) {
      callbacks.splice(i, 1);
      break;
    }
  }
  if (callbacks.length === 0) {
    delete this._callbacks["$" + event2];
  }
  return this;
};
Emitter.prototype.emit = function(event2) {
  this._callbacks = this._callbacks || {};
  var args = new Array(arguments.length - 1), callbacks = this._callbacks["$" + event2];
  for (var i = 1; i < arguments.length; i++) {
    args[i - 1] = arguments[i];
  }
  if (callbacks) {
    callbacks = callbacks.slice(0);
    for (var i = 0, len = callbacks.length; i < len; ++i) {
      callbacks[i].apply(this, args);
    }
  }
  return this;
};
Emitter.prototype.emitReserved = Emitter.prototype.emit;
Emitter.prototype.listeners = function(event2) {
  this._callbacks = this._callbacks || {};
  return this._callbacks["$" + event2] || [];
};
Emitter.prototype.hasListeners = function(event2) {
  return !!this.listeners(event2).length;
};
const nextTick = (() => {
  const isPromiseAvailable = typeof Promise === "function" && typeof Promise.resolve === "function";
  if (isPromiseAvailable) {
    return (cb) => Promise.resolve().then(cb);
  } else {
    return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);
  }
})();
const globalThisShim = (() => {
  if (typeof self !== "undefined") {
    return self;
  } else if (typeof window !== "undefined") {
    return window;
  } else {
    return Function("return this")();
  }
})();
const defaultBinaryType = "arraybuffer";
function createCookieJar() {
}
function pick(obj, ...attr) {
  return attr.reduce((acc, k) => {
    if (obj.hasOwnProperty(k)) {
      acc[k] = obj[k];
    }
    return acc;
  }, {});
}
const NATIVE_SET_TIMEOUT = globalThisShim.setTimeout;
const NATIVE_CLEAR_TIMEOUT = globalThisShim.clearTimeout;
function installTimerFunctions(obj, opts) {
  if (opts.useNativeTimers) {
    obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globalThisShim);
    obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globalThisShim);
  } else {
    obj.setTimeoutFn = globalThisShim.setTimeout.bind(globalThisShim);
    obj.clearTimeoutFn = globalThisShim.clearTimeout.bind(globalThisShim);
  }
}
const BASE64_OVERHEAD = 1.33;
function byteLength(obj) {
  if (typeof obj === "string") {
    return utf8Length(obj);
  }
  return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);
}
function utf8Length(str) {
  let c = 0, length = 0;
  for (let i = 0, l = str.length; i < l; i++) {
    c = str.charCodeAt(i);
    if (c < 128) {
      length += 1;
    } else if (c < 2048) {
      length += 2;
    } else if (c < 55296 || c >= 57344) {
      length += 3;
    } else {
      i++;
      length += 4;
    }
  }
  return length;
}
function randomString() {
  return Date.now().toString(36).substring(3) + Math.random().toString(36).substring(2, 5);
}
function encode(obj) {
  let str = "";
  for (let i in obj) {
    if (obj.hasOwnProperty(i)) {
      if (str.length)
        str += "&";
      str += encodeURIComponent(i) + "=" + encodeURIComponent(obj[i]);
    }
  }
  return str;
}
function decode(qs) {
  let qry = {};
  let pairs = qs.split("&");
  for (let i = 0, l = pairs.length; i < l; i++) {
    let pair = pairs[i].split("=");
    qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
  }
  return qry;
}
class TransportError extends Error {
  constructor(reason, description, context) {
    super(reason);
    this.description = description;
    this.context = context;
    this.type = "TransportError";
  }
}
class Transport extends Emitter {
  /**
   * Transport abstract constructor.
   *
   * @param {Object} opts - options
   * @protected
   */
  constructor(opts) {
    super();
    this.writable = false;
    installTimerFunctions(this, opts);
    this.opts = opts;
    this.query = opts.query;
    this.socket = opts.socket;
    this.supportsBinary = !opts.forceBase64;
  }
  /**
   * Emits an error.
   *
   * @param {String} reason
   * @param description
   * @param context - the error context
   * @return {Transport} for chaining
   * @protected
   */
  onError(reason, description, context) {
    super.emitReserved("error", new TransportError(reason, description, context));
    return this;
  }
  /**
   * Opens the transport.
   */
  open() {
    this.readyState = "opening";
    this.doOpen();
    return this;
  }
  /**
   * Closes the transport.
   */
  close() {
    if (this.readyState === "opening" || this.readyState === "open") {
      this.doClose();
      this.onClose();
    }
    return this;
  }
  /**
   * Sends multiple packets.
   *
   * @param {Array} packets
   */
  send(packets) {
    if (this.readyState === "open") {
      this.write(packets);
    }
  }
  /**
   * Called upon open
   *
   * @protected
   */
  onOpen() {
    this.readyState = "open";
    this.writable = true;
    super.emitReserved("open");
  }
  /**
   * Called with data.
   *
   * @param {String} data
   * @protected
   */
  onData(data) {
    const packet = decodePacket(data, this.socket.binaryType);
    this.onPacket(packet);
  }
  /**
   * Called with a decoded packet.
   *
   * @protected
   */
  onPacket(packet) {
    super.emitReserved("packet", packet);
  }
  /**
   * Called upon close.
   *
   * @protected
   */
  onClose(details) {
    this.readyState = "closed";
    super.emitReserved("close", details);
  }
  /**
   * Pauses the transport, in order not to lose packets during an upgrade.
   *
   * @param onPause
   */
  pause(onPause) {
  }
  createUri(schema, query = {}) {
    return schema + "://" + this._hostname() + this._port() + this.opts.path + this._query(query);
  }
  _hostname() {
    const hostname = this.opts.hostname;
    return hostname.indexOf(":") === -1 ? hostname : "[" + hostname + "]";
  }
  _port() {
    if (this.opts.port && (this.opts.secure && Number(this.opts.port !== 443) || !this.opts.secure && Number(this.opts.port) !== 80)) {
      return ":" + this.opts.port;
    } else {
      return "";
    }
  }
  _query(query) {
    const encodedQuery = encode(query);
    return encodedQuery.length ? "?" + encodedQuery : "";
  }
}
class Polling extends Transport {
  constructor() {
    super(...arguments);
    this._polling = false;
  }
  get name() {
    return "polling";
  }
  /**
   * Opens the socket (triggers polling). We write a PING message to determine
   * when the transport is open.
   *
   * @protected
   */
  doOpen() {
    this._poll();
  }
  /**
   * Pauses polling.
   *
   * @param {Function} onPause - callback upon buffers are flushed and transport is paused
   * @package
   */
  pause(onPause) {
    this.readyState = "pausing";
    const pause = () => {
      this.readyState = "paused";
      onPause();
    };
    if (this._polling || !this.writable) {
      let total = 0;
      if (this._polling) {
        total++;
        this.once("pollComplete", function() {
          --total || pause();
        });
      }
      if (!this.writable) {
        total++;
        this.once("drain", function() {
          --total || pause();
        });
      }
    } else {
      pause();
    }
  }
  /**
   * Starts polling cycle.
   *
   * @private
   */
  _poll() {
    this._polling = true;
    this.doPoll();
    this.emitReserved("poll");
  }
  /**
   * Overloads onData to detect payloads.
   *
   * @protected
   */
  onData(data) {
    const callback = (packet) => {
      if ("opening" === this.readyState && packet.type === "open") {
        this.onOpen();
      }
      if ("close" === packet.type) {
        this.onClose({ description: "transport closed by the server" });
        return false;
      }
      this.onPacket(packet);
    };
    decodePayload(data, this.socket.binaryType).forEach(callback);
    if ("closed" !== this.readyState) {
      this._polling = false;
      this.emitReserved("pollComplete");
      if ("open" === this.readyState) {
        this._poll();
      }
    }
  }
  /**
   * For polling, send a close packet.
   *
   * @protected
   */
  doClose() {
    const close = () => {
      this.write([{ type: "close" }]);
    };
    if ("open" === this.readyState) {
      close();
    } else {
      this.once("open", close);
    }
  }
  /**
   * Writes a packets payload.
   *
   * @param {Array} packets - data packets
   * @protected
   */
  write(packets) {
    this.writable = false;
    encodePayload(packets, (data) => {
      this.doWrite(data, () => {
        this.writable = true;
        this.emitReserved("drain");
      });
    });
  }
  /**
   * Generates uri for connection.
   *
   * @private
   */
  uri() {
    const schema = this.opts.secure ? "https" : "http";
    const query = this.query || {};
    if (false !== this.opts.timestampRequests) {
      query[this.opts.timestampParam] = randomString();
    }
    if (!this.supportsBinary && !query.sid) {
      query.b64 = 1;
    }
    return this.createUri(schema, query);
  }
}
let value = false;
try {
  value = typeof XMLHttpRequest !== "undefined" && "withCredentials" in new XMLHttpRequest();
} catch (err) {
}
const hasCORS = value;
function empty() {
}
class BaseXHR extends Polling {
  /**
   * XHR Polling constructor.
   *
   * @param {Object} opts
   * @package
   */
  constructor(opts) {
    super(opts);
    if (typeof location !== "undefined") {
      const isSSL = "https:" === location.protocol;
      let port = location.port;
      if (!port) {
        port = isSSL ? "443" : "80";
      }
      this.xd = typeof location !== "undefined" && opts.hostname !== location.hostname || port !== opts.port;
    }
  }
  /**
   * Sends data.
   *
   * @param {String} data to send.
   * @param {Function} called upon flush.
   * @private
   */
  doWrite(data, fn) {
    const req = this.request({
      method: "POST",
      data
    });
    req.on("success", fn);
    req.on("error", (xhrStatus, context) => {
      this.onError("xhr post error", xhrStatus, context);
    });
  }
  /**
   * Starts a poll cycle.
   *
   * @private
   */
  doPoll() {
    const req = this.request();
    req.on("data", this.onData.bind(this));
    req.on("error", (xhrStatus, context) => {
      this.onError("xhr poll error", xhrStatus, context);
    });
    this.pollXhr = req;
  }
}
class Request extends Emitter {
  /**
   * Request constructor
   *
   * @param {Object} options
   * @package
   */
  constructor(createRequest, uri, opts) {
    super();
    this.createRequest = createRequest;
    installTimerFunctions(this, opts);
    this._opts = opts;
    this._method = opts.method || "GET";
    this._uri = uri;
    this._data = void 0 !== opts.data ? opts.data : null;
    this._create();
  }
  /**
   * Creates the XHR object and sends the request.
   *
   * @private
   */
  _create() {
    var _a;
    const opts = pick(this._opts, "agent", "pfx", "key", "passphrase", "cert", "ca", "ciphers", "rejectUnauthorized", "autoUnref");
    opts.xdomain = !!this._opts.xd;
    const xhr = this._xhr = this.createRequest(opts);
    try {
      xhr.open(this._method, this._uri, true);
      try {
        if (this._opts.extraHeaders) {
          xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);
          for (let i in this._opts.extraHeaders) {
            if (this._opts.extraHeaders.hasOwnProperty(i)) {
              xhr.setRequestHeader(i, this._opts.extraHeaders[i]);
            }
          }
        }
      } catch (e) {
      }
      if ("POST" === this._method) {
        try {
          xhr.setRequestHeader("Content-type", "text/plain;charset=UTF-8");
        } catch (e) {
        }
      }
      try {
        xhr.setRequestHeader("Accept", "*/*");
      } catch (e) {
      }
      (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);
      if ("withCredentials" in xhr) {
        xhr.withCredentials = this._opts.withCredentials;
      }
      if (this._opts.requestTimeout) {
        xhr.timeout = this._opts.requestTimeout;
      }
      xhr.onreadystatechange = () => {
        var _a2;
        if (xhr.readyState === 3) {
          (_a2 = this._opts.cookieJar) === null || _a2 === void 0 ? void 0 : _a2.parseCookies(
            // @ts-ignore
            xhr.getResponseHeader("set-cookie")
          );
        }
        if (4 !== xhr.readyState)
          return;
        if (200 === xhr.status || 1223 === xhr.status) {
          this._onLoad();
        } else {
          this.setTimeoutFn(() => {
            this._onError(typeof xhr.status === "number" ? xhr.status : 0);
          }, 0);
        }
      };
      xhr.send(this._data);
    } catch (e) {
      this.setTimeoutFn(() => {
        this._onError(e);
      }, 0);
      return;
    }
    if (typeof document !== "undefined") {
      this._index = Request.requestsCount++;
      Request.requests[this._index] = this;
    }
  }
  /**
   * Called upon error.
   *
   * @private
   */
  _onError(err) {
    this.emitReserved("error", err, this._xhr);
    this._cleanup(true);
  }
  /**
   * Cleans up house.
   *
   * @private
   */
  _cleanup(fromError) {
    if ("undefined" === typeof this._xhr || null === this._xhr) {
      return;
    }
    this._xhr.onreadystatechange = empty;
    if (fromError) {
      try {
        this._xhr.abort();
      } catch (e) {
      }
    }
    if (typeof document !== "undefined") {
      delete Request.requests[this._index];
    }
    this._xhr = null;
  }
  /**
   * Called upon load.
   *
   * @private
   */
  _onLoad() {
    const data = this._xhr.responseText;
    if (data !== null) {
      this.emitReserved("data", data);
      this.emitReserved("success");
      this._cleanup();
    }
  }
  /**
   * Aborts the request.
   *
   * @package
   */
  abort() {
    this._cleanup();
  }
}
Request.requestsCount = 0;
Request.requests = {};
if (typeof document !== "undefined") {
  if (typeof attachEvent === "function") {
    attachEvent("onunload", unloadHandler);
  } else if (typeof addEventListener === "function") {
    const terminationEvent = "onpagehide" in globalThisShim ? "pagehide" : "unload";
    addEventListener(terminationEvent, unloadHandler, false);
  }
}
function unloadHandler() {
  for (let i in Request.requests) {
    if (Request.requests.hasOwnProperty(i)) {
      Request.requests[i].abort();
    }
  }
}
const hasXHR2 = function() {
  const xhr = newRequest({
    xdomain: false
  });
  return xhr && xhr.responseType !== null;
}();
class XHR extends BaseXHR {
  constructor(opts) {
    super(opts);
    const forceBase64 = opts && opts.forceBase64;
    this.supportsBinary = hasXHR2 && !forceBase64;
  }
  request(opts = {}) {
    Object.assign(opts, { xd: this.xd }, this.opts);
    return new Request(newRequest, this.uri(), opts);
  }
}
function newRequest(opts) {
  const xdomain = opts.xdomain;
  try {
    if ("undefined" !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {
      return new XMLHttpRequest();
    }
  } catch (e) {
  }
  if (!xdomain) {
    try {
      return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP");
    } catch (e) {
    }
  }
}
const isReactNative = typeof navigator !== "undefined" && typeof navigator.product === "string" && navigator.product.toLowerCase() === "reactnative";
class BaseWS extends Transport {
  get name() {
    return "websocket";
  }
  doOpen() {
    const uri = this.uri();
    const protocols = this.opts.protocols;
    const opts = isReactNative ? {} : pick(this.opts, "agent", "perMessageDeflate", "pfx", "key", "passphrase", "cert", "ca", "ciphers", "rejectUnauthorized", "localAddress", "protocolVersion", "origin", "maxPayload", "family", "checkServerIdentity");
    if (this.opts.extraHeaders) {
      opts.headers = this.opts.extraHeaders;
    }
    try {
      this.ws = this.createSocket(uri, protocols, opts);
    } catch (err) {
      return this.emitReserved("error", err);
    }
    this.ws.binaryType = this.socket.binaryType;
    this.addEventListeners();
  }
  /**
   * Adds event listeners to the socket
   *
   * @private
   */
  addEventListeners() {
    this.ws.onopen = () => {
      if (this.opts.autoUnref) {
        this.ws._socket.unref();
      }
      this.onOpen();
    };
    this.ws.onclose = (closeEvent) => this.onClose({
      description: "websocket connection closed",
      context: closeEvent
    });
    this.ws.onmessage = (ev) => this.onData(ev.data);
    this.ws.onerror = (e) => this.onError("websocket error", e);
  }
  write(packets) {
    this.writable = false;
    for (let i = 0; i < packets.length; i++) {
      const packet = packets[i];
      const lastPacket = i === packets.length - 1;
      encodePacket(packet, this.supportsBinary, (data) => {
        try {
          this.doWrite(packet, data);
        } catch (e) {
        }
        if (lastPacket) {
          nextTick(() => {
            this.writable = true;
            this.emitReserved("drain");
          }, this.setTimeoutFn);
        }
      });
    }
  }
  doClose() {
    if (typeof this.ws !== "undefined") {
      this.ws.onerror = () => {
      };
      this.ws.close();
      this.ws = null;
    }
  }
  /**
   * Generates uri for connection.
   *
   * @private
   */
  uri() {
    const schema = this.opts.secure ? "wss" : "ws";
    const query = this.query || {};
    if (this.opts.timestampRequests) {
      query[this.opts.timestampParam] = randomString();
    }
    if (!this.supportsBinary) {
      query.b64 = 1;
    }
    return this.createUri(schema, query);
  }
}
const WebSocketCtor = globalThisShim.WebSocket || globalThisShim.MozWebSocket;
class WS extends BaseWS {
  createSocket(uri, protocols, opts) {
    return !isReactNative ? protocols ? new WebSocketCtor(uri, protocols) : new WebSocketCtor(uri) : new WebSocketCtor(uri, protocols, opts);
  }
  doWrite(_packet, data) {
    this.ws.send(data);
  }
}
class WT extends Transport {
  get name() {
    return "webtransport";
  }
  doOpen() {
    try {
      this._transport = new WebTransport(this.createUri("https"), this.opts.transportOptions[this.name]);
    } catch (err) {
      return this.emitReserved("error", err);
    }
    this._transport.closed.then(() => {
      this.onClose();
    }).catch((err) => {
      this.onError("webtransport error", err);
    });
    this._transport.ready.then(() => {
      this._transport.createBidirectionalStream().then((stream) => {
        const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);
        const reader = stream.readable.pipeThrough(decoderStream).getReader();
        const encoderStream = createPacketEncoderStream();
        encoderStream.readable.pipeTo(stream.writable);
        this._writer = encoderStream.writable.getWriter();
        const read = () => {
          reader.read().then(({ done, value: value2 }) => {
            if (done) {
              return;
            }
            this.onPacket(value2);
            read();
          }).catch((err) => {
          });
        };
        read();
        const packet = { type: "open" };
        if (this.query.sid) {
          packet.data = `{"sid":"${this.query.sid}"}`;
        }
        this._writer.write(packet).then(() => this.onOpen());
      });
    });
  }
  write(packets) {
    this.writable = false;
    for (let i = 0; i < packets.length; i++) {
      const packet = packets[i];
      const lastPacket = i === packets.length - 1;
      this._writer.write(packet).then(() => {
        if (lastPacket) {
          nextTick(() => {
            this.writable = true;
            this.emitReserved("drain");
          }, this.setTimeoutFn);
        }
      });
    }
  }
  doClose() {
    var _a;
    (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();
  }
}
const transports = {
  websocket: WS,
  webtransport: WT,
  polling: XHR
};
const re = /^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;
const parts = [
  "source",
  "protocol",
  "authority",
  "userInfo",
  "user",
  "password",
  "host",
  "port",
  "relative",
  "path",
  "directory",
  "file",
  "query",
  "anchor"
];
function parse(str) {
  if (str.length > 8e3) {
    throw "URI too long";
  }
  const src = str, b = str.indexOf("["), e = str.indexOf("]");
  if (b != -1 && e != -1) {
    str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ";") + str.substring(e, str.length);
  }
  let m = re.exec(str || ""), uri = {}, i = 14;
  while (i--) {
    uri[parts[i]] = m[i] || "";
  }
  if (b != -1 && e != -1) {
    uri.source = src;
    uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ":");
    uri.authority = uri.authority.replace("[", "").replace("]", "").replace(/;/g, ":");
    uri.ipv6uri = true;
  }
  uri.pathNames = pathNames(uri, uri["path"]);
  uri.queryKey = queryKey(uri, uri["query"]);
  return uri;
}
function pathNames(obj, path) {
  const regx = /\/{2,9}/g, names = path.replace(regx, "/").split("/");
  if (path.slice(0, 1) == "/" || path.length === 0) {
    names.splice(0, 1);
  }
  if (path.slice(-1) == "/") {
    names.splice(names.length - 1, 1);
  }
  return names;
}
function queryKey(uri, query) {
  const data = {};
  query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function($0, $1, $2) {
    if ($1) {
      data[$1] = $2;
    }
  });
  return data;
}
const withEventListeners = typeof addEventListener === "function" && typeof removeEventListener === "function";
const OFFLINE_EVENT_LISTENERS = [];
if (withEventListeners) {
  addEventListener("offline", () => {
    OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());
  }, false);
}
class SocketWithoutUpgrade extends Emitter {
  /**
   * Socket constructor.
   *
   * @param {String|Object} uri - uri or options
   * @param {Object} opts - options
   */
  constructor(uri, opts) {
    super();
    this.binaryType = defaultBinaryType;
    this.writeBuffer = [];
    this._prevBufferLen = 0;
    this._pingInterval = -1;
    this._pingTimeout = -1;
    this._maxPayload = -1;
    this._pingTimeoutTime = Infinity;
    if (uri && "object" === typeof uri) {
      opts = uri;
      uri = null;
    }
    if (uri) {
      const parsedUri = parse(uri);
      opts.hostname = parsedUri.host;
      opts.secure = parsedUri.protocol === "https" || parsedUri.protocol === "wss";
      opts.port = parsedUri.port;
      if (parsedUri.query)
        opts.query = parsedUri.query;
    } else if (opts.host) {
      opts.hostname = parse(opts.host).host;
    }
    installTimerFunctions(this, opts);
    this.secure = null != opts.secure ? opts.secure : typeof location !== "undefined" && "https:" === location.protocol;
    if (opts.hostname && !opts.port) {
      opts.port = this.secure ? "443" : "80";
    }
    this.hostname = opts.hostname || (typeof location !== "undefined" ? location.hostname : "localhost");
    this.port = opts.port || (typeof location !== "undefined" && location.port ? location.port : this.secure ? "443" : "80");
    this.transports = [];
    this._transportsByName = {};
    opts.transports.forEach((t) => {
      const transportName = t.prototype.name;
      this.transports.push(transportName);
      this._transportsByName[transportName] = t;
    });
    this.opts = Object.assign({
      path: "/engine.io",
      agent: false,
      withCredentials: false,
      upgrade: true,
      timestampParam: "t",
      rememberUpgrade: false,
      addTrailingSlash: true,
      rejectUnauthorized: true,
      perMessageDeflate: {
        threshold: 1024
      },
      transportOptions: {},
      closeOnBeforeunload: false
    }, opts);
    this.opts.path = this.opts.path.replace(/\/$/, "") + (this.opts.addTrailingSlash ? "/" : "");
    if (typeof this.opts.query === "string") {
      this.opts.query = decode(this.opts.query);
    }
    if (withEventListeners) {
      if (this.opts.closeOnBeforeunload) {
        this._beforeunloadEventListener = () => {
          if (this.transport) {
            this.transport.removeAllListeners();
            this.transport.close();
          }
        };
        addEventListener("beforeunload", this._beforeunloadEventListener, false);
      }
      if (this.hostname !== "localhost") {
        this._offlineEventListener = () => {
          this._onClose("transport close", {
            description: "network connection lost"
          });
        };
        OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);
      }
    }
    if (this.opts.withCredentials) {
      this._cookieJar = createCookieJar();
    }
    this._open();
  }
  /**
   * Creates transport of the given type.
   *
   * @param {String} name - transport name
   * @return {Transport}
   * @private
   */
  createTransport(name) {
    const query = Object.assign({}, this.opts.query);
    query.EIO = protocol$1;
    query.transport = name;
    if (this.id)
      query.sid = this.id;
    const opts = Object.assign({}, this.opts, {
      query,
      socket: this,
      hostname: this.hostname,
      secure: this.secure,
      port: this.port
    }, this.opts.transportOptions[name]);
    return new this._transportsByName[name](opts);
  }
  /**
   * Initializes transport to use and starts probe.
   *
   * @private
   */
  _open() {
    if (this.transports.length === 0) {
      this.setTimeoutFn(() => {
        this.emitReserved("error", "No transports available");
      }, 0);
      return;
    }
    const transportName = this.opts.rememberUpgrade && SocketWithoutUpgrade.priorWebsocketSuccess && this.transports.indexOf("websocket") !== -1 ? "websocket" : this.transports[0];
    this.readyState = "opening";
    const transport = this.createTransport(transportName);
    transport.open();
    this.setTransport(transport);
  }
  /**
   * Sets the current transport. Disables the existing one (if any).
   *
   * @private
   */
  setTransport(transport) {
    if (this.transport) {
      this.transport.removeAllListeners();
    }
    this.transport = transport;
    transport.on("drain", this._onDrain.bind(this)).on("packet", this._onPacket.bind(this)).on("error", this._onError.bind(this)).on("close", (reason) => this._onClose("transport close", reason));
  }
  /**
   * Called when connection is deemed open.
   *
   * @private
   */
  onOpen() {
    this.readyState = "open";
    SocketWithoutUpgrade.priorWebsocketSuccess = "websocket" === this.transport.name;
    this.emitReserved("open");
    this.flush();
  }
  /**
   * Handles a packet.
   *
   * @private
   */
  _onPacket(packet) {
    if ("opening" === this.readyState || "open" === this.readyState || "closing" === this.readyState) {
      this.emitReserved("packet", packet);
      this.emitReserved("heartbeat");
      switch (packet.type) {
        case "open":
          this.onHandshake(JSON.parse(packet.data));
          break;
        case "ping":
          this._sendPacket("pong");
          this.emitReserved("ping");
          this.emitReserved("pong");
          this._resetPingTimeout();
          break;
        case "error":
          const err = new Error("server error");
          err.code = packet.data;
          this._onError(err);
          break;
        case "message":
          this.emitReserved("data", packet.data);
          this.emitReserved("message", packet.data);
          break;
      }
    }
  }
  /**
   * Called upon handshake completion.
   *
   * @param {Object} data - handshake obj
   * @private
   */
  onHandshake(data) {
    this.emitReserved("handshake", data);
    this.id = data.sid;
    this.transport.query.sid = data.sid;
    this._pingInterval = data.pingInterval;
    this._pingTimeout = data.pingTimeout;
    this._maxPayload = data.maxPayload;
    this.onOpen();
    if ("closed" === this.readyState)
      return;
    this._resetPingTimeout();
  }
  /**
   * Sets and resets ping timeout timer based on server pings.
   *
   * @private
   */
  _resetPingTimeout() {
    this.clearTimeoutFn(this._pingTimeoutTimer);
    const delay = this._pingInterval + this._pingTimeout;
    this._pingTimeoutTime = Date.now() + delay;
    this._pingTimeoutTimer = this.setTimeoutFn(() => {
      this._onClose("ping timeout");
    }, delay);
    if (this.opts.autoUnref) {
      this._pingTimeoutTimer.unref();
    }
  }
  /**
   * Called on `drain` event
   *
   * @private
   */
  _onDrain() {
    this.writeBuffer.splice(0, this._prevBufferLen);
    this._prevBufferLen = 0;
    if (0 === this.writeBuffer.length) {
      this.emitReserved("drain");
    } else {
      this.flush();
    }
  }
  /**
   * Flush write buffers.
   *
   * @private
   */
  flush() {
    if ("closed" !== this.readyState && this.transport.writable && !this.upgrading && this.writeBuffer.length) {
      const packets = this._getWritablePackets();
      this.transport.send(packets);
      this._prevBufferLen = packets.length;
      this.emitReserved("flush");
    }
  }
  /**
   * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP
   * long-polling)
   *
   * @private
   */
  _getWritablePackets() {
    const shouldCheckPayloadSize = this._maxPayload && this.transport.name === "polling" && this.writeBuffer.length > 1;
    if (!shouldCheckPayloadSize) {
      return this.writeBuffer;
    }
    let payloadSize = 1;
    for (let i = 0; i < this.writeBuffer.length; i++) {
      const data = this.writeBuffer[i].data;
      if (data) {
        payloadSize += byteLength(data);
      }
      if (i > 0 && payloadSize > this._maxPayload) {
        return this.writeBuffer.slice(0, i);
      }
      payloadSize += 2;
    }
    return this.writeBuffer;
  }
  /**
   * Checks whether the heartbeat timer has expired but the socket has not yet been notified.
   *
   * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the
   * `write()` method then the message would not be buffered by the Socket.IO client.
   *
   * @return {boolean}
   * @private
   */
  /* private */
  _hasPingExpired() {
    if (!this._pingTimeoutTime)
      return true;
    const hasExpired = Date.now() > this._pingTimeoutTime;
    if (hasExpired) {
      this._pingTimeoutTime = 0;
      nextTick(() => {
        this._onClose("ping timeout");
      }, this.setTimeoutFn);
    }
    return hasExpired;
  }
  /**
   * Sends a message.
   *
   * @param {String} msg - message.
   * @param {Object} options.
   * @param {Function} fn - callback function.
   * @return {Socket} for chaining.
   */
  write(msg, options, fn) {
    this._sendPacket("message", msg, options, fn);
    return this;
  }
  /**
   * Sends a message. Alias of {@link Socket#write}.
   *
   * @param {String} msg - message.
   * @param {Object} options.
   * @param {Function} fn - callback function.
   * @return {Socket} for chaining.
   */
  send(msg, options, fn) {
    this._sendPacket("message", msg, options, fn);
    return this;
  }
  /**
   * Sends a packet.
   *
   * @param {String} type: packet type.
   * @param {String} data.
   * @param {Object} options.
   * @param {Function} fn - callback function.
   * @private
   */
  _sendPacket(type, data, options, fn) {
    if ("function" === typeof data) {
      fn = data;
      data = void 0;
    }
    if ("function" === typeof options) {
      fn = options;
      options = null;
    }
    if ("closing" === this.readyState || "closed" === this.readyState) {
      return;
    }
    options = options || {};
    options.compress = false !== options.compress;
    const packet = {
      type,
      data,
      options
    };
    this.emitReserved("packetCreate", packet);
    this.writeBuffer.push(packet);
    if (fn)
      this.once("flush", fn);
    this.flush();
  }
  /**
   * Closes the connection.
   */
  close() {
    const close = () => {
      this._onClose("forced close");
      this.transport.close();
    };
    const cleanupAndClose = () => {
      this.off("upgrade", cleanupAndClose);
      this.off("upgradeError", cleanupAndClose);
      close();
    };
    const waitForUpgrade = () => {
      this.once("upgrade", cleanupAndClose);
      this.once("upgradeError", cleanupAndClose);
    };
    if ("opening" === this.readyState || "open" === this.readyState) {
      this.readyState = "closing";
      if (this.writeBuffer.length) {
        this.once("drain", () => {
          if (this.upgrading) {
            waitForUpgrade();
          } else {
            close();
          }
        });
      } else if (this.upgrading) {
        waitForUpgrade();
      } else {
        close();
      }
    }
    return this;
  }
  /**
   * Called upon transport error
   *
   * @private
   */
  _onError(err) {
    SocketWithoutUpgrade.priorWebsocketSuccess = false;
    if (this.opts.tryAllTransports && this.transports.length > 1 && this.readyState === "opening") {
      this.transports.shift();
      return this._open();
    }
    this.emitReserved("error", err);
    this._onClose("transport error", err);
  }
  /**
   * Called upon transport close.
   *
   * @private
   */
  _onClose(reason, description) {
    if ("opening" === this.readyState || "open" === this.readyState || "closing" === this.readyState) {
      this.clearTimeoutFn(this._pingTimeoutTimer);
      this.transport.removeAllListeners("close");
      this.transport.close();
      this.transport.removeAllListeners();
      if (withEventListeners) {
        if (this._beforeunloadEventListener) {
          removeEventListener("beforeunload", this._beforeunloadEventListener, false);
        }
        if (this._offlineEventListener) {
          const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);
          if (i !== -1) {
            OFFLINE_EVENT_LISTENERS.splice(i, 1);
          }
        }
      }
      this.readyState = "closed";
      this.id = null;
      this.emitReserved("close", reason, description);
      this.writeBuffer = [];
      this._prevBufferLen = 0;
    }
  }
}
SocketWithoutUpgrade.protocol = protocol$1;
class SocketWithUpgrade extends SocketWithoutUpgrade {
  constructor() {
    super(...arguments);
    this._upgrades = [];
  }
  onOpen() {
    super.onOpen();
    if ("open" === this.readyState && this.opts.upgrade) {
      for (let i = 0; i < this._upgrades.length; i++) {
        this._probe(this._upgrades[i]);
      }
    }
  }
  /**
   * Probes a transport.
   *
   * @param {String} name - transport name
   * @private
   */
  _probe(name) {
    let transport = this.createTransport(name);
    let failed = false;
    SocketWithoutUpgrade.priorWebsocketSuccess = false;
    const onTransportOpen = () => {
      if (failed)
        return;
      transport.send([{ type: "ping", data: "probe" }]);
      transport.once("packet", (msg) => {
        if (failed)
          return;
        if ("pong" === msg.type && "probe" === msg.data) {
          this.upgrading = true;
          this.emitReserved("upgrading", transport);
          if (!transport)
            return;
          SocketWithoutUpgrade.priorWebsocketSuccess = "websocket" === transport.name;
          this.transport.pause(() => {
            if (failed)
              return;
            if ("closed" === this.readyState)
              return;
            cleanup();
            this.setTransport(transport);
            transport.send([{ type: "upgrade" }]);
            this.emitReserved("upgrade", transport);
            transport = null;
            this.upgrading = false;
            this.flush();
          });
        } else {
          const err = new Error("probe error");
          err.transport = transport.name;
          this.emitReserved("upgradeError", err);
        }
      });
    };
    function freezeTransport() {
      if (failed)
        return;
      failed = true;
      cleanup();
      transport.close();
      transport = null;
    }
    const onerror = (err) => {
      const error = new Error("probe error: " + err);
      error.transport = transport.name;
      freezeTransport();
      this.emitReserved("upgradeError", error);
    };
    function onTransportClose() {
      onerror("transport closed");
    }
    function onclose() {
      onerror("socket closed");
    }
    function onupgrade(to) {
      if (transport && to.name !== transport.name) {
        freezeTransport();
      }
    }
    const cleanup = () => {
      transport.removeListener("open", onTransportOpen);
      transport.removeListener("error", onerror);
      transport.removeListener("close", onTransportClose);
      this.off("close", onclose);
      this.off("upgrading", onupgrade);
    };
    transport.once("open", onTransportOpen);
    transport.once("error", onerror);
    transport.once("close", onTransportClose);
    this.once("close", onclose);
    this.once("upgrading", onupgrade);
    if (this._upgrades.indexOf("webtransport") !== -1 && name !== "webtransport") {
      this.setTimeoutFn(() => {
        if (!failed) {
          transport.open();
        }
      }, 200);
    } else {
      transport.open();
    }
  }
  onHandshake(data) {
    this._upgrades = this._filterUpgrades(data.upgrades);
    super.onHandshake(data);
  }
  /**
   * Filters upgrades, returning only those matching client transports.
   *
   * @param {Array} upgrades - server upgrades
   * @private
   */
  _filterUpgrades(upgrades) {
    const filteredUpgrades = [];
    for (let i = 0; i < upgrades.length; i++) {
      if (~this.transports.indexOf(upgrades[i]))
        filteredUpgrades.push(upgrades[i]);
    }
    return filteredUpgrades;
  }
}
let Socket$1 = class Socket extends SocketWithUpgrade {
  constructor(uri, opts = {}) {
    const o = typeof uri === "object" ? uri : opts;
    if (!o.transports || o.transports && typeof o.transports[0] === "string") {
      o.transports = (o.transports || ["polling", "websocket", "webtransport"]).map((transportName) => transports[transportName]).filter((t) => !!t);
    }
    super(uri, o);
  }
};
function url(uri, path = "", loc) {
  let obj = uri;
  loc = loc || typeof location !== "undefined" && location;
  if (null == uri)
    uri = loc.protocol + "//" + loc.host;
  if (typeof uri === "string") {
    if ("/" === uri.charAt(0)) {
      if ("/" === uri.charAt(1)) {
        uri = loc.protocol + uri;
      } else {
        uri = loc.host + uri;
      }
    }
    if (!/^(https?|wss?):\/\//.test(uri)) {
      if ("undefined" !== typeof loc) {
        uri = loc.protocol + "//" + uri;
      } else {
        uri = "https://" + uri;
      }
    }
    obj = parse(uri);
  }
  if (!obj.port) {
    if (/^(http|ws)$/.test(obj.protocol)) {
      obj.port = "80";
    } else if (/^(http|ws)s$/.test(obj.protocol)) {
      obj.port = "443";
    }
  }
  obj.path = obj.path || "/";
  const ipv6 = obj.host.indexOf(":") !== -1;
  const host = ipv6 ? "[" + obj.host + "]" : obj.host;
  obj.id = obj.protocol + "://" + host + ":" + obj.port + path;
  obj.href = obj.protocol + "://" + host + (loc && loc.port === obj.port ? "" : ":" + obj.port);
  return obj;
}
const withNativeArrayBuffer = typeof ArrayBuffer === "function";
const isView = (obj) => {
  return typeof ArrayBuffer.isView === "function" ? ArrayBuffer.isView(obj) : obj.buffer instanceof ArrayBuffer;
};
const toString = Object.prototype.toString;
const withNativeBlob = typeof Blob === "function" || typeof Blob !== "undefined" && toString.call(Blob) === "[object BlobConstructor]";
const withNativeFile = typeof File === "function" || typeof File !== "undefined" && toString.call(File) === "[object FileConstructor]";
function isBinary(obj) {
  return withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj)) || withNativeBlob && obj instanceof Blob || withNativeFile && obj instanceof File;
}
function hasBinary(obj, toJSON) {
  if (!obj || typeof obj !== "object") {
    return false;
  }
  if (Array.isArray(obj)) {
    for (let i = 0, l = obj.length; i < l; i++) {
      if (hasBinary(obj[i])) {
        return true;
      }
    }
    return false;
  }
  if (isBinary(obj)) {
    return true;
  }
  if (obj.toJSON && typeof obj.toJSON === "function" && arguments.length === 1) {
    return hasBinary(obj.toJSON(), true);
  }
  for (const key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {
      return true;
    }
  }
  return false;
}
function deconstructPacket(packet) {
  const buffers = [];
  const packetData = packet.data;
  const pack = packet;
  pack.data = _deconstructPacket(packetData, buffers);
  pack.attachments = buffers.length;
  return { packet: pack, buffers };
}
function _deconstructPacket(data, buffers) {
  if (!data)
    return data;
  if (isBinary(data)) {
    const placeholder = { _placeholder: true, num: buffers.length };
    buffers.push(data);
    return placeholder;
  } else if (Array.isArray(data)) {
    const newData = new Array(data.length);
    for (let i = 0; i < data.length; i++) {
      newData[i] = _deconstructPacket(data[i], buffers);
    }
    return newData;
  } else if (typeof data === "object" && !(data instanceof Date)) {
    const newData = {};
    for (const key in data) {
      if (Object.prototype.hasOwnProperty.call(data, key)) {
        newData[key] = _deconstructPacket(data[key], buffers);
      }
    }
    return newData;
  }
  return data;
}
function reconstructPacket(packet, buffers) {
  packet.data = _reconstructPacket(packet.data, buffers);
  delete packet.attachments;
  return packet;
}
function _reconstructPacket(data, buffers) {
  if (!data)
    return data;
  if (data && data._placeholder === true) {
    const isIndexValid = typeof data.num === "number" && data.num >= 0 && data.num < buffers.length;
    if (isIndexValid) {
      return buffers[data.num];
    } else {
      throw new Error("illegal attachments");
    }
  } else if (Array.isArray(data)) {
    for (let i = 0; i < data.length; i++) {
      data[i] = _reconstructPacket(data[i], buffers);
    }
  } else if (typeof data === "object") {
    for (const key in data) {
      if (Object.prototype.hasOwnProperty.call(data, key)) {
        data[key] = _reconstructPacket(data[key], buffers);
      }
    }
  }
  return data;
}
const RESERVED_EVENTS$1 = [
  "connect",
  "connect_error",
  "disconnect",
  "disconnecting",
  "newListener",
  "removeListener"
  // used by the Node.js EventEmitter
];
const protocol = 5;
var PacketType;
(function(PacketType2) {
  PacketType2[PacketType2["CONNECT"] = 0] = "CONNECT";
  PacketType2[PacketType2["DISCONNECT"] = 1] = "DISCONNECT";
  PacketType2[PacketType2["EVENT"] = 2] = "EVENT";
  PacketType2[PacketType2["ACK"] = 3] = "ACK";
  PacketType2[PacketType2["CONNECT_ERROR"] = 4] = "CONNECT_ERROR";
  PacketType2[PacketType2["BINARY_EVENT"] = 5] = "BINARY_EVENT";
  PacketType2[PacketType2["BINARY_ACK"] = 6] = "BINARY_ACK";
})(PacketType || (PacketType = {}));
class Encoder {
  /**
   * Encoder constructor
   *
   * @param {function} replacer - custom replacer to pass down to JSON.parse
   */
  constructor(replacer) {
    this.replacer = replacer;
  }
  /**
   * Encode a packet as a single string if non-binary, or as a
   * buffer sequence, depending on packet type.
   *
   * @param {Object} obj - packet object
   */
  encode(obj) {
    if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {
      if (hasBinary(obj)) {
        return this.encodeAsBinary({
          type: obj.type === PacketType.EVENT ? PacketType.BINARY_EVENT : PacketType.BINARY_ACK,
          nsp: obj.nsp,
          data: obj.data,
          id: obj.id
        });
      }
    }
    return [this.encodeAsString(obj)];
  }
  /**
   * Encode packet as string.
   */
  encodeAsString(obj) {
    let str = "" + obj.type;
    if (obj.type === PacketType.BINARY_EVENT || obj.type === PacketType.BINARY_ACK) {
      str += obj.attachments + "-";
    }
    if (obj.nsp && "/" !== obj.nsp) {
      str += obj.nsp + ",";
    }
    if (null != obj.id) {
      str += obj.id;
    }
    if (null != obj.data) {
      str += JSON.stringify(obj.data, this.replacer);
    }
    return str;
  }
  /**
   * Encode packet as 'buffer sequence' by removing blobs, and
   * deconstructing packet into object with placeholders and
   * a list of buffers.
   */
  encodeAsBinary(obj) {
    const deconstruction = deconstructPacket(obj);
    const pack = this.encodeAsString(deconstruction.packet);
    const buffers = deconstruction.buffers;
    buffers.unshift(pack);
    return buffers;
  }
}
function isObject(value2) {
  return Object.prototype.toString.call(value2) === "[object Object]";
}
class Decoder extends Emitter {
  /**
   * Decoder constructor
   *
   * @param {function} reviver - custom reviver to pass down to JSON.stringify
   */
  constructor(reviver) {
    super();
    this.reviver = reviver;
  }
  /**
   * Decodes an encoded packet string into packet JSON.
   *
   * @param {String} obj - encoded packet
   */
  add(obj) {
    let packet;
    if (typeof obj === "string") {
      if (this.reconstructor) {
        throw new Error("got plaintext data when reconstructing a packet");
      }
      packet = this.decodeString(obj);
      const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;
      if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {
        packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;
        this.reconstructor = new BinaryReconstructor(packet);
        if (packet.attachments === 0) {
          super.emitReserved("decoded", packet);
        }
      } else {
        super.emitReserved("decoded", packet);
      }
    } else if (isBinary(obj) || obj.base64) {
      if (!this.reconstructor) {
        throw new Error("got binary data when not reconstructing a packet");
      } else {
        packet = this.reconstructor.takeBinaryData(obj);
        if (packet) {
          this.reconstructor = null;
          super.emitReserved("decoded", packet);
        }
      }
    } else {
      throw new Error("Unknown type: " + obj);
    }
  }
  /**
   * Decode a packet String (JSON data)
   *
   * @param {String} str
   * @return {Object} packet
   */
  decodeString(str) {
    let i = 0;
    const p = {
      type: Number(str.charAt(0))
    };
    if (PacketType[p.type] === void 0) {
      throw new Error("unknown packet type " + p.type);
    }
    if (p.type === PacketType.BINARY_EVENT || p.type === PacketType.BINARY_ACK) {
      const start = i + 1;
      while (str.charAt(++i) !== "-" && i != str.length) {
      }
      const buf = str.substring(start, i);
      if (buf != Number(buf) || str.charAt(i) !== "-") {
        throw new Error("Illegal attachments");
      }
      p.attachments = Number(buf);
    }
    if ("/" === str.charAt(i + 1)) {
      const start = i + 1;
      while (++i) {
        const c = str.charAt(i);
        if ("," === c)
          break;
        if (i === str.length)
          break;
      }
      p.nsp = str.substring(start, i);
    } else {
      p.nsp = "/";
    }
    const next2 = str.charAt(i + 1);
    if ("" !== next2 && Number(next2) == next2) {
      const start = i + 1;
      while (++i) {
        const c = str.charAt(i);
        if (null == c || Number(c) != c) {
          --i;
          break;
        }
        if (i === str.length)
          break;
      }
      p.id = Number(str.substring(start, i + 1));
    }
    if (str.charAt(++i)) {
      const payload = this.tryParse(str.substr(i));
      if (Decoder.isPayloadValid(p.type, payload)) {
        p.data = payload;
      } else {
        throw new Error("invalid payload");
      }
    }
    return p;
  }
  tryParse(str) {
    try {
      return JSON.parse(str, this.reviver);
    } catch (e) {
      return false;
    }
  }
  static isPayloadValid(type, payload) {
    switch (type) {
      case PacketType.CONNECT:
        return isObject(payload);
      case PacketType.DISCONNECT:
        return payload === void 0;
      case PacketType.CONNECT_ERROR:
        return typeof payload === "string" || isObject(payload);
      case PacketType.EVENT:
      case PacketType.BINARY_EVENT:
        return Array.isArray(payload) && (typeof payload[0] === "number" || typeof payload[0] === "string" && RESERVED_EVENTS$1.indexOf(payload[0]) === -1);
      case PacketType.ACK:
      case PacketType.BINARY_ACK:
        return Array.isArray(payload);
    }
  }
  /**
   * Deallocates a parser's resources
   */
  destroy() {
    if (this.reconstructor) {
      this.reconstructor.finishedReconstruction();
      this.reconstructor = null;
    }
  }
}
class BinaryReconstructor {
  constructor(packet) {
    this.packet = packet;
    this.buffers = [];
    this.reconPack = packet;
  }
  /**
   * Method to be called when binary data received from connection
   * after a BINARY_EVENT packet.
   *
   * @param {Buffer | ArrayBuffer} binData - the raw binary data received
   * @return {null | Object} returns null if more binary data is expected or
   *   a reconstructed packet object if all buffers have been received.
   */
  takeBinaryData(binData) {
    this.buffers.push(binData);
    if (this.buffers.length === this.reconPack.attachments) {
      const packet = reconstructPacket(this.reconPack, this.buffers);
      this.finishedReconstruction();
      return packet;
    }
    return null;
  }
  /**
   * Cleans up binary packet reconstruction variables.
   */
  finishedReconstruction() {
    this.reconPack = null;
    this.buffers = [];
  }
}
const parser = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  Decoder,
  Encoder,
  get PacketType() {
    return PacketType;
  },
  protocol
}, Symbol.toStringTag, { value: "Module" }));
function on(obj, ev, fn) {
  obj.on(ev, fn);
  return function subDestroy() {
    obj.off(ev, fn);
  };
}
const RESERVED_EVENTS = Object.freeze({
  connect: 1,
  connect_error: 1,
  disconnect: 1,
  disconnecting: 1,
  // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener
  newListener: 1,
  removeListener: 1
});
class Socket2 extends Emitter {
  /**
   * `Socket` constructor.
   */
  constructor(io, nsp, opts) {
    super();
    this.connected = false;
    this.recovered = false;
    this.receiveBuffer = [];
    this.sendBuffer = [];
    this._queue = [];
    this._queueSeq = 0;
    this.ids = 0;
    this.acks = {};
    this.flags = {};
    this.io = io;
    this.nsp = nsp;
    if (opts && opts.auth) {
      this.auth = opts.auth;
    }
    this._opts = Object.assign({}, opts);
    if (this.io._autoConnect)
      this.open();
  }
  /**
   * Whether the socket is currently disconnected
   *
   * @example
   * const socket = io();
   *
   * socket.on("connect", () => {
   *   console.log(socket.disconnected); // false
   * });
   *
   * socket.on("disconnect", () => {
   *   console.log(socket.disconnected); // true
   * });
   */
  get disconnected() {
    return !this.connected;
  }
  /**
   * Subscribe to open, close and packet events
   *
   * @private
   */
  subEvents() {
    if (this.subs)
      return;
    const io = this.io;
    this.subs = [
      on(io, "open", this.onopen.bind(this)),
      on(io, "packet", this.onpacket.bind(this)),
      on(io, "error", this.onerror.bind(this)),
      on(io, "close", this.onclose.bind(this))
    ];
  }
  /**
   * Whether the Socket will try to reconnect when its Manager connects or reconnects.
   *
   * @example
   * const socket = io();
   *
   * console.log(socket.active); // true
   *
   * socket.on("disconnect", (reason) => {
   *   if (reason === "io server disconnect") {
   *     // the disconnection was initiated by the server, you need to manually reconnect
   *     console.log(socket.active); // false
   *   }
   *   // else the socket will automatically try to reconnect
   *   console.log(socket.active); // true
   * });
   */
  get active() {
    return !!this.subs;
  }
  /**
   * "Opens" the socket.
   *
   * @example
   * const socket = io({
   *   autoConnect: false
   * });
   *
   * socket.connect();
   */
  connect() {
    if (this.connected)
      return this;
    this.subEvents();
    if (!this.io["_reconnecting"])
      this.io.open();
    if ("open" === this.io._readyState)
      this.onopen();
    return this;
  }
  /**
   * Alias for {@link connect()}.
   */
  open() {
    return this.connect();
  }
  /**
   * Sends a `message` event.
   *
   * This method mimics the WebSocket.send() method.
   *
   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send
   *
   * @example
   * socket.send("hello");
   *
   * // this is equivalent to
   * socket.emit("message", "hello");
   *
   * @return self
   */
  send(...args) {
    args.unshift("message");
    this.emit.apply(this, args);
    return this;
  }
  /**
   * Override `emit`.
   * If the event is in `events`, it's emitted normally.
   *
   * @example
   * socket.emit("hello", "world");
   *
   * // all serializable datastructures are supported (no need to call JSON.stringify)
   * socket.emit("hello", 1, "2", { 3: ["4"], 5: Uint8Array.from([6]) });
   *
   * // with an acknowledgement from the server
   * socket.emit("hello", "world", (val) => {
   *   // ...
   * });
   *
   * @return self
   */
  emit(ev, ...args) {
    var _a, _b, _c;
    if (RESERVED_EVENTS.hasOwnProperty(ev)) {
      throw new Error('"' + ev.toString() + '" is a reserved event name');
    }
    args.unshift(ev);
    if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {
      this._addToQueue(args);
      return this;
    }
    const packet = {
      type: PacketType.EVENT,
      data: args
    };
    packet.options = {};
    packet.options.compress = this.flags.compress !== false;
    if ("function" === typeof args[args.length - 1]) {
      const id = this.ids++;
      const ack = args.pop();
      this._registerAckCallback(id, ack);
      packet.id = id;
    }
    const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;
    const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());
    const discardPacket = this.flags.volatile && !isTransportWritable;
    if (discardPacket) ;
    else if (isConnected) {
      this.notifyOutgoingListeners(packet);
      this.packet(packet);
    } else {
      this.sendBuffer.push(packet);
    }
    this.flags = {};
    return this;
  }
  /**
   * @private
   */
  _registerAckCallback(id, ack) {
    var _a;
    const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;
    if (timeout === void 0) {
      this.acks[id] = ack;
      return;
    }
    const timer = this.io.setTimeoutFn(() => {
      delete this.acks[id];
      for (let i = 0; i < this.sendBuffer.length; i++) {
        if (this.sendBuffer[i].id === id) {
          this.sendBuffer.splice(i, 1);
        }
      }
      ack.call(this, new Error("operation has timed out"));
    }, timeout);
    const fn = (...args) => {
      this.io.clearTimeoutFn(timer);
      ack.apply(this, args);
    };
    fn.withError = true;
    this.acks[id] = fn;
  }
  /**
   * Emits an event and waits for an acknowledgement
   *
   * @example
   * // without timeout
   * const response = await socket.emitWithAck("hello", "world");
   *
   * // with a specific timeout
   * try {
   *   const response = await socket.timeout(1000).emitWithAck("hello", "world");
   * } catch (err) {
   *   // the server did not acknowledge the event in the given delay
   * }
   *
   * @return a Promise that will be fulfilled when the server acknowledges the event
   */
  emitWithAck(ev, ...args) {
    return new Promise((resolve, reject) => {
      const fn = (arg1, arg2) => {
        return arg1 ? reject(arg1) : resolve(arg2);
      };
      fn.withError = true;
      args.push(fn);
      this.emit(ev, ...args);
    });
  }
  /**
   * Add the packet to the queue.
   * @param args
   * @private
   */
  _addToQueue(args) {
    let ack;
    if (typeof args[args.length - 1] === "function") {
      ack = args.pop();
    }
    const packet = {
      id: this._queueSeq++,
      tryCount: 0,
      pending: false,
      args,
      flags: Object.assign({ fromQueue: true }, this.flags)
    };
    args.push((err, ...responseArgs) => {
      if (packet !== this._queue[0]) {
        return;
      }
      const hasError = err !== null;
      if (hasError) {
        if (packet.tryCount > this._opts.retries) {
          this._queue.shift();
          if (ack) {
            ack(err);
          }
        }
      } else {
        this._queue.shift();
        if (ack) {
          ack(null, ...responseArgs);
        }
      }
      packet.pending = false;
      return this._drainQueue();
    });
    this._queue.push(packet);
    this._drainQueue();
  }
  /**
   * Send the first packet of the queue, and wait for an acknowledgement from the server.
   * @param force - whether to resend a packet that has not been acknowledged yet
   *
   * @private
   */
  _drainQueue(force = false) {
    if (!this.connected || this._queue.length === 0) {
      return;
    }
    const packet = this._queue[0];
    if (packet.pending && !force) {
      return;
    }
    packet.pending = true;
    packet.tryCount++;
    this.flags = packet.flags;
    this.emit.apply(this, packet.args);
  }
  /**
   * Sends a packet.
   *
   * @param packet
   * @private
   */
  packet(packet) {
    packet.nsp = this.nsp;
    this.io._packet(packet);
  }
  /**
   * Called upon engine `open`.
   *
   * @private
   */
  onopen() {
    if (typeof this.auth == "function") {
      this.auth((data) => {
        this._sendConnectPacket(data);
      });
    } else {
      this._sendConnectPacket(this.auth);
    }
  }
  /**
   * Sends a CONNECT packet to initiate the Socket.IO session.
   *
   * @param data
   * @private
   */
  _sendConnectPacket(data) {
    this.packet({
      type: PacketType.CONNECT,
      data: this._pid ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data) : data
    });
  }
  /**
   * Called upon engine or manager `error`.
   *
   * @param err
   * @private
   */
  onerror(err) {
    if (!this.connected) {
      this.emitReserved("connect_error", err);
    }
  }
  /**
   * Called upon engine `close`.
   *
   * @param reason
   * @param description
   * @private
   */
  onclose(reason, description) {
    this.connected = false;
    delete this.id;
    this.emitReserved("disconnect", reason, description);
    this._clearAcks();
  }
  /**
   * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from
   * the server.
   *
   * @private
   */
  _clearAcks() {
    Object.keys(this.acks).forEach((id) => {
      const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);
      if (!isBuffered) {
        const ack = this.acks[id];
        delete this.acks[id];
        if (ack.withError) {
          ack.call(this, new Error("socket has been disconnected"));
        }
      }
    });
  }
  /**
   * Called with socket packet.
   *
   * @param packet
   * @private
   */
  onpacket(packet) {
    const sameNamespace = packet.nsp === this.nsp;
    if (!sameNamespace)
      return;
    switch (packet.type) {
      case PacketType.CONNECT:
        if (packet.data && packet.data.sid) {
          this.onconnect(packet.data.sid, packet.data.pid);
        } else {
          this.emitReserved("connect_error", new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));
        }
        break;
      case PacketType.EVENT:
      case PacketType.BINARY_EVENT:
        this.onevent(packet);
        break;
      case PacketType.ACK:
      case PacketType.BINARY_ACK:
        this.onack(packet);
        break;
      case PacketType.DISCONNECT:
        this.ondisconnect();
        break;
      case PacketType.CONNECT_ERROR:
        this.destroy();
        const err = new Error(packet.data.message);
        err.data = packet.data.data;
        this.emitReserved("connect_error", err);
        break;
    }
  }
  /**
   * Called upon a server event.
   *
   * @param packet
   * @private
   */
  onevent(packet) {
    const args = packet.data || [];
    if (null != packet.id) {
      args.push(this.ack(packet.id));
    }
    if (this.connected) {
      this.emitEvent(args);
    } else {
      this.receiveBuffer.push(Object.freeze(args));
    }
  }
  emitEvent(args) {
    if (this._anyListeners && this._anyListeners.length) {
      const listeners = this._anyListeners.slice();
      for (const listener of listeners) {
        listener.apply(this, args);
      }
    }
    super.emit.apply(this, args);
    if (this._pid && args.length && typeof args[args.length - 1] === "string") {
      this._lastOffset = args[args.length - 1];
    }
  }
  /**
   * Produces an ack callback to emit with an event.
   *
   * @private
   */
  ack(id) {
    const self2 = this;
    let sent = false;
    return function(...args) {
      if (sent)
        return;
      sent = true;
      self2.packet({
        type: PacketType.ACK,
        id,
        data: args
      });
    };
  }
  /**
   * Called upon a server acknowledgement.
   *
   * @param packet
   * @private
   */
  onack(packet) {
    const ack = this.acks[packet.id];
    if (typeof ack !== "function") {
      return;
    }
    delete this.acks[packet.id];
    if (ack.withError) {
      packet.data.unshift(null);
    }
    ack.apply(this, packet.data);
  }
  /**
   * Called upon server connect.
   *
   * @private
   */
  onconnect(id, pid) {
    this.id = id;
    this.recovered = pid && this._pid === pid;
    this._pid = pid;
    this.connected = true;
    this.emitBuffered();
    this.emitReserved("connect");
    this._drainQueue(true);
  }
  /**
   * Emit buffered events (received and emitted).
   *
   * @private
   */
  emitBuffered() {
    this.receiveBuffer.forEach((args) => this.emitEvent(args));
    this.receiveBuffer = [];
    this.sendBuffer.forEach((packet) => {
      this.notifyOutgoingListeners(packet);
      this.packet(packet);
    });
    this.sendBuffer = [];
  }
  /**
   * Called upon server disconnect.
   *
   * @private
   */
  ondisconnect() {
    this.destroy();
    this.onclose("io server disconnect");
  }
  /**
   * Called upon forced client/server side disconnections,
   * this method ensures the manager stops tracking us and
   * that reconnections don't get triggered for this.
   *
   * @private
   */
  destroy() {
    if (this.subs) {
      this.subs.forEach((subDestroy) => subDestroy());
      this.subs = void 0;
    }
    this.io["_destroy"](this);
  }
  /**
   * Disconnects the socket manually. In that case, the socket will not try to reconnect.
   *
   * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.
   *
   * @example
   * const socket = io();
   *
   * socket.on("disconnect", (reason) => {
   *   // console.log(reason); prints "io client disconnect"
   * });
   *
   * socket.disconnect();
   *
   * @return self
   */
  disconnect() {
    if (this.connected) {
      this.packet({ type: PacketType.DISCONNECT });
    }
    this.destroy();
    if (this.connected) {
      this.onclose("io client disconnect");
    }
    return this;
  }
  /**
   * Alias for {@link disconnect()}.
   *
   * @return self
   */
  close() {
    return this.disconnect();
  }
  /**
   * Sets the compress flag.
   *
   * @example
   * socket.compress(false).emit("hello");
   *
   * @param compress - if `true`, compresses the sending data
   * @return self
   */
  compress(compress) {
    this.flags.compress = compress;
    return this;
  }
  /**
   * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not
   * ready to send messages.
   *
   * @example
   * socket.volatile.emit("hello"); // the server may or may not receive it
   *
   * @returns self
   */
  get volatile() {
    this.flags.volatile = true;
    return this;
  }
  /**
   * Sets a modifier for a subsequent event emission that the callback will be called with an error when the
   * given number of milliseconds have elapsed without an acknowledgement from the server:
   *
   * @example
   * socket.timeout(5000).emit("my-event", (err) => {
   *   if (err) {
   *     // the server did not acknowledge the event in the given delay
   *   }
   * });
   *
   * @returns self
   */
  timeout(timeout) {
    this.flags.timeout = timeout;
    return this;
  }
  /**
   * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
   * callback.
   *
   * @example
   * socket.onAny((event, ...args) => {
   *   console.log(`got ${event}`);
   * });
   *
   * @param listener
   */
  onAny(listener) {
    this._anyListeners = this._anyListeners || [];
    this._anyListeners.push(listener);
    return this;
  }
  /**
   * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
   * callback. The listener is added to the beginning of the listeners array.
   *
   * @example
   * socket.prependAny((event, ...args) => {
   *   console.log(`got event ${event}`);
   * });
   *
   * @param listener
   */
  prependAny(listener) {
    this._anyListeners = this._anyListeners || [];
    this._anyListeners.unshift(listener);
    return this;
  }
  /**
   * Removes the listener that will be fired when any event is emitted.
   *
   * @example
   * const catchAllListener = (event, ...args) => {
   *   console.log(`got event ${event}`);
   * }
   *
   * socket.onAny(catchAllListener);
   *
   * // remove a specific listener
   * socket.offAny(catchAllListener);
   *
   * // or remove all listeners
   * socket.offAny();
   *
   * @param listener
   */
  offAny(listener) {
    if (!this._anyListeners) {
      return this;
    }
    if (listener) {
      const listeners = this._anyListeners;
      for (let i = 0; i < listeners.length; i++) {
        if (listener === listeners[i]) {
          listeners.splice(i, 1);
          return this;
        }
      }
    } else {
      this._anyListeners = [];
    }
    return this;
  }
  /**
   * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,
   * e.g. to remove listeners.
   */
  listenersAny() {
    return this._anyListeners || [];
  }
  /**
   * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
   * callback.
   *
   * Note: acknowledgements sent to the server are not included.
   *
   * @example
   * socket.onAnyOutgoing((event, ...args) => {
   *   console.log(`sent event ${event}`);
   * });
   *
   * @param listener
   */
  onAnyOutgoing(listener) {
    this._anyOutgoingListeners = this._anyOutgoingListeners || [];
    this._anyOutgoingListeners.push(listener);
    return this;
  }
  /**
   * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the
   * callback. The listener is added to the beginning of the listeners array.
   *
   * Note: acknowledgements sent to the server are not included.
   *
   * @example
   * socket.prependAnyOutgoing((event, ...args) => {
   *   console.log(`sent event ${event}`);
   * });
   *
   * @param listener
   */
  prependAnyOutgoing(listener) {
    this._anyOutgoingListeners = this._anyOutgoingListeners || [];
    this._anyOutgoingListeners.unshift(listener);
    return this;
  }
  /**
   * Removes the listener that will be fired when any event is emitted.
   *
   * @example
   * const catchAllListener = (event, ...args) => {
   *   console.log(`sent event ${event}`);
   * }
   *
   * socket.onAnyOutgoing(catchAllListener);
   *
   * // remove a specific listener
   * socket.offAnyOutgoing(catchAllListener);
   *
   * // or remove all listeners
   * socket.offAnyOutgoing();
   *
   * @param [listener] - the catch-all listener (optional)
   */
  offAnyOutgoing(listener) {
    if (!this._anyOutgoingListeners) {
      return this;
    }
    if (listener) {
      const listeners = this._anyOutgoingListeners;
      for (let i = 0; i < listeners.length; i++) {
        if (listener === listeners[i]) {
          listeners.splice(i, 1);
          return this;
        }
      }
    } else {
      this._anyOutgoingListeners = [];
    }
    return this;
  }
  /**
   * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,
   * e.g. to remove listeners.
   */
  listenersAnyOutgoing() {
    return this._anyOutgoingListeners || [];
  }
  /**
   * Notify the listeners for each packet sent
   *
   * @param packet
   *
   * @private
   */
  notifyOutgoingListeners(packet) {
    if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {
      const listeners = this._anyOutgoingListeners.slice();
      for (const listener of listeners) {
        listener.apply(this, packet.data);
      }
    }
  }
}
function Backoff(opts) {
  opts = opts || {};
  this.ms = opts.min || 100;
  this.max = opts.max || 1e4;
  this.factor = opts.factor || 2;
  this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;
  this.attempts = 0;
}
Backoff.prototype.duration = function() {
  var ms = this.ms * Math.pow(this.factor, this.attempts++);
  if (this.jitter) {
    var rand = Math.random();
    var deviation = Math.floor(rand * this.jitter * ms);
    ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;
  }
  return Math.min(ms, this.max) | 0;
};
Backoff.prototype.reset = function() {
  this.attempts = 0;
};
Backoff.prototype.setMin = function(min) {
  this.ms = min;
};
Backoff.prototype.setMax = function(max) {
  this.max = max;
};
Backoff.prototype.setJitter = function(jitter) {
  this.jitter = jitter;
};
class Manager extends Emitter {
  constructor(uri, opts) {
    var _a;
    super();
    this.nsps = {};
    this.subs = [];
    if (uri && "object" === typeof uri) {
      opts = uri;
      uri = void 0;
    }
    opts = opts || {};
    opts.path = opts.path || "/socket.io";
    this.opts = opts;
    installTimerFunctions(this, opts);
    this.reconnection(opts.reconnection !== false);
    this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);
    this.reconnectionDelay(opts.reconnectionDelay || 1e3);
    this.reconnectionDelayMax(opts.reconnectionDelayMax || 5e3);
    this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);
    this.backoff = new Backoff({
      min: this.reconnectionDelay(),
      max: this.reconnectionDelayMax(),
      jitter: this.randomizationFactor()
    });
    this.timeout(null == opts.timeout ? 2e4 : opts.timeout);
    this._readyState = "closed";
    this.uri = uri;
    const _parser = opts.parser || parser;
    this.encoder = new _parser.Encoder();
    this.decoder = new _parser.Decoder();
    this._autoConnect = opts.autoConnect !== false;
    if (this._autoConnect)
      this.open();
  }
  reconnection(v) {
    if (!arguments.length)
      return this._reconnection;
    this._reconnection = !!v;
    if (!v) {
      this.skipReconnect = true;
    }
    return this;
  }
  reconnectionAttempts(v) {
    if (v === void 0)
      return this._reconnectionAttempts;
    this._reconnectionAttempts = v;
    return this;
  }
  reconnectionDelay(v) {
    var _a;
    if (v === void 0)
      return this._reconnectionDelay;
    this._reconnectionDelay = v;
    (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);
    return this;
  }
  randomizationFactor(v) {
    var _a;
    if (v === void 0)
      return this._randomizationFactor;
    this._randomizationFactor = v;
    (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);
    return this;
  }
  reconnectionDelayMax(v) {
    var _a;
    if (v === void 0)
      return this._reconnectionDelayMax;
    this._reconnectionDelayMax = v;
    (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);
    return this;
  }
  timeout(v) {
    if (!arguments.length)
      return this._timeout;
    this._timeout = v;
    return this;
  }
  /**
   * Starts trying to reconnect if reconnection is enabled and we have not
   * started reconnecting yet
   *
   * @private
   */
  maybeReconnectOnOpen() {
    if (!this._reconnecting && this._reconnection && this.backoff.attempts === 0) {
      this.reconnect();
    }
  }
  /**
   * Sets the current transport `socket`.
   *
   * @param {Function} fn - optional, callback
   * @return self
   * @public
   */
  open(fn) {
    if (~this._readyState.indexOf("open"))
      return this;
    this.engine = new Socket$1(this.uri, this.opts);
    const socket = this.engine;
    const self2 = this;
    this._readyState = "opening";
    this.skipReconnect = false;
    const openSubDestroy = on(socket, "open", function() {
      self2.onopen();
      fn && fn();
    });
    const onError = (err) => {
      this.cleanup();
      this._readyState = "closed";
      this.emitReserved("error", err);
      if (fn) {
        fn(err);
      } else {
        this.maybeReconnectOnOpen();
      }
    };
    const errorSub = on(socket, "error", onError);
    if (false !== this._timeout) {
      const timeout = this._timeout;
      const timer = this.setTimeoutFn(() => {
        openSubDestroy();
        onError(new Error("timeout"));
        socket.close();
      }, timeout);
      if (this.opts.autoUnref) {
        timer.unref();
      }
      this.subs.push(() => {
        this.clearTimeoutFn(timer);
      });
    }
    this.subs.push(openSubDestroy);
    this.subs.push(errorSub);
    return this;
  }
  /**
   * Alias for open()
   *
   * @return self
   * @public
   */
  connect(fn) {
    return this.open(fn);
  }
  /**
   * Called upon transport open.
   *
   * @private
   */
  onopen() {
    this.cleanup();
    this._readyState = "open";
    this.emitReserved("open");
    const socket = this.engine;
    this.subs.push(
      on(socket, "ping", this.onping.bind(this)),
      on(socket, "data", this.ondata.bind(this)),
      on(socket, "error", this.onerror.bind(this)),
      on(socket, "close", this.onclose.bind(this)),
      // @ts-ignore
      on(this.decoder, "decoded", this.ondecoded.bind(this))
    );
  }
  /**
   * Called upon a ping.
   *
   * @private
   */
  onping() {
    this.emitReserved("ping");
  }
  /**
   * Called with data.
   *
   * @private
   */
  ondata(data) {
    try {
      this.decoder.add(data);
    } catch (e) {
      this.onclose("parse error", e);
    }
  }
  /**
   * Called when parser fully decodes a packet.
   *
   * @private
   */
  ondecoded(packet) {
    nextTick(() => {
      this.emitReserved("packet", packet);
    }, this.setTimeoutFn);
  }
  /**
   * Called upon socket error.
   *
   * @private
   */
  onerror(err) {
    this.emitReserved("error", err);
  }
  /**
   * Creates a new socket for the given `nsp`.
   *
   * @return {Socket}
   * @public
   */
  socket(nsp, opts) {
    let socket = this.nsps[nsp];
    if (!socket) {
      socket = new Socket2(this, nsp, opts);
      this.nsps[nsp] = socket;
    } else if (this._autoConnect && !socket.active) {
      socket.connect();
    }
    return socket;
  }
  /**
   * Called upon a socket close.
   *
   * @param socket
   * @private
   */
  _destroy(socket) {
    const nsps = Object.keys(this.nsps);
    for (const nsp of nsps) {
      const socket2 = this.nsps[nsp];
      if (socket2.active) {
        return;
      }
    }
    this._close();
  }
  /**
   * Writes a packet.
   *
   * @param packet
   * @private
   */
  _packet(packet) {
    const encodedPackets = this.encoder.encode(packet);
    for (let i = 0; i < encodedPackets.length; i++) {
      this.engine.write(encodedPackets[i], packet.options);
    }
  }
  /**
   * Clean up transport subscriptions and packet buffer.
   *
   * @private
   */
  cleanup() {
    this.subs.forEach((subDestroy) => subDestroy());
    this.subs.length = 0;
    this.decoder.destroy();
  }
  /**
   * Close the current socket.
   *
   * @private
   */
  _close() {
    this.skipReconnect = true;
    this._reconnecting = false;
    this.onclose("forced close");
  }
  /**
   * Alias for close()
   *
   * @private
   */
  disconnect() {
    return this._close();
  }
  /**
   * Called when:
   *
   * - the low-level engine is closed
   * - the parser encountered a badly formatted packet
   * - all sockets are disconnected
   *
   * @private
   */
  onclose(reason, description) {
    var _a;
    this.cleanup();
    (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();
    this.backoff.reset();
    this._readyState = "closed";
    this.emitReserved("close", reason, description);
    if (this._reconnection && !this.skipReconnect) {
      this.reconnect();
    }
  }
  /**
   * Attempt a reconnection.
   *
   * @private
   */
  reconnect() {
    if (this._reconnecting || this.skipReconnect)
      return this;
    const self2 = this;
    if (this.backoff.attempts >= this._reconnectionAttempts) {
      this.backoff.reset();
      this.emitReserved("reconnect_failed");
      this._reconnecting = false;
    } else {
      const delay = this.backoff.duration();
      this._reconnecting = true;
      const timer = this.setTimeoutFn(() => {
        if (self2.skipReconnect)
          return;
        this.emitReserved("reconnect_attempt", self2.backoff.attempts);
        if (self2.skipReconnect)
          return;
        self2.open((err) => {
          if (err) {
            self2._reconnecting = false;
            self2.reconnect();
            this.emitReserved("reconnect_error", err);
          } else {
            self2.onreconnect();
          }
        });
      }, delay);
      if (this.opts.autoUnref) {
        timer.unref();
      }
      this.subs.push(() => {
        this.clearTimeoutFn(timer);
      });
    }
  }
  /**
   * Called upon successful reconnect.
   *
   * @private
   */
  onreconnect() {
    const attempt = this.backoff.attempts;
    this._reconnecting = false;
    this.backoff.reset();
    this.emitReserved("reconnect", attempt);
  }
}
const cache = {};
function lookup(uri, opts) {
  if (typeof uri === "object") {
    opts = uri;
    uri = void 0;
  }
  opts = opts || {};
  const parsed = url(uri, opts.path || "/socket.io");
  const source = parsed.source;
  const id = parsed.id;
  const path = parsed.path;
  const sameNamespace = cache[id] && path in cache[id]["nsps"];
  const newConnection = opts.forceNew || opts["force new connection"] || false === opts.multiplex || sameNamespace;
  let io;
  if (newConnection) {
    io = new Manager(source, opts);
  } else {
    if (!cache[id]) {
      cache[id] = new Manager(source, opts);
    }
    io = cache[id];
  }
  if (parsed.query && !opts.query) {
    opts.query = parsed.queryKey;
  }
  return io.socket(parsed.path, opts);
}
Object.assign(lookup, {
  Manager,
  Socket: Socket2,
  io: lookup,
  connect: lookup
});
var root_2$5 = from_html(`<div class="absolute top-0 bottom-0 left-0 right-0 opacity-60 bg-white dark:bg-gray-900 z-10"></div>`);
var root_4$6 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4"><path d="M11.644 1.59a.75.75 0 0 1 .712 0l9.75 5.25a.75.75 0 0 1 0 1.32l-9.75 5.25a.75.75 0 0 1-.712 0l-9.75-5.25a.75.75 0 0 1 0-1.32l9.75-5.25Z"></path><path d="m3.265 10.602 7.668 4.129a2.25 2.25 0 0 0 2.134 0l7.668-4.13 1.37.739a.75.75 0 0 1 0 1.32l-9.75 5.25a.75.75 0 0 1-.71 0l-9.75-5.25a.75.75 0 0 1 0-1.32l1.37-.738Z"></path><path d="m10.933 19.231-7.668-4.13-1.37.739a.75.75 0 0 0 0 1.32l9.75 5.25c.221.12.489.12.71 0l9.75-5.25a.75.75 0 0 0 0-1.32l-1.37-.738-7.668 4.13a2.25 2.25 0 0 1-2.134-.001Z"></path></svg>`);
var root_3$5 = from_html(`<div class=" absolute top-0.5 right-2.5"><!></div>`);
var root_1$8 = from_html(`<!> <div class="flex w-full gap-2"><div class="flex-1 relative"><input autocomplete="off"/> <!></div></div>`, 1);
var root_5$3 = from_html(`<button class="self-center p-1 bg-transparent hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-850 rounded-lg transition" type="button"><!></button>`);
var root$9 = from_html(`<!> <!> <div class="flex w-full gap-2 items-center"><!> <div class="flex gap-1"><!></div></div>`, 1);
function OpenAIConnection($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let onDelete = prop($$props, "onDelete", 8, () => {
  });
  let onSubmit = prop($$props, "onSubmit", 8, () => {
  });
  let pipeline = prop($$props, "pipeline", 8, false);
  let url2 = prop($$props, "url", 12, "");
  let key = prop($$props, "key", 12, "");
  let config2 = prop($$props, "config", 28, () => ({}));
  let showConfigModal = mutable_source(false);
  let showDeleteConfirmDialog = mutable_source(false);
  init();
  var fragment = root$9();
  var node = first_child(fragment);
  ConfirmDialog(node, {
    get show() {
      return get(showDeleteConfirmDialog);
    },
    set show($$value) {
      set(showDeleteConfirmDialog, $$value);
    },
    $$events: {
      confirm: () => {
        onDelete()();
      }
    },
    $$legacy: true
  });
  var node_1 = sibling(node, 2);
  {
    let $0 = derived_safe_equal(() => ({ url: url2(), key: key(), config: config2() }));
    AddConnectionModal(node_1, {
      edit: true,
      get connection() {
        return get($0);
      },
      onDelete: () => {
        set(showDeleteConfirmDialog, true);
      },
      onSubmit: (connection) => {
        url2(connection.url);
        key(connection.key);
        config2(connection.config);
        onSubmit()(connection);
      },
      get show() {
        return get(showConfigModal);
      },
      set show($$value) {
        set(showConfigModal, $$value);
      },
      $$legacy: true
    });
  }
  var div = sibling(node_1, 2);
  var node_2 = child(div);
  {
    let $0 = derived_safe_equal(() => ($i18n(), deep_read_state(url2()), untrack(() => $i18n().t(`WebUI will make requests to "{{url}}/chat/completions"`, { url: url2() }))));
    Tooltip(node_2, {
      className: "w-full relative",
      get content() {
        return get($0);
      },
      placement: "top-start",
      children: ($$anchor2, $$slotProps) => {
        var fragment_1 = root_1$8();
        var node_3 = first_child(fragment_1);
        {
          var consequent = ($$anchor3) => {
            var div_1 = root_2$5();
            append($$anchor3, div_1);
          };
          if_block(node_3, ($$render) => {
            if (deep_read_state(config2()), untrack(() => {
              var _a;
              return !(((_a = config2()) == null ? void 0 : _a.enable) ?? true);
            })) $$render(consequent);
          });
        }
        var div_2 = sibling(node_3, 2);
        var div_3 = child(div_2);
        var input = child(div_3);
        remove_input_defaults(input);
        input.readOnly = true;
        var node_4 = sibling(input, 2);
        {
          var consequent_1 = ($$anchor3) => {
            var div_4 = root_3$5();
            var node_5 = child(div_4);
            Tooltip(node_5, {
              content: "Pipelines",
              children: ($$anchor4, $$slotProps2) => {
                var svg = root_4$6();
                append($$anchor4, svg);
              },
              $$slots: { default: true }
            });
            reset(div_4);
            append($$anchor3, div_4);
          };
          if_block(node_4, ($$render) => {
            if (pipeline()) $$render(consequent_1);
          });
        }
        reset(div_3);
        reset(div_2);
        template_effect(
          ($02) => {
            set_class(input, 1, ` outline-hidden w-full bg-transparent ${pipeline() ? "pr-8" : ""}`);
            set_attribute(input, "placeholder", $02);
          },
          [() => ($i18n(), untrack(() => $i18n().t("API Base URL")))]
        );
        bind_value(input, url2);
        append($$anchor2, fragment_1);
      },
      $$slots: { default: true }
    });
  }
  var div_5 = sibling(node_2, 2);
  var node_6 = child(div_5);
  {
    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Configure"))));
    Tooltip(node_6, {
      get content() {
        return get($0);
      },
      className: "self-start",
      children: ($$anchor2, $$slotProps) => {
        var button = root_5$3();
        var node_7 = child(button);
        Cog6(node_7, {});
        reset(button);
        event("click", button, () => {
          set(showConfigModal, true);
        });
        append($$anchor2, button);
      },
      $$slots: { default: true }
    });
  }
  reset(div_5);
  reset(div);
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_1$7 = from_html(`<div><div class=" flex justify-between dark:text-gray-100 px-5 pt-4 pb-2"><div class="flex w-full justify-between items-center text-lg font-medium self-center font-primary"><div class=" shrink-0"> </div></div> <button class="self-center"><!></button></div> <div class="flex flex-col md:flex-row w-full px-5 pb-4 md:space-x-4 dark:text-gray-200"><!></div></div>`);
function ManageOllamaModal($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let show = prop($$props, "show", 12, false);
  let urlIdx = prop($$props, "urlIdx", 8, null);
  init();
  Modal($$anchor, {
    size: "sm",
    get show() {
      return show();
    },
    set show($$value) {
      show($$value);
    },
    children: ($$anchor2, $$slotProps) => {
      var div = root_1$7();
      var div_1 = child(div);
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text2 = child(div_3, true);
      reset(div_3);
      reset(div_2);
      var button = sibling(div_2, 2);
      var node = child(button);
      XMark(node, { className: "size-5" });
      reset(button);
      reset(div_1);
      var div_4 = sibling(div_1, 2);
      var node_1 = child(div_4);
      ManageOllama(node_1, {
        get urlIdx() {
          return urlIdx();
        }
      });
      reset(div_4);
      reset(div);
      template_effect(($0) => set_text(text2, $0), [() => ($i18n(), untrack(() => $i18n().t("Manage Ollama")))]);
      event("click", button, () => {
        show(false);
      });
      append($$anchor2, div);
    },
    $$slots: { default: true },
    $$legacy: true
  });
  pop();
  $$cleanup();
}
var root_2$4 = from_html(`<div class="absolute top-0 bottom-0 left-0 right-0 opacity-60 bg-white dark:bg-gray-900 z-10"></div>`);
var root_1$6 = from_html(`<!> <input class="w-full text-sm bg-transparent outline-hidden"/>`, 1);
var root_3$4 = from_html(`<button class="self-center p-1 bg-transparent hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-850 rounded-lg transition" type="button"><!></button>`);
var root_4$5 = from_html(`<button class="self-center p-1 bg-transparent hover:bg-gray-100 dark:bg-gray-900 dark:hover:bg-gray-850 rounded-lg transition" type="button"><!></button>`);
var root$8 = from_html(`<!> <!> <!> <div class="flex gap-1.5"><!> <div class="flex gap-1"><!> <!></div></div>`, 1);
function OllamaConnection($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let onDelete = prop($$props, "onDelete", 8, () => {
  });
  let onSubmit = prop($$props, "onSubmit", 8, () => {
  });
  let url2 = prop($$props, "url", 12, "");
  let idx = prop($$props, "idx", 8, 0);
  let config2 = prop($$props, "config", 28, () => ({}));
  let showManageModal = mutable_source(false);
  let showConfigModal = mutable_source(false);
  let showDeleteConfirmDialog = mutable_source(false);
  init();
  var fragment = root$8();
  var node = first_child(fragment);
  {
    let $0 = derived_safe_equal(() => (deep_read_state(url2()), deep_read_state(config2()), untrack(() => {
      var _a;
      return { url: url2(), key: ((_a = config2()) == null ? void 0 : _a.key) ?? "", config: config2() };
    })));
    AddConnectionModal(node, {
      ollama: true,
      edit: true,
      get connection() {
        return get($0);
      },
      onDelete: () => {
        set(showDeleteConfirmDialog, true);
      },
      onSubmit: (connection) => {
        url2(connection.url);
        config2({ ...connection.config, key: connection.key });
        onSubmit()(connection);
      },
      get show() {
        return get(showConfigModal);
      },
      set show($$value) {
        set(showConfigModal, $$value);
      },
      $$legacy: true
    });
  }
  var node_1 = sibling(node, 2);
  ConfirmDialog(node_1, {
    get show() {
      return get(showDeleteConfirmDialog);
    },
    set show($$value) {
      set(showDeleteConfirmDialog, $$value);
    },
    $$events: {
      confirm: () => {
        onDelete()();
        set(showConfigModal, false);
      }
    },
    $$legacy: true
  });
  var node_2 = sibling(node_1, 2);
  ManageOllamaModal(node_2, {
    get urlIdx() {
      return idx();
    },
    get show() {
      return get(showManageModal);
    },
    set show($$value) {
      set(showManageModal, $$value);
    },
    $$legacy: true
  });
  var div = sibling(node_2, 2);
  var node_3 = child(div);
  {
    let $0 = derived_safe_equal(() => ($i18n(), deep_read_state(url2()), untrack(() => $i18n().t(`WebUI will make requests to "{{url}}/api/chat"`, { url: url2() }))));
    Tooltip(node_3, {
      className: "w-full relative",
      get content() {
        return get($0);
      },
      placement: "top-start",
      children: ($$anchor2, $$slotProps) => {
        var fragment_1 = root_1$6();
        var node_4 = first_child(fragment_1);
        {
          var consequent = ($$anchor3) => {
            var div_1 = root_2$4();
            append($$anchor3, div_1);
          };
          if_block(node_4, ($$render) => {
            if (deep_read_state(config2()), untrack(() => {
              var _a;
              return !(((_a = config2()) == null ? void 0 : _a.enable) ?? true);
            })) $$render(consequent);
          });
        }
        var input = sibling(node_4, 2);
        remove_input_defaults(input);
        input.readOnly = true;
        template_effect(($02) => set_attribute(input, "placeholder", $02), [
          () => ($i18n(), untrack(() => $i18n().t("Enter URL (e.g. http://localhost:11434)")))
        ]);
        bind_value(input, url2);
        append($$anchor2, fragment_1);
      },
      $$slots: { default: true }
    });
  }
  var div_2 = sibling(node_3, 2);
  var node_5 = child(div_2);
  {
    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Manage"))));
    Tooltip(node_5, {
      get content() {
        return get($0);
      },
      className: "self-start",
      children: ($$anchor2, $$slotProps) => {
        var button = root_3$4();
        var node_6 = child(button);
        Download(node_6, {});
        reset(button);
        event("click", button, () => {
          set(showManageModal, true);
        });
        append($$anchor2, button);
      },
      $$slots: { default: true }
    });
  }
  var node_7 = sibling(node_5, 2);
  {
    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Configure"))));
    Tooltip(node_7, {
      get content() {
        return get($0);
      },
      className: "self-start",
      children: ($$anchor2, $$slotProps) => {
        var button_1 = root_4$5();
        var node_8 = child(button_1);
        Cog6(node_8, {});
        reset(button_1);
        event("click", button_1, () => {
          set(showConfigModal, true);
        });
        append($$anchor2, button_1);
      },
      $$slots: { default: true }
    });
  }
  reset(div_2);
  reset(div);
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_3$3 = from_html(`<button class="px-1" type="button"><!></button>`);
var root_2$3 = from_html(`<div><div class="flex justify-between items-center"><div class="font-medium text-xs"> </div> <!></div> <div class="flex flex-col gap-1.5 mt-1.5"></div></div>`);
var root_6$1 = from_html(`<button class="px-1" type="button"><!></button>`);
var root_5$2 = from_html(`<div><div class="flex justify-between items-center"><div class="font-medium text-xs"> </div> <!></div> <div class="flex w-full gap-1.5"><div class="flex-1 flex flex-col gap-1.5 mt-1.5"></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> <a class=" text-gray-300 font-medium underline" href="https://github.com/open-webui/open-webui#troubleshooting" target="_blank"> </a></div></div>`);
var root_1$5 = from_html(`<div class="mb-3.5"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="my-2"><div class="mt-2 space-y-2"><div class="flex justify-between items-center text-sm"><div class="  font-medium"> </div> <div class="flex items-center"><div><!></div></div></div> <!></div></div> <div class=" my-2"><div class="flex justify-between items-center text-sm mb-2"><div class="  font-medium"> </div> <div class="mt-1"><!></div></div> <!></div> <div class="my-2"><div class="flex justify-between items-center text-sm"><div class="  font-medium"> </div> <div class="flex items-center"><div><!></div></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> </div></div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="my-2"><div class="flex justify-between items-center text-sm"><div class=" text-xs font-medium"> </div> <div class="flex items-center"><div><!></div></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> </div></div></div>`);
var root_8$3 = from_html(`<div class="flex h-full justify-center"><div class="my-auto"><!></div></div>`);
var root$7 = from_html(`<!> <!> <form class="flex flex-col h-full justify-between text-sm"><div class=" overflow-y-scroll scrollbar-hidden h-full"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`, 1);
function Connections($$anchor, $$props) {
  push($$props, false);
  const $config = () => store_get(config, "$config", $$stores);
  const $settings = () => store_get(settings, "$settings", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $user = () => store_get(user, "$user", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const dispatch = createEventDispatcher();
  const i18n = getContext("i18n");
  const getModels$12 = async () => {
    var _a, _b, _c;
    const models2 = await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null), false, true);
    return models2;
  };
  let OLLAMA_BASE_URLS = mutable_source([""]);
  let OLLAMA_API_CONFIGS = mutable_source({});
  let OPENAI_API_KEYS = mutable_source([""]);
  let OPENAI_API_BASE_URLS = mutable_source([""]);
  let OPENAI_API_CONFIGS = mutable_source({});
  let ENABLE_OPENAI_API = mutable_source(null);
  let ENABLE_OLLAMA_API = mutable_source(null);
  let connectionsConfig = mutable_source(null);
  let pipelineUrls = mutable_source({});
  let showAddOpenAIConnectionModal = mutable_source(false);
  let showAddOllamaConnectionModal = mutable_source(false);
  const updateOpenAIHandler = async () => {
    if (get(ENABLE_OPENAI_API) !== null) {
      set(OPENAI_API_BASE_URLS, get(OPENAI_API_BASE_URLS).map((url2) => url2.replace(/\/$/, "")));
      if (get(OPENAI_API_KEYS).length !== get(OPENAI_API_BASE_URLS).length) {
        if (get(OPENAI_API_KEYS).length > get(OPENAI_API_BASE_URLS).length) {
          set(OPENAI_API_KEYS, get(OPENAI_API_KEYS).slice(0, get(OPENAI_API_BASE_URLS).length));
        }
        if (get(OPENAI_API_KEYS).length < get(OPENAI_API_BASE_URLS).length) {
          const diff = get(OPENAI_API_BASE_URLS).length - get(OPENAI_API_KEYS).length;
          for (let i = 0; i < diff; i++) {
            get(OPENAI_API_KEYS).push("");
          }
        }
      }
      const res = await updateOpenAIConfig(localStorage.token, {
        ENABLE_OPENAI_API: get(ENABLE_OPENAI_API),
        OPENAI_API_BASE_URLS: get(OPENAI_API_BASE_URLS),
        OPENAI_API_KEYS: get(OPENAI_API_KEYS),
        OPENAI_API_CONFIGS: get(OPENAI_API_CONFIGS)
      }).catch((error) => {
        toast.error(`${error}`);
      });
      if (res) {
        toast.success($i18n().t("OpenAI API settings updated"));
        await models.set(await getModels$12());
      }
    }
  };
  const updateOllamaHandler = async () => {
    if (get(ENABLE_OLLAMA_API) !== null) {
      set(OLLAMA_BASE_URLS, get(OLLAMA_BASE_URLS).map((url2) => url2.replace(/\/$/, "")));
      const res = await updateOllamaConfig(localStorage.token, {
        ENABLE_OLLAMA_API: get(ENABLE_OLLAMA_API),
        OLLAMA_BASE_URLS: get(OLLAMA_BASE_URLS),
        OLLAMA_API_CONFIGS: get(OLLAMA_API_CONFIGS)
      }).catch((error) => {
        toast.error(`${error}`);
      });
      if (res) {
        toast.success($i18n().t("Ollama API settings updated"));
        await models.set(await getModels$12());
      }
    }
  };
  const updateConnectionsHandler = async () => {
    const res = await setConnectionsConfig(localStorage.token, get(connectionsConfig)).catch((error) => {
      toast.error(`${error}`);
    });
    if (res) {
      toast.success($i18n().t("Connections settings updated"));
      await models.set(await getModels$12());
      await config.set(await getBackendConfig());
    }
  };
  const addOpenAIConnectionHandler = async (connection) => {
    set(OPENAI_API_BASE_URLS, [...get(OPENAI_API_BASE_URLS), connection.url]);
    set(OPENAI_API_KEYS, [...get(OPENAI_API_KEYS), connection.key]);
    mutate(OPENAI_API_CONFIGS, get(OPENAI_API_CONFIGS)[get(OPENAI_API_BASE_URLS).length - 1] = connection.config);
    await updateOpenAIHandler();
  };
  const addOllamaConnectionHandler = async (connection) => {
    set(OLLAMA_BASE_URLS, [...get(OLLAMA_BASE_URLS), connection.url]);
    mutate(OLLAMA_API_CONFIGS, get(OLLAMA_API_CONFIGS)[get(OLLAMA_BASE_URLS).length - 1] = { ...connection.config, key: connection.key });
    await updateOllamaHandler();
  };
  onMount(async () => {
    var _a;
    if (((_a = $user()) == null ? void 0 : _a.role) === "admin") {
      let ollamaConfig = {};
      let openaiConfig = {};
      await Promise.all([
        (async () => {
          ollamaConfig = await getOllamaConfig(localStorage.token);
        })(),
        (async () => {
          openaiConfig = await getOpenAIConfig(localStorage.token);
        })(),
        (async () => {
          set(connectionsConfig, await getConnectionsConfig(localStorage.token));
        })()
      ]);
      set(ENABLE_OPENAI_API, openaiConfig.ENABLE_OPENAI_API);
      set(ENABLE_OLLAMA_API, ollamaConfig.ENABLE_OLLAMA_API);
      set(OPENAI_API_BASE_URLS, openaiConfig.OPENAI_API_BASE_URLS);
      set(OPENAI_API_KEYS, openaiConfig.OPENAI_API_KEYS);
      set(OPENAI_API_CONFIGS, openaiConfig.OPENAI_API_CONFIGS);
      set(OLLAMA_BASE_URLS, ollamaConfig.OLLAMA_BASE_URLS);
      set(OLLAMA_API_CONFIGS, ollamaConfig.OLLAMA_API_CONFIGS);
      if (get(ENABLE_OPENAI_API)) {
        for (const [idx, url2] of get(OPENAI_API_BASE_URLS).entries()) {
          if (!get(OPENAI_API_CONFIGS)[idx]) {
            mutate(OPENAI_API_CONFIGS, get(OPENAI_API_CONFIGS)[idx] = get(OPENAI_API_CONFIGS)[url2] || {});
          }
        }
        get(OPENAI_API_BASE_URLS).forEach(async (url2, idx) => {
          var _a2;
          mutate(OPENAI_API_CONFIGS, get(OPENAI_API_CONFIGS)[idx] = get(OPENAI_API_CONFIGS)[idx] || {});
          if (!(((_a2 = get(OPENAI_API_CONFIGS)[idx]) == null ? void 0 : _a2.enable) ?? true)) {
            return;
          }
          const res = await getOpenAIModels(localStorage.token, idx);
          if (res.pipelines) {
            mutate(pipelineUrls, get(pipelineUrls)[url2] = true);
          }
        });
      }
      if (get(ENABLE_OLLAMA_API)) {
        for (const [idx, url2] of get(OLLAMA_BASE_URLS).entries()) {
          if (!get(OLLAMA_API_CONFIGS)[idx]) {
            mutate(OLLAMA_API_CONFIGS, get(OLLAMA_API_CONFIGS)[idx] = get(OLLAMA_API_CONFIGS)[url2] || {});
          }
        }
      }
    }
  });
  const submitHandler = async () => {
    updateOpenAIHandler();
    updateOllamaHandler();
    dispatch("save");
    await config.set(await getBackendConfig());
  };
  init();
  var fragment = root$7();
  var node = first_child(fragment);
  AddConnectionModal(node, {
    onSubmit: addOpenAIConnectionHandler,
    get show() {
      return get(showAddOpenAIConnectionModal);
    },
    set show($$value) {
      set(showAddOpenAIConnectionModal, $$value);
    },
    $$legacy: true
  });
  var node_1 = sibling(node, 2);
  AddConnectionModal(node_1, {
    ollama: true,
    onSubmit: addOllamaConnectionHandler,
    get show() {
      return get(showAddOllamaConnectionModal);
    },
    set show($$value) {
      set(showAddOllamaConnectionModal, $$value);
    },
    $$legacy: true
  });
  var form = sibling(node_1, 2);
  var div = child(form);
  var node_2 = child(div);
  {
    var consequent_2 = ($$anchor2) => {
      var div_1 = root_1$5();
      var div_2 = child(div_1);
      var text2 = child(div_2, true);
      reset(div_2);
      var div_3 = sibling(div_2, 4);
      var div_4 = child(div_3);
      var div_5 = child(div_4);
      var div_6 = child(div_5);
      var text_1 = child(div_6, true);
      reset(div_6);
      var div_7 = sibling(div_6, 2);
      var div_8 = child(div_7);
      var node_3 = child(div_8);
      Switch_1(node_3, {
        get state() {
          return get(ENABLE_OPENAI_API);
        },
        set state($$value) {
          set(ENABLE_OPENAI_API, $$value);
        },
        $$events: {
          change: async () => {
            updateOpenAIHandler();
          }
        },
        $$legacy: true
      });
      reset(div_8);
      reset(div_7);
      reset(div_5);
      var node_4 = sibling(div_5, 2);
      {
        var consequent = ($$anchor3) => {
          var div_9 = root_2$3();
          var div_10 = child(div_9);
          var div_11 = child(div_10);
          var text_2 = child(div_11, true);
          reset(div_11);
          var node_5 = sibling(div_11, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t(`Add Connection`));
            Tooltip(node_5, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var button = root_3$3();
                var node_6 = child(button);
                Plus(node_6, {});
                reset(button);
                event("click", button, () => {
                  set(showAddOpenAIConnectionModal, true);
                });
                append($$anchor4, button);
              },
              $$slots: { default: true }
            });
          }
          reset(div_10);
          var div_12 = sibling(div_10, 2);
          each(div_12, 5, () => get(OPENAI_API_BASE_URLS), index, ($$anchor4, url2, idx) => {
            {
              let $0 = derived_safe_equal(() => get(pipelineUrls)[get(url2)] ? true : false);
              OpenAIConnection($$anchor4, {
                get pipeline() {
                  return get($0);
                },
                onSubmit: () => {
                  updateOpenAIHandler();
                },
                onDelete: () => {
                  set(OPENAI_API_BASE_URLS, get(OPENAI_API_BASE_URLS).filter((url3, urlIdx) => idx !== urlIdx));
                  set(OPENAI_API_KEYS, get(OPENAI_API_KEYS).filter((key, keyIdx) => idx !== keyIdx));
                  let newConfig = {};
                  get(OPENAI_API_BASE_URLS).forEach((url3, newIdx) => {
                    newConfig[newIdx] = get(OPENAI_API_CONFIGS)[newIdx < idx ? newIdx : newIdx + 1];
                  });
                  set(OPENAI_API_CONFIGS, newConfig);
                  updateOpenAIHandler();
                },
                get url() {
                  return get(OPENAI_API_BASE_URLS)[idx];
                },
                set url($$value) {
                  mutate(OPENAI_API_BASE_URLS, get(OPENAI_API_BASE_URLS)[idx] = $$value);
                },
                get key() {
                  return get(OPENAI_API_KEYS)[idx];
                },
                set key($$value) {
                  mutate(OPENAI_API_KEYS, get(OPENAI_API_KEYS)[idx] = $$value);
                },
                get config() {
                  return get(OPENAI_API_CONFIGS)[idx];
                },
                set config($$value) {
                  mutate(OPENAI_API_CONFIGS, get(OPENAI_API_CONFIGS)[idx] = $$value);
                },
                $$legacy: true
              });
            }
          });
          reset(div_12);
          reset(div_9);
          template_effect(($0) => set_text(text_2, $0), [() => $i18n().t("Manage OpenAI API Connections")]);
          append($$anchor3, div_9);
        };
        if_block(node_4, ($$render) => {
          if (get(ENABLE_OPENAI_API)) $$render(consequent);
        });
      }
      reset(div_4);
      reset(div_3);
      var div_13 = sibling(div_3, 2);
      var div_14 = child(div_13);
      var div_15 = child(div_14);
      var text_3 = child(div_15, true);
      reset(div_15);
      var div_16 = sibling(div_15, 2);
      var node_7 = child(div_16);
      Switch_1(node_7, {
        get state() {
          return get(ENABLE_OLLAMA_API);
        },
        set state($$value) {
          set(ENABLE_OLLAMA_API, $$value);
        },
        $$events: {
          change: async () => {
            updateOllamaHandler();
          }
        },
        $$legacy: true
      });
      reset(div_16);
      reset(div_14);
      var node_8 = sibling(div_14, 2);
      {
        var consequent_1 = ($$anchor3) => {
          var div_17 = root_5$2();
          var div_18 = child(div_17);
          var div_19 = child(div_18);
          var text_4 = child(div_19, true);
          reset(div_19);
          var node_9 = sibling(div_19, 2);
          {
            let $0 = derived_safe_equal(() => $i18n().t(`Add Connection`));
            Tooltip(node_9, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var button_1 = root_6$1();
                var node_10 = child(button_1);
                Plus(node_10, {});
                reset(button_1);
                event("click", button_1, () => {
                  set(showAddOllamaConnectionModal, true);
                });
                append($$anchor4, button_1);
              },
              $$slots: { default: true }
            });
          }
          reset(div_18);
          var div_20 = sibling(div_18, 2);
          var div_21 = child(div_20);
          each(div_21, 5, () => get(OLLAMA_BASE_URLS), index, ($$anchor4, url2, idx) => {
            OllamaConnection($$anchor4, {
              idx,
              onSubmit: () => {
                updateOllamaHandler();
              },
              onDelete: () => {
                set(OLLAMA_BASE_URLS, get(OLLAMA_BASE_URLS).filter((url3, urlIdx) => idx !== urlIdx));
                let newConfig = {};
                get(OLLAMA_BASE_URLS).forEach((url3, newIdx) => {
                  newConfig[newIdx] = get(OLLAMA_API_CONFIGS)[newIdx < idx ? newIdx : newIdx + 1];
                });
                set(OLLAMA_API_CONFIGS, newConfig);
              },
              get url() {
                return get(OLLAMA_BASE_URLS)[idx];
              },
              set url($$value) {
                mutate(OLLAMA_BASE_URLS, get(OLLAMA_BASE_URLS)[idx] = $$value);
              },
              get config() {
                return get(OLLAMA_API_CONFIGS)[idx];
              },
              set config($$value) {
                mutate(OLLAMA_API_CONFIGS, get(OLLAMA_API_CONFIGS)[idx] = $$value);
              },
              $$legacy: true
            });
          });
          reset(div_21);
          reset(div_20);
          var div_22 = sibling(div_20, 2);
          var text_5 = child(div_22);
          var a = sibling(text_5);
          var text_6 = child(a, true);
          reset(a);
          reset(div_22);
          reset(div_17);
          template_effect(
            ($0, $1, $2) => {
              set_text(text_4, $0);
              set_text(text_5, `${$1 ?? ""} `);
              set_text(text_6, $2);
            },
            [
              () => $i18n().t("Manage Ollama API Connections"),
              () => $i18n().t("Trouble accessing Ollama?"),
              () => $i18n().t("Click here for help.")
            ]
          );
          append($$anchor3, div_17);
        };
        if_block(node_8, ($$render) => {
          if (get(ENABLE_OLLAMA_API)) $$render(consequent_1);
        });
      }
      reset(div_13);
      var div_23 = sibling(div_13, 2);
      var div_24 = child(div_23);
      var div_25 = child(div_24);
      var text_7 = child(div_25, true);
      reset(div_25);
      var div_26 = sibling(div_25, 2);
      var div_27 = child(div_26);
      var node_11 = child(div_27);
      Switch_1(node_11, {
        get state() {
          return get(connectionsConfig).ENABLE_DIRECT_CONNECTIONS;
        },
        set state($$value) {
          mutate(connectionsConfig, get(connectionsConfig).ENABLE_DIRECT_CONNECTIONS = $$value);
        },
        $$events: {
          change: async () => {
            updateConnectionsHandler();
          }
        },
        $$legacy: true
      });
      reset(div_27);
      reset(div_26);
      reset(div_24);
      var div_28 = sibling(div_24, 2);
      var text_8 = child(div_28, true);
      reset(div_28);
      reset(div_23);
      var div_29 = sibling(div_23, 4);
      var div_30 = child(div_29);
      var div_31 = child(div_30);
      var text_9 = child(div_31, true);
      reset(div_31);
      var div_32 = sibling(div_31, 2);
      var div_33 = child(div_32);
      var node_12 = child(div_33);
      Switch_1(node_12, {
        get state() {
          return get(connectionsConfig).ENABLE_BASE_MODELS_CACHE;
        },
        set state($$value) {
          mutate(connectionsConfig, get(connectionsConfig).ENABLE_BASE_MODELS_CACHE = $$value);
        },
        $$events: {
          change: async () => {
            updateConnectionsHandler();
          }
        },
        $$legacy: true
      });
      reset(div_33);
      reset(div_32);
      reset(div_30);
      var div_34 = sibling(div_30, 2);
      var text_10 = child(div_34, true);
      reset(div_34);
      reset(div_29);
      reset(div_1);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6) => {
          set_text(text2, $0);
          set_text(text_1, $1);
          set_text(text_3, $2);
          set_text(text_7, $3);
          set_text(text_8, $4);
          set_text(text_9, $5);
          set_text(text_10, $6);
        },
        [
          () => $i18n().t("General"),
          () => $i18n().t("OpenAI API"),
          () => $i18n().t("Ollama API"),
          () => $i18n().t("Direct Connections"),
          () => $i18n().t("Direct Connections allow users to connect to their own OpenAI compatible API endpoints."),
          () => $i18n().t("Cache Base Model List"),
          () => $i18n().t("Base Model List Cache speeds up access by fetching base models only at startup or on settings savefaster, but may not show recent base model changes.")
        ]
      );
      append($$anchor2, div_1);
    };
    var alternate = ($$anchor2) => {
      var div_35 = root_8$3();
      var div_36 = child(div_35);
      var node_13 = child(div_36);
      Spinner(node_13, { className: "size-6" });
      reset(div_36);
      reset(div_35);
      append($$anchor2, div_35);
    };
    if_block(node_2, ($$render) => {
      if (get(ENABLE_OPENAI_API) !== null && get(ENABLE_OLLAMA_API) !== null && get(connectionsConfig) !== null) $$render(consequent_2);
      else $$render(alternate, false);
    });
  }
  reset(div);
  var div_37 = sibling(div, 2);
  var button_2 = child(div_37);
  var text_11 = child(button_2, true);
  reset(button_2);
  reset(div_37);
  reset(form);
  template_effect(($0) => set_text(text_11, $0), [() => $i18n().t("Save")]);
  event("submit", form, preventDefault(submitHandler));
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_2$2 = from_html(`<div class="flex w-full mt-1"><div class="flex-1 flex justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div></div>`);
var root_5$1 = from_html(`<input class="flex-1 w-full text-sm bg-transparent outline-hidden"/>`);
var root_4$4 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><!></div> <div class="my-0.5 flex gap-2 pr-2"><!></div> <div class="flex flex-col gap-2 mt-2"><div class=" flex flex-col w-full justify-between"><div class=" mb-1 text-xs font-medium"> </div> <div class="flex w-full items-center relative"><!></div></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center"><!></div></div> <div class="flex justify-between w-full mt-2"><div class="self-center text-xs font-medium"><!></div> <div><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option></select></div></div>`, 1);
var root_16$2 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/> <!></div>`);
var root_18$1 = from_html(`<div class="flex w-full mt-1"><div class="flex-1 mr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/></div></div>`);
var root_20$1 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/> <!></div> <div class="flex flex-col gap-2 mt-2"><div class=" flex flex-col w-full justify-between"><div class=" mb-1 text-xs font-medium"> </div> <div class="flex w-full items-center relative"><!></div></div></div>`, 1);
var root_22$1 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/> <!></div>`);
var root_24$1 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/> <!></div>`);
var root_26$1 = from_html(`<div class="flex w-full mt-2"><div class="flex-1 flex justify-between"><div class="self-center text-xs font-medium"> </div> <select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 text-xs bg-transparent outline-hidden"><option> </option><option> </option></select></div></div> <div class="flex w-full mt-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/></div> <div class="flex w-full mt-2"><!></div> <div class="flex flex-col justify-between w-full mt-2"><div class="text-xs font-medium"><!></div> <div class="mt-1.5"><!></div></div>`, 1);
var root_30$1 = from_html(`<div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option></select></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" flex gap-1.5 w-full"><div class="  w-full justify-between"><div class="self-center text-xs font-medium min-w-fit mb-1"> </div> <div class="self-center"><input class=" w-full rounded-lg py-1.5 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="number" autocomplete="off" min="0"/></div></div> <div class="w-full"><div class=" self-center text-xs font-medium min-w-fit mb-1"> </div> <div class="self-center"><input class="w-full rounded-lg py-1.5 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="number" autocomplete="off" min="0"/></div></div></div></div>`, 1);
var root_32$1 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" required/> <!></div>`);
var root_34$1 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" required/> <!></div>`);
var root_36$1 = from_html(`<div class="my-0.5 flex flex-col gap-2 pr-2 w-full"><div class="flex gap-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" required/> <!></div> <div class="flex gap-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" required/></div></div>`);
var root_37 = from_html(`<div class="flex w-full"><div class="flex-1 mr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" required/></div></div>`);
var root_40$1 = from_html(`<div class="self-center"><!></div>`);
var root_41 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8.75 2.75a.75.75 0 0 0-1.5 0v5.69L5.03 6.22a.75.75 0 0 0-1.06 1.06l3.5 3.5a.75.75 0 0 0 1.06 0l3.5-3.5a.75.75 0 0 0-1.06-1.06L8.75 8.44V2.75Z"></path><path d="M3.5 9.75a.75.75 0 0 0-1.5 0v1.5A2.75 2.75 0 0 0 4.75 14h6.5A2.75 2.75 0 0 0 14 11.25v-1.5a.75.75 0 0 0-1.5 0v1.5c0 .69-.56 1.25-1.25 1.25h-6.5c-.69 0-1.25-.56-1.25-1.25v-1.5Z"></path></svg>`);
var root_39 = from_html(`<button class="px-2.5 bg-transparent text-gray-800 dark:bg-transparent dark:text-gray-100 rounded-lg transition"><!></button>`);
var root_38$1 = from_html(`<div class="flex w-full"><div class="flex-1 mr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/></div> <!></div>`);
var root_42$1 = from_html(`<div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div><input type="number" class=" bg-transparent text-center w-14 outline-none" min="-2" max="16000" step="1"/></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class="self-center text-xs font-medium"><!></div> <div class="flex items-center relative"><!></div></div>`, 1);
var root_48$1 = from_html(`<div class="my-0.5 flex gap-2 pr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" required/> <!></div>`);
var root_46$1 = from_html(`<div class="mb-2.5 flex w-full justify-between"><div class="self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex flex-col w-full justify-between"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option></select></div></div> <!></div> <div class="  mb-2.5 flex flex-col w-full"><div class=" mb-1 text-xs font-medium"> </div> <div><div class="flex w-full"><div class="flex-1 mr-2"><input class="flex-1 w-full text-sm bg-transparent outline-hidden"/></div></div></div></div>`, 1);
var root_49 = from_html(`<div class="mb-2.5 flex w-full justify-between"><div class="self-center text-xs font-medium"> </div> <div class="flex items-center relative"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" autocomplete="off" min="0"/></div></div>`);
var root_50$1 = from_html(`<div class="  mb-2.5 flex flex-col w-full justify-between"><div class=" flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" step="0.01" autocomplete="off" min="0.0"/></div></div> <div class="mt-1 text-xs text-gray-400 dark:text-gray-500"> </div></div>`);
var root_53 = from_html(`<span class="ml-2 self-center"> </span>`);
var root_54 = from_html(`<span class="ml-2 self-center"> </span>`);
var root_52 = from_html(`<div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <button class="p-1 px-3 text-xs flex rounded-sm transition shrink-0 outline-hidden" type="button"><!></button></div>`);
var root_55 = from_html(`<div class="flex mt-0.5 space-x-2"><div class=" flex-1"><input id="steps-range" type="range" min="0" max="1" step="0.05" class="w-full h-2 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"/> <div class="py-0.5"><div class="flex w-full justify-between"><div class=" text-left text-xs font-small"> </div> <div class=" text-right text-xs font-small"> </div></div></div></div> <div><input type="number" class=" bg-transparent text-center w-14" min="0" max="1" step="any"/></div></div>`);
var root_51$1 = from_html(`<div class=" mb-2.5 py-0.5 w-full justify-between"><!> <!></div>`);
var root_45 = from_html(`<div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <!> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" autocomplete="off" min="0"/></div></div> <!> <!> <!>`, 1);
var root_31 = from_html(`<div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex flex-col w-full justify-between"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option><option> </option></select></div></div> <!></div> <div class="  mb-2.5 flex flex-col w-full"><div class=" mb-1 text-xs font-medium"> </div> <div><!></div> <div class="mt-1 mb-1 text-xs text-gray-400 dark:text-gray-500"> </div></div> <!></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <!> <div class="  mb-2.5 flex flex-col w-full justify-between"><div class=" mb-1 text-xs font-medium"> </div> <div class="flex w-full items-center relative"><!></div></div></div>`, 1);
var root_57$1 = from_html(`<input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="text" autocomplete="off"/>`);
var root_58$1 = from_html(`<input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" autocomplete="off" min="0"/>`);
var root_59 = from_html(`<input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" autocomplete="off" min="0"/>`);
var root_60$1 = from_html(`<input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" autocomplete="off" min="0"/>`);
var root_61 = from_html(`<input class="flex-1 w-full text-sm bg-transparent outline-hidden" type="number" autocomplete="off" min="0"/>`);
var root_1$4 = from_html(`<div class=" space-y-2.5 overflow-y-scroll scrollbar-hidden h-full pr-1.5"><div><div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5 flex flex-col w-full justify-between"><div class="flex w-full justify-between mb-1"><div class="self-center text-xs font-medium"> </div> <div><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 text-xs bg-transparent outline-hidden text-right"><option> </option><option> </option><option> </option><option> </option><option> </option><option> </option><option> </option><option> </option></select></div></div> <!></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"><!></div> <div class="flex items-center relative"><!></div></div> <!></div> <!> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><button class="text-xs" type="button"> </button></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><button class="text-xs" type="button"> </button></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><button class="text-xs" type="button"> </button></div></div></div></div></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div>`, 1);
var root_62$1 = from_html(`<div class="flex items-center justify-center h-full"><!></div>`);
var root$6 = from_html(`<!> <!> <!> <form class="flex flex-col h-full justify-between space-y-3 text-sm"><!></form>`, 1);
function Documents($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const dispatch = createEventDispatcher();
  const i18n = getContext("i18n");
  let updateEmbeddingModelLoading = mutable_source(false);
  let showResetConfirm = mutable_source(false);
  let showResetUploadDirConfirm = mutable_source(false);
  let showReindexConfirm = mutable_source(false);
  let RAG_EMBEDDING_ENGINE = mutable_source("");
  let RAG_EMBEDDING_MODEL = mutable_source("");
  let RAG_EMBEDDING_BATCH_SIZE = mutable_source(1);
  let ENABLE_ASYNC_EMBEDDING = mutable_source(true);
  let OpenAIUrl = mutable_source("");
  let OpenAIKey = mutable_source("");
  let AzureOpenAIUrl = mutable_source("");
  let AzureOpenAIKey = mutable_source("");
  let AzureOpenAIVersion = mutable_source("");
  let OllamaUrl = mutable_source("");
  let OllamaKey = mutable_source("");
  let RAGConfig = mutable_source(null);
  const embeddingModelUpdateHandler = async () => {
    if (get(RAG_EMBEDDING_ENGINE) === "" && get(RAG_EMBEDDING_MODEL).split("/").length - 1 > 1) {
      toast.error($i18n().t("Model filesystem path detected. Model shortname is required for update, cannot continue."));
      return;
    }
    if (get(RAG_EMBEDDING_ENGINE) === "ollama" && get(RAG_EMBEDDING_MODEL) === "") {
      toast.error($i18n().t("Model filesystem path detected. Model shortname is required for update, cannot continue."));
      return;
    }
    if (get(RAG_EMBEDDING_ENGINE) === "openai" && get(RAG_EMBEDDING_MODEL) === "") {
      toast.error($i18n().t("Model filesystem path detected. Model shortname is required for update, cannot continue."));
      return;
    }
    if (get(RAG_EMBEDDING_ENGINE) === "azure_openai" && (get(AzureOpenAIKey) === "" || get(AzureOpenAIUrl) === "" || get(AzureOpenAIVersion) === "")) {
      toast.error($i18n().t("OpenAI URL/Key required."));
      return;
    }
    console.debug("Update embedding model attempt:", {
      RAG_EMBEDDING_ENGINE: get(RAG_EMBEDDING_ENGINE),
      RAG_EMBEDDING_MODEL: get(RAG_EMBEDDING_MODEL),
      RAG_EMBEDDING_BATCH_SIZE: get(RAG_EMBEDDING_BATCH_SIZE),
      ENABLE_ASYNC_EMBEDDING: get(ENABLE_ASYNC_EMBEDDING)
    });
    set(updateEmbeddingModelLoading, true);
    const res = await updateEmbeddingConfig(localStorage.token, {
      RAG_EMBEDDING_ENGINE: get(RAG_EMBEDDING_ENGINE),
      RAG_EMBEDDING_MODEL: get(RAG_EMBEDDING_MODEL),
      RAG_EMBEDDING_BATCH_SIZE: get(RAG_EMBEDDING_BATCH_SIZE),
      ENABLE_ASYNC_EMBEDDING: get(ENABLE_ASYNC_EMBEDDING),
      ollama_config: { key: get(OllamaKey), url: get(OllamaUrl) },
      openai_config: { key: get(OpenAIKey), url: get(OpenAIUrl) },
      azure_openai_config: {
        key: get(AzureOpenAIKey),
        url: get(AzureOpenAIUrl),
        version: get(AzureOpenAIVersion)
      }
    }).catch(async (error) => {
      toast.error(`${error}`);
      await setEmbeddingConfig();
      return null;
    });
    set(updateEmbeddingModelLoading, false);
    if (res) {
      console.debug("embeddingModelUpdateHandler:", res);
    }
  };
  const submitHandler = async () => {
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "external" && get(RAGConfig).EXTERNAL_DOCUMENT_LOADER_URL === "") {
      toast.error($i18n().t("External Document Loader URL required."));
      return;
    }
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "tika" && get(RAGConfig).TIKA_SERVER_URL === "") {
      toast.error($i18n().t("Tika Server URL required."));
      return;
    }
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "docling" && get(RAGConfig).DOCLING_SERVER_URL === "") {
      toast.error($i18n().t("Docling Server URL required."));
      return;
    }
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "datalab_marker" && get(RAGConfig).DATALAB_MARKER_ADDITIONAL_CONFIG && get(RAGConfig).DATALAB_MARKER_ADDITIONAL_CONFIG.trim() !== "") {
      try {
        JSON.parse(get(RAGConfig).DATALAB_MARKER_ADDITIONAL_CONFIG);
      } catch (e) {
        toast.error($i18n().t("Invalid JSON format in Additional Config"));
        return;
      }
    }
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "document_intelligence" && get(RAGConfig).DOCUMENT_INTELLIGENCE_ENDPOINT === "") {
      toast.error($i18n().t("Document Intelligence endpoint required."));
      return;
    }
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "mistral_ocr" && get(RAGConfig).MISTRAL_OCR_API_KEY === "") {
      toast.error($i18n().t("Mistral OCR API Key required."));
      return;
    }
    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "mineru" && get(RAGConfig).MINERU_API_MODE === "cloud" && get(RAGConfig).MINERU_API_KEY === "") {
      toast.error($i18n().t("MinerU API Key required for Cloud API mode."));
      return;
    }
    if (!get(RAGConfig).BYPASS_EMBEDDING_AND_RETRIEVAL) {
      await embeddingModelUpdateHandler();
    }
    if (get(RAGConfig).DOCLING_PARAMS) {
      try {
        JSON.parse(get(RAGConfig).DOCLING_PARAMS);
      } catch (e) {
        toast.error($i18n().t("Invalid JSON format in {{NAME}}", { NAME: $i18n().t("Docling Parameters") }));
        return;
      }
    }
    if (get(RAGConfig).MINERU_PARAMS) {
      try {
        JSON.parse(get(RAGConfig).MINERU_PARAMS);
      } catch (e) {
        toast.error($i18n().t("Invalid JSON format in MinerU Parameters"));
        return;
      }
    }
    await updateRAGConfig(localStorage.token, {
      ...get(RAGConfig),
      ALLOWED_FILE_EXTENSIONS: get(RAGConfig).ALLOWED_FILE_EXTENSIONS.split(",").map((ext) => ext.trim()).filter((ext) => ext !== ""),
      DOCLING_PARAMS: typeof get(RAGConfig).DOCLING_PARAMS === "string" && get(RAGConfig).DOCLING_PARAMS.trim() !== "" ? JSON.parse(get(RAGConfig).DOCLING_PARAMS) : {},
      MINERU_PARAMS: typeof get(RAGConfig).MINERU_PARAMS === "string" && get(RAGConfig).MINERU_PARAMS.trim() !== "" ? JSON.parse(get(RAGConfig).MINERU_PARAMS) : {}
    });
    dispatch("save");
  };
  const setEmbeddingConfig = async () => {
    const embeddingConfig = await getEmbeddingConfig(localStorage.token);
    if (embeddingConfig) {
      set(RAG_EMBEDDING_ENGINE, embeddingConfig.RAG_EMBEDDING_ENGINE);
      set(RAG_EMBEDDING_MODEL, embeddingConfig.RAG_EMBEDDING_MODEL);
      set(RAG_EMBEDDING_BATCH_SIZE, embeddingConfig.RAG_EMBEDDING_BATCH_SIZE ?? 1);
      set(ENABLE_ASYNC_EMBEDDING, embeddingConfig.ENABLE_ASYNC_EMBEDDING ?? true);
      set(OpenAIKey, embeddingConfig.openai_config.key);
      set(OpenAIUrl, embeddingConfig.openai_config.url);
      set(OllamaKey, embeddingConfig.ollama_config.key);
      set(OllamaUrl, embeddingConfig.ollama_config.url);
      set(AzureOpenAIKey, embeddingConfig.azure_openai_config.key);
      set(AzureOpenAIUrl, embeddingConfig.azure_openai_config.url);
      set(AzureOpenAIVersion, embeddingConfig.azure_openai_config.version);
    }
  };
  onMount(async () => {
    await setEmbeddingConfig();
    const config2 = await getRAGConfig(localStorage.token);
    config2.ALLOWED_FILE_EXTENSIONS = ((config2 == null ? void 0 : config2.ALLOWED_FILE_EXTENSIONS) ?? []).join(", ");
    config2.DOCLING_PARAMS = typeof config2.DOCLING_PARAMS === "object" ? JSON.stringify(config2.DOCLING_PARAMS ?? {}, null, 2) : config2.DOCLING_PARAMS;
    config2.MINERU_PARAMS = typeof config2.MINERU_PARAMS === "object" ? JSON.stringify(config2.MINERU_PARAMS ?? {}, null, 2) : config2.MINERU_PARAMS;
    set(RAGConfig, config2);
  });
  init();
  var fragment = root$6();
  var node = first_child(fragment);
  ConfirmDialog(node, {
    get show() {
      return get(showResetUploadDirConfirm);
    },
    set show($$value) {
      set(showResetUploadDirConfirm, $$value);
    },
    $$events: {
      confirm: async () => {
        const res = await deleteAllFiles(localStorage.token).catch((error) => {
          toast.error(`${error}`);
          return null;
        });
        if (res) {
          toast.success($i18n().t("Success"));
        }
      }
    },
    $$legacy: true
  });
  var node_1 = sibling(node, 2);
  ConfirmDialog(node_1, {
    get show() {
      return get(showResetConfirm);
    },
    set show($$value) {
      set(showResetConfirm, $$value);
    },
    $$events: {
      confirm: () => {
        const res = resetVectorDB(localStorage.token).catch((error) => {
          toast.error(`${error}`);
          return null;
        });
        if (res) {
          toast.success($i18n().t("Success"));
        }
      }
    },
    $$legacy: true
  });
  var node_2 = sibling(node_1, 2);
  ConfirmDialog(node_2, {
    get show() {
      return get(showReindexConfirm);
    },
    set show($$value) {
      set(showReindexConfirm, $$value);
    },
    $$events: {
      confirm: async () => {
        const res = await reindexKnowledgeFiles(localStorage.token).catch((error) => {
          toast.error(`${error}`);
          return null;
        });
        if (res) {
          toast.success($i18n().t("Success"));
        }
      }
    },
    $$legacy: true
  });
  var form = sibling(node_2, 2);
  var node_3 = child(form);
  {
    var consequent_25 = ($$anchor2) => {
      var fragment_1 = root_1$4();
      var div = first_child(fragment_1);
      var div_1 = child(div);
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text$1 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var div_6 = child(div_5);
      var text_1 = child(div_6, true);
      reset(div_6);
      var div_7 = sibling(div_6, 2);
      var select = child(div_7);
      template_effect(() => {
        get(RAGConfig);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option = child(select);
      var text_2 = child(option, true);
      reset(option);
      option.value = option.__value = "";
      var option_1 = sibling(option);
      var text_3 = child(option_1, true);
      reset(option_1);
      option_1.value = option_1.__value = "external";
      var option_2 = sibling(option_1);
      var text_4 = child(option_2, true);
      reset(option_2);
      option_2.value = option_2.__value = "tika";
      var option_3 = sibling(option_2);
      var text_5 = child(option_3, true);
      reset(option_3);
      option_3.value = option_3.__value = "docling";
      var option_4 = sibling(option_3);
      var text_6 = child(option_4, true);
      reset(option_4);
      option_4.value = option_4.__value = "datalab_marker";
      var option_5 = sibling(option_4);
      var text_7 = child(option_5, true);
      reset(option_5);
      option_5.value = option_5.__value = "document_intelligence";
      var option_6 = sibling(option_5);
      var text_8 = child(option_6, true);
      reset(option_6);
      option_6.value = option_6.__value = "mistral_ocr";
      var option_7 = sibling(option_6);
      var text_9 = child(option_7, true);
      reset(option_7);
      option_7.value = option_7.__value = "mineru";
      reset(select);
      reset(div_7);
      reset(div_5);
      var node_4 = sibling(div_5, 2);
      {
        var consequent = ($$anchor3) => {
          var div_8 = root_2$2();
          var div_9 = child(div_8);
          var div_10 = child(div_9);
          var text_10 = child(div_10, true);
          reset(div_10);
          var div_11 = sibling(div_10, 2);
          var node_5 = child(div_11);
          Switch_1(node_5, {
            get state() {
              return get(RAGConfig).PDF_EXTRACT_IMAGES;
            },
            set state($$value) {
              mutate(RAGConfig, get(RAGConfig).PDF_EXTRACT_IMAGES = $$value);
            },
            $$legacy: true
          });
          reset(div_11);
          reset(div_9);
          reset(div_8);
          template_effect(($0) => set_text(text_10, $0), [() => $i18n().t("PDF Extract Images (OCR)")]);
          append($$anchor3, div_8);
        };
        var alternate_6 = ($$anchor3) => {
          var fragment_2 = comment();
          var node_6 = first_child(fragment_2);
          {
            var consequent_1 = ($$anchor4) => {
              var fragment_3 = root_4$4();
              var div_12 = first_child(fragment_3);
              var node_7 = child(div_12);
              {
                let $0 = derived_safe_equal(() => $i18n().t("API Base URL for Datalab Marker service. Defaults to: https://www.datalab.to/api/v1/marker"));
                Tooltip(node_7, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  className: "w-full",
                  children: ($$anchor5, $$slotProps) => {
                    var input = root_5$1();
                    remove_input_defaults(input);
                    template_effect(($02) => set_attribute(input, "placeholder", $02), [() => $i18n().t("Enter Datalab Marker API Base URL")]);
                    bind_value(input, () => get(RAGConfig).DATALAB_MARKER_API_BASE_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_API_BASE_URL = $$value));
                    append($$anchor5, input);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_12);
              var div_13 = sibling(div_12, 2);
              var node_8 = child(div_13);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Enter Datalab Marker API Key"));
                SensitiveInput(node_8, {
                  get placeholder() {
                    return get($0);
                  },
                  required: false,
                  get value() {
                    return get(RAGConfig).DATALAB_MARKER_API_KEY;
                  },
                  set value($$value) {
                    mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_API_KEY = $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_13);
              var div_14 = sibling(div_13, 2);
              var div_15 = child(div_14);
              var div_16 = child(div_15);
              var text_11 = child(div_16, true);
              reset(div_16);
              var div_17 = sibling(div_16, 2);
              var node_9 = child(div_17);
              {
                let $0 = derived_safe_equal(() => $i18n().t(`Additional configuration options for marker. This should be a JSON string with key-value pairs. For example, '{"key": "value"}'. Supported keys include: disable_links, keep_pageheader_in_output, keep_pagefooter_in_output, filter_blank_pages, drop_repeated_text, layout_coverage_threshold, merge_threshold, height_tolerance, gap_threshold, image_threshold, min_line_length, level_count, default_level`));
                Tooltip(node_9, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  className: "w-full",
                  children: ($$anchor5, $$slotProps) => {
                    {
                      let $02 = derived_safe_equal(() => $i18n().t('Enter JSON config (e.g., {"disable_links": true})'));
                      Textarea($$anchor5, {
                        get placeholder() {
                          return get($02);
                        },
                        get value() {
                          return get(RAGConfig).DATALAB_MARKER_ADDITIONAL_CONFIG;
                        },
                        set value($$value) {
                          mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_ADDITIONAL_CONFIG = $$value);
                        },
                        $$legacy: true
                      });
                    }
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_17);
              reset(div_15);
              reset(div_14);
              var div_18 = sibling(div_14, 2);
              var div_19 = child(div_18);
              var node_10 = child(div_19);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Significantly improves accuracy by using an LLM to enhance tables, forms, inline math, and layout detection. Will increase latency. Defaults to False."));
                Tooltip(node_10, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_12 = text();
                    template_effect(($02) => set_text(text_12, $02), [() => $i18n().t("Use LLM")]);
                    append($$anchor5, text_12);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_19);
              var div_20 = sibling(div_19, 2);
              var node_11 = child(div_20);
              Switch_1(node_11, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_USE_LLM;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_USE_LLM = $$value);
                },
                $$legacy: true
              });
              reset(div_20);
              reset(div_18);
              var div_21 = sibling(div_18, 2);
              var div_22 = child(div_21);
              var node_12 = child(div_22);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Skip the cache and re-run the inference. Defaults to False."));
                Tooltip(node_12, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_13 = text();
                    template_effect(($02) => set_text(text_13, $02), [() => $i18n().t("Skip Cache")]);
                    append($$anchor5, text_13);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_22);
              var div_23 = sibling(div_22, 2);
              var node_13 = child(div_23);
              Switch_1(node_13, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_SKIP_CACHE;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_SKIP_CACHE = $$value);
                },
                $$legacy: true
              });
              reset(div_23);
              reset(div_21);
              var div_24 = sibling(div_21, 2);
              var div_25 = child(div_24);
              var node_14 = child(div_25);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Force OCR on all pages of the PDF. This can lead to worse results if you have good text in your PDFs. Defaults to False."));
                Tooltip(node_14, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_14 = text();
                    template_effect(($02) => set_text(text_14, $02), [() => $i18n().t("Force OCR")]);
                    append($$anchor5, text_14);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_25);
              var div_26 = sibling(div_25, 2);
              var node_15 = child(div_26);
              Switch_1(node_15, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_FORCE_OCR;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_FORCE_OCR = $$value);
                },
                $$legacy: true
              });
              reset(div_26);
              reset(div_24);
              var div_27 = sibling(div_24, 2);
              var div_28 = child(div_27);
              var node_16 = child(div_28);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Whether to paginate the output. Each page will be separated by a horizontal rule and page number. Defaults to False."));
                Tooltip(node_16, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_15 = text();
                    template_effect(($02) => set_text(text_15, $02), [() => $i18n().t("Paginate")]);
                    append($$anchor5, text_15);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_28);
              var div_29 = sibling(div_28, 2);
              var node_17 = child(div_29);
              Switch_1(node_17, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_PAGINATE;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_PAGINATE = $$value);
                },
                $$legacy: true
              });
              reset(div_29);
              reset(div_27);
              var div_30 = sibling(div_27, 2);
              var div_31 = child(div_30);
              var node_18 = child(div_31);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Strip existing OCR text from the PDF and re-run OCR. Ignored if Force OCR is enabled. Defaults to False."));
                Tooltip(node_18, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_16 = text();
                    template_effect(($02) => set_text(text_16, $02), [() => $i18n().t("Strip Existing OCR")]);
                    append($$anchor5, text_16);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_31);
              var div_32 = sibling(div_31, 2);
              var node_19 = child(div_32);
              Switch_1(node_19, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_STRIP_EXISTING_OCR;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_STRIP_EXISTING_OCR = $$value);
                },
                $$legacy: true
              });
              reset(div_32);
              reset(div_30);
              var div_33 = sibling(div_30, 2);
              var div_34 = child(div_33);
              var node_20 = child(div_34);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Disable image extraction from the PDF. If Use LLM is enabled, images will be automatically captioned. Defaults to False."));
                Tooltip(node_20, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_17 = text();
                    template_effect(($02) => set_text(text_17, $02), [() => $i18n().t("Disable Image Extraction")]);
                    append($$anchor5, text_17);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_34);
              var div_35 = sibling(div_34, 2);
              var node_21 = child(div_35);
              Switch_1(node_21, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_DISABLE_IMAGE_EXTRACTION;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_DISABLE_IMAGE_EXTRACTION = $$value);
                },
                $$legacy: true
              });
              reset(div_35);
              reset(div_33);
              var div_36 = sibling(div_33, 2);
              var div_37 = child(div_36);
              var node_22 = child(div_37);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Format the lines in the output. Defaults to False. If set to True, the lines will be formatted to detect inline math and styles."));
                Tooltip(node_22, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_18 = text();
                    template_effect(($02) => set_text(text_18, $02), [() => $i18n().t("Format Lines")]);
                    append($$anchor5, text_18);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_37);
              var div_38 = sibling(div_37, 2);
              var node_23 = child(div_38);
              Switch_1(node_23, {
                get state() {
                  return get(RAGConfig).DATALAB_MARKER_FORMAT_LINES;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_FORMAT_LINES = $$value);
                },
                $$legacy: true
              });
              reset(div_38);
              reset(div_36);
              var div_39 = sibling(div_36, 2);
              var div_40 = child(div_39);
              var node_24 = child(div_40);
              {
                let $0 = derived_safe_equal(() => $i18n().t("The output format for the text. Can be 'json', 'markdown', or 'html'. Defaults to 'markdown'."));
                Tooltip(node_24, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_19 = text();
                    template_effect(($02) => set_text(text_19, $02), [() => $i18n().t("Output Format")]);
                    append($$anchor5, text_19);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_40);
              var div_41 = sibling(div_40, 2);
              var select_1 = child(div_41);
              template_effect(() => {
                get(RAGConfig);
                invalidate_inner_signals(() => {
                  $i18n();
                });
              });
              var option_8 = child(select_1);
              var text_20 = child(option_8, true);
              reset(option_8);
              option_8.value = option_8.__value = "markdown";
              var option_9 = sibling(option_8);
              var text_21 = child(option_9, true);
              reset(option_9);
              option_9.value = option_9.__value = "json";
              var option_10 = sibling(option_9);
              var text_22 = child(option_10, true);
              reset(option_10);
              option_10.value = option_10.__value = "html";
              reset(select_1);
              reset(div_41);
              reset(div_39);
              template_effect(
                ($0, $1, $2, $3) => {
                  set_text(text_11, $0);
                  set_text(text_20, $1);
                  set_text(text_21, $2);
                  set_text(text_22, $3);
                },
                [
                  () => $i18n().t("Additional Config"),
                  () => $i18n().t("Markdown"),
                  () => $i18n().t("JSON"),
                  () => $i18n().t("HTML")
                ]
              );
              bind_select_value(select_1, () => get(RAGConfig).DATALAB_MARKER_OUTPUT_FORMAT, ($$value) => mutate(RAGConfig, get(RAGConfig).DATALAB_MARKER_OUTPUT_FORMAT = $$value));
              append($$anchor4, fragment_3);
            };
            var alternate_5 = ($$anchor4) => {
              var fragment_13 = comment();
              var node_25 = first_child(fragment_13);
              {
                var consequent_2 = ($$anchor5) => {
                  var div_42 = root_16$2();
                  var input_1 = child(div_42);
                  remove_input_defaults(input_1);
                  var node_26 = sibling(input_1, 2);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("Enter External Document Loader API Key"));
                    SensitiveInput(node_26, {
                      get placeholder() {
                        return get($0);
                      },
                      required: false,
                      get value() {
                        return get(RAGConfig).EXTERNAL_DOCUMENT_LOADER_API_KEY;
                      },
                      set value($$value) {
                        mutate(RAGConfig, get(RAGConfig).EXTERNAL_DOCUMENT_LOADER_API_KEY = $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_42);
                  template_effect(($0) => set_attribute(input_1, "placeholder", $0), [() => $i18n().t("Enter External Document Loader URL")]);
                  bind_value(input_1, () => get(RAGConfig).EXTERNAL_DOCUMENT_LOADER_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).EXTERNAL_DOCUMENT_LOADER_URL = $$value));
                  append($$anchor5, div_42);
                };
                var alternate_4 = ($$anchor5) => {
                  var fragment_14 = comment();
                  var node_27 = first_child(fragment_14);
                  {
                    var consequent_3 = ($$anchor6) => {
                      var div_43 = root_18$1();
                      var div_44 = child(div_43);
                      var input_2 = child(div_44);
                      remove_input_defaults(input_2);
                      reset(div_44);
                      reset(div_43);
                      template_effect(($0) => set_attribute(input_2, "placeholder", $0), [() => $i18n().t("Enter Tika Server URL")]);
                      bind_value(input_2, () => get(RAGConfig).TIKA_SERVER_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).TIKA_SERVER_URL = $$value));
                      append($$anchor6, div_43);
                    };
                    var alternate_3 = ($$anchor6) => {
                      var fragment_15 = comment();
                      var node_28 = first_child(fragment_15);
                      {
                        var consequent_4 = ($$anchor7) => {
                          var fragment_16 = root_20$1();
                          var div_45 = first_child(fragment_16);
                          var input_3 = child(div_45);
                          remove_input_defaults(input_3);
                          var node_29 = sibling(input_3, 2);
                          {
                            let $0 = derived_safe_equal(() => $i18n().t("Enter Docling API Key"));
                            SensitiveInput(node_29, {
                              get placeholder() {
                                return get($0);
                              },
                              required: false,
                              get value() {
                                return get(RAGConfig).DOCLING_API_KEY;
                              },
                              set value($$value) {
                                mutate(RAGConfig, get(RAGConfig).DOCLING_API_KEY = $$value);
                              },
                              $$legacy: true
                            });
                          }
                          reset(div_45);
                          var div_46 = sibling(div_45, 2);
                          var div_47 = child(div_46);
                          var div_48 = child(div_47);
                          var text_23 = child(div_48, true);
                          reset(div_48);
                          var div_49 = sibling(div_48, 2);
                          var node_30 = child(div_49);
                          {
                            let $0 = derived_safe_equal(() => $i18n().t("Enter additional parameters in JSON format"));
                            Textarea(node_30, {
                              get placeholder() {
                                return get($0);
                              },
                              minSize: 100,
                              get value() {
                                return get(RAGConfig).DOCLING_PARAMS;
                              },
                              set value($$value) {
                                mutate(RAGConfig, get(RAGConfig).DOCLING_PARAMS = $$value);
                              },
                              $$legacy: true
                            });
                          }
                          reset(div_49);
                          reset(div_47);
                          reset(div_46);
                          template_effect(
                            ($0, $1) => {
                              set_attribute(input_3, "placeholder", $0);
                              set_text(text_23, $1);
                            },
                            [
                              () => $i18n().t("Enter Docling Server URL"),
                              () => $i18n().t("Parameters")
                            ]
                          );
                          bind_value(input_3, () => get(RAGConfig).DOCLING_SERVER_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).DOCLING_SERVER_URL = $$value));
                          append($$anchor7, fragment_16);
                        };
                        var alternate_2 = ($$anchor7) => {
                          var fragment_17 = comment();
                          var node_31 = first_child(fragment_17);
                          {
                            var consequent_5 = ($$anchor8) => {
                              var div_50 = root_22$1();
                              var input_4 = child(div_50);
                              remove_input_defaults(input_4);
                              var node_32 = sibling(input_4, 2);
                              {
                                let $0 = derived_safe_equal(() => $i18n().t("Enter Document Intelligence Key"));
                                SensitiveInput(node_32, {
                                  get placeholder() {
                                    return get($0);
                                  },
                                  required: false,
                                  get value() {
                                    return get(RAGConfig).DOCUMENT_INTELLIGENCE_KEY;
                                  },
                                  set value($$value) {
                                    mutate(RAGConfig, get(RAGConfig).DOCUMENT_INTELLIGENCE_KEY = $$value);
                                  },
                                  $$legacy: true
                                });
                              }
                              reset(div_50);
                              template_effect(($0) => set_attribute(input_4, "placeholder", $0), [() => $i18n().t("Enter Document Intelligence Endpoint")]);
                              bind_value(input_4, () => get(RAGConfig).DOCUMENT_INTELLIGENCE_ENDPOINT, ($$value) => mutate(RAGConfig, get(RAGConfig).DOCUMENT_INTELLIGENCE_ENDPOINT = $$value));
                              append($$anchor8, div_50);
                            };
                            var alternate_1 = ($$anchor8) => {
                              var fragment_18 = comment();
                              var node_33 = first_child(fragment_18);
                              {
                                var consequent_6 = ($$anchor9) => {
                                  var div_51 = root_24$1();
                                  var input_5 = child(div_51);
                                  remove_input_defaults(input_5);
                                  var node_34 = sibling(input_5, 2);
                                  {
                                    let $0 = derived_safe_equal(() => $i18n().t("Enter Mistral API Key"));
                                    SensitiveInput(node_34, {
                                      get placeholder() {
                                        return get($0);
                                      },
                                      get value() {
                                        return get(RAGConfig).MISTRAL_OCR_API_KEY;
                                      },
                                      set value($$value) {
                                        mutate(RAGConfig, get(RAGConfig).MISTRAL_OCR_API_KEY = $$value);
                                      },
                                      $$legacy: true
                                    });
                                  }
                                  reset(div_51);
                                  template_effect(($0) => set_attribute(input_5, "placeholder", $0), [() => $i18n().t("Enter Mistral API Base URL")]);
                                  bind_value(input_5, () => get(RAGConfig).MISTRAL_OCR_API_BASE_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).MISTRAL_OCR_API_BASE_URL = $$value));
                                  append($$anchor9, div_51);
                                };
                                var alternate = ($$anchor9) => {
                                  var fragment_19 = comment();
                                  var node_35 = first_child(fragment_19);
                                  {
                                    var consequent_7 = ($$anchor10) => {
                                      var fragment_20 = root_26$1();
                                      var div_52 = first_child(fragment_20);
                                      var div_53 = child(div_52);
                                      var div_54 = child(div_53);
                                      var text_24 = child(div_54, true);
                                      reset(div_54);
                                      var select_2 = sibling(div_54, 2);
                                      template_effect(() => {
                                        get(RAGConfig);
                                        invalidate_inner_signals(() => {
                                          $i18n();
                                        });
                                      });
                                      var option_11 = child(select_2);
                                      var text_25 = child(option_11, true);
                                      reset(option_11);
                                      option_11.value = option_11.__value = "local";
                                      var option_12 = sibling(option_11);
                                      var text_26 = child(option_12, true);
                                      reset(option_12);
                                      option_12.value = option_12.__value = "cloud";
                                      reset(select_2);
                                      reset(div_53);
                                      reset(div_52);
                                      var div_55 = sibling(div_52, 2);
                                      var input_6 = child(div_55);
                                      remove_input_defaults(input_6);
                                      reset(div_55);
                                      var div_56 = sibling(div_55, 2);
                                      var node_36 = child(div_56);
                                      {
                                        let $0 = derived_safe_equal(() => $i18n().t("Enter MinerU API Key"));
                                        SensitiveInput(node_36, {
                                          get placeholder() {
                                            return get($0);
                                          },
                                          required: false,
                                          get value() {
                                            return get(RAGConfig).MINERU_API_KEY;
                                          },
                                          set value($$value) {
                                            mutate(RAGConfig, get(RAGConfig).MINERU_API_KEY = $$value);
                                          },
                                          $$legacy: true
                                        });
                                      }
                                      reset(div_56);
                                      var div_57 = sibling(div_56, 2);
                                      var div_58 = child(div_57);
                                      var node_37 = child(div_58);
                                      {
                                        let $0 = derived_safe_equal(() => $i18n().t("Advanced parameters for MinerU parsing (enable_ocr, enable_formula, enable_table, language, model_version, page_ranges)"));
                                        Tooltip(node_37, {
                                          get content() {
                                            return get($0);
                                          },
                                          placement: "top-start",
                                          children: ($$anchor11, $$slotProps) => {
                                            next();
                                            var text_27 = text();
                                            template_effect(($02) => set_text(text_27, $02), [() => $i18n().t("Parameters")]);
                                            append($$anchor11, text_27);
                                          },
                                          $$slots: { default: true }
                                        });
                                      }
                                      reset(div_58);
                                      var div_59 = sibling(div_58, 2);
                                      var node_38 = child(div_59);
                                      Textarea(node_38, {
                                        placeholder: `{
  "enable_ocr": false,
  "enable_formula": true,
  "enable_table": true,
  "language": "en",
  "model_version": "pipeline",
  "page_ranges": ""
}`,
                                        minSize: 100,
                                        get value() {
                                          return get(RAGConfig).MINERU_PARAMS;
                                        },
                                        set value($$value) {
                                          mutate(RAGConfig, get(RAGConfig).MINERU_PARAMS = $$value);
                                        },
                                        $$legacy: true
                                      });
                                      reset(div_59);
                                      reset(div_57);
                                      template_effect(
                                        ($0, $1, $2, $3) => {
                                          set_text(text_24, $0);
                                          set_text(text_25, $1);
                                          set_text(text_26, $2);
                                          set_attribute(input_6, "placeholder", $3);
                                        },
                                        [
                                          () => $i18n().t("API Mode"),
                                          () => $i18n().t("local"),
                                          () => $i18n().t("cloud"),
                                          () => get(RAGConfig).MINERU_API_MODE === "cloud" ? $i18n().t("https://mineru.net/api/v4") : $i18n().t("http://localhost:8000")
                                        ]
                                      );
                                      bind_select_value(select_2, () => get(RAGConfig).MINERU_API_MODE, ($$value) => mutate(RAGConfig, get(RAGConfig).MINERU_API_MODE = $$value));
                                      event("change", select_2, () => {
                                        const cloudUrl = "https://mineru.net/api/v4";
                                        const localUrl = "http://localhost:8000";
                                        if (get(RAGConfig).MINERU_API_MODE === "cloud") {
                                          if (!get(RAGConfig).MINERU_API_URL || get(RAGConfig).MINERU_API_URL === localUrl) {
                                            mutate(RAGConfig, get(RAGConfig).MINERU_API_URL = cloudUrl);
                                          }
                                        } else {
                                          if (!get(RAGConfig).MINERU_API_URL || get(RAGConfig).MINERU_API_URL === cloudUrl) {
                                            mutate(RAGConfig, get(RAGConfig).MINERU_API_URL = localUrl);
                                          }
                                        }
                                      });
                                      bind_value(input_6, () => get(RAGConfig).MINERU_API_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).MINERU_API_URL = $$value));
                                      append($$anchor10, fragment_20);
                                    };
                                    if_block(
                                      node_35,
                                      ($$render) => {
                                        if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "mineru") $$render(consequent_7);
                                      },
                                      true
                                    );
                                  }
                                  append($$anchor9, fragment_19);
                                };
                                if_block(
                                  node_33,
                                  ($$render) => {
                                    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "mistral_ocr") $$render(consequent_6);
                                    else $$render(alternate, false);
                                  },
                                  true
                                );
                              }
                              append($$anchor8, fragment_18);
                            };
                            if_block(
                              node_31,
                              ($$render) => {
                                if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "document_intelligence") $$render(consequent_5);
                                else $$render(alternate_1, false);
                              },
                              true
                            );
                          }
                          append($$anchor7, fragment_17);
                        };
                        if_block(
                          node_28,
                          ($$render) => {
                            if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "docling") $$render(consequent_4);
                            else $$render(alternate_2, false);
                          },
                          true
                        );
                      }
                      append($$anchor6, fragment_15);
                    };
                    if_block(
                      node_27,
                      ($$render) => {
                        if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "tika") $$render(consequent_3);
                        else $$render(alternate_3, false);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_14);
                };
                if_block(
                  node_25,
                  ($$render) => {
                    if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "external") $$render(consequent_2);
                    else $$render(alternate_4, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_13);
            };
            if_block(
              node_6,
              ($$render) => {
                if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "datalab_marker") $$render(consequent_1);
                else $$render(alternate_5, false);
              },
              true
            );
          }
          append($$anchor3, fragment_2);
        };
        if_block(node_4, ($$render) => {
          if (get(RAGConfig).CONTENT_EXTRACTION_ENGINE === "") $$render(consequent);
          else $$render(alternate_6, false);
        });
      }
      reset(div_4);
      var div_60 = sibling(div_4, 2);
      var div_61 = child(div_60);
      var node_39 = child(div_61);
      {
        let $0 = derived_safe_equal(() => $i18n().t("Full Context Mode"));
        Tooltip(node_39, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            next();
            var text_28 = text();
            template_effect(($02) => set_text(text_28, $02), [() => $i18n().t("Bypass Embedding and Retrieval")]);
            append($$anchor3, text_28);
          },
          $$slots: { default: true }
        });
      }
      reset(div_61);
      var div_62 = sibling(div_61, 2);
      var node_40 = child(div_62);
      {
        let $0 = derived_safe_equal(() => get(RAGConfig).BYPASS_EMBEDDING_AND_RETRIEVAL ? $i18n().t("Inject the entire content as context for comprehensive processing, this is recommended for complex queries.") : $i18n().t("Default to segmented retrieval for focused and relevant content extraction, this is recommended for most cases."));
        Tooltip(node_40, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            Switch_1($$anchor3, {
              get state() {
                return get(RAGConfig).BYPASS_EMBEDDING_AND_RETRIEVAL;
              },
              set state($$value) {
                mutate(RAGConfig, get(RAGConfig).BYPASS_EMBEDDING_AND_RETRIEVAL = $$value);
              },
              $$legacy: true
            });
          },
          $$slots: { default: true }
        });
      }
      reset(div_62);
      reset(div_60);
      var node_41 = sibling(div_60, 2);
      {
        var consequent_8 = ($$anchor3) => {
          var fragment_24 = root_30$1();
          var div_63 = first_child(fragment_24);
          var div_64 = child(div_63);
          var text_29 = child(div_64, true);
          reset(div_64);
          var div_65 = sibling(div_64, 2);
          var select_3 = child(div_65);
          template_effect(() => {
            get(RAGConfig);
            invalidate_inner_signals(() => {
              $i18n();
            });
          });
          var option_13 = child(select_3);
          var text_30 = child(option_13);
          reset(option_13);
          option_13.value = option_13.__value = "";
          var option_14 = sibling(option_13);
          var text_31 = child(option_14);
          reset(option_14);
          option_14.value = option_14.__value = "token";
          var option_15 = sibling(option_14);
          var text_32 = child(option_15, true);
          reset(option_15);
          option_15.value = option_15.__value = "markdown_header";
          reset(select_3);
          reset(div_65);
          reset(div_63);
          var div_66 = sibling(div_63, 2);
          var div_67 = child(div_66);
          var div_68 = child(div_67);
          var div_69 = child(div_68);
          var text_33 = child(div_69, true);
          reset(div_69);
          var div_70 = sibling(div_69, 2);
          var input_7 = child(div_70);
          remove_input_defaults(input_7);
          reset(div_70);
          reset(div_68);
          var div_71 = sibling(div_68, 2);
          var div_72 = child(div_71);
          var text_34 = child(div_72, true);
          reset(div_72);
          var div_73 = sibling(div_72, 2);
          var input_8 = child(div_73);
          remove_input_defaults(input_8);
          reset(div_73);
          reset(div_71);
          reset(div_67);
          reset(div_66);
          template_effect(
            ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9) => {
              set_text(text_29, $0);
              set_text(text_30, `${$1 ?? ""} (${$2 ?? ""})`);
              set_text(text_31, `${$3 ?? ""} (${$4 ?? ""})`);
              set_text(text_32, $5);
              set_text(text_33, $6);
              set_attribute(input_7, "placeholder", $7);
              set_text(text_34, $8);
              set_attribute(input_8, "placeholder", $9);
            },
            [
              () => $i18n().t("Text Splitter"),
              () => $i18n().t("Default"),
              () => $i18n().t("Character"),
              () => $i18n().t("Token"),
              () => $i18n().t("Tiktoken"),
              () => $i18n().t("Markdown (Header)"),
              () => $i18n().t("Chunk Size"),
              () => $i18n().t("Enter Chunk Size"),
              () => $i18n().t("Chunk Overlap"),
              () => $i18n().t("Enter Chunk Overlap")
            ]
          );
          bind_select_value(select_3, () => get(RAGConfig).TEXT_SPLITTER, ($$value) => mutate(RAGConfig, get(RAGConfig).TEXT_SPLITTER = $$value));
          bind_value(input_7, () => get(RAGConfig).CHUNK_SIZE, ($$value) => mutate(RAGConfig, get(RAGConfig).CHUNK_SIZE = $$value));
          bind_value(input_8, () => get(RAGConfig).CHUNK_OVERLAP, ($$value) => mutate(RAGConfig, get(RAGConfig).CHUNK_OVERLAP = $$value));
          append($$anchor3, fragment_24);
        };
        if_block(node_41, ($$render) => {
          if (!get(RAGConfig).BYPASS_EMBEDDING_AND_RETRIEVAL) $$render(consequent_8);
        });
      }
      reset(div_2);
      var node_42 = sibling(div_2, 2);
      {
        var consequent_24 = ($$anchor3) => {
          var fragment_25 = root_31();
          var div_74 = first_child(fragment_25);
          var div_75 = child(div_74);
          var text_35 = child(div_75, true);
          reset(div_75);
          var div_76 = sibling(div_75, 4);
          var div_77 = child(div_76);
          var div_78 = child(div_77);
          var text_36 = child(div_78, true);
          reset(div_78);
          var div_79 = sibling(div_78, 2);
          var select_4 = child(div_79);
          template_effect(() => {
            get(RAG_EMBEDDING_ENGINE);
            invalidate_inner_signals(() => {
              $i18n();
              get(RAG_EMBEDDING_MODEL);
            });
          });
          var option_16 = child(select_4);
          var text_37 = child(option_16, true);
          reset(option_16);
          option_16.value = option_16.__value = "";
          var option_17 = sibling(option_16);
          var text_38 = child(option_17, true);
          reset(option_17);
          option_17.value = option_17.__value = "ollama";
          var option_18 = sibling(option_17);
          var text_39 = child(option_18, true);
          reset(option_18);
          option_18.value = option_18.__value = "openai";
          var option_19 = sibling(option_18);
          var text_40 = child(option_19, true);
          reset(option_19);
          option_19.value = option_19.__value = "azure_openai";
          reset(select_4);
          reset(div_79);
          reset(div_77);
          var node_43 = sibling(div_77, 2);
          {
            var consequent_9 = ($$anchor4) => {
              var div_80 = root_32$1();
              var input_9 = child(div_80);
              remove_input_defaults(input_9);
              var node_44 = sibling(input_9, 2);
              {
                let $0 = derived_safe_equal(() => $i18n().t("API Key"));
                SensitiveInput(node_44, {
                  get placeholder() {
                    return get($0);
                  },
                  required: false,
                  get value() {
                    return get(OpenAIKey);
                  },
                  set value($$value) {
                    set(OpenAIKey, $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_80);
              template_effect(($0) => set_attribute(input_9, "placeholder", $0), [() => $i18n().t("API Base URL")]);
              bind_value(input_9, () => get(OpenAIUrl), ($$value) => set(OpenAIUrl, $$value));
              append($$anchor4, div_80);
            };
            var alternate_8 = ($$anchor4) => {
              var fragment_26 = comment();
              var node_45 = first_child(fragment_26);
              {
                var consequent_10 = ($$anchor5) => {
                  var div_81 = root_34$1();
                  var input_10 = child(div_81);
                  remove_input_defaults(input_10);
                  var node_46 = sibling(input_10, 2);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("API Key"));
                    SensitiveInput(node_46, {
                      get placeholder() {
                        return get($0);
                      },
                      required: false,
                      get value() {
                        return get(OllamaKey);
                      },
                      set value($$value) {
                        set(OllamaKey, $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_81);
                  template_effect(($0) => set_attribute(input_10, "placeholder", $0), [() => $i18n().t("API Base URL")]);
                  bind_value(input_10, () => get(OllamaUrl), ($$value) => set(OllamaUrl, $$value));
                  append($$anchor5, div_81);
                };
                var alternate_7 = ($$anchor5) => {
                  var fragment_27 = comment();
                  var node_47 = first_child(fragment_27);
                  {
                    var consequent_11 = ($$anchor6) => {
                      var div_82 = root_36$1();
                      var div_83 = child(div_82);
                      var input_11 = child(div_83);
                      remove_input_defaults(input_11);
                      var node_48 = sibling(input_11, 2);
                      {
                        let $0 = derived_safe_equal(() => $i18n().t("API Key"));
                        SensitiveInput(node_48, {
                          get placeholder() {
                            return get($0);
                          },
                          get value() {
                            return get(AzureOpenAIKey);
                          },
                          set value($$value) {
                            set(AzureOpenAIKey, $$value);
                          },
                          $$legacy: true
                        });
                      }
                      reset(div_83);
                      var div_84 = sibling(div_83, 2);
                      var input_12 = child(div_84);
                      remove_input_defaults(input_12);
                      reset(div_84);
                      reset(div_82);
                      template_effect(
                        ($0, $1) => {
                          set_attribute(input_11, "placeholder", $0);
                          set_attribute(input_12, "placeholder", $1);
                        },
                        [() => $i18n().t("API Base URL"), () => $i18n().t("Version")]
                      );
                      bind_value(input_11, () => get(AzureOpenAIUrl), ($$value) => set(AzureOpenAIUrl, $$value));
                      bind_value(input_12, () => get(AzureOpenAIVersion), ($$value) => set(AzureOpenAIVersion, $$value));
                      append($$anchor6, div_82);
                    };
                    if_block(
                      node_47,
                      ($$render) => {
                        if (get(RAG_EMBEDDING_ENGINE) === "azure_openai") $$render(consequent_11);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_27);
                };
                if_block(
                  node_45,
                  ($$render) => {
                    if (get(RAG_EMBEDDING_ENGINE) === "ollama") $$render(consequent_10);
                    else $$render(alternate_7, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_26);
            };
            if_block(node_43, ($$render) => {
              if (get(RAG_EMBEDDING_ENGINE) === "openai") $$render(consequent_9);
              else $$render(alternate_8, false);
            });
          }
          reset(div_76);
          var div_85 = sibling(div_76, 2);
          var div_86 = child(div_85);
          var text_41 = child(div_86, true);
          reset(div_86);
          var div_87 = sibling(div_86, 2);
          var node_49 = child(div_87);
          {
            var consequent_12 = ($$anchor4) => {
              var div_88 = root_37();
              var div_89 = child(div_88);
              var input_13 = child(div_89);
              remove_input_defaults(input_13);
              reset(div_89);
              reset(div_88);
              template_effect(($0) => set_attribute(input_13, "placeholder", $0), [() => $i18n().t("Set embedding model")]);
              bind_value(input_13, () => get(RAG_EMBEDDING_MODEL), ($$value) => set(RAG_EMBEDDING_MODEL, $$value));
              append($$anchor4, div_88);
            };
            var alternate_10 = ($$anchor4) => {
              var div_90 = root_38$1();
              var div_91 = child(div_90);
              var input_14 = child(div_91);
              remove_input_defaults(input_14);
              reset(div_91);
              var node_50 = sibling(div_91, 2);
              {
                var consequent_14 = ($$anchor5) => {
                  var button = root_39();
                  var node_51 = child(button);
                  {
                    var consequent_13 = ($$anchor6) => {
                      var div_92 = root_40$1();
                      var node_52 = child(div_92);
                      Spinner(node_52, {});
                      reset(div_92);
                      append($$anchor6, div_92);
                    };
                    var alternate_9 = ($$anchor6) => {
                      var svg = root_41();
                      append($$anchor6, svg);
                    };
                    if_block(node_51, ($$render) => {
                      if (get(updateEmbeddingModelLoading)) $$render(consequent_13);
                      else $$render(alternate_9, false);
                    });
                  }
                  reset(button);
                  template_effect(() => button.disabled = get(updateEmbeddingModelLoading));
                  event("click", button, () => {
                    embeddingModelUpdateHandler();
                  });
                  append($$anchor5, button);
                };
                if_block(node_50, ($$render) => {
                  if (get(RAG_EMBEDDING_ENGINE) === "") $$render(consequent_14);
                });
              }
              reset(div_90);
              template_effect(($0) => set_attribute(input_14, "placeholder", $0), [
                () => $i18n().t("Set embedding model (e.g. {{model}})", { model: get(RAG_EMBEDDING_MODEL).slice(-40) })
              ]);
              bind_value(input_14, () => get(RAG_EMBEDDING_MODEL), ($$value) => set(RAG_EMBEDDING_MODEL, $$value));
              append($$anchor4, div_90);
            };
            if_block(node_49, ($$render) => {
              if (get(RAG_EMBEDDING_ENGINE) === "ollama") $$render(consequent_12);
              else $$render(alternate_10, false);
            });
          }
          reset(div_87);
          var div_93 = sibling(div_87, 2);
          var text_42 = child(div_93, true);
          reset(div_93);
          reset(div_85);
          var node_53 = sibling(div_85, 2);
          {
            var consequent_15 = ($$anchor4) => {
              var fragment_28 = root_42$1();
              var div_94 = first_child(fragment_28);
              var div_95 = child(div_94);
              var text_43 = child(div_95, true);
              reset(div_95);
              var div_96 = sibling(div_95, 2);
              var input_15 = child(div_96);
              remove_input_defaults(input_15);
              reset(div_96);
              reset(div_94);
              var div_97 = sibling(div_94, 2);
              var div_98 = child(div_97);
              var node_54 = child(div_98);
              {
                let $0 = derived_safe_equal(() => $i18n().t("Runs embedding tasks concurrently to speed up processing. Turn off if rate limits become an issue."));
                Tooltip(node_54, {
                  get content() {
                    return get($0);
                  },
                  placement: "top-start",
                  children: ($$anchor5, $$slotProps) => {
                    next();
                    var text_44 = text();
                    template_effect(($02) => set_text(text_44, $02), [() => $i18n().t("Async Embedding Processing")]);
                    append($$anchor5, text_44);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_98);
              var div_99 = sibling(div_98, 2);
              var node_55 = child(div_99);
              Switch_1(node_55, {
                get state() {
                  return get(ENABLE_ASYNC_EMBEDDING);
                },
                set state($$value) {
                  set(ENABLE_ASYNC_EMBEDDING, $$value);
                },
                $$legacy: true
              });
              reset(div_99);
              reset(div_97);
              template_effect(($0) => set_text(text_43, $0), [() => $i18n().t("Embedding Batch Size")]);
              bind_value(input_15, () => get(RAG_EMBEDDING_BATCH_SIZE), ($$value) => set(RAG_EMBEDDING_BATCH_SIZE, $$value));
              append($$anchor4, fragment_28);
            };
            if_block(node_53, ($$render) => {
              if (get(RAG_EMBEDDING_ENGINE) === "ollama" || get(RAG_EMBEDDING_ENGINE) === "openai" || get(RAG_EMBEDDING_ENGINE) === "azure_openai") $$render(consequent_15);
            });
          }
          reset(div_74);
          var div_100 = sibling(div_74, 2);
          var div_101 = child(div_100);
          var text_45 = child(div_101, true);
          reset(div_101);
          var div_102 = sibling(div_101, 4);
          var div_103 = child(div_102);
          var text_46 = child(div_103, true);
          reset(div_103);
          var div_104 = sibling(div_103, 2);
          var node_56 = child(div_104);
          {
            let $0 = derived_safe_equal(() => get(RAGConfig).RAG_FULL_CONTEXT ? $i18n().t("Inject the entire content as context for comprehensive processing, this is recommended for complex queries.") : $i18n().t("Default to segmented retrieval for focused and relevant content extraction, this is recommended for most cases."));
            Tooltip(node_56, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                Switch_1($$anchor4, {
                  get state() {
                    return get(RAGConfig).RAG_FULL_CONTEXT;
                  },
                  set state($$value) {
                    mutate(RAGConfig, get(RAGConfig).RAG_FULL_CONTEXT = $$value);
                  },
                  $$legacy: true
                });
              },
              $$slots: { default: true }
            });
          }
          reset(div_104);
          reset(div_102);
          var node_57 = sibling(div_102, 2);
          {
            var consequent_23 = ($$anchor4) => {
              var fragment_31 = root_45();
              var div_105 = first_child(fragment_31);
              var div_106 = child(div_105);
              var text_47 = child(div_106, true);
              reset(div_106);
              var div_107 = sibling(div_106, 2);
              var node_58 = child(div_107);
              Switch_1(node_58, {
                get state() {
                  return get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH;
                },
                set state($$value) {
                  mutate(RAGConfig, get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH = $$value);
                },
                $$legacy: true
              });
              reset(div_107);
              reset(div_105);
              var node_59 = sibling(div_105, 2);
              {
                var consequent_17 = ($$anchor5) => {
                  var fragment_32 = root_46$1();
                  var div_108 = first_child(fragment_32);
                  var div_109 = child(div_108);
                  var text_48 = child(div_109, true);
                  reset(div_109);
                  var div_110 = sibling(div_109, 2);
                  var node_60 = child(div_110);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("Adds filenames, titles, sections, and snippets into the BM25 text to improve lexical recall."));
                    Tooltip(node_60, {
                      get content() {
                        return get($0);
                      },
                      children: ($$anchor6, $$slotProps) => {
                        Switch_1($$anchor6, {
                          get state() {
                            return get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH_ENRICHED_TEXTS;
                          },
                          set state($$value) {
                            mutate(RAGConfig, get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH_ENRICHED_TEXTS = $$value);
                          },
                          $$legacy: true
                        });
                      },
                      $$slots: { default: true }
                    });
                  }
                  reset(div_110);
                  reset(div_108);
                  var div_111 = sibling(div_108, 2);
                  var div_112 = child(div_111);
                  var div_113 = child(div_112);
                  var text_49 = child(div_113, true);
                  reset(div_113);
                  var div_114 = sibling(div_113, 2);
                  var select_5 = child(div_114);
                  template_effect(() => {
                    get(RAGConfig);
                    invalidate_inner_signals(() => {
                      $i18n();
                    });
                  });
                  var option_20 = child(select_5);
                  var text_50 = child(option_20, true);
                  reset(option_20);
                  option_20.value = option_20.__value = "";
                  var option_21 = sibling(option_20);
                  var text_51 = child(option_21, true);
                  reset(option_21);
                  option_21.value = option_21.__value = "external";
                  reset(select_5);
                  reset(div_114);
                  reset(div_112);
                  var node_61 = sibling(div_112, 2);
                  {
                    var consequent_16 = ($$anchor6) => {
                      var div_115 = root_48$1();
                      var input_16 = child(div_115);
                      remove_input_defaults(input_16);
                      var node_62 = sibling(input_16, 2);
                      {
                        let $0 = derived_safe_equal(() => $i18n().t("API Key"));
                        SensitiveInput(node_62, {
                          get placeholder() {
                            return get($0);
                          },
                          required: false,
                          get value() {
                            return get(RAGConfig).RAG_EXTERNAL_RERANKER_API_KEY;
                          },
                          set value($$value) {
                            mutate(RAGConfig, get(RAGConfig).RAG_EXTERNAL_RERANKER_API_KEY = $$value);
                          },
                          $$legacy: true
                        });
                      }
                      reset(div_115);
                      template_effect(($0) => set_attribute(input_16, "placeholder", $0), [() => $i18n().t("API Base URL")]);
                      bind_value(input_16, () => get(RAGConfig).RAG_EXTERNAL_RERANKER_URL, ($$value) => mutate(RAGConfig, get(RAGConfig).RAG_EXTERNAL_RERANKER_URL = $$value));
                      append($$anchor6, div_115);
                    };
                    if_block(node_61, ($$render) => {
                      if (get(RAGConfig).RAG_RERANKING_ENGINE === "external") $$render(consequent_16);
                    });
                  }
                  reset(div_111);
                  var div_116 = sibling(div_111, 2);
                  var div_117 = child(div_116);
                  var text_52 = child(div_117, true);
                  reset(div_117);
                  var div_118 = sibling(div_117, 2);
                  var div_119 = child(div_118);
                  var div_120 = child(div_119);
                  var input_17 = child(div_120);
                  remove_input_defaults(input_17);
                  reset(div_120);
                  reset(div_119);
                  reset(div_118);
                  reset(div_116);
                  template_effect(
                    ($0, $1, $2, $3, $4, $5, $6) => {
                      set_text(text_48, $0);
                      set_text(text_49, $1);
                      set_attribute(select_5, "placeholder", $2);
                      set_text(text_50, $3);
                      set_text(text_51, $4);
                      set_text(text_52, $5);
                      set_attribute(input_17, "placeholder", $6);
                    },
                    [
                      () => $i18n().t("Enrich Hybrid Search Text"),
                      () => $i18n().t("Reranking Engine"),
                      () => $i18n().t("Select a reranking model engine"),
                      () => $i18n().t("Default (SentenceTransformers)"),
                      () => $i18n().t("External"),
                      () => $i18n().t("Reranking Model"),
                      () => $i18n().t("Set reranking model (e.g. {{model}})", { model: "BAAI/bge-reranker-v2-m3" })
                    ]
                  );
                  bind_select_value(select_5, () => get(RAGConfig).RAG_RERANKING_ENGINE, ($$value) => mutate(RAGConfig, get(RAGConfig).RAG_RERANKING_ENGINE = $$value));
                  event("change", select_5, (e) => {
                    if (e.target.value === "external") {
                      mutate(RAGConfig, get(RAGConfig).RAG_RERANKING_MODEL = "");
                    } else if (e.target.value === "") {
                      mutate(RAGConfig, get(RAGConfig).RAG_RERANKING_MODEL = "BAAI/bge-reranker-v2-m3");
                    }
                  });
                  bind_value(input_17, () => get(RAGConfig).RAG_RERANKING_MODEL, ($$value) => mutate(RAGConfig, get(RAGConfig).RAG_RERANKING_MODEL = $$value));
                  append($$anchor5, fragment_32);
                };
                if_block(node_59, ($$render) => {
                  if (get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH === true) $$render(consequent_17);
                });
              }
              var div_121 = sibling(node_59, 2);
              var div_122 = child(div_121);
              var text_53 = child(div_122, true);
              reset(div_122);
              var div_123 = sibling(div_122, 2);
              var input_18 = child(div_123);
              remove_input_defaults(input_18);
              reset(div_123);
              reset(div_121);
              var node_63 = sibling(div_121, 2);
              {
                var consequent_18 = ($$anchor5) => {
                  var div_124 = root_49();
                  var div_125 = child(div_124);
                  var text_54 = child(div_125, true);
                  reset(div_125);
                  var div_126 = sibling(div_125, 2);
                  var input_19 = child(div_126);
                  remove_input_defaults(input_19);
                  reset(div_126);
                  reset(div_124);
                  template_effect(
                    ($0, $1) => {
                      set_text(text_54, $0);
                      set_attribute(input_19, "placeholder", $1);
                    },
                    [
                      () => $i18n().t("Top K Reranker"),
                      () => $i18n().t("Enter Top K Reranker")
                    ]
                  );
                  bind_value(input_19, () => get(RAGConfig).TOP_K_RERANKER, ($$value) => mutate(RAGConfig, get(RAGConfig).TOP_K_RERANKER = $$value));
                  append($$anchor5, div_124);
                };
                if_block(node_63, ($$render) => {
                  if (get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH === true) $$render(consequent_18);
                });
              }
              var node_64 = sibling(node_63, 2);
              {
                var consequent_19 = ($$anchor5) => {
                  var div_127 = root_50$1();
                  var div_128 = child(div_127);
                  var div_129 = child(div_128);
                  var text_55 = child(div_129, true);
                  reset(div_129);
                  var div_130 = sibling(div_129, 2);
                  var input_20 = child(div_130);
                  remove_input_defaults(input_20);
                  reset(div_130);
                  reset(div_128);
                  var div_131 = sibling(div_128, 2);
                  var text_56 = child(div_131, true);
                  reset(div_131);
                  reset(div_127);
                  template_effect(
                    ($0, $1, $2, $3) => {
                      set_text(text_55, $0);
                      set_attribute(input_20, "placeholder", $1);
                      set_attribute(input_20, "title", $2);
                      set_text(text_56, $3);
                    },
                    [
                      () => $i18n().t("Relevance Threshold"),
                      () => $i18n().t("Enter Score"),
                      () => $i18n().t("The score should be a value between 0.0 (0%) and 1.0 (100%)."),
                      () => $i18n().t("Note: If you set a minimum score, the search will only return documents with a score greater than or equal to the minimum score.")
                    ]
                  );
                  bind_value(input_20, () => get(RAGConfig).RELEVANCE_THRESHOLD, ($$value) => mutate(RAGConfig, get(RAGConfig).RELEVANCE_THRESHOLD = $$value));
                  append($$anchor5, div_127);
                };
                if_block(node_64, ($$render) => {
                  if (get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH === true) $$render(consequent_19);
                });
              }
              var node_65 = sibling(node_64, 2);
              {
                var consequent_22 = ($$anchor5) => {
                  var div_132 = root_51$1();
                  var node_66 = child(div_132);
                  {
                    let $0 = derived_safe_equal(() => $i18n().t("The Weight of BM25 Hybrid Search. 0 more semantic, 1 more lexical. Default 0.5"));
                    Tooltip(node_66, {
                      get content() {
                        return get($0);
                      },
                      placement: "top-start",
                      className: "inline-tooltip",
                      children: ($$anchor6, $$slotProps) => {
                        var div_133 = root_52();
                        var div_134 = child(div_133);
                        var text_57 = child(div_134, true);
                        reset(div_134);
                        var button_1 = sibling(div_134, 2);
                        var node_67 = child(button_1);
                        {
                          var consequent_20 = ($$anchor7) => {
                            var span = root_53();
                            var text_58 = child(span, true);
                            reset(span);
                            template_effect(($02) => set_text(text_58, $02), [() => $i18n().t("Default")]);
                            append($$anchor7, span);
                          };
                          var alternate_11 = ($$anchor7) => {
                            var span_1 = root_54();
                            var text_59 = child(span_1, true);
                            reset(span_1);
                            template_effect(($02) => set_text(text_59, $02), [() => $i18n().t("Custom")]);
                            append($$anchor7, span_1);
                          };
                          if_block(node_67, ($$render) => {
                            var _a;
                            if ((((_a = get(RAGConfig)) == null ? void 0 : _a.HYBRID_BM25_WEIGHT) ?? null) === null) $$render(consequent_20);
                            else $$render(alternate_11, false);
                          });
                        }
                        reset(button_1);
                        reset(div_133);
                        template_effect(($02) => set_text(text_57, $02), [() => $i18n().t("BM25 Weight")]);
                        event("click", button_1, () => {
                          var _a;
                          mutate(RAGConfig, get(RAGConfig).HYBRID_BM25_WEIGHT = (((_a = get(RAGConfig)) == null ? void 0 : _a.HYBRID_BM25_WEIGHT) ?? null) === null ? 0.5 : null);
                        });
                        append($$anchor6, div_133);
                      },
                      $$slots: { default: true }
                    });
                  }
                  var node_68 = sibling(node_66, 2);
                  {
                    var consequent_21 = ($$anchor6) => {
                      var div_135 = root_55();
                      var div_136 = child(div_135);
                      var input_21 = child(div_136);
                      remove_input_defaults(input_21);
                      var div_137 = sibling(input_21, 2);
                      var div_138 = child(div_137);
                      var div_139 = child(div_138);
                      var text_60 = child(div_139, true);
                      reset(div_139);
                      var div_140 = sibling(div_139, 2);
                      var text_61 = child(div_140, true);
                      reset(div_140);
                      reset(div_138);
                      reset(div_137);
                      reset(div_136);
                      var div_141 = sibling(div_136, 2);
                      var input_22 = child(div_141);
                      remove_input_defaults(input_22);
                      reset(div_141);
                      reset(div_135);
                      template_effect(
                        ($0, $1) => {
                          set_text(text_60, $0);
                          set_text(text_61, $1);
                        },
                        [() => $i18n().t("semantic"), () => $i18n().t("lexical")]
                      );
                      bind_value(input_21, () => get(RAGConfig).HYBRID_BM25_WEIGHT, ($$value) => mutate(RAGConfig, get(RAGConfig).HYBRID_BM25_WEIGHT = $$value));
                      bind_value(input_22, () => get(RAGConfig).HYBRID_BM25_WEIGHT, ($$value) => mutate(RAGConfig, get(RAGConfig).HYBRID_BM25_WEIGHT = $$value));
                      append($$anchor6, div_135);
                    };
                    if_block(node_68, ($$render) => {
                      var _a;
                      if ((((_a = get(RAGConfig)) == null ? void 0 : _a.HYBRID_BM25_WEIGHT) ?? null) !== null) $$render(consequent_21);
                    });
                  }
                  reset(div_132);
                  append($$anchor5, div_132);
                };
                if_block(node_65, ($$render) => {
                  if (get(RAGConfig).ENABLE_RAG_HYBRID_SEARCH === true) $$render(consequent_22);
                });
              }
              template_effect(
                ($0, $1, $2) => {
                  set_text(text_47, $0);
                  set_text(text_53, $1);
                  set_attribute(input_18, "placeholder", $2);
                },
                [
                  () => $i18n().t("Hybrid Search"),
                  () => $i18n().t("Top K"),
                  () => $i18n().t("Enter Top K")
                ]
              );
              bind_value(input_18, () => get(RAGConfig).TOP_K, ($$value) => mutate(RAGConfig, get(RAGConfig).TOP_K = $$value));
              append($$anchor4, fragment_31);
            };
            if_block(node_57, ($$render) => {
              if (!get(RAGConfig).RAG_FULL_CONTEXT) $$render(consequent_23);
            });
          }
          var div_142 = sibling(node_57, 2);
          var div_143 = child(div_142);
          var text_62 = child(div_143, true);
          reset(div_143);
          var div_144 = sibling(div_143, 2);
          var node_69 = child(div_144);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
            Tooltip(node_69, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              className: "w-full",
              children: ($$anchor4, $$slotProps) => {
                {
                  let $02 = derived_safe_equal(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"));
                  Textarea($$anchor4, {
                    get placeholder() {
                      return get($02);
                    },
                    get value() {
                      return get(RAGConfig).RAG_TEMPLATE;
                    },
                    set value($$value) {
                      mutate(RAGConfig, get(RAGConfig).RAG_TEMPLATE = $$value);
                    },
                    $$legacy: true
                  });
                }
              },
              $$slots: { default: true }
            });
          }
          reset(div_144);
          reset(div_142);
          reset(div_100);
          template_effect(
            ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11) => {
              set_text(text_35, $0);
              set_text(text_36, $1);
              set_attribute(select_4, "placeholder", $2);
              set_text(text_37, $3);
              set_text(text_38, $4);
              set_text(text_39, $5);
              set_text(text_40, $6);
              set_text(text_41, $7);
              set_text(text_42, $8);
              set_text(text_45, $9);
              set_text(text_46, $10);
              set_text(text_62, $11);
            },
            [
              () => $i18n().t("Embedding"),
              () => $i18n().t("Embedding Model Engine"),
              () => $i18n().t("Select an embedding model engine"),
              () => $i18n().t("Default (SentenceTransformers)"),
              () => $i18n().t("Ollama"),
              () => $i18n().t("OpenAI"),
              () => $i18n().t("Azure OpenAI"),
              () => $i18n().t("Embedding Model"),
              () => $i18n().t('After updating or changing the embedding model, you must reindex the knowledge base for the changes to take effect. You can do this using the "Reindex" button below.'),
              () => $i18n().t("Retrieval"),
              () => $i18n().t("Full Context Mode"),
              () => $i18n().t("RAG Template")
            ]
          );
          bind_select_value(select_4, () => get(RAG_EMBEDDING_ENGINE), ($$value) => set(RAG_EMBEDDING_ENGINE, $$value));
          event("change", select_4, (e) => {
            if (e.target.value === "ollama") {
              set(RAG_EMBEDDING_MODEL, "");
            } else if (e.target.value === "openai") {
              set(RAG_EMBEDDING_MODEL, "text-embedding-3-small");
            } else if (e.target.value === "azure_openai") {
              set(RAG_EMBEDDING_MODEL, "text-embedding-3-small");
            } else if (e.target.value === "") {
              set(RAG_EMBEDDING_MODEL, "sentence-transformers/all-MiniLM-L6-v2");
            }
          });
          append($$anchor3, fragment_25);
        };
        if_block(node_42, ($$render) => {
          if (!get(RAGConfig).BYPASS_EMBEDDING_AND_RETRIEVAL) $$render(consequent_24);
        });
      }
      var div_145 = sibling(node_42, 2);
      var div_146 = child(div_145);
      var text_63 = child(div_146, true);
      reset(div_146);
      var div_147 = sibling(div_146, 4);
      var div_148 = child(div_147);
      var text_64 = child(div_148, true);
      reset(div_148);
      var div_149 = sibling(div_148, 2);
      var node_70 = child(div_149);
      {
        let $0 = derived_safe_equal(() => $i18n().t("Allowed file extensions for upload. Separate multiple extensions with commas. Leave empty for all file types."));
        Tooltip(node_70, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            var input_23 = root_57$1();
            remove_input_defaults(input_23);
            template_effect(($02) => set_attribute(input_23, "placeholder", $02), [() => $i18n().t("e.g. pdf, docx, txt")]);
            bind_value(input_23, () => get(RAGConfig).ALLOWED_FILE_EXTENSIONS, ($$value) => mutate(RAGConfig, get(RAGConfig).ALLOWED_FILE_EXTENSIONS = $$value));
            append($$anchor3, input_23);
          },
          $$slots: { default: true }
        });
      }
      reset(div_149);
      reset(div_147);
      var div_150 = sibling(div_147, 2);
      var div_151 = child(div_150);
      var text_65 = child(div_151, true);
      reset(div_151);
      var div_152 = sibling(div_151, 2);
      var node_71 = child(div_152);
      {
        let $0 = derived_safe_equal(() => $i18n().t("The maximum file size in MB. If the file size exceeds this limit, the file will not be uploaded."));
        Tooltip(node_71, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            var input_24 = root_58$1();
            remove_input_defaults(input_24);
            template_effect(($02) => set_attribute(input_24, "placeholder", $02), [() => $i18n().t("Leave empty for unlimited")]);
            bind_value(input_24, () => get(RAGConfig).FILE_MAX_SIZE, ($$value) => mutate(RAGConfig, get(RAGConfig).FILE_MAX_SIZE = $$value));
            append($$anchor3, input_24);
          },
          $$slots: { default: true }
        });
      }
      reset(div_152);
      reset(div_150);
      var div_153 = sibling(div_150, 2);
      var div_154 = child(div_153);
      var text_66 = child(div_154, true);
      reset(div_154);
      var div_155 = sibling(div_154, 2);
      var node_72 = child(div_155);
      {
        let $0 = derived_safe_equal(() => $i18n().t("The maximum number of files that can be used at once in chat. If the number of files exceeds this limit, the files will not be uploaded."));
        Tooltip(node_72, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            var input_25 = root_59();
            remove_input_defaults(input_25);
            template_effect(($02) => set_attribute(input_25, "placeholder", $02), [() => $i18n().t("Leave empty for unlimited")]);
            bind_value(input_25, () => get(RAGConfig).FILE_MAX_COUNT, ($$value) => mutate(RAGConfig, get(RAGConfig).FILE_MAX_COUNT = $$value));
            append($$anchor3, input_25);
          },
          $$slots: { default: true }
        });
      }
      reset(div_155);
      reset(div_153);
      var div_156 = sibling(div_153, 2);
      var div_157 = child(div_156);
      var text_67 = child(div_157, true);
      reset(div_157);
      var div_158 = sibling(div_157, 2);
      var node_73 = child(div_158);
      {
        let $0 = derived_safe_equal(() => $i18n().t("The width in pixels to compress images to. Leave empty for no compression."));
        Tooltip(node_73, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            var input_26 = root_60$1();
            remove_input_defaults(input_26);
            template_effect(($02) => set_attribute(input_26, "placeholder", $02), [() => $i18n().t("Leave empty for no compression")]);
            bind_value(input_26, () => get(RAGConfig).FILE_IMAGE_COMPRESSION_WIDTH, ($$value) => mutate(RAGConfig, get(RAGConfig).FILE_IMAGE_COMPRESSION_WIDTH = $$value));
            append($$anchor3, input_26);
          },
          $$slots: { default: true }
        });
      }
      reset(div_158);
      reset(div_156);
      var div_159 = sibling(div_156, 2);
      var div_160 = child(div_159);
      var text_68 = child(div_160, true);
      reset(div_160);
      var div_161 = sibling(div_160, 2);
      var node_74 = child(div_161);
      {
        let $0 = derived_safe_equal(() => $i18n().t("The height in pixels to compress images to. Leave empty for no compression."));
        Tooltip(node_74, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            var input_27 = root_61();
            remove_input_defaults(input_27);
            template_effect(($02) => set_attribute(input_27, "placeholder", $02), [() => $i18n().t("Leave empty for no compression")]);
            bind_value(input_27, () => get(RAGConfig).FILE_IMAGE_COMPRESSION_HEIGHT, ($$value) => mutate(RAGConfig, get(RAGConfig).FILE_IMAGE_COMPRESSION_HEIGHT = $$value));
            append($$anchor3, input_27);
          },
          $$slots: { default: true }
        });
      }
      reset(div_161);
      reset(div_159);
      reset(div_145);
      var div_162 = sibling(div_145, 2);
      var div_163 = child(div_162);
      var text_69 = child(div_163, true);
      reset(div_163);
      var div_164 = sibling(div_163, 4);
      var div_165 = child(div_164);
      var text_70 = child(div_165, true);
      reset(div_165);
      var div_166 = sibling(div_165, 2);
      var node_75 = child(div_166);
      Switch_1(node_75, {
        get state() {
          return get(RAGConfig).ENABLE_GOOGLE_DRIVE_INTEGRATION;
        },
        set state($$value) {
          mutate(RAGConfig, get(RAGConfig).ENABLE_GOOGLE_DRIVE_INTEGRATION = $$value);
        },
        $$legacy: true
      });
      reset(div_166);
      reset(div_164);
      var div_167 = sibling(div_164, 2);
      var div_168 = child(div_167);
      var text_71 = child(div_168, true);
      reset(div_168);
      var div_169 = sibling(div_168, 2);
      var node_76 = child(div_169);
      Switch_1(node_76, {
        get state() {
          return get(RAGConfig).ENABLE_ONEDRIVE_INTEGRATION;
        },
        set state($$value) {
          mutate(RAGConfig, get(RAGConfig).ENABLE_ONEDRIVE_INTEGRATION = $$value);
        },
        $$legacy: true
      });
      reset(div_169);
      reset(div_167);
      reset(div_162);
      var div_170 = sibling(div_162, 2);
      var div_171 = child(div_170);
      var text_72 = child(div_171, true);
      reset(div_171);
      var div_172 = sibling(div_171, 4);
      var div_173 = child(div_172);
      var text_73 = child(div_173, true);
      reset(div_173);
      var div_174 = sibling(div_173, 2);
      var button_2 = child(div_174);
      var text_74 = child(button_2, true);
      reset(button_2);
      reset(div_174);
      reset(div_172);
      var div_175 = sibling(div_172, 2);
      var div_176 = child(div_175);
      var text_75 = child(div_176, true);
      reset(div_176);
      var div_177 = sibling(div_176, 2);
      var button_3 = child(div_177);
      var text_76 = child(button_3, true);
      reset(button_3);
      reset(div_177);
      reset(div_175);
      var div_178 = sibling(div_175, 2);
      var div_179 = child(div_178);
      var text_77 = child(div_179, true);
      reset(div_179);
      var div_180 = sibling(div_179, 2);
      var button_4 = child(div_180);
      var text_78 = child(button_4, true);
      reset(button_4);
      reset(div_180);
      reset(div_178);
      reset(div_170);
      reset(div_1);
      reset(div);
      var div_181 = sibling(div, 2);
      var button_5 = child(div_181);
      var text_79 = child(button_5, true);
      reset(button_5);
      reset(div_181);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26) => {
          set_text(text$1, $0);
          set_text(text_1, $1);
          set_text(text_2, $2);
          set_text(text_3, $3);
          set_text(text_4, $4);
          set_text(text_5, $5);
          set_text(text_6, $6);
          set_text(text_7, $7);
          set_text(text_8, $8);
          set_text(text_9, $9);
          set_text(text_63, $10);
          set_text(text_64, $11);
          set_text(text_65, $12);
          set_text(text_66, $13);
          set_text(text_67, $14);
          set_text(text_68, $15);
          set_text(text_69, $16);
          set_text(text_70, $17);
          set_text(text_71, $18);
          set_text(text_72, $19);
          set_text(text_73, $20);
          set_text(text_74, $21);
          set_text(text_75, $22);
          set_text(text_76, $23);
          set_text(text_77, $24);
          set_text(text_78, $25);
          set_text(text_79, $26);
        },
        [
          () => $i18n().t("General"),
          () => $i18n().t("Content Extraction Engine"),
          () => $i18n().t("Default"),
          () => $i18n().t("External"),
          () => $i18n().t("Tika"),
          () => $i18n().t("Docling"),
          () => $i18n().t("Datalab Marker API"),
          () => $i18n().t("Document Intelligence"),
          () => $i18n().t("Mistral OCR"),
          () => $i18n().t("MinerU"),
          () => $i18n().t("Files"),
          () => $i18n().t("Allowed File Extensions"),
          () => $i18n().t("Max Upload Size"),
          () => $i18n().t("Max Upload Count"),
          () => $i18n().t("Image Compression Width"),
          () => $i18n().t("Image Compression Height"),
          () => $i18n().t("Integration"),
          () => $i18n().t("Google Drive"),
          () => $i18n().t("OneDrive"),
          () => $i18n().t("Danger Zone"),
          () => $i18n().t("Reset Upload Directory"),
          () => $i18n().t("Reset"),
          () => $i18n().t("Reset Vector Storage/Knowledge"),
          () => $i18n().t("Reset"),
          () => $i18n().t("Reindex Knowledge Base Vectors"),
          () => $i18n().t("Reindex"),
          () => $i18n().t("Save")
        ]
      );
      bind_select_value(select, () => get(RAGConfig).CONTENT_EXTRACTION_ENGINE, ($$value) => mutate(RAGConfig, get(RAGConfig).CONTENT_EXTRACTION_ENGINE = $$value));
      event("click", button_2, () => {
        set(showResetUploadDirConfirm, true);
      });
      event("click", button_3, () => {
        set(showResetConfirm, true);
      });
      event("click", button_4, () => {
        set(showReindexConfirm, true);
      });
      append($$anchor2, fragment_1);
    };
    var alternate_12 = ($$anchor2) => {
      var div_182 = root_62$1();
      var node_77 = child(div_182);
      Spinner(node_77, { className: "size-5" });
      reset(div_182);
      append($$anchor2, div_182);
    };
    if_block(node_3, ($$render) => {
      if (get(RAGConfig)) $$render(consequent_25);
      else $$render(alternate_12, false);
    });
  }
  reset(form);
  event("submit", form, preventDefault(() => {
    submitHandler();
  }));
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_3$2 = from_html(`<option>DDGS</option>`);
var root_4$3 = from_html(`<option> </option>`);
var root_6 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div>`);
var root_8$2 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div></div> <div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><!></div></div></div></div>`, 1);
var root_10$1 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off" required/></div></div></div></div>`);
var root_12$1 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div></div> <div class="mb-2.5 flex w-full flex-col"><div class="flex gap-2"><div class="w-full"><div class=" self-center text-xs font-medium mb-1"> </div> <input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" required/></div> <div class="w-full"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div></div>`, 1);
var root_14 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div> <div class="mt-1.5"><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div></div>`);
var root_16$1 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_18 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_20 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_22 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_24 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_26 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_28 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_30 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_32 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div> <div class="mt-1.5"><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div></div>`);
var root_34 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div> <div class="mt-1.5"><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div></div>`);
var root_36 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_38 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_40 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_42 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div> <div class="mb-2.5 flex w-full flex-col"><div><div class="self-center text-xs font-medium mb-1"> </div> <input list="perplexity-model-list" class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/> <datalist id="perplexity-model-list"><option> </option><option> </option><option> </option><option> </option><option> </option></datalist></div></div> <div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <select class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"><option> </option><option> </option><option> </option></select></div></div>`, 1);
var root_44 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div> <div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`, 1);
var root_46 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_48 = from_html(`<div class="w-full mb-2.5"><div class=" self-center text-xs font-medium mb-1"> </div> <input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" required/></div>`);
var root_50 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_51 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div class="flex gap-2"><div class="w-full"><div class=" self-center text-xs font-medium mb-1"> </div> <input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" required/></div></div></div> <div class="mb-2.5 flex w-full flex-col"><div class="  text-xs font-medium mb-1"> </div> <input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden"/></div>`, 1);
var root_57 = from_html(`<option> </option>`);
var root_58 = from_html(`<div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div>`);
var root_60 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" autocomplete="off"/></div></div></div></div>`);
var root_62 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_65 = from_html(`<div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div>`);
var root_64 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <!></div>`);
var root_67 = from_html(`<div class="mb-2.5 flex w-full flex-col"><div><div class=" self-center text-xs font-medium mb-1"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mt-2"><div class=" self-center text-xs font-medium mb-1"> </div> <!></div></div>`);
var root_1$3 = from_html(`<div><div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right" required><option disabled selected> </option><!></select></div></div> <!> <!> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"><!></div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"><!></div> <div class="flex items-center relative"><!></div></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><!></div></div></div> <div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right"><option> </option><!></select></div></div> <!> <div class="mb-2.5 w-full"><div class=" self-center text-xs font-medium mb-1"> </div> <input class="w-full rounded-lg py-2 px-4 text-sm bg-gray-50 dark:text-gray-300 dark:bg-gray-850 outline-hidden" required/></div> <div class="  mb-2.5 flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><input class="flex-1 w-full rounded-lg text-sm bg-transparent outline-hidden" type="text" autocomplete="off"/></div></div> <div class="  mb-2.5 flex flex-col w-full justify-between"><div class=" mb-1 text-xs font-medium"> </div> <div class="flex items-center relative"><input class="flex-1 w-full rounded-lg text-sm bg-transparent outline-hidden" type="text" autocomplete="off"/></div></div></div></div>`);
var root$5 = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class=" space-y-3 overflow-y-scroll scrollbar-hidden h-full"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`);
function WebSearch($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let saveHandler = prop($$props, "saveHandler", 8);
  let webSearchEngines = [
    "ollama_cloud",
    "perplexity_search",
    "searxng",
    "yacy",
    "google_pse",
    "brave",
    "kagi",
    "mojeek",
    "bocha",
    "serpstack",
    "serper",
    "serply",
    "searchapi",
    "serpapi",
    "duckduckgo",
    "tavily",
    "jina",
    "bing",
    "exa",
    "perplexity",
    "sougou",
    "firecrawl",
    "external"
  ];
  let webLoaderEngines = ["playwright", "firecrawl", "tavily", "external"];
  let webConfig = mutable_source(null);
  const submitHandler = async () => {
    if (get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST) {
      mutate(webConfig, get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST = get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST.split(",").map((domain) => domain.trim()).filter((domain) => domain.length > 0));
    } else {
      mutate(webConfig, get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST = []);
    }
    if (get(webConfig).YOUTUBE_LOADER_LANGUAGE) {
      mutate(webConfig, get(webConfig).YOUTUBE_LOADER_LANGUAGE = get(webConfig).YOUTUBE_LOADER_LANGUAGE.split(",").map((lang) => lang.trim()).filter((lang) => lang.length > 0));
    } else {
      mutate(webConfig, get(webConfig).YOUTUBE_LOADER_LANGUAGE = []);
    }
    await updateRAGConfig(localStorage.token, { web: get(webConfig) });
    mutate(webConfig, get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST = get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST.join(","));
    mutate(webConfig, get(webConfig).YOUTUBE_LOADER_LANGUAGE = get(webConfig).YOUTUBE_LOADER_LANGUAGE.join(","));
  };
  onMount(async () => {
    var _a;
    const res = await getRAGConfig(localStorage.token);
    if (res) {
      set(webConfig, res.web);
      if ((_a = get(webConfig)) == null ? void 0 : _a.WEB_SEARCH_DOMAIN_FILTER_LIST) {
        mutate(webConfig, get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST = get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST.join(","));
      }
      mutate(webConfig, get(webConfig).YOUTUBE_LOADER_LANGUAGE = get(webConfig).YOUTUBE_LOADER_LANGUAGE.join(","));
    }
  });
  init();
  var form = root$5();
  var div = child(form);
  var node = child(div);
  {
    var consequent_32 = ($$anchor2) => {
      var div_1 = root_1$3();
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text$1 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var text_1 = child(div_5, true);
      reset(div_5);
      var div_6 = sibling(div_5, 2);
      var node_1 = child(div_6);
      Switch_1(node_1, {
        get state() {
          return get(webConfig).ENABLE_WEB_SEARCH;
        },
        set state($$value) {
          mutate(webConfig, get(webConfig).ENABLE_WEB_SEARCH = $$value);
        },
        $$legacy: true
      });
      reset(div_6);
      reset(div_4);
      var div_7 = sibling(div_4, 2);
      var div_8 = child(div_7);
      var text_2 = child(div_8, true);
      reset(div_8);
      var div_9 = sibling(div_8, 2);
      var select = child(div_9);
      template_effect(() => {
        get(webConfig);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option = child(select);
      var text_3 = child(option, true);
      reset(option);
      option.value = option.__value = "";
      var node_2 = sibling(option);
      each(node_2, 1, () => webSearchEngines, index, ($$anchor3, engine) => {
        var fragment = comment();
        var node_3 = first_child(fragment);
        {
          var consequent = ($$anchor4) => {
            var option_1 = root_3$2();
            var option_1_value = {};
            template_effect(() => {
              if (option_1_value !== (option_1_value = get(engine))) {
                option_1.value = (option_1.__value = get(engine)) ?? "";
              }
            });
            append($$anchor4, option_1);
          };
          var alternate = ($$anchor4) => {
            var option_2 = root_4$3();
            var text_4 = child(option_2, true);
            reset(option_2);
            var option_2_value = {};
            template_effect(() => {
              set_text(text_4, get(engine));
              if (option_2_value !== (option_2_value = get(engine))) {
                option_2.value = (option_2.__value = get(engine)) ?? "";
              }
            });
            append($$anchor4, option_2);
          };
          if_block(node_3, ($$render) => {
            if (get(engine) === "duckduckgo" || get(engine) === "ddgs") $$render(consequent);
            else $$render(alternate, false);
          });
        }
        append($$anchor3, fragment);
      });
      reset(select);
      reset(div_9);
      reset(div_7);
      var node_4 = sibling(div_7, 2);
      {
        var consequent_24 = ($$anchor3) => {
          var fragment_1 = comment();
          var node_5 = first_child(fragment_1);
          {
            var consequent_1 = ($$anchor4) => {
              var div_10 = root_6();
              var div_11 = child(div_10);
              var div_12 = child(div_11);
              var text_5 = child(div_12, true);
              reset(div_12);
              var div_13 = sibling(div_12, 2);
              var div_14 = child(div_13);
              var node_6 = child(div_14);
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Ollama Cloud API Key"))));
                SensitiveInput(node_6, {
                  get placeholder() {
                    return get($0);
                  },
                  get value() {
                    return get(webConfig).OLLAMA_CLOUD_WEB_SEARCH_API_KEY;
                  },
                  set value($$value) {
                    mutate(webConfig, get(webConfig).OLLAMA_CLOUD_WEB_SEARCH_API_KEY = $$value);
                  },
                  $$legacy: true
                });
              }
              reset(div_14);
              reset(div_13);
              reset(div_11);
              reset(div_10);
              template_effect(($0) => set_text(text_5, $0), [
                () => ($i18n(), untrack(() => $i18n().t("Ollama Cloud API Key")))
              ]);
              append($$anchor4, div_10);
            };
            var alternate_22 = ($$anchor4) => {
              var fragment_2 = comment();
              var node_7 = first_child(fragment_2);
              {
                var consequent_2 = ($$anchor5) => {
                  var fragment_3 = root_8$2();
                  var div_15 = first_child(fragment_3);
                  var div_16 = child(div_15);
                  var div_17 = child(div_16);
                  var text_6 = child(div_17, true);
                  reset(div_17);
                  var div_18 = sibling(div_17, 2);
                  var div_19 = child(div_18);
                  var input = child(div_19);
                  remove_input_defaults(input);
                  reset(div_19);
                  reset(div_18);
                  reset(div_16);
                  reset(div_15);
                  var div_20 = sibling(div_15, 2);
                  var div_21 = child(div_20);
                  var div_22 = child(div_21);
                  var text_7 = child(div_22, true);
                  reset(div_22);
                  var div_23 = sibling(div_22, 2);
                  var div_24 = child(div_23);
                  var node_8 = child(div_24);
                  {
                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Perplexity API Key"))));
                    SensitiveInput(node_8, {
                      get placeholder() {
                        return get($0);
                      },
                      get value() {
                        return get(webConfig).PERPLEXITY_API_KEY;
                      },
                      set value($$value) {
                        mutate(webConfig, get(webConfig).PERPLEXITY_API_KEY = $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_24);
                  reset(div_23);
                  reset(div_21);
                  reset(div_20);
                  template_effect(
                    ($0, $1, $2) => {
                      set_text(text_6, $0);
                      set_attribute(input, "placeholder", $1);
                      set_text(text_7, $2);
                    },
                    [
                      () => ($i18n(), untrack(() => $i18n().t("Perplexity Search API URL"))),
                      () => ($i18n(), untrack(() => $i18n().t("Enter Perplexity Search API URL"))),
                      () => ($i18n(), untrack(() => $i18n().t("Perplexity API Key")))
                    ]
                  );
                  bind_value(input, () => get(webConfig).PERPLEXITY_SEARCH_API_URL, ($$value) => mutate(webConfig, get(webConfig).PERPLEXITY_SEARCH_API_URL = $$value));
                  append($$anchor5, fragment_3);
                };
                var alternate_21 = ($$anchor5) => {
                  var fragment_4 = comment();
                  var node_9 = first_child(fragment_4);
                  {
                    var consequent_3 = ($$anchor6) => {
                      var div_25 = root_10$1();
                      var div_26 = child(div_25);
                      var div_27 = child(div_26);
                      var text_8 = child(div_27, true);
                      reset(div_27);
                      var div_28 = sibling(div_27, 2);
                      var div_29 = child(div_28);
                      var input_1 = child(div_29);
                      remove_input_defaults(input_1);
                      reset(div_29);
                      reset(div_28);
                      reset(div_26);
                      reset(div_25);
                      template_effect(
                        ($0, $1) => {
                          set_text(text_8, $0);
                          set_attribute(input_1, "placeholder", $1);
                        },
                        [
                          () => ($i18n(), untrack(() => $i18n().t("Searxng Query URL"))),
                          () => ($i18n(), untrack(() => $i18n().t("Enter Searxng Query URL")))
                        ]
                      );
                      bind_value(input_1, () => get(webConfig).SEARXNG_QUERY_URL, ($$value) => mutate(webConfig, get(webConfig).SEARXNG_QUERY_URL = $$value));
                      append($$anchor6, div_25);
                    };
                    var alternate_20 = ($$anchor6) => {
                      var fragment_5 = comment();
                      var node_10 = first_child(fragment_5);
                      {
                        var consequent_4 = ($$anchor7) => {
                          var fragment_6 = root_12$1();
                          var div_30 = first_child(fragment_6);
                          var div_31 = child(div_30);
                          var div_32 = child(div_31);
                          var text_9 = child(div_32, true);
                          reset(div_32);
                          var div_33 = sibling(div_32, 2);
                          var div_34 = child(div_33);
                          var input_2 = child(div_34);
                          remove_input_defaults(input_2);
                          reset(div_34);
                          reset(div_33);
                          reset(div_31);
                          reset(div_30);
                          var div_35 = sibling(div_30, 2);
                          var div_36 = child(div_35);
                          var div_37 = child(div_36);
                          var div_38 = child(div_37);
                          var text_10 = child(div_38, true);
                          reset(div_38);
                          var input_3 = sibling(div_38, 2);
                          remove_input_defaults(input_3);
                          reset(div_37);
                          var div_39 = sibling(div_37, 2);
                          var div_40 = child(div_39);
                          var text_11 = child(div_40, true);
                          reset(div_40);
                          var node_11 = sibling(div_40, 2);
                          {
                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Yacy Password"))));
                            SensitiveInput(node_11, {
                              get placeholder() {
                                return get($0);
                              },
                              get value() {
                                return get(webConfig).YACY_PASSWORD;
                              },
                              set value($$value) {
                                mutate(webConfig, get(webConfig).YACY_PASSWORD = $$value);
                              },
                              $$legacy: true
                            });
                          }
                          reset(div_39);
                          reset(div_36);
                          reset(div_35);
                          template_effect(
                            ($0, $1, $2, $3, $4) => {
                              set_text(text_9, $0);
                              set_attribute(input_2, "placeholder", $1);
                              set_text(text_10, $2);
                              set_attribute(input_3, "placeholder", $3);
                              set_text(text_11, $4);
                            },
                            [
                              () => ($i18n(), untrack(() => $i18n().t("Yacy Instance URL"))),
                              () => ($i18n(), untrack(() => $i18n().t("Enter Yacy URL (e.g. http://yacy.example.com:8090)"))),
                              () => ($i18n(), untrack(() => $i18n().t("Yacy Username"))),
                              () => ($i18n(), untrack(() => $i18n().t("Enter Yacy Username"))),
                              () => ($i18n(), untrack(() => $i18n().t("Yacy Password")))
                            ]
                          );
                          bind_value(input_2, () => get(webConfig).YACY_QUERY_URL, ($$value) => mutate(webConfig, get(webConfig).YACY_QUERY_URL = $$value));
                          bind_value(input_3, () => get(webConfig).YACY_USERNAME, ($$value) => mutate(webConfig, get(webConfig).YACY_USERNAME = $$value));
                          append($$anchor7, fragment_6);
                        };
                        var alternate_19 = ($$anchor7) => {
                          var fragment_7 = comment();
                          var node_12 = first_child(fragment_7);
                          {
                            var consequent_5 = ($$anchor8) => {
                              var div_41 = root_14();
                              var div_42 = child(div_41);
                              var div_43 = child(div_42);
                              var text_12 = child(div_43, true);
                              reset(div_43);
                              var node_13 = sibling(div_43, 2);
                              {
                                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Google PSE API Key"))));
                                SensitiveInput(node_13, {
                                  get placeholder() {
                                    return get($0);
                                  },
                                  get value() {
                                    return get(webConfig).GOOGLE_PSE_API_KEY;
                                  },
                                  set value($$value) {
                                    mutate(webConfig, get(webConfig).GOOGLE_PSE_API_KEY = $$value);
                                  },
                                  $$legacy: true
                                });
                              }
                              reset(div_42);
                              var div_44 = sibling(div_42, 2);
                              var div_45 = child(div_44);
                              var text_13 = child(div_45, true);
                              reset(div_45);
                              var div_46 = sibling(div_45, 2);
                              var div_47 = child(div_46);
                              var input_4 = child(div_47);
                              remove_input_defaults(input_4);
                              reset(div_47);
                              reset(div_46);
                              reset(div_44);
                              reset(div_41);
                              template_effect(
                                ($0, $1, $2) => {
                                  set_text(text_12, $0);
                                  set_text(text_13, $1);
                                  set_attribute(input_4, "placeholder", $2);
                                },
                                [
                                  () => ($i18n(), untrack(() => $i18n().t("Google PSE API Key"))),
                                  () => ($i18n(), untrack(() => $i18n().t("Google PSE Engine Id"))),
                                  () => ($i18n(), untrack(() => $i18n().t("Enter Google PSE Engine Id")))
                                ]
                              );
                              bind_value(input_4, () => get(webConfig).GOOGLE_PSE_ENGINE_ID, ($$value) => mutate(webConfig, get(webConfig).GOOGLE_PSE_ENGINE_ID = $$value));
                              append($$anchor8, div_41);
                            };
                            var alternate_18 = ($$anchor8) => {
                              var fragment_8 = comment();
                              var node_14 = first_child(fragment_8);
                              {
                                var consequent_6 = ($$anchor9) => {
                                  var div_48 = root_16$1();
                                  var div_49 = child(div_48);
                                  var div_50 = child(div_49);
                                  var text_14 = child(div_50, true);
                                  reset(div_50);
                                  var node_15 = sibling(div_50, 2);
                                  {
                                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Brave Search API Key"))));
                                    SensitiveInput(node_15, {
                                      get placeholder() {
                                        return get($0);
                                      },
                                      get value() {
                                        return get(webConfig).BRAVE_SEARCH_API_KEY;
                                      },
                                      set value($$value) {
                                        mutate(webConfig, get(webConfig).BRAVE_SEARCH_API_KEY = $$value);
                                      },
                                      $$legacy: true
                                    });
                                  }
                                  reset(div_49);
                                  reset(div_48);
                                  template_effect(($0) => set_text(text_14, $0), [
                                    () => ($i18n(), untrack(() => $i18n().t("Brave Search API Key")))
                                  ]);
                                  append($$anchor9, div_48);
                                };
                                var alternate_17 = ($$anchor9) => {
                                  var fragment_9 = comment();
                                  var node_16 = first_child(fragment_9);
                                  {
                                    var consequent_7 = ($$anchor10) => {
                                      var div_51 = root_18();
                                      var div_52 = child(div_51);
                                      var div_53 = child(div_52);
                                      var text_15 = child(div_53, true);
                                      reset(div_53);
                                      var node_17 = sibling(div_53, 2);
                                      {
                                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Kagi Search API Key"))));
                                        SensitiveInput(node_17, {
                                          get placeholder() {
                                            return get($0);
                                          },
                                          get value() {
                                            return get(webConfig).KAGI_SEARCH_API_KEY;
                                          },
                                          set value($$value) {
                                            mutate(webConfig, get(webConfig).KAGI_SEARCH_API_KEY = $$value);
                                          },
                                          $$legacy: true
                                        });
                                      }
                                      reset(div_52);
                                      reset(div_51);
                                      template_effect(($0) => set_text(text_15, $0), [
                                        () => ($i18n(), untrack(() => $i18n().t("Kagi Search API Key")))
                                      ]);
                                      append($$anchor10, div_51);
                                    };
                                    var alternate_16 = ($$anchor10) => {
                                      var fragment_10 = comment();
                                      var node_18 = first_child(fragment_10);
                                      {
                                        var consequent_8 = ($$anchor11) => {
                                          var div_54 = root_20();
                                          var div_55 = child(div_54);
                                          var div_56 = child(div_55);
                                          var text_16 = child(div_56, true);
                                          reset(div_56);
                                          var node_19 = sibling(div_56, 2);
                                          {
                                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Mojeek Search API Key"))));
                                            SensitiveInput(node_19, {
                                              get placeholder() {
                                                return get($0);
                                              },
                                              get value() {
                                                return get(webConfig).MOJEEK_SEARCH_API_KEY;
                                              },
                                              set value($$value) {
                                                mutate(webConfig, get(webConfig).MOJEEK_SEARCH_API_KEY = $$value);
                                              },
                                              $$legacy: true
                                            });
                                          }
                                          reset(div_55);
                                          reset(div_54);
                                          template_effect(($0) => set_text(text_16, $0), [
                                            () => ($i18n(), untrack(() => $i18n().t("Mojeek Search API Key")))
                                          ]);
                                          append($$anchor11, div_54);
                                        };
                                        var alternate_15 = ($$anchor11) => {
                                          var fragment_11 = comment();
                                          var node_20 = first_child(fragment_11);
                                          {
                                            var consequent_9 = ($$anchor12) => {
                                              var div_57 = root_22();
                                              var div_58 = child(div_57);
                                              var div_59 = child(div_58);
                                              var text_17 = child(div_59, true);
                                              reset(div_59);
                                              var node_21 = sibling(div_59, 2);
                                              {
                                                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Bocha Search API Key"))));
                                                SensitiveInput(node_21, {
                                                  get placeholder() {
                                                    return get($0);
                                                  },
                                                  get value() {
                                                    return get(webConfig).BOCHA_SEARCH_API_KEY;
                                                  },
                                                  set value($$value) {
                                                    mutate(webConfig, get(webConfig).BOCHA_SEARCH_API_KEY = $$value);
                                                  },
                                                  $$legacy: true
                                                });
                                              }
                                              reset(div_58);
                                              reset(div_57);
                                              template_effect(($0) => set_text(text_17, $0), [
                                                () => ($i18n(), untrack(() => $i18n().t("Bocha Search API Key")))
                                              ]);
                                              append($$anchor12, div_57);
                                            };
                                            var alternate_14 = ($$anchor12) => {
                                              var fragment_12 = comment();
                                              var node_22 = first_child(fragment_12);
                                              {
                                                var consequent_10 = ($$anchor13) => {
                                                  var div_60 = root_24();
                                                  var div_61 = child(div_60);
                                                  var div_62 = child(div_61);
                                                  var text_18 = child(div_62, true);
                                                  reset(div_62);
                                                  var node_23 = sibling(div_62, 2);
                                                  {
                                                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Serpstack API Key"))));
                                                    SensitiveInput(node_23, {
                                                      get placeholder() {
                                                        return get($0);
                                                      },
                                                      get value() {
                                                        return get(webConfig).SERPSTACK_API_KEY;
                                                      },
                                                      set value($$value) {
                                                        mutate(webConfig, get(webConfig).SERPSTACK_API_KEY = $$value);
                                                      },
                                                      $$legacy: true
                                                    });
                                                  }
                                                  reset(div_61);
                                                  reset(div_60);
                                                  template_effect(($0) => set_text(text_18, $0), [
                                                    () => ($i18n(), untrack(() => $i18n().t("Serpstack API Key")))
                                                  ]);
                                                  append($$anchor13, div_60);
                                                };
                                                var alternate_13 = ($$anchor13) => {
                                                  var fragment_13 = comment();
                                                  var node_24 = first_child(fragment_13);
                                                  {
                                                    var consequent_11 = ($$anchor14) => {
                                                      var div_63 = root_26();
                                                      var div_64 = child(div_63);
                                                      var div_65 = child(div_64);
                                                      var text_19 = child(div_65, true);
                                                      reset(div_65);
                                                      var node_25 = sibling(div_65, 2);
                                                      {
                                                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Serper API Key"))));
                                                        SensitiveInput(node_25, {
                                                          get placeholder() {
                                                            return get($0);
                                                          },
                                                          get value() {
                                                            return get(webConfig).SERPER_API_KEY;
                                                          },
                                                          set value($$value) {
                                                            mutate(webConfig, get(webConfig).SERPER_API_KEY = $$value);
                                                          },
                                                          $$legacy: true
                                                        });
                                                      }
                                                      reset(div_64);
                                                      reset(div_63);
                                                      template_effect(($0) => set_text(text_19, $0), [
                                                        () => ($i18n(), untrack(() => $i18n().t("Serper API Key")))
                                                      ]);
                                                      append($$anchor14, div_63);
                                                    };
                                                    var alternate_12 = ($$anchor14) => {
                                                      var fragment_14 = comment();
                                                      var node_26 = first_child(fragment_14);
                                                      {
                                                        var consequent_12 = ($$anchor15) => {
                                                          var div_66 = root_28();
                                                          var div_67 = child(div_66);
                                                          var div_68 = child(div_67);
                                                          var text_20 = child(div_68, true);
                                                          reset(div_68);
                                                          var node_27 = sibling(div_68, 2);
                                                          {
                                                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Serply API Key"))));
                                                            SensitiveInput(node_27, {
                                                              get placeholder() {
                                                                return get($0);
                                                              },
                                                              get value() {
                                                                return get(webConfig).SERPLY_API_KEY;
                                                              },
                                                              set value($$value) {
                                                                mutate(webConfig, get(webConfig).SERPLY_API_KEY = $$value);
                                                              },
                                                              $$legacy: true
                                                            });
                                                          }
                                                          reset(div_67);
                                                          reset(div_66);
                                                          template_effect(($0) => set_text(text_20, $0), [
                                                            () => ($i18n(), untrack(() => $i18n().t("Serply API Key")))
                                                          ]);
                                                          append($$anchor15, div_66);
                                                        };
                                                        var alternate_11 = ($$anchor15) => {
                                                          var fragment_15 = comment();
                                                          var node_28 = first_child(fragment_15);
                                                          {
                                                            var consequent_13 = ($$anchor16) => {
                                                              var div_69 = root_30();
                                                              var div_70 = child(div_69);
                                                              var div_71 = child(div_70);
                                                              var text_21 = child(div_71, true);
                                                              reset(div_71);
                                                              var node_29 = sibling(div_71, 2);
                                                              {
                                                                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Tavily API Key"))));
                                                                SensitiveInput(node_29, {
                                                                  get placeholder() {
                                                                    return get($0);
                                                                  },
                                                                  get value() {
                                                                    return get(webConfig).TAVILY_API_KEY;
                                                                  },
                                                                  set value($$value) {
                                                                    mutate(webConfig, get(webConfig).TAVILY_API_KEY = $$value);
                                                                  },
                                                                  $$legacy: true
                                                                });
                                                              }
                                                              reset(div_70);
                                                              reset(div_69);
                                                              template_effect(($0) => set_text(text_21, $0), [
                                                                () => ($i18n(), untrack(() => $i18n().t("Tavily API Key")))
                                                              ]);
                                                              append($$anchor16, div_69);
                                                            };
                                                            var alternate_10 = ($$anchor16) => {
                                                              var fragment_16 = comment();
                                                              var node_30 = first_child(fragment_16);
                                                              {
                                                                var consequent_14 = ($$anchor17) => {
                                                                  var div_72 = root_32();
                                                                  var div_73 = child(div_72);
                                                                  var div_74 = child(div_73);
                                                                  var text_22 = child(div_74, true);
                                                                  reset(div_74);
                                                                  var node_31 = sibling(div_74, 2);
                                                                  {
                                                                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter SearchApi API Key"))));
                                                                    SensitiveInput(node_31, {
                                                                      get placeholder() {
                                                                        return get($0);
                                                                      },
                                                                      get value() {
                                                                        return get(webConfig).SEARCHAPI_API_KEY;
                                                                      },
                                                                      set value($$value) {
                                                                        mutate(webConfig, get(webConfig).SEARCHAPI_API_KEY = $$value);
                                                                      },
                                                                      $$legacy: true
                                                                    });
                                                                  }
                                                                  reset(div_73);
                                                                  var div_75 = sibling(div_73, 2);
                                                                  var div_76 = child(div_75);
                                                                  var text_23 = child(div_76, true);
                                                                  reset(div_76);
                                                                  var div_77 = sibling(div_76, 2);
                                                                  var div_78 = child(div_77);
                                                                  var input_5 = child(div_78);
                                                                  remove_input_defaults(input_5);
                                                                  reset(div_78);
                                                                  reset(div_77);
                                                                  reset(div_75);
                                                                  reset(div_72);
                                                                  template_effect(
                                                                    ($0, $1, $2) => {
                                                                      set_text(text_22, $0);
                                                                      set_text(text_23, $1);
                                                                      set_attribute(input_5, "placeholder", $2);
                                                                    },
                                                                    [
                                                                      () => ($i18n(), untrack(() => $i18n().t("SearchApi API Key"))),
                                                                      () => ($i18n(), untrack(() => $i18n().t("SearchApi Engine"))),
                                                                      () => ($i18n(), untrack(() => $i18n().t("Enter SearchApi Engine")))
                                                                    ]
                                                                  );
                                                                  bind_value(input_5, () => get(webConfig).SEARCHAPI_ENGINE, ($$value) => mutate(webConfig, get(webConfig).SEARCHAPI_ENGINE = $$value));
                                                                  append($$anchor17, div_72);
                                                                };
                                                                var alternate_9 = ($$anchor17) => {
                                                                  var fragment_17 = comment();
                                                                  var node_32 = first_child(fragment_17);
                                                                  {
                                                                    var consequent_15 = ($$anchor18) => {
                                                                      var div_79 = root_34();
                                                                      var div_80 = child(div_79);
                                                                      var div_81 = child(div_80);
                                                                      var text_24 = child(div_81, true);
                                                                      reset(div_81);
                                                                      var node_33 = sibling(div_81, 2);
                                                                      {
                                                                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter SerpApi API Key"))));
                                                                        SensitiveInput(node_33, {
                                                                          get placeholder() {
                                                                            return get($0);
                                                                          },
                                                                          get value() {
                                                                            return get(webConfig).SERPAPI_API_KEY;
                                                                          },
                                                                          set value($$value) {
                                                                            mutate(webConfig, get(webConfig).SERPAPI_API_KEY = $$value);
                                                                          },
                                                                          $$legacy: true
                                                                        });
                                                                      }
                                                                      reset(div_80);
                                                                      var div_82 = sibling(div_80, 2);
                                                                      var div_83 = child(div_82);
                                                                      var text_25 = child(div_83, true);
                                                                      reset(div_83);
                                                                      var div_84 = sibling(div_83, 2);
                                                                      var div_85 = child(div_84);
                                                                      var input_6 = child(div_85);
                                                                      remove_input_defaults(input_6);
                                                                      reset(div_85);
                                                                      reset(div_84);
                                                                      reset(div_82);
                                                                      reset(div_79);
                                                                      template_effect(
                                                                        ($0, $1, $2) => {
                                                                          set_text(text_24, $0);
                                                                          set_text(text_25, $1);
                                                                          set_attribute(input_6, "placeholder", $2);
                                                                        },
                                                                        [
                                                                          () => ($i18n(), untrack(() => $i18n().t("SerpApi API Key"))),
                                                                          () => ($i18n(), untrack(() => $i18n().t("SerpApi Engine"))),
                                                                          () => ($i18n(), untrack(() => $i18n().t("Enter SerpApi Engine")))
                                                                        ]
                                                                      );
                                                                      bind_value(input_6, () => get(webConfig).SERPAPI_ENGINE, ($$value) => mutate(webConfig, get(webConfig).SERPAPI_ENGINE = $$value));
                                                                      append($$anchor18, div_79);
                                                                    };
                                                                    var alternate_8 = ($$anchor18) => {
                                                                      var fragment_18 = comment();
                                                                      var node_34 = first_child(fragment_18);
                                                                      {
                                                                        var consequent_16 = ($$anchor19) => {
                                                                          var div_86 = root_36();
                                                                          var div_87 = child(div_86);
                                                                          var div_88 = child(div_87);
                                                                          var text_26 = child(div_88, true);
                                                                          reset(div_88);
                                                                          var node_35 = sibling(div_88, 2);
                                                                          {
                                                                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Jina API Key"))));
                                                                            SensitiveInput(node_35, {
                                                                              get placeholder() {
                                                                                return get($0);
                                                                              },
                                                                              get value() {
                                                                                return get(webConfig).JINA_API_KEY;
                                                                              },
                                                                              set value($$value) {
                                                                                mutate(webConfig, get(webConfig).JINA_API_KEY = $$value);
                                                                              },
                                                                              $$legacy: true
                                                                            });
                                                                          }
                                                                          reset(div_87);
                                                                          reset(div_86);
                                                                          template_effect(($0) => set_text(text_26, $0), [() => ($i18n(), untrack(() => $i18n().t("Jina API Key")))]);
                                                                          append($$anchor19, div_86);
                                                                        };
                                                                        var alternate_7 = ($$anchor19) => {
                                                                          var fragment_19 = comment();
                                                                          var node_36 = first_child(fragment_19);
                                                                          {
                                                                            var consequent_17 = ($$anchor20) => {
                                                                              var div_89 = root_38();
                                                                              var div_90 = child(div_89);
                                                                              var div_91 = child(div_90);
                                                                              var text_27 = child(div_91, true);
                                                                              reset(div_91);
                                                                              var div_92 = sibling(div_91, 2);
                                                                              var div_93 = child(div_92);
                                                                              var input_7 = child(div_93);
                                                                              remove_input_defaults(input_7);
                                                                              reset(div_93);
                                                                              reset(div_92);
                                                                              reset(div_90);
                                                                              var div_94 = sibling(div_90, 2);
                                                                              var div_95 = child(div_94);
                                                                              var text_28 = child(div_95, true);
                                                                              reset(div_95);
                                                                              var node_37 = sibling(div_95, 2);
                                                                              {
                                                                                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Bing Search V7 Subscription Key"))));
                                                                                SensitiveInput(node_37, {
                                                                                  get placeholder() {
                                                                                    return get($0);
                                                                                  },
                                                                                  get value() {
                                                                                    return get(webConfig).BING_SEARCH_V7_SUBSCRIPTION_KEY;
                                                                                  },
                                                                                  set value($$value) {
                                                                                    mutate(webConfig, get(webConfig).BING_SEARCH_V7_SUBSCRIPTION_KEY = $$value);
                                                                                  },
                                                                                  $$legacy: true
                                                                                });
                                                                              }
                                                                              reset(div_94);
                                                                              reset(div_89);
                                                                              template_effect(
                                                                                ($0, $1, $2) => {
                                                                                  set_text(text_27, $0);
                                                                                  set_attribute(input_7, "placeholder", $1);
                                                                                  set_text(text_28, $2);
                                                                                },
                                                                                [
                                                                                  () => ($i18n(), untrack(() => $i18n().t("Bing Search V7 Endpoint"))),
                                                                                  () => ($i18n(), untrack(() => $i18n().t("Enter Bing Search V7 Endpoint"))),
                                                                                  () => ($i18n(), untrack(() => $i18n().t("Bing Search V7 Subscription Key")))
                                                                                ]
                                                                              );
                                                                              bind_value(input_7, () => get(webConfig).BING_SEARCH_V7_ENDPOINT, ($$value) => mutate(webConfig, get(webConfig).BING_SEARCH_V7_ENDPOINT = $$value));
                                                                              append($$anchor20, div_89);
                                                                            };
                                                                            var alternate_6 = ($$anchor20) => {
                                                                              var fragment_20 = comment();
                                                                              var node_38 = first_child(fragment_20);
                                                                              {
                                                                                var consequent_18 = ($$anchor21) => {
                                                                                  var div_96 = root_40();
                                                                                  var div_97 = child(div_96);
                                                                                  var div_98 = child(div_97);
                                                                                  var text_29 = child(div_98, true);
                                                                                  reset(div_98);
                                                                                  var node_39 = sibling(div_98, 2);
                                                                                  {
                                                                                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Exa API Key"))));
                                                                                    SensitiveInput(node_39, {
                                                                                      get placeholder() {
                                                                                        return get($0);
                                                                                      },
                                                                                      get value() {
                                                                                        return get(webConfig).EXA_API_KEY;
                                                                                      },
                                                                                      set value($$value) {
                                                                                        mutate(webConfig, get(webConfig).EXA_API_KEY = $$value);
                                                                                      },
                                                                                      $$legacy: true
                                                                                    });
                                                                                  }
                                                                                  reset(div_97);
                                                                                  reset(div_96);
                                                                                  template_effect(($0) => set_text(text_29, $0), [() => ($i18n(), untrack(() => $i18n().t("Exa API Key")))]);
                                                                                  append($$anchor21, div_96);
                                                                                };
                                                                                var alternate_5 = ($$anchor21) => {
                                                                                  var fragment_21 = comment();
                                                                                  var node_40 = first_child(fragment_21);
                                                                                  {
                                                                                    var consequent_19 = ($$anchor22) => {
                                                                                      var fragment_22 = root_42();
                                                                                      var div_99 = first_child(fragment_22);
                                                                                      var div_100 = child(div_99);
                                                                                      var div_101 = child(div_100);
                                                                                      var text_30 = child(div_101, true);
                                                                                      reset(div_101);
                                                                                      var node_41 = sibling(div_101, 2);
                                                                                      {
                                                                                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Perplexity API Key"))));
                                                                                        SensitiveInput(node_41, {
                                                                                          get placeholder() {
                                                                                            return get($0);
                                                                                          },
                                                                                          get value() {
                                                                                            return get(webConfig).PERPLEXITY_API_KEY;
                                                                                          },
                                                                                          set value($$value) {
                                                                                            mutate(webConfig, get(webConfig).PERPLEXITY_API_KEY = $$value);
                                                                                          },
                                                                                          $$legacy: true
                                                                                        });
                                                                                      }
                                                                                      reset(div_100);
                                                                                      reset(div_99);
                                                                                      var div_102 = sibling(div_99, 2);
                                                                                      var div_103 = child(div_102);
                                                                                      var div_104 = child(div_103);
                                                                                      var text_31 = child(div_104, true);
                                                                                      reset(div_104);
                                                                                      var input_8 = sibling(div_104, 2);
                                                                                      remove_input_defaults(input_8);
                                                                                      var datalist = sibling(input_8, 2);
                                                                                      var option_3 = child(datalist);
                                                                                      var text_32 = child(option_3, true);
                                                                                      reset(option_3);
                                                                                      option_3.value = option_3.__value = "sonar";
                                                                                      var option_4 = sibling(option_3);
                                                                                      var text_33 = child(option_4, true);
                                                                                      reset(option_4);
                                                                                      option_4.value = option_4.__value = "sonar-pro";
                                                                                      var option_5 = sibling(option_4);
                                                                                      var text_34 = child(option_5, true);
                                                                                      reset(option_5);
                                                                                      option_5.value = option_5.__value = "sonar-reasoning";
                                                                                      var option_6 = sibling(option_5);
                                                                                      var text_35 = child(option_6, true);
                                                                                      reset(option_6);
                                                                                      option_6.value = option_6.__value = "sonar-reasoning-pro";
                                                                                      var option_7 = sibling(option_6);
                                                                                      var text_36 = child(option_7, true);
                                                                                      reset(option_7);
                                                                                      option_7.value = option_7.__value = "sonar-deep-research";
                                                                                      reset(datalist);
                                                                                      reset(div_103);
                                                                                      reset(div_102);
                                                                                      var div_105 = sibling(div_102, 2);
                                                                                      var div_106 = child(div_105);
                                                                                      var div_107 = child(div_106);
                                                                                      var text_37 = child(div_107, true);
                                                                                      reset(div_107);
                                                                                      var select_1 = sibling(div_107, 2);
                                                                                      template_effect(() => {
                                                                                        get(webConfig);
                                                                                        invalidate_inner_signals(() => {
                                                                                          $i18n();
                                                                                        });
                                                                                      });
                                                                                      var option_8 = child(select_1);
                                                                                      var text_38 = child(option_8, true);
                                                                                      reset(option_8);
                                                                                      option_8.value = option_8.__value = "low";
                                                                                      var option_9 = sibling(option_8);
                                                                                      var text_39 = child(option_9, true);
                                                                                      reset(option_9);
                                                                                      option_9.value = option_9.__value = "medium";
                                                                                      var option_10 = sibling(option_9);
                                                                                      var text_40 = child(option_10, true);
                                                                                      reset(option_10);
                                                                                      option_10.value = option_10.__value = "high";
                                                                                      reset(select_1);
                                                                                      reset(div_106);
                                                                                      reset(div_105);
                                                                                      template_effect(
                                                                                        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10) => {
                                                                                          set_text(text_30, $0);
                                                                                          set_text(text_31, $1);
                                                                                          set_text(text_32, $2);
                                                                                          set_text(text_33, $3);
                                                                                          set_text(text_34, $4);
                                                                                          set_text(text_35, $5);
                                                                                          set_text(text_36, $6);
                                                                                          set_text(text_37, $7);
                                                                                          set_text(text_38, $8);
                                                                                          set_text(text_39, $9);
                                                                                          set_text(text_40, $10);
                                                                                        },
                                                                                        [
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Perplexity API Key"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Perplexity Model"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Sonar"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Sonar Pro"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Sonar Reasoning"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Sonar Reasoning Pro"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Sonar Deep Research"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Perplexity Search Context Usage"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Low"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("Medium"))),
                                                                                          () => ($i18n(), untrack(() => $i18n().t("High")))
                                                                                        ]
                                                                                      );
                                                                                      bind_value(input_8, () => get(webConfig).PERPLEXITY_MODEL, ($$value) => mutate(webConfig, get(webConfig).PERPLEXITY_MODEL = $$value));
                                                                                      bind_select_value(select_1, () => get(webConfig).PERPLEXITY_SEARCH_CONTEXT_USAGE, ($$value) => mutate(webConfig, get(webConfig).PERPLEXITY_SEARCH_CONTEXT_USAGE = $$value));
                                                                                      append($$anchor22, fragment_22);
                                                                                    };
                                                                                    var alternate_4 = ($$anchor22) => {
                                                                                      var fragment_23 = comment();
                                                                                      var node_42 = first_child(fragment_23);
                                                                                      {
                                                                                        var consequent_20 = ($$anchor23) => {
                                                                                          var fragment_24 = root_44();
                                                                                          var div_108 = first_child(fragment_24);
                                                                                          var div_109 = child(div_108);
                                                                                          var div_110 = child(div_109);
                                                                                          var text_41 = child(div_110, true);
                                                                                          reset(div_110);
                                                                                          var node_43 = sibling(div_110, 2);
                                                                                          {
                                                                                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Sougou Search API sID"))));
                                                                                            SensitiveInput(node_43, {
                                                                                              get placeholder() {
                                                                                                return get($0);
                                                                                              },
                                                                                              get value() {
                                                                                                return get(webConfig).SOUGOU_API_SID;
                                                                                              },
                                                                                              set value($$value) {
                                                                                                mutate(webConfig, get(webConfig).SOUGOU_API_SID = $$value);
                                                                                              },
                                                                                              $$legacy: true
                                                                                            });
                                                                                          }
                                                                                          reset(div_109);
                                                                                          reset(div_108);
                                                                                          var div_111 = sibling(div_108, 2);
                                                                                          var div_112 = child(div_111);
                                                                                          var div_113 = child(div_112);
                                                                                          var text_42 = child(div_113, true);
                                                                                          reset(div_113);
                                                                                          var node_44 = sibling(div_113, 2);
                                                                                          {
                                                                                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Sougou Search API SK"))));
                                                                                            SensitiveInput(node_44, {
                                                                                              get placeholder() {
                                                                                                return get($0);
                                                                                              },
                                                                                              get value() {
                                                                                                return get(webConfig).SOUGOU_API_SK;
                                                                                              },
                                                                                              set value($$value) {
                                                                                                mutate(webConfig, get(webConfig).SOUGOU_API_SK = $$value);
                                                                                              },
                                                                                              $$legacy: true
                                                                                            });
                                                                                          }
                                                                                          reset(div_112);
                                                                                          reset(div_111);
                                                                                          template_effect(
                                                                                            ($0, $1) => {
                                                                                              set_text(text_41, $0);
                                                                                              set_text(text_42, $1);
                                                                                            },
                                                                                            [
                                                                                              () => ($i18n(), untrack(() => $i18n().t("Sougou Search API sID"))),
                                                                                              () => ($i18n(), untrack(() => $i18n().t("Sougou Search API SK")))
                                                                                            ]
                                                                                          );
                                                                                          append($$anchor23, fragment_24);
                                                                                        };
                                                                                        var alternate_3 = ($$anchor23) => {
                                                                                          var fragment_25 = comment();
                                                                                          var node_45 = first_child(fragment_25);
                                                                                          {
                                                                                            var consequent_21 = ($$anchor24) => {
                                                                                              var div_114 = root_46();
                                                                                              var div_115 = child(div_114);
                                                                                              var div_116 = child(div_115);
                                                                                              var text_43 = child(div_116, true);
                                                                                              reset(div_116);
                                                                                              var div_117 = sibling(div_116, 2);
                                                                                              var div_118 = child(div_117);
                                                                                              var input_9 = child(div_118);
                                                                                              remove_input_defaults(input_9);
                                                                                              reset(div_118);
                                                                                              reset(div_117);
                                                                                              reset(div_115);
                                                                                              var div_119 = sibling(div_115, 2);
                                                                                              var div_120 = child(div_119);
                                                                                              var text_44 = child(div_120, true);
                                                                                              reset(div_120);
                                                                                              var node_46 = sibling(div_120, 2);
                                                                                              {
                                                                                                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Firecrawl API Key"))));
                                                                                                SensitiveInput(node_46, {
                                                                                                  get placeholder() {
                                                                                                    return get($0);
                                                                                                  },
                                                                                                  get value() {
                                                                                                    return get(webConfig).FIRECRAWL_API_KEY;
                                                                                                  },
                                                                                                  set value($$value) {
                                                                                                    mutate(webConfig, get(webConfig).FIRECRAWL_API_KEY = $$value);
                                                                                                  },
                                                                                                  $$legacy: true
                                                                                                });
                                                                                              }
                                                                                              reset(div_119);
                                                                                              reset(div_114);
                                                                                              template_effect(
                                                                                                ($0, $1, $2) => {
                                                                                                  set_text(text_43, $0);
                                                                                                  set_attribute(input_9, "placeholder", $1);
                                                                                                  set_text(text_44, $2);
                                                                                                },
                                                                                                [
                                                                                                  () => ($i18n(), untrack(() => $i18n().t("Firecrawl API Base URL"))),
                                                                                                  () => ($i18n(), untrack(() => $i18n().t("Enter Firecrawl API Base URL"))),
                                                                                                  () => ($i18n(), untrack(() => $i18n().t("Firecrawl API Key")))
                                                                                                ]
                                                                                              );
                                                                                              bind_value(input_9, () => get(webConfig).FIRECRAWL_API_BASE_URL, ($$value) => mutate(webConfig, get(webConfig).FIRECRAWL_API_BASE_URL = $$value));
                                                                                              append($$anchor24, div_114);
                                                                                            };
                                                                                            var alternate_2 = ($$anchor24) => {
                                                                                              var fragment_26 = comment();
                                                                                              var node_47 = first_child(fragment_26);
                                                                                              {
                                                                                                var consequent_22 = ($$anchor25) => {
                                                                                                  var div_121 = root_48();
                                                                                                  var div_122 = child(div_121);
                                                                                                  var text_45 = child(div_122, true);
                                                                                                  reset(div_122);
                                                                                                  var input_10 = sibling(div_122, 2);
                                                                                                  remove_input_defaults(input_10);
                                                                                                  reset(div_121);
                                                                                                  template_effect(
                                                                                                    ($0, $1) => {
                                                                                                      set_text(text_45, $0);
                                                                                                      set_attribute(input_10, "placeholder", $1);
                                                                                                    },
                                                                                                    [
                                                                                                      () => ($i18n(), untrack(() => $i18n().t("Concurrent Requests"))),
                                                                                                      () => ($i18n(), untrack(() => $i18n().t("Concurrent Requests")))
                                                                                                    ]
                                                                                                  );
                                                                                                  bind_value(input_10, () => get(webConfig).WEB_SEARCH_CONCURRENT_REQUESTS, ($$value) => mutate(webConfig, get(webConfig).WEB_SEARCH_CONCURRENT_REQUESTS = $$value));
                                                                                                  append($$anchor25, div_121);
                                                                                                };
                                                                                                var alternate_1 = ($$anchor25) => {
                                                                                                  var fragment_27 = comment();
                                                                                                  var node_48 = first_child(fragment_27);
                                                                                                  {
                                                                                                    var consequent_23 = ($$anchor26) => {
                                                                                                      var div_123 = root_50();
                                                                                                      var div_124 = child(div_123);
                                                                                                      var div_125 = child(div_124);
                                                                                                      var text_46 = child(div_125, true);
                                                                                                      reset(div_125);
                                                                                                      var div_126 = sibling(div_125, 2);
                                                                                                      var div_127 = child(div_126);
                                                                                                      var input_11 = child(div_127);
                                                                                                      remove_input_defaults(input_11);
                                                                                                      reset(div_127);
                                                                                                      reset(div_126);
                                                                                                      reset(div_124);
                                                                                                      var div_128 = sibling(div_124, 2);
                                                                                                      var div_129 = child(div_128);
                                                                                                      var text_47 = child(div_129, true);
                                                                                                      reset(div_129);
                                                                                                      var node_49 = sibling(div_129, 2);
                                                                                                      {
                                                                                                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter External Web Search API Key"))));
                                                                                                        SensitiveInput(node_49, {
                                                                                                          get placeholder() {
                                                                                                            return get($0);
                                                                                                          },
                                                                                                          get value() {
                                                                                                            return get(webConfig).EXTERNAL_WEB_SEARCH_API_KEY;
                                                                                                          },
                                                                                                          set value($$value) {
                                                                                                            mutate(webConfig, get(webConfig).EXTERNAL_WEB_SEARCH_API_KEY = $$value);
                                                                                                          },
                                                                                                          $$legacy: true
                                                                                                        });
                                                                                                      }
                                                                                                      reset(div_128);
                                                                                                      reset(div_123);
                                                                                                      template_effect(
                                                                                                        ($0, $1, $2) => {
                                                                                                          set_text(text_46, $0);
                                                                                                          set_attribute(input_11, "placeholder", $1);
                                                                                                          set_text(text_47, $2);
                                                                                                        },
                                                                                                        [
                                                                                                          () => ($i18n(), untrack(() => $i18n().t("External Web Search URL"))),
                                                                                                          () => ($i18n(), untrack(() => $i18n().t("Enter External Web Search URL"))),
                                                                                                          () => ($i18n(), untrack(() => $i18n().t("External Web Search API Key")))
                                                                                                        ]
                                                                                                      );
                                                                                                      bind_value(input_11, () => get(webConfig).EXTERNAL_WEB_SEARCH_URL, ($$value) => mutate(webConfig, get(webConfig).EXTERNAL_WEB_SEARCH_URL = $$value));
                                                                                                      append($$anchor26, div_123);
                                                                                                    };
                                                                                                    if_block(
                                                                                                      node_48,
                                                                                                      ($$render) => {
                                                                                                        if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "external")) $$render(consequent_23);
                                                                                                      },
                                                                                                      true
                                                                                                    );
                                                                                                  }
                                                                                                  append($$anchor25, fragment_27);
                                                                                                };
                                                                                                if_block(
                                                                                                  node_47,
                                                                                                  ($$render) => {
                                                                                                    if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "ddgs" || get(webConfig).WEB_SEARCH_ENGINE === "duckduckgo")) $$render(consequent_22);
                                                                                                    else $$render(alternate_1, false);
                                                                                                  },
                                                                                                  true
                                                                                                );
                                                                                              }
                                                                                              append($$anchor24, fragment_26);
                                                                                            };
                                                                                            if_block(
                                                                                              node_45,
                                                                                              ($$render) => {
                                                                                                if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "firecrawl")) $$render(consequent_21);
                                                                                                else $$render(alternate_2, false);
                                                                                              },
                                                                                              true
                                                                                            );
                                                                                          }
                                                                                          append($$anchor23, fragment_25);
                                                                                        };
                                                                                        if_block(
                                                                                          node_42,
                                                                                          ($$render) => {
                                                                                            if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "sougou")) $$render(consequent_20);
                                                                                            else $$render(alternate_3, false);
                                                                                          },
                                                                                          true
                                                                                        );
                                                                                      }
                                                                                      append($$anchor22, fragment_23);
                                                                                    };
                                                                                    if_block(
                                                                                      node_40,
                                                                                      ($$render) => {
                                                                                        if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "perplexity")) $$render(consequent_19);
                                                                                        else $$render(alternate_4, false);
                                                                                      },
                                                                                      true
                                                                                    );
                                                                                  }
                                                                                  append($$anchor21, fragment_21);
                                                                                };
                                                                                if_block(
                                                                                  node_38,
                                                                                  ($$render) => {
                                                                                    if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "exa")) $$render(consequent_18);
                                                                                    else $$render(alternate_5, false);
                                                                                  },
                                                                                  true
                                                                                );
                                                                              }
                                                                              append($$anchor20, fragment_20);
                                                                            };
                                                                            if_block(
                                                                              node_36,
                                                                              ($$render) => {
                                                                                if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "bing")) $$render(consequent_17);
                                                                                else $$render(alternate_6, false);
                                                                              },
                                                                              true
                                                                            );
                                                                          }
                                                                          append($$anchor19, fragment_19);
                                                                        };
                                                                        if_block(
                                                                          node_34,
                                                                          ($$render) => {
                                                                            if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "jina")) $$render(consequent_16);
                                                                            else $$render(alternate_7, false);
                                                                          },
                                                                          true
                                                                        );
                                                                      }
                                                                      append($$anchor18, fragment_18);
                                                                    };
                                                                    if_block(
                                                                      node_32,
                                                                      ($$render) => {
                                                                        if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "serpapi")) $$render(consequent_15);
                                                                        else $$render(alternate_8, false);
                                                                      },
                                                                      true
                                                                    );
                                                                  }
                                                                  append($$anchor17, fragment_17);
                                                                };
                                                                if_block(
                                                                  node_30,
                                                                  ($$render) => {
                                                                    if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "searchapi")) $$render(consequent_14);
                                                                    else $$render(alternate_9, false);
                                                                  },
                                                                  true
                                                                );
                                                              }
                                                              append($$anchor16, fragment_16);
                                                            };
                                                            if_block(
                                                              node_28,
                                                              ($$render) => {
                                                                if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "tavily")) $$render(consequent_13);
                                                                else $$render(alternate_10, false);
                                                              },
                                                              true
                                                            );
                                                          }
                                                          append($$anchor15, fragment_15);
                                                        };
                                                        if_block(
                                                          node_26,
                                                          ($$render) => {
                                                            if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "serply")) $$render(consequent_12);
                                                            else $$render(alternate_11, false);
                                                          },
                                                          true
                                                        );
                                                      }
                                                      append($$anchor14, fragment_14);
                                                    };
                                                    if_block(
                                                      node_24,
                                                      ($$render) => {
                                                        if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "serper")) $$render(consequent_11);
                                                        else $$render(alternate_12, false);
                                                      },
                                                      true
                                                    );
                                                  }
                                                  append($$anchor13, fragment_13);
                                                };
                                                if_block(
                                                  node_22,
                                                  ($$render) => {
                                                    if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "serpstack")) $$render(consequent_10);
                                                    else $$render(alternate_13, false);
                                                  },
                                                  true
                                                );
                                              }
                                              append($$anchor12, fragment_12);
                                            };
                                            if_block(
                                              node_20,
                                              ($$render) => {
                                                if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "bocha")) $$render(consequent_9);
                                                else $$render(alternate_14, false);
                                              },
                                              true
                                            );
                                          }
                                          append($$anchor11, fragment_11);
                                        };
                                        if_block(
                                          node_18,
                                          ($$render) => {
                                            if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "mojeek")) $$render(consequent_8);
                                            else $$render(alternate_15, false);
                                          },
                                          true
                                        );
                                      }
                                      append($$anchor10, fragment_10);
                                    };
                                    if_block(
                                      node_16,
                                      ($$render) => {
                                        if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "kagi")) $$render(consequent_7);
                                        else $$render(alternate_16, false);
                                      },
                                      true
                                    );
                                  }
                                  append($$anchor9, fragment_9);
                                };
                                if_block(
                                  node_14,
                                  ($$render) => {
                                    if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "brave")) $$render(consequent_6);
                                    else $$render(alternate_17, false);
                                  },
                                  true
                                );
                              }
                              append($$anchor8, fragment_8);
                            };
                            if_block(
                              node_12,
                              ($$render) => {
                                if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "google_pse")) $$render(consequent_5);
                                else $$render(alternate_18, false);
                              },
                              true
                            );
                          }
                          append($$anchor7, fragment_7);
                        };
                        if_block(
                          node_10,
                          ($$render) => {
                            if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "yacy")) $$render(consequent_4);
                            else $$render(alternate_19, false);
                          },
                          true
                        );
                      }
                      append($$anchor6, fragment_5);
                    };
                    if_block(
                      node_9,
                      ($$render) => {
                        if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "searxng")) $$render(consequent_3);
                        else $$render(alternate_20, false);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_4);
                };
                if_block(
                  node_7,
                  ($$render) => {
                    if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "perplexity_search")) $$render(consequent_2);
                    else $$render(alternate_21, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_2);
            };
            if_block(node_5, ($$render) => {
              if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE === "ollama_cloud")) $$render(consequent_1);
              else $$render(alternate_22, false);
            });
          }
          append($$anchor3, fragment_1);
        };
        if_block(node_4, ($$render) => {
          if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE !== "")) $$render(consequent_24);
        });
      }
      var node_50 = sibling(node_4, 2);
      {
        var consequent_25 = ($$anchor3) => {
          var fragment_28 = root_51();
          var div_130 = first_child(fragment_28);
          var div_131 = child(div_130);
          var div_132 = child(div_131);
          var div_133 = child(div_132);
          var text_48 = child(div_133, true);
          reset(div_133);
          var input_12 = sibling(div_133, 2);
          remove_input_defaults(input_12);
          reset(div_132);
          reset(div_131);
          reset(div_130);
          var div_134 = sibling(div_130, 2);
          var div_135 = child(div_134);
          var text_49 = child(div_135, true);
          reset(div_135);
          var input_13 = sibling(div_135, 2);
          remove_input_defaults(input_13);
          reset(div_134);
          template_effect(
            ($0, $1, $2, $3) => {
              set_text(text_48, $0);
              set_attribute(input_12, "placeholder", $1);
              set_text(text_49, $2);
              set_attribute(input_13, "placeholder", $3);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Search Result Count"))),
              () => ($i18n(), untrack(() => $i18n().t("Search Result Count"))),
              () => ($i18n(), untrack(() => $i18n().t("Domain Filter List"))),
              () => ($i18n(), untrack(() => $i18n().t("Enter domains separated by commas (e.g., example.com,site.org,!excludedsite.com)")))
            ]
          );
          bind_value(input_12, () => get(webConfig).WEB_SEARCH_RESULT_COUNT, ($$value) => mutate(webConfig, get(webConfig).WEB_SEARCH_RESULT_COUNT = $$value));
          bind_value(input_13, () => get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST, ($$value) => mutate(webConfig, get(webConfig).WEB_SEARCH_DOMAIN_FILTER_LIST = $$value));
          append($$anchor3, fragment_28);
        };
        if_block(node_50, ($$render) => {
          if (get(webConfig), untrack(() => get(webConfig).ENABLE_WEB_SEARCH)) $$render(consequent_25);
        });
      }
      var div_136 = sibling(node_50, 2);
      var div_137 = child(div_136);
      var node_51 = child(div_137);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Full Context Mode"))));
        Tooltip(node_51, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            next();
            var text_50 = text();
            template_effect(($02) => set_text(text_50, $02), [
              () => ($i18n(), untrack(() => $i18n().t("Bypass Embedding and Retrieval")))
            ]);
            append($$anchor3, text_50);
          },
          $$slots: { default: true }
        });
      }
      reset(div_137);
      var div_138 = sibling(div_137, 2);
      var node_52 = child(div_138);
      {
        let $0 = derived_safe_equal(() => (get(webConfig), $i18n(), untrack(() => get(webConfig).BYPASS_WEB_SEARCH_EMBEDDING_AND_RETRIEVAL ? $i18n().t("Inject the entire content as context for comprehensive processing, this is recommended for complex queries.") : $i18n().t("Default to segmented retrieval for focused and relevant content extraction, this is recommended for most cases."))));
        Tooltip(node_52, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            Switch_1($$anchor3, {
              get state() {
                return get(webConfig).BYPASS_WEB_SEARCH_EMBEDDING_AND_RETRIEVAL;
              },
              set state($$value) {
                mutate(webConfig, get(webConfig).BYPASS_WEB_SEARCH_EMBEDDING_AND_RETRIEVAL = $$value);
              },
              $$legacy: true
            });
          },
          $$slots: { default: true }
        });
      }
      reset(div_138);
      reset(div_136);
      var div_139 = sibling(div_136, 2);
      var div_140 = child(div_139);
      var node_53 = child(div_140);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Bypass Web Loader"))));
        Tooltip(node_53, {
          get content() {
            return get($0);
          },
          placement: "top-start",
          children: ($$anchor3, $$slotProps) => {
            next();
            var text_51 = text();
            template_effect(($02) => set_text(text_51, $02), [
              () => ($i18n(), untrack(() => $i18n().t("Bypass Web Loader")))
            ]);
            append($$anchor3, text_51);
          },
          $$slots: { default: true }
        });
      }
      reset(div_140);
      var div_141 = sibling(div_140, 2);
      var node_54 = child(div_141);
      Tooltip(node_54, {
        content: "",
        children: ($$anchor3, $$slotProps) => {
          Switch_1($$anchor3, {
            get state() {
              return get(webConfig).BYPASS_WEB_SEARCH_WEB_LOADER;
            },
            set state($$value) {
              mutate(webConfig, get(webConfig).BYPASS_WEB_SEARCH_WEB_LOADER = $$value);
            },
            $$legacy: true
          });
        },
        $$slots: { default: true }
      });
      reset(div_141);
      reset(div_139);
      var div_142 = sibling(div_139, 2);
      var div_143 = child(div_142);
      var text_52 = child(div_143, true);
      reset(div_143);
      var div_144 = sibling(div_143, 2);
      var node_55 = child(div_144);
      {
        let $0 = derived_safe_equal(() => (get(webConfig), $i18n(), untrack(() => get(webConfig).WEB_SEARCH_TRUST_ENV ? $i18n().t("Use proxy designated by http_proxy and https_proxy environment variables to fetch page contents.") : $i18n().t("Use no proxy to fetch page contents."))));
        Tooltip(node_55, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            Switch_1($$anchor3, {
              get state() {
                return get(webConfig).WEB_SEARCH_TRUST_ENV;
              },
              set state($$value) {
                mutate(webConfig, get(webConfig).WEB_SEARCH_TRUST_ENV = $$value);
              },
              $$legacy: true
            });
          },
          $$slots: { default: true }
        });
      }
      reset(div_144);
      reset(div_142);
      reset(div_2);
      var div_145 = sibling(div_2, 2);
      var div_146 = child(div_145);
      var text_53 = child(div_146, true);
      reset(div_146);
      var div_147 = sibling(div_146, 4);
      var div_148 = child(div_147);
      var text_54 = child(div_148, true);
      reset(div_148);
      var div_149 = sibling(div_148, 2);
      var select_2 = child(div_149);
      template_effect(() => {
        get(webConfig);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option_11 = child(select_2);
      var text_55 = child(option_11, true);
      reset(option_11);
      option_11.value = option_11.__value = "";
      var node_56 = sibling(option_11);
      each(node_56, 1, () => webLoaderEngines, index, ($$anchor3, engine) => {
        var option_12 = root_57();
        var text_56 = child(option_12, true);
        reset(option_12);
        var option_12_value = {};
        template_effect(() => {
          set_text(text_56, get(engine));
          if (option_12_value !== (option_12_value = get(engine))) {
            option_12.value = (option_12.__value = get(engine)) ?? "";
          }
        });
        append($$anchor3, option_12);
      });
      reset(select_2);
      reset(div_149);
      reset(div_147);
      var node_57 = sibling(div_147, 2);
      {
        var consequent_26 = ($$anchor3) => {
          var div_150 = root_58();
          var div_151 = child(div_150);
          var text_57 = child(div_151, true);
          reset(div_151);
          var div_152 = sibling(div_151, 2);
          var node_58 = child(div_152);
          Switch_1(node_58, {
            get state() {
              return get(webConfig).ENABLE_WEB_LOADER_SSL_VERIFICATION;
            },
            set state($$value) {
              mutate(webConfig, get(webConfig).ENABLE_WEB_LOADER_SSL_VERIFICATION = $$value);
            },
            $$legacy: true
          });
          reset(div_152);
          reset(div_150);
          template_effect(($0) => set_text(text_57, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Verify SSL Certificate")))
          ]);
          append($$anchor3, div_150);
        };
        var alternate_26 = ($$anchor3) => {
          var fragment_34 = comment();
          var node_59 = first_child(fragment_34);
          {
            var consequent_27 = ($$anchor4) => {
              var div_153 = root_60();
              var div_154 = child(div_153);
              var div_155 = child(div_154);
              var text_58 = child(div_155, true);
              reset(div_155);
              var div_156 = sibling(div_155, 2);
              var div_157 = child(div_156);
              var input_14 = child(div_157);
              remove_input_defaults(input_14);
              reset(div_157);
              reset(div_156);
              reset(div_154);
              var div_158 = sibling(div_154, 2);
              var div_159 = child(div_158);
              var text_59 = child(div_159, true);
              reset(div_159);
              var div_160 = sibling(div_159, 2);
              var div_161 = child(div_160);
              var input_15 = child(div_161);
              remove_input_defaults(input_15);
              reset(div_161);
              reset(div_160);
              reset(div_158);
              reset(div_153);
              template_effect(
                ($0, $1, $2, $3) => {
                  set_text(text_58, $0);
                  set_attribute(input_14, "placeholder", $1);
                  set_text(text_59, $2);
                  set_attribute(input_15, "placeholder", $3);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Playwright WebSocket URL"))),
                  () => ($i18n(), untrack(() => $i18n().t("Enter Playwright WebSocket URL"))),
                  () => ($i18n(), untrack(() => $i18n().t("Playwright Timeout (ms)"))),
                  () => ($i18n(), untrack(() => $i18n().t("Enter Playwright Timeout")))
                ]
              );
              bind_value(input_14, () => get(webConfig).PLAYWRIGHT_WS_URL, ($$value) => mutate(webConfig, get(webConfig).PLAYWRIGHT_WS_URL = $$value));
              bind_value(input_15, () => get(webConfig).PLAYWRIGHT_TIMEOUT, ($$value) => mutate(webConfig, get(webConfig).PLAYWRIGHT_TIMEOUT = $$value));
              append($$anchor4, div_153);
            };
            var alternate_25 = ($$anchor4) => {
              var fragment_35 = comment();
              var node_60 = first_child(fragment_35);
              {
                var consequent_28 = ($$anchor5) => {
                  var div_162 = root_62();
                  var div_163 = child(div_162);
                  var div_164 = child(div_163);
                  var text_60 = child(div_164, true);
                  reset(div_164);
                  var div_165 = sibling(div_164, 2);
                  var div_166 = child(div_165);
                  var input_16 = child(div_166);
                  remove_input_defaults(input_16);
                  reset(div_166);
                  reset(div_165);
                  reset(div_163);
                  var div_167 = sibling(div_163, 2);
                  var div_168 = child(div_167);
                  var text_61 = child(div_168, true);
                  reset(div_168);
                  var node_61 = sibling(div_168, 2);
                  {
                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Firecrawl API Key"))));
                    SensitiveInput(node_61, {
                      get placeholder() {
                        return get($0);
                      },
                      get value() {
                        return get(webConfig).FIRECRAWL_API_KEY;
                      },
                      set value($$value) {
                        mutate(webConfig, get(webConfig).FIRECRAWL_API_KEY = $$value);
                      },
                      $$legacy: true
                    });
                  }
                  reset(div_167);
                  reset(div_162);
                  template_effect(
                    ($0, $1, $2) => {
                      set_text(text_60, $0);
                      set_attribute(input_16, "placeholder", $1);
                      set_text(text_61, $2);
                    },
                    [
                      () => ($i18n(), untrack(() => $i18n().t("Firecrawl API Base URL"))),
                      () => ($i18n(), untrack(() => $i18n().t("Enter Firecrawl API Base URL"))),
                      () => ($i18n(), untrack(() => $i18n().t("Firecrawl API Key")))
                    ]
                  );
                  bind_value(input_16, () => get(webConfig).FIRECRAWL_API_BASE_URL, ($$value) => mutate(webConfig, get(webConfig).FIRECRAWL_API_BASE_URL = $$value));
                  append($$anchor5, div_162);
                };
                var alternate_24 = ($$anchor5) => {
                  var fragment_36 = comment();
                  var node_62 = first_child(fragment_36);
                  {
                    var consequent_30 = ($$anchor6) => {
                      var div_169 = root_64();
                      var div_170 = child(div_169);
                      var div_171 = child(div_170);
                      var text_62 = child(div_171, true);
                      reset(div_171);
                      var div_172 = sibling(div_171, 2);
                      var div_173 = child(div_172);
                      var input_17 = child(div_173);
                      remove_input_defaults(input_17);
                      reset(div_173);
                      reset(div_172);
                      reset(div_170);
                      var node_63 = sibling(div_170, 2);
                      {
                        var consequent_29 = ($$anchor7) => {
                          var div_174 = root_65();
                          var div_175 = child(div_174);
                          var text_63 = child(div_175, true);
                          reset(div_175);
                          var node_64 = sibling(div_175, 2);
                          {
                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Tavily API Key"))));
                            SensitiveInput(node_64, {
                              get placeholder() {
                                return get($0);
                              },
                              get value() {
                                return get(webConfig).TAVILY_API_KEY;
                              },
                              set value($$value) {
                                mutate(webConfig, get(webConfig).TAVILY_API_KEY = $$value);
                              },
                              $$legacy: true
                            });
                          }
                          reset(div_174);
                          template_effect(($0) => set_text(text_63, $0), [
                            () => ($i18n(), untrack(() => $i18n().t("Tavily API Key")))
                          ]);
                          append($$anchor7, div_174);
                        };
                        if_block(node_63, ($$render) => {
                          if (get(webConfig), untrack(() => get(webConfig).WEB_SEARCH_ENGINE !== "tavily")) $$render(consequent_29);
                        });
                      }
                      reset(div_169);
                      template_effect(
                        ($0, $1) => {
                          set_text(text_62, $0);
                          set_attribute(input_17, "placeholder", $1);
                        },
                        [
                          () => ($i18n(), untrack(() => $i18n().t("Tavily Extract Depth"))),
                          () => ($i18n(), untrack(() => $i18n().t("Enter Tavily Extract Depth")))
                        ]
                      );
                      bind_value(input_17, () => get(webConfig).TAVILY_EXTRACT_DEPTH, ($$value) => mutate(webConfig, get(webConfig).TAVILY_EXTRACT_DEPTH = $$value));
                      append($$anchor6, div_169);
                    };
                    var alternate_23 = ($$anchor6) => {
                      var fragment_37 = comment();
                      var node_65 = first_child(fragment_37);
                      {
                        var consequent_31 = ($$anchor7) => {
                          var div_176 = root_67();
                          var div_177 = child(div_176);
                          var div_178 = child(div_177);
                          var text_64 = child(div_178, true);
                          reset(div_178);
                          var div_179 = sibling(div_178, 2);
                          var div_180 = child(div_179);
                          var input_18 = child(div_180);
                          remove_input_defaults(input_18);
                          reset(div_180);
                          reset(div_179);
                          reset(div_177);
                          var div_181 = sibling(div_177, 2);
                          var div_182 = child(div_181);
                          var text_65 = child(div_182, true);
                          reset(div_182);
                          var node_66 = sibling(div_182, 2);
                          {
                            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter External Web Loader API Key"))));
                            SensitiveInput(node_66, {
                              get placeholder() {
                                return get($0);
                              },
                              get value() {
                                return get(webConfig).EXTERNAL_WEB_LOADER_API_KEY;
                              },
                              set value($$value) {
                                mutate(webConfig, get(webConfig).EXTERNAL_WEB_LOADER_API_KEY = $$value);
                              },
                              $$legacy: true
                            });
                          }
                          reset(div_181);
                          reset(div_176);
                          template_effect(
                            ($0, $1, $2) => {
                              set_text(text_64, $0);
                              set_attribute(input_18, "placeholder", $1);
                              set_text(text_65, $2);
                            },
                            [
                              () => ($i18n(), untrack(() => $i18n().t("External Web Loader URL"))),
                              () => ($i18n(), untrack(() => $i18n().t("Enter External Web Loader URL"))),
                              () => ($i18n(), untrack(() => $i18n().t("External Web Loader API Key")))
                            ]
                          );
                          bind_value(input_18, () => get(webConfig).EXTERNAL_WEB_LOADER_URL, ($$value) => mutate(webConfig, get(webConfig).EXTERNAL_WEB_LOADER_URL = $$value));
                          append($$anchor7, div_176);
                        };
                        if_block(
                          node_65,
                          ($$render) => {
                            if (get(webConfig), untrack(() => get(webConfig).WEB_LOADER_ENGINE === "external")) $$render(consequent_31);
                          },
                          true
                        );
                      }
                      append($$anchor6, fragment_37);
                    };
                    if_block(
                      node_62,
                      ($$render) => {
                        if (get(webConfig), untrack(() => get(webConfig).WEB_LOADER_ENGINE === "tavily")) $$render(consequent_30);
                        else $$render(alternate_23, false);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_36);
                };
                if_block(
                  node_60,
                  ($$render) => {
                    if (get(webConfig), untrack(() => get(webConfig).WEB_LOADER_ENGINE === "firecrawl" && get(webConfig).WEB_SEARCH_ENGINE !== "firecrawl")) $$render(consequent_28);
                    else $$render(alternate_24, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_35);
            };
            if_block(
              node_59,
              ($$render) => {
                if (get(webConfig), untrack(() => get(webConfig).WEB_LOADER_ENGINE === "playwright")) $$render(consequent_27);
                else $$render(alternate_25, false);
              },
              true
            );
          }
          append($$anchor3, fragment_34);
        };
        if_block(node_57, ($$render) => {
          if (get(webConfig), untrack(() => get(webConfig).WEB_LOADER_ENGINE === "" || get(webConfig).WEB_LOADER_ENGINE === "safe_web")) $$render(consequent_26);
          else $$render(alternate_26, false);
        });
      }
      var div_183 = sibling(node_57, 2);
      var div_184 = child(div_183);
      var text_66 = child(div_184, true);
      reset(div_184);
      var input_19 = sibling(div_184, 2);
      remove_input_defaults(input_19);
      reset(div_183);
      var div_185 = sibling(div_183, 2);
      var div_186 = child(div_185);
      var text_67 = child(div_186, true);
      reset(div_186);
      var div_187 = sibling(div_186, 2);
      var input_20 = child(div_187);
      remove_input_defaults(input_20);
      reset(div_187);
      reset(div_185);
      var div_188 = sibling(div_185, 2);
      var div_189 = child(div_188);
      var text_68 = child(div_189, true);
      reset(div_189);
      var div_190 = sibling(div_189, 2);
      var input_21 = child(div_190);
      remove_input_defaults(input_21);
      reset(div_190);
      reset(div_188);
      reset(div_145);
      reset(div_1);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15) => {
          set_text(text$1, $0);
          set_text(text_1, $1);
          set_text(text_2, $2);
          set_attribute(select, "placeholder", $3);
          set_text(text_3, $4);
          set_text(text_52, $5);
          set_text(text_53, $6);
          set_text(text_54, $7);
          set_attribute(select_2, "placeholder", $8);
          set_text(text_55, $9);
          set_text(text_66, $10);
          set_attribute(input_19, "placeholder", $11);
          set_text(text_67, $12);
          set_attribute(input_20, "placeholder", $13);
          set_text(text_68, $14);
          set_attribute(input_21, "placeholder", $15);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("General"))),
          () => ($i18n(), untrack(() => $i18n().t("Web Search"))),
          () => ($i18n(), untrack(() => $i18n().t("Web Search Engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Trust Proxy Environment"))),
          () => ($i18n(), untrack(() => $i18n().t("Loader"))),
          () => ($i18n(), untrack(() => $i18n().t("Web Loader Engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Default"))),
          () => ($i18n(), untrack(() => $i18n().t("Concurrent Requests"))),
          () => ($i18n(), untrack(() => $i18n().t("Concurrent Requests"))),
          () => ($i18n(), untrack(() => $i18n().t("Youtube Language"))),
          () => ($i18n(), untrack(() => $i18n().t("Enter language codes"))),
          () => ($i18n(), untrack(() => $i18n().t("Youtube Proxy URL"))),
          () => ($i18n(), untrack(() => $i18n().t("Enter proxy URL (e.g. https://user:password@host:port)")))
        ]
      );
      bind_select_value(select, () => get(webConfig).WEB_SEARCH_ENGINE, ($$value) => mutate(webConfig, get(webConfig).WEB_SEARCH_ENGINE = $$value));
      bind_select_value(select_2, () => get(webConfig).WEB_LOADER_ENGINE, ($$value) => mutate(webConfig, get(webConfig).WEB_LOADER_ENGINE = $$value));
      bind_value(input_19, () => get(webConfig).WEB_LOADER_CONCURRENT_REQUESTS, ($$value) => mutate(webConfig, get(webConfig).WEB_LOADER_CONCURRENT_REQUESTS = $$value));
      bind_value(input_20, () => get(webConfig).YOUTUBE_LOADER_LANGUAGE, ($$value) => mutate(webConfig, get(webConfig).YOUTUBE_LOADER_LANGUAGE = $$value));
      bind_value(input_21, () => get(webConfig).YOUTUBE_LOADER_PROXY_URL, ($$value) => mutate(webConfig, get(webConfig).YOUTUBE_LOADER_PROXY_URL = $$value));
      append($$anchor2, div_1);
    };
    if_block(node, ($$render) => {
      if (get(webConfig)) $$render(consequent_32);
    });
  }
  reset(div);
  var div_191 = sibling(div, 2);
  var button = child(div_191);
  var text_69 = child(button, true);
  reset(button);
  reset(div_191);
  reset(form);
  template_effect(($0) => set_text(text_69, $0), [() => ($i18n(), untrack(() => $i18n().t("Save")))]);
  event("submit", form, preventDefault(async () => {
    await submitHandler();
    saveHandler()();
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root$4 = from_svg(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875ZM9.75 17.25a.75.75 0 0 0-1.5 0V18a.75.75 0 0 0 1.5 0v-.75Zm2.25-3a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-1.5 0v-3a.75.75 0 0 1 .75-.75Zm3.75-1.5a.75.75 0 0 0-1.5 0V18a.75.75 0 0 0 1.5 0v-5.25Z" clip-rule="evenodd"></path><path d="M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"></path></svg>`);
function DocumentChartBar($$anchor, $$props) {
  let className = prop($$props, "className", 8, "size-4");
  prop($$props, "strokeWidth", 8, "1.5");
  var svg = root$4();
  template_effect(() => set_class(svg, 0, clsx(className())));
  append($$anchor, svg);
}
var root_4$2 = from_html(`<button class="p-1" type="button"><!></button>`);
var root_7 = from_html(`<div class=" text-center text-xs text-gray-500"> </div>`);
var root_3$1 = from_html(`<div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium flex justify-between items-center"><div> </div> <div><!></div></div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="flex flex-col gap-2"><!></div></div>`);
var root_1$2 = from_html(`<div><div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5 flex w-full justify-between"><div class=" text-xs font-medium"> </div> <!></div></div> <!></div>`);
var root_8$1 = from_html(`<div class="flex h-full justify-center"><div class="my-auto"><!></div></div>`);
var root$3 = from_html(`<!> <form class="flex flex-col h-full justify-between text-sm"><div class="overflow-y-scroll scrollbar-hidden h-full"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`, 1);
function Evaluations($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const $config = () => store_get(config, "$config", $$stores);
  const $settings = () => store_get(settings, "$settings", $$stores);
  const $user = () => store_get(user, "$user", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const dispatch = createEventDispatcher();
  const i18n = getContext("i18n");
  let evaluationConfig = mutable_source(null);
  let showAddModel = mutable_source(false);
  const submitHandler = async () => {
    var _a, _b, _c;
    set(evaluationConfig, await updateConfig$1(localStorage.token, get(evaluationConfig)).catch((err) => {
      toast.error(err);
      return null;
    }));
    if (get(evaluationConfig)) {
      toast.success($i18n().t("Settings saved successfully!"));
      models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
    }
  };
  const addModelHandler = async (model) => {
    var _a, _b, _c;
    get(evaluationConfig).EVALUATION_ARENA_MODELS.push(model);
    mutate(evaluationConfig, get(evaluationConfig).EVALUATION_ARENA_MODELS = [...get(evaluationConfig).EVALUATION_ARENA_MODELS]);
    await submitHandler();
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  const editModelHandler = async (model, modelIdx) => {
    var _a, _b, _c;
    mutate(evaluationConfig, get(evaluationConfig).EVALUATION_ARENA_MODELS[modelIdx] = model);
    mutate(evaluationConfig, get(evaluationConfig).EVALUATION_ARENA_MODELS = [...get(evaluationConfig).EVALUATION_ARENA_MODELS]);
    await submitHandler();
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  const deleteModelHandler = async (modelIdx) => {
    var _a, _b, _c;
    mutate(evaluationConfig, get(evaluationConfig).EVALUATION_ARENA_MODELS = get(evaluationConfig).EVALUATION_ARENA_MODELS.filter((m, mIdx) => mIdx !== modelIdx));
    await submitHandler();
    models.set(await getModels(localStorage.token, ((_b = (_a = $config()) == null ? void 0 : _a.features) == null ? void 0 : _b.enable_direct_connections) && (((_c = $settings()) == null ? void 0 : _c.directConnections) ?? null)));
  };
  onMount(async () => {
    var _a;
    if (((_a = $user()) == null ? void 0 : _a.role) === "admin") {
      set(evaluationConfig, await getConfig$1(localStorage.token).catch((err) => {
        toast.error(err);
        return null;
      }));
    }
  });
  init();
  var fragment = root$3();
  var node = first_child(fragment);
  ArenaModelModal(node, {
    get show() {
      return get(showAddModel);
    },
    set show($$value) {
      set(showAddModel, $$value);
    },
    $$events: {
      submit: async (e) => {
        addModelHandler(e.detail);
      }
    },
    $$legacy: true
  });
  var form = sibling(node, 2);
  var div = child(form);
  var node_1 = child(div);
  {
    var consequent_2 = ($$anchor2) => {
      var div_1 = root_1$2();
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text2 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var text_1 = child(div_5, true);
      reset(div_5);
      var node_2 = sibling(div_5, 2);
      {
        let $0 = derived_safe_equal(() => $i18n().t(`Message rating should be enabled to use this feature`));
        Tooltip(node_2, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            Switch_1($$anchor3, {
              get state() {
                return get(evaluationConfig).ENABLE_EVALUATION_ARENA_MODELS;
              },
              set state($$value) {
                mutate(evaluationConfig, get(evaluationConfig).ENABLE_EVALUATION_ARENA_MODELS = $$value);
              },
              $$legacy: true
            });
          },
          $$slots: { default: true }
        });
      }
      reset(div_4);
      reset(div_2);
      var node_3 = sibling(div_2, 2);
      {
        var consequent_1 = ($$anchor3) => {
          var div_6 = root_3$1();
          var div_7 = child(div_6);
          var div_8 = child(div_7);
          var text_2 = child(div_8, true);
          reset(div_8);
          var div_9 = sibling(div_8, 2);
          var node_4 = child(div_9);
          {
            let $0 = derived_safe_equal(() => $i18n().t("Add Arena Model"));
            Tooltip(node_4, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var button = root_4$2();
                var node_5 = child(button);
                Plus(node_5, {});
                reset(button);
                event("click", button, () => {
                  set(showAddModel, true);
                });
                append($$anchor4, button);
              },
              $$slots: { default: true }
            });
          }
          reset(div_9);
          reset(div_7);
          var div_10 = sibling(div_7, 4);
          var node_6 = child(div_10);
          {
            var consequent = ($$anchor4) => {
              var fragment_2 = comment();
              var node_7 = first_child(fragment_2);
              each(node_7, 1, () => get(evaluationConfig).EVALUATION_ARENA_MODELS, index, ($$anchor5, model, index2) => {
                Model($$anchor5, {
                  get model() {
                    return get(model);
                  },
                  $$events: {
                    edit: (e) => {
                      editModelHandler(e.detail, index2);
                    },
                    delete: (e) => {
                      deleteModelHandler(index2);
                    }
                  }
                });
              });
              append($$anchor4, fragment_2);
            };
            var alternate = ($$anchor4) => {
              var div_11 = root_7();
              var text_3 = child(div_11, true);
              reset(div_11);
              template_effect(($0) => set_text(text_3, $0), [
                () => $i18n().t(`Using the default arena model with all models. Click the plus button to add custom models.`)
              ]);
              append($$anchor4, div_11);
            };
            if_block(node_6, ($$render) => {
              var _a;
              if ((((_a = get(evaluationConfig)) == null ? void 0 : _a.EVALUATION_ARENA_MODELS) ?? []).length > 0) $$render(consequent);
              else $$render(alternate, false);
            });
          }
          reset(div_10);
          reset(div_6);
          template_effect(($0) => set_text(text_2, $0), [() => $i18n().t("Manage")]);
          append($$anchor3, div_6);
        };
        if_block(node_3, ($$render) => {
          if (get(evaluationConfig).ENABLE_EVALUATION_ARENA_MODELS) $$render(consequent_1);
        });
      }
      reset(div_1);
      template_effect(
        ($0, $1) => {
          set_text(text2, $0);
          set_text(text_1, $1);
        },
        [() => $i18n().t("General"), () => $i18n().t("Arena Models")]
      );
      append($$anchor2, div_1);
    };
    var alternate_1 = ($$anchor2) => {
      var div_12 = root_8$1();
      var div_13 = child(div_12);
      var node_8 = child(div_13);
      Spinner(node_8, { className: "size-6" });
      reset(div_13);
      reset(div_12);
      append($$anchor2, div_12);
    };
    if_block(node_1, ($$render) => {
      if (get(evaluationConfig) !== null) $$render(consequent_2);
      else $$render(alternate_1, false);
    });
  }
  reset(div);
  var div_14 = sibling(div, 2);
  var button_1 = child(div_14);
  var text_4 = child(button_1, true);
  reset(button_1);
  reset(div_14);
  reset(form);
  template_effect(($0) => set_text(text_4, $0), [() => $i18n().t("Save")]);
  event("submit", form, preventDefault(() => {
    submitHandler();
    dispatch("save");
  }));
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root_2$1 = from_html(`<option> </option>`);
var root_3 = from_html(`<div class="text-gray-500 text-xs"> </div>`);
var root_5 = from_html(`<div class="flex w-full gap-2"><div class="flex-1"><!></div></div>`);
var root_8 = from_html(`<input class="dark:bg-gray-900 w-fit rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right" type="number" autocomplete="off"/>`);
var root_4$1 = from_html(`<div class="mb-2.5 flex flex-col gap-1.5 w-full"><div class="text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm py-0.5 placeholder:text-gray-300 dark:placeholder:text-gray-700 bg-transparent outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mb-2.5 flex flex-col gap-1.5 w-full"><div class=" flex gap-2 w-full items-center justify-between"><div class="text-xs font-medium"> </div> <div><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-left"><option selected> </option><option> </option><option> </option></select></div></div> <!></div> <div class="flex gap-2 w-full items-center justify-between"><div class="text-xs font-medium"> </div> <div><!></div></div>`, 1);
var root_10 = from_html(`<option> </option>`);
var root_11 = from_html(`<div class="text-gray-500 text-xs"> </div>`);
var root_13 = from_html(`<div class="flex w-full gap-2"><div class="flex-1"><!></div></div>`);
var root_16 = from_html(`<input class="dark:bg-gray-900 w-fit rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right" type="number" autocomplete="off"/>`);
var root_12 = from_html(`<div class="mb-2.5 flex flex-col gap-1.5 w-full"><div class="text-xs font-medium"> </div> <div class="flex w-full"><div class="flex-1"><input class="w-full text-sm py-0.5 placeholder:text-gray-300 dark:placeholder:text-gray-700 bg-transparent outline-hidden" type="text" autocomplete="off"/></div></div></div> <div class="mb-2.5 flex flex-col gap-1.5 w-full"><div class="flex gap-2 w-full items-center justify-between"><div class="text-xs font-medium"> </div> <div><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-left"><option selected> </option><option> </option><option> </option></select></div></div> <!></div> <div class="flex gap-2 w-full items-center justify-between"><div class="text-xs font-medium"> </div> <div><!></div></div>`, 1);
var root_9 = from_html(`<div class="mb-2.5"><div class="  flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right" required><option disabled selected> </option><!></select></div></div> <!></div> <!> <hr class="border-gray-100 dark:border-gray-850 my-2"/> <div><div class="py-0.5 w-full"><div class=" mb-2.5 text-xs font-medium"> </div> <!></div></div>`, 1);
var root_1$1 = from_html(`<div><div class="mb-3.5"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5"><div class=" flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div></div> <div class="mb-2.5"><div class="flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <div class="flex items-center relative"><select class="dark:bg-gray-900 w-fit pr-8 rounded-sm px-2 p-1 text-xs bg-transparent outline-hidden text-right" required><option disabled selected> </option><!></select></div></div> <!></div> <!></div> <div class="mb-3.5"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5"><div class=" flex w-full justify-between"><div class=" self-center text-xs font-medium"> </div> <!></div></div> <!></div></div>`);
var root$2 = from_html(`<form class="flex flex-col h-full justify-between space-y-3 text-sm"><div class=" space-y-3 overflow-y-scroll scrollbar-hidden h-full"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`);
function CodeExecution($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let saveHandler = prop($$props, "saveHandler", 8);
  let config2 = mutable_source(null);
  let engines = ["jupyter"];
  const submitHandler = async () => {
    await setCodeExecutionConfig(localStorage.token, get(config2));
  };
  onMount(async () => {
    const res = await getCodeExecutionConfig(localStorage.token);
    if (res) {
      set(config2, res);
    }
  });
  init();
  var form = root$2();
  var div = child(form);
  var node = child(div);
  {
    var consequent_9 = ($$anchor2) => {
      var div_1 = root_1$1();
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text2 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var div_6 = child(div_5);
      var text_1 = child(div_6, true);
      reset(div_6);
      var node_1 = sibling(div_6, 2);
      Switch_1(node_1, {
        get state() {
          return get(config2).ENABLE_CODE_EXECUTION;
        },
        set state($$value) {
          mutate(config2, get(config2).ENABLE_CODE_EXECUTION = $$value);
        },
        $$legacy: true
      });
      reset(div_5);
      reset(div_4);
      var div_7 = sibling(div_4, 2);
      var div_8 = child(div_7);
      var div_9 = child(div_8);
      var text_2 = child(div_9, true);
      reset(div_9);
      var div_10 = sibling(div_9, 2);
      var select = child(div_10);
      template_effect(() => {
        get(config2);
        invalidate_inner_signals(() => {
          $i18n();
        });
      });
      var option = child(select);
      var text_3 = child(option, true);
      reset(option);
      option.value = option.__value = "";
      var node_2 = sibling(option);
      each(node_2, 1, () => engines, index, ($$anchor3, engine) => {
        var option_1 = root_2$1();
        var text_4 = child(option_1, true);
        reset(option_1);
        var option_1_value = {};
        template_effect(() => {
          set_text(text_4, get(engine));
          if (option_1_value !== (option_1_value = get(engine))) {
            option_1.value = (option_1.__value = get(engine)) ?? "";
          }
        });
        append($$anchor3, option_1);
      });
      reset(select);
      reset(div_10);
      reset(div_8);
      var node_3 = sibling(div_8, 2);
      {
        var consequent = ($$anchor3) => {
          var div_11 = root_3();
          var text_5 = child(div_11, true);
          reset(div_11);
          template_effect(($0) => set_text(text_5, $0), [
            () => ($i18n(), untrack(() => $i18n().t("Warning: Jupyter execution enables arbitrary code execution, posing severe security risksproceed with extreme caution.")))
          ]);
          append($$anchor3, div_11);
        };
        if_block(node_3, ($$render) => {
          if (get(config2), untrack(() => get(config2).CODE_EXECUTION_ENGINE === "jupyter")) $$render(consequent);
        });
      }
      reset(div_7);
      var node_4 = sibling(div_7, 2);
      {
        var consequent_3 = ($$anchor3) => {
          var fragment = root_4$1();
          var div_12 = first_child(fragment);
          var div_13 = child(div_12);
          var text_6 = child(div_13, true);
          reset(div_13);
          var div_14 = sibling(div_13, 2);
          var div_15 = child(div_14);
          var input = child(div_15);
          remove_input_defaults(input);
          reset(div_15);
          reset(div_14);
          reset(div_12);
          var div_16 = sibling(div_12, 2);
          var div_17 = child(div_16);
          var div_18 = child(div_17);
          var text_7 = child(div_18, true);
          reset(div_18);
          var div_19 = sibling(div_18, 2);
          var select_1 = child(div_19);
          template_effect(() => {
            get(config2);
            invalidate_inner_signals(() => {
              $i18n();
            });
          });
          var option_2 = child(select_1);
          var text_8 = child(option_2, true);
          reset(option_2);
          option_2.value = option_2.__value = "";
          var option_3 = sibling(option_2);
          var text_9 = child(option_3, true);
          reset(option_3);
          option_3.value = option_3.__value = "token";
          var option_4 = sibling(option_3);
          var text_10 = child(option_4, true);
          reset(option_4);
          option_4.value = option_4.__value = "password";
          reset(select_1);
          reset(div_19);
          reset(div_17);
          var node_5 = sibling(div_17, 2);
          {
            var consequent_2 = ($$anchor4) => {
              var div_20 = root_5();
              var div_21 = child(div_20);
              var node_6 = child(div_21);
              {
                var consequent_1 = ($$anchor5) => {
                  {
                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Jupyter Password"))));
                    SensitiveInput($$anchor5, {
                      type: "text",
                      get placeholder() {
                        return get($0);
                      },
                      autocomplete: "off",
                      get value() {
                        return get(config2).CODE_EXECUTION_JUPYTER_AUTH_PASSWORD;
                      },
                      set value($$value) {
                        mutate(config2, get(config2).CODE_EXECUTION_JUPYTER_AUTH_PASSWORD = $$value);
                      },
                      $$legacy: true
                    });
                  }
                };
                var alternate = ($$anchor5) => {
                  {
                    let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Jupyter Token"))));
                    SensitiveInput($$anchor5, {
                      type: "text",
                      get placeholder() {
                        return get($0);
                      },
                      autocomplete: "off",
                      get value() {
                        return get(config2).CODE_EXECUTION_JUPYTER_AUTH_TOKEN;
                      },
                      set value($$value) {
                        mutate(config2, get(config2).CODE_EXECUTION_JUPYTER_AUTH_TOKEN = $$value);
                      },
                      $$legacy: true
                    });
                  }
                };
                if_block(node_6, ($$render) => {
                  if (get(config2), untrack(() => get(config2).CODE_EXECUTION_JUPYTER_AUTH === "password")) $$render(consequent_1);
                  else $$render(alternate, false);
                });
              }
              reset(div_21);
              reset(div_20);
              append($$anchor4, div_20);
            };
            if_block(node_5, ($$render) => {
              if (get(config2), untrack(() => get(config2).CODE_EXECUTION_JUPYTER_AUTH)) $$render(consequent_2);
            });
          }
          reset(div_16);
          var div_22 = sibling(div_16, 2);
          var div_23 = child(div_22);
          var text_11 = child(div_23, true);
          reset(div_23);
          var div_24 = sibling(div_23, 2);
          var node_7 = child(div_24);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter timeout in seconds"))));
            Tooltip(node_7, {
              get content() {
                return get($0);
              },
              children: ($$anchor4, $$slotProps) => {
                var input_1 = root_8();
                remove_input_defaults(input_1);
                template_effect(($02) => set_attribute(input_1, "placeholder", $02), [() => ($i18n(), untrack(() => $i18n().t("e.g. 60")))]);
                bind_value(input_1, () => get(config2).CODE_EXECUTION_JUPYTER_TIMEOUT, ($$value) => mutate(config2, get(config2).CODE_EXECUTION_JUPYTER_TIMEOUT = $$value));
                append($$anchor4, input_1);
              },
              $$slots: { default: true }
            });
          }
          reset(div_24);
          reset(div_22);
          template_effect(
            ($0, $1, $2, $3, $4, $5, $6, $7) => {
              set_text(text_6, $0);
              set_attribute(input, "placeholder", $1);
              set_text(text_7, $2);
              set_attribute(select_1, "placeholder", $3);
              set_text(text_8, $4);
              set_text(text_9, $5);
              set_text(text_10, $6);
              set_text(text_11, $7);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Jupyter URL"))),
              () => ($i18n(), untrack(() => $i18n().t("Enter Jupyter URL"))),
              () => ($i18n(), untrack(() => $i18n().t("Jupyter Auth"))),
              () => ($i18n(), untrack(() => $i18n().t("Select an auth method"))),
              () => ($i18n(), untrack(() => $i18n().t("None"))),
              () => ($i18n(), untrack(() => $i18n().t("Token"))),
              () => ($i18n(), untrack(() => $i18n().t("Password"))),
              () => ($i18n(), untrack(() => $i18n().t("Code Execution Timeout")))
            ]
          );
          bind_value(input, () => get(config2).CODE_EXECUTION_JUPYTER_URL, ($$value) => mutate(config2, get(config2).CODE_EXECUTION_JUPYTER_URL = $$value));
          bind_select_value(select_1, () => get(config2).CODE_EXECUTION_JUPYTER_AUTH, ($$value) => mutate(config2, get(config2).CODE_EXECUTION_JUPYTER_AUTH = $$value));
          append($$anchor3, fragment);
        };
        if_block(node_4, ($$render) => {
          if (get(config2), untrack(() => get(config2).CODE_EXECUTION_ENGINE === "jupyter")) $$render(consequent_3);
        });
      }
      reset(div_2);
      var div_25 = sibling(div_2, 2);
      var div_26 = child(div_25);
      var text_12 = child(div_26, true);
      reset(div_26);
      var div_27 = sibling(div_26, 4);
      var div_28 = child(div_27);
      var div_29 = child(div_28);
      var text_13 = child(div_29, true);
      reset(div_29);
      var node_8 = sibling(div_29, 2);
      Switch_1(node_8, {
        get state() {
          return get(config2).ENABLE_CODE_INTERPRETER;
        },
        set state($$value) {
          mutate(config2, get(config2).ENABLE_CODE_INTERPRETER = $$value);
        },
        $$legacy: true
      });
      reset(div_28);
      reset(div_27);
      var node_9 = sibling(div_27, 2);
      {
        var consequent_8 = ($$anchor3) => {
          var fragment_3 = root_9();
          var div_30 = first_child(fragment_3);
          var div_31 = child(div_30);
          var div_32 = child(div_31);
          var text_14 = child(div_32, true);
          reset(div_32);
          var div_33 = sibling(div_32, 2);
          var select_2 = child(div_33);
          template_effect(() => {
            get(config2);
            invalidate_inner_signals(() => {
              $i18n();
            });
          });
          var option_5 = child(select_2);
          var text_15 = child(option_5, true);
          reset(option_5);
          option_5.value = option_5.__value = "";
          var node_10 = sibling(option_5);
          each(node_10, 1, () => engines, index, ($$anchor4, engine) => {
            var option_6 = root_10();
            var text_16 = child(option_6, true);
            reset(option_6);
            var option_6_value = {};
            template_effect(() => {
              set_text(text_16, get(engine));
              if (option_6_value !== (option_6_value = get(engine))) {
                option_6.value = (option_6.__value = get(engine)) ?? "";
              }
            });
            append($$anchor4, option_6);
          });
          reset(select_2);
          reset(div_33);
          reset(div_31);
          var node_11 = sibling(div_31, 2);
          {
            var consequent_4 = ($$anchor4) => {
              var div_34 = root_11();
              var text_17 = child(div_34, true);
              reset(div_34);
              template_effect(($0) => set_text(text_17, $0), [
                () => ($i18n(), untrack(() => $i18n().t("Warning: Jupyter execution enables arbitrary code execution, posing severe security risksproceed with extreme caution.")))
              ]);
              append($$anchor4, div_34);
            };
            if_block(node_11, ($$render) => {
              if (get(config2), untrack(() => get(config2).CODE_INTERPRETER_ENGINE === "jupyter")) $$render(consequent_4);
            });
          }
          reset(div_30);
          var node_12 = sibling(div_30, 2);
          {
            var consequent_7 = ($$anchor4) => {
              var fragment_4 = root_12();
              var div_35 = first_child(fragment_4);
              var div_36 = child(div_35);
              var text_18 = child(div_36, true);
              reset(div_36);
              var div_37 = sibling(div_36, 2);
              var div_38 = child(div_37);
              var input_2 = child(div_38);
              remove_input_defaults(input_2);
              reset(div_38);
              reset(div_37);
              reset(div_35);
              var div_39 = sibling(div_35, 2);
              var div_40 = child(div_39);
              var div_41 = child(div_40);
              var text_19 = child(div_41, true);
              reset(div_41);
              var div_42 = sibling(div_41, 2);
              var select_3 = child(div_42);
              template_effect(() => {
                get(config2);
                invalidate_inner_signals(() => {
                  $i18n();
                });
              });
              var option_7 = child(select_3);
              var text_20 = child(option_7, true);
              reset(option_7);
              option_7.value = option_7.__value = "";
              var option_8 = sibling(option_7);
              var text_21 = child(option_8, true);
              reset(option_8);
              option_8.value = option_8.__value = "token";
              var option_9 = sibling(option_8);
              var text_22 = child(option_9, true);
              reset(option_9);
              option_9.value = option_9.__value = "password";
              reset(select_3);
              reset(div_42);
              reset(div_40);
              var node_13 = sibling(div_40, 2);
              {
                var consequent_6 = ($$anchor5) => {
                  var div_43 = root_13();
                  var div_44 = child(div_43);
                  var node_14 = child(div_44);
                  {
                    var consequent_5 = ($$anchor6) => {
                      {
                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Jupyter Password"))));
                        SensitiveInput($$anchor6, {
                          type: "text",
                          get placeholder() {
                            return get($0);
                          },
                          autocomplete: "off",
                          get value() {
                            return get(config2).CODE_INTERPRETER_JUPYTER_AUTH_PASSWORD;
                          },
                          set value($$value) {
                            mutate(config2, get(config2).CODE_INTERPRETER_JUPYTER_AUTH_PASSWORD = $$value);
                          },
                          $$legacy: true
                        });
                      }
                    };
                    var alternate_1 = ($$anchor6) => {
                      {
                        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter Jupyter Token"))));
                        SensitiveInput($$anchor6, {
                          type: "text",
                          get placeholder() {
                            return get($0);
                          },
                          autocomplete: "off",
                          get value() {
                            return get(config2).CODE_INTERPRETER_JUPYTER_AUTH_TOKEN;
                          },
                          set value($$value) {
                            mutate(config2, get(config2).CODE_INTERPRETER_JUPYTER_AUTH_TOKEN = $$value);
                          },
                          $$legacy: true
                        });
                      }
                    };
                    if_block(node_14, ($$render) => {
                      if (get(config2), untrack(() => get(config2).CODE_INTERPRETER_JUPYTER_AUTH === "password")) $$render(consequent_5);
                      else $$render(alternate_1, false);
                    });
                  }
                  reset(div_44);
                  reset(div_43);
                  append($$anchor5, div_43);
                };
                if_block(node_13, ($$render) => {
                  if (get(config2), untrack(() => get(config2).CODE_INTERPRETER_JUPYTER_AUTH)) $$render(consequent_6);
                });
              }
              reset(div_39);
              var div_45 = sibling(div_39, 2);
              var div_46 = child(div_45);
              var text_23 = child(div_46, true);
              reset(div_46);
              var div_47 = sibling(div_46, 2);
              var node_15 = child(div_47);
              {
                let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Enter timeout in seconds"))));
                Tooltip(node_15, {
                  get content() {
                    return get($0);
                  },
                  children: ($$anchor5, $$slotProps) => {
                    var input_3 = root_16();
                    remove_input_defaults(input_3);
                    template_effect(($02) => set_attribute(input_3, "placeholder", $02), [() => ($i18n(), untrack(() => $i18n().t("e.g. 60")))]);
                    bind_value(input_3, () => get(config2).CODE_INTERPRETER_JUPYTER_TIMEOUT, ($$value) => mutate(config2, get(config2).CODE_INTERPRETER_JUPYTER_TIMEOUT = $$value));
                    append($$anchor5, input_3);
                  },
                  $$slots: { default: true }
                });
              }
              reset(div_47);
              reset(div_45);
              template_effect(
                ($0, $1, $2, $3, $4, $5, $6, $7) => {
                  set_text(text_18, $0);
                  set_attribute(input_2, "placeholder", $1);
                  set_text(text_19, $2);
                  set_attribute(select_3, "placeholder", $3);
                  set_text(text_20, $4);
                  set_text(text_21, $5);
                  set_text(text_22, $6);
                  set_text(text_23, $7);
                },
                [
                  () => ($i18n(), untrack(() => $i18n().t("Jupyter URL"))),
                  () => ($i18n(), untrack(() => $i18n().t("Enter Jupyter URL"))),
                  () => ($i18n(), untrack(() => $i18n().t("Jupyter Auth"))),
                  () => ($i18n(), untrack(() => $i18n().t("Select an auth method"))),
                  () => ($i18n(), untrack(() => $i18n().t("None"))),
                  () => ($i18n(), untrack(() => $i18n().t("Token"))),
                  () => ($i18n(), untrack(() => $i18n().t("Password"))),
                  () => ($i18n(), untrack(() => $i18n().t("Code Execution Timeout")))
                ]
              );
              bind_value(input_2, () => get(config2).CODE_INTERPRETER_JUPYTER_URL, ($$value) => mutate(config2, get(config2).CODE_INTERPRETER_JUPYTER_URL = $$value));
              bind_select_value(select_3, () => get(config2).CODE_INTERPRETER_JUPYTER_AUTH, ($$value) => mutate(config2, get(config2).CODE_INTERPRETER_JUPYTER_AUTH = $$value));
              append($$anchor4, fragment_4);
            };
            if_block(node_12, ($$render) => {
              if (get(config2), untrack(() => get(config2).CODE_INTERPRETER_ENGINE === "jupyter")) $$render(consequent_7);
            });
          }
          var div_48 = sibling(node_12, 4);
          var div_49 = child(div_48);
          var div_50 = child(div_49);
          var text_24 = child(div_50, true);
          reset(div_50);
          var node_16 = sibling(div_50, 2);
          {
            let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"))));
            Tooltip(node_16, {
              get content() {
                return get($0);
              },
              placement: "top-start",
              children: ($$anchor4, $$slotProps) => {
                {
                  let $02 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t("Leave empty to use the default prompt, or enter a custom prompt"))));
                  Textarea($$anchor4, {
                    get placeholder() {
                      return get($02);
                    },
                    get value() {
                      return get(config2).CODE_INTERPRETER_PROMPT_TEMPLATE;
                    },
                    set value($$value) {
                      mutate(config2, get(config2).CODE_INTERPRETER_PROMPT_TEMPLATE = $$value);
                    },
                    $$legacy: true
                  });
                }
              },
              $$slots: { default: true }
            });
          }
          reset(div_49);
          reset(div_48);
          template_effect(
            ($0, $1, $2, $3) => {
              set_text(text_14, $0);
              set_attribute(select_2, "placeholder", $1);
              set_text(text_15, $2);
              set_text(text_24, $3);
            },
            [
              () => ($i18n(), untrack(() => $i18n().t("Code Interpreter Engine"))),
              () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
              () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
              () => ($i18n(), untrack(() => $i18n().t("Code Interpreter Prompt Template")))
            ]
          );
          bind_select_value(select_2, () => get(config2).CODE_INTERPRETER_ENGINE, ($$value) => mutate(config2, get(config2).CODE_INTERPRETER_ENGINE = $$value));
          append($$anchor3, fragment_3);
        };
        if_block(node_9, ($$render) => {
          if (get(config2), untrack(() => get(config2).ENABLE_CODE_INTERPRETER)) $$render(consequent_8);
        });
      }
      reset(div_25);
      reset(div_1);
      template_effect(
        ($0, $1, $2, $3, $4, $5, $6) => {
          set_text(text2, $0);
          set_text(text_1, $1);
          set_text(text_2, $2);
          set_attribute(select, "placeholder", $3);
          set_text(text_3, $4);
          set_text(text_12, $5);
          set_text(text_13, $6);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("General"))),
          () => ($i18n(), untrack(() => $i18n().t("Enable Code Execution"))),
          () => ($i18n(), untrack(() => $i18n().t("Code Execution Engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Select a engine"))),
          () => ($i18n(), untrack(() => $i18n().t("Code Interpreter"))),
          () => ($i18n(), untrack(() => $i18n().t("Enable Code Interpreter")))
        ]
      );
      bind_select_value(select, () => get(config2).CODE_EXECUTION_ENGINE, ($$value) => mutate(config2, get(config2).CODE_EXECUTION_ENGINE = $$value));
      append($$anchor2, div_1);
    };
    if_block(node, ($$render) => {
      if (get(config2)) $$render(consequent_9);
    });
  }
  reset(div);
  var div_51 = sibling(div, 2);
  var button = child(div_51);
  var text_25 = child(button, true);
  reset(button);
  reset(div_51);
  reset(form);
  template_effect(($0) => set_text(text_25, $0), [() => ($i18n(), untrack(() => $i18n().t("Save")))]);
  event("submit", form, preventDefault(async () => {
    await submitHandler();
    saveHandler()();
  }));
  append($$anchor, form);
  pop();
  $$cleanup();
}
var root_2 = from_html(`<button class="px-1" type="button"><!></button>`);
var root_1 = from_html(`<div><div class="mb-3"><div class=" mt-0.5 mb-2.5 text-base font-medium"> </div> <hr class=" border-gray-100 dark:border-gray-850 my-2"/> <div class="mb-2.5 flex flex-col w-full justify-between"><div class="flex justify-between items-center mb-0.5"><div class="font-medium"> </div> <!></div> <div class="flex flex-col gap-1"></div> <div class="my-1.5"><div class="text-xs text-gray-500"> </div></div></div></div></div>`);
var root_4 = from_html(`<div class="flex h-full justify-center"><div class="my-auto"><!></div></div>`);
var root$1 = from_html(`<!> <form class="flex flex-col h-full justify-between text-sm"><div class=" overflow-y-scroll scrollbar-hidden h-full"><!></div> <div class="flex justify-end pt-3 text-sm font-medium"><button class="px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full" type="submit"> </button></div></form>`, 1);
function Tools($$anchor, $$props) {
  push($$props, false);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  createEventDispatcher();
  const i18n = getContext("i18n");
  prop($$props, "saveSettings", 8);
  let servers = mutable_source(null);
  let showConnectionModal = mutable_source(false);
  const addConnectionHandler = async (server) => {
    set(servers, [...get(servers), server]);
    await updateHandler();
  };
  const updateHandler = async () => {
    const res = await setToolServerConnections(localStorage.token, { TOOL_SERVER_CONNECTIONS: get(servers) }).catch((err) => {
      toast.error($i18n().t("Failed to save connections"));
      return null;
    });
    if (res) {
      toast.success($i18n().t("Connections saved successfully"));
    }
  };
  onMount(async () => {
    const res = await getToolServerConnections(localStorage.token);
    set(servers, res.TOOL_SERVER_CONNECTIONS);
  });
  init();
  var fragment = root$1();
  var node = first_child(fragment);
  AddToolServerModal(node, {
    onSubmit: addConnectionHandler,
    get show() {
      return get(showConnectionModal);
    },
    set show($$value) {
      set(showConnectionModal, $$value);
    },
    $$legacy: true
  });
  var form = sibling(node, 2);
  var div = child(form);
  var node_1 = child(div);
  {
    var consequent = ($$anchor2) => {
      var div_1 = root_1();
      var div_2 = child(div_1);
      var div_3 = child(div_2);
      var text2 = child(div_3, true);
      reset(div_3);
      var div_4 = sibling(div_3, 4);
      var div_5 = child(div_4);
      var div_6 = child(div_5);
      var text_1 = child(div_6, true);
      reset(div_6);
      var node_2 = sibling(div_6, 2);
      {
        let $0 = derived_safe_equal(() => ($i18n(), untrack(() => $i18n().t(`Add Connection`))));
        Tooltip(node_2, {
          get content() {
            return get($0);
          },
          children: ($$anchor3, $$slotProps) => {
            var button = root_2();
            var node_3 = child(button);
            Plus(node_3, {});
            reset(button);
            event("click", button, () => {
              set(showConnectionModal, true);
            });
            append($$anchor3, button);
          },
          $$slots: { default: true }
        });
      }
      reset(div_5);
      var div_7 = sibling(div_5, 2);
      each(div_7, 5, () => get(servers), index, ($$anchor3, server, idx) => {
        Connection($$anchor3, {
          onSubmit: () => {
            updateHandler();
          },
          onDelete: () => {
            set(servers, get(servers).filter((_, i) => i !== idx));
            updateHandler();
          },
          get connection() {
            return get(servers)[idx];
          },
          set connection($$value) {
            get(servers)[idx] = $$value, invalidate_inner_signals(() => get(servers));
          },
          $$legacy: true
        });
      });
      reset(div_7);
      var div_8 = sibling(div_7, 2);
      var div_9 = child(div_8);
      var text_2 = child(div_9, true);
      reset(div_9);
      reset(div_8);
      reset(div_4);
      reset(div_2);
      reset(div_1);
      template_effect(
        ($0, $1, $2) => {
          set_text(text2, $0);
          set_text(text_1, $1);
          set_text(text_2, $2);
        },
        [
          () => ($i18n(), untrack(() => $i18n().t("General"))),
          () => ($i18n(), untrack(() => $i18n().t("Manage Tool Servers"))),
          () => ($i18n(), untrack(() => $i18n().t("Connect to your own OpenAPI compatible external tool servers.")))
        ]
      );
      append($$anchor2, div_1);
    };
    var alternate = ($$anchor2) => {
      var div_10 = root_4();
      var div_11 = child(div_10);
      var node_4 = child(div_11);
      Spinner(node_4, { className: "size-6" });
      reset(div_11);
      reset(div_10);
      append($$anchor2, div_10);
    };
    if_block(node_1, ($$render) => {
      if (get(servers) !== null) $$render(consequent);
      else $$render(alternate, false);
    });
  }
  reset(div);
  var div_12 = sibling(div, 2);
  var button_1 = child(div_12);
  var text_3 = child(button_1, true);
  reset(button_1);
  reset(div_12);
  reset(form);
  template_effect(($0) => set_text(text_3, $0), [() => ($i18n(), untrack(() => $i18n().t("Save")))]);
  event("submit", form, preventDefault(() => {
    updateHandler();
  }));
  append($$anchor, fragment);
  pop();
  $$cleanup();
}
var root = from_html(`<div class="flex flex-col lg:flex-row w-full h-full pb-2 lg:space-x-4"><div id="admin-settings-tabs-container" class="tabs mx-[16px] lg:mx-0 lg:px-[16px] flex flex-row overflow-x-auto gap-2.5 max-w-full lg:gap-1 lg:flex-col lg:flex-none lg:w-50 dark:text-gray-200 text-sm font-medium text-left scrollbar-none"><button id="general"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M6.955 1.45A.5.5 0 0 1 7.452 1h1.096a.5.5 0 0 1 .497.45l.17 1.699c.484.12.94.312 1.356.562l1.321-1.081a.5.5 0 0 1 .67.033l.774.775a.5.5 0 0 1 .034.67l-1.08 1.32c.25.417.44.873.561 1.357l1.699.17a.5.5 0 0 1 .45.497v1.096a.5.5 0 0 1-.45.497l-1.699.17c-.12.484-.312.94-.562 1.356l1.082 1.322a.5.5 0 0 1-.034.67l-.774.774a.5.5 0 0 1-.67.033l-1.322-1.08c-.416.25-.872.44-1.356.561l-.17 1.699a.5.5 0 0 1-.497.45H7.452a.5.5 0 0 1-.497-.45l-.17-1.699a4.973 4.973 0 0 1-1.356-.562L4.108 13.37a.5.5 0 0 1-.67-.033l-.774-.775a.5.5 0 0 1-.034-.67l1.08-1.32a4.971 4.971 0 0 1-.561-1.357l-1.699-.17A.5.5 0 0 1 1 8.548V7.452a.5.5 0 0 1 .45-.497l1.699-.17c.12-.484.312-.94.562-1.356L2.629 4.107a.5.5 0 0 1 .034-.67l.774-.774a.5.5 0 0 1 .67-.033L5.43 3.71a4.97 4.97 0 0 1 1.356-.561l.17-1.699ZM6 8c0 .538.212 1.026.558 1.385l.057.057a2 2 0 0 0 2.828-2.828l-.058-.056A2 2 0 0 0 6 8Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center"> </div></button> <button id="connections"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M1 9.5A3.5 3.5 0 0 0 4.5 13H12a3 3 0 0 0 .917-5.857 2.503 2.503 0 0 0-3.198-3.019 3.5 3.5 0 0 0-6.628 2.171A3.5 3.5 0 0 0 1 9.5Z"></path></svg></div> <div class=" self-center"> </div></button> <button id="models"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M10 1c3.866 0 7 1.79 7 4s-3.134 4-7 4-7-1.79-7-4 3.134-4 7-4zm5.694 8.13c.464-.264.91-.583 1.306-.952V10c0 2.21-3.134 4-7 4s-7-1.79-7-4V8.178c.396.37.842.688 1.306.953C5.838 10.006 7.854 10.5 10 10.5s4.162-.494 5.694-1.37zM3 13.179V15c0 2.21 3.134 4 7 4s7-1.79 7-4v-1.822c-.396.37-.842.688-1.306.953-1.532.875-3.548 1.369-5.694 1.369s-4.162-.494-5.694-1.37A7.009 7.009 0 013 13.179z" clip-rule="evenodd"></path></svg></div> <div class=" self-center"> </div></button> <button id="evaluations"><div class=" self-center mr-2"><!></div> <div class=" self-center"> </div></button> <button id="tools"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center"> </div></button> <button id="documents"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M11.625 16.5a1.875 1.875 0 1 0 0-3.75 1.875 1.875 0 0 0 0 3.75Z"></path><path fill-rule="evenodd" d="M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6 16.5c.66 0 1.277-.19 1.797-.518l1.048 1.048a.75.75 0 0 0 1.06-1.06l-1.047-1.048A3.375 3.375 0 1 0 11.625 18Z" clip-rule="evenodd"></path><path d="M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"></path></svg></div> <div class=" self-center"> </div></button> <button id="web"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z"></path></svg></div> <div class=" self-center"> </div></button> <button id="code-execution"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M2 4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4Zm2.22 1.97a.75.75 0 0 0 0 1.06l.97.97-.97.97a.75.75 0 1 0 1.06 1.06l1.5-1.5a.75.75 0 0 0 0-1.06l-1.5-1.5a.75.75 0 0 0-1.06 0ZM8.75 8.5a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5h-2.5Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center"> </div></button> <button id="interface"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M2 4.25A2.25 2.25 0 0 1 4.25 2h7.5A2.25 2.25 0 0 1 14 4.25v5.5A2.25 2.25 0 0 1 11.75 12h-1.312c.1.128.21.248.328.36a.75.75 0 0 1 .234.545v.345a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-.345a.75.75 0 0 1 .234-.545c.118-.111.228-.232.328-.36H4.25A2.25 2.25 0 0 1 2 9.75v-5.5Zm2.25-.75a.75.75 0 0 0-.75.75v4.5c0 .414.336.75.75.75h7.5a.75.75 0 0 0 .75-.75v-4.5a.75.75 0 0 0-.75-.75h-7.5Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center"> </div></button> <button id="audio"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M7.557 2.066A.75.75 0 0 1 8 2.75v10.5a.75.75 0 0 1-1.248.56L3.59 11H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.59l3.162-2.81a.75.75 0 0 1 .805-.124ZM12.95 3.05a.75.75 0 1 0-1.06 1.06 5.5 5.5 0 0 1 0 7.78.75.75 0 1 0 1.06 1.06 7 7 0 0 0 0-9.9Z"></path><path d="M10.828 5.172a.75.75 0 1 0-1.06 1.06 2.5 2.5 0 0 1 0 3.536.75.75 0 1 0 1.06 1.06 4 4 0 0 0 0-5.656Z"></path></svg></div> <div class=" self-center"> </div></button> <button id="images"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M2 4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4Zm10.5 5.707a.5.5 0 0 0-.146-.353l-1-1a.5.5 0 0 0-.708 0L9.354 9.646a.5.5 0 0 1-.708 0L6.354 7.354a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0-.146.353V12a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V9.707ZM12 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" clip-rule="evenodd"></path></svg></div> <div class=" self-center"> </div></button> <button id="pipelines"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4"><path d="M11.644 1.59a.75.75 0 0 1 .712 0l9.75 5.25a.75.75 0 0 1 0 1.32l-9.75 5.25a.75.75 0 0 1-.712 0l-9.75-5.25a.75.75 0 0 1 0-1.32l9.75-5.25Z"></path><path d="m3.265 10.602 7.668 4.129a2.25 2.25 0 0 0 2.134 0l7.668-4.13 1.37.739a.75.75 0 0 1 0 1.32l-9.75 5.25a.75.75 0 0 1-.71 0l-9.75-5.25a.75.75 0 0 1 0-1.32l1.37-.738Z"></path><path d="m10.933 19.231-7.668-4.13-1.37.739a.75.75 0 0 0 0 1.32l9.75 5.25c.221.12.489.12.71 0l9.75-5.25a.75.75 0 0 0 0-1.32l-1.37-.738-7.668 4.13a2.25 2.25 0 0 1-2.134-.001Z"></path></svg></div> <div class=" self-center"> </div></button> <button id="db"><div class=" self-center mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path d="M8 7c3.314 0 6-1.343 6-3s-2.686-3-6-3-6 1.343-6 3 2.686 3 6 3Z"></path><path d="M8 8.5c1.84 0 3.579-.37 4.914-1.037A6.33 6.33 0 0 0 14 6.78V8c0 1.657-2.686 3-6 3S2 9.657 2 8V6.78c.346.273.72.5 1.087.683C4.42 8.131 6.16 8.5 8 8.5Z"></path><path d="M8 12.5c1.84 0 3.579-.37 4.914-1.037.366-.183.74-.41 1.086-.684V12c0 1.657-2.686 3-6 3s-6-1.343-6-3v-1.22c.346.273.72.5 1.087.683C4.42 12.131 6.16 12.5 8 12.5Z"></path></svg></div> <div class=" self-center"> </div></button></div> <div class="flex-1 mt-3 lg:mt-0 px-[16px] lg:pr-[16px] lg:pl-0 overflow-y-scroll scrollbar-hidden"><!></div></div>`);
function Settings($$anchor, $$props) {
  push($$props, false);
  const $page = () => store_get(page, "$page", $$stores);
  const $i18n = () => store_get(i18n, "$i18n", $$stores);
  const [$$stores, $$cleanup] = setup_stores();
  const i18n = getContext("i18n");
  let selectedTab = mutable_source("general");
  const scrollToTab = (tabId) => {
    const tabElement = document.getElementById(tabId);
    if (tabElement) {
      tabElement.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "start" });
    }
  };
  onMount(() => {
    const containerElement = document.getElementById("admin-settings-tabs-container");
    if (containerElement) {
      containerElement.addEventListener("wheel", function(event2) {
        if (event2.deltaY !== 0) {
          containerElement.scrollLeft += event2.deltaY;
        }
      });
    }
    scrollToTab(get(selectedTab));
  });
  legacy_pre_effect(() => $page(), () => {
    const pathParts = $page().url.pathname.split("/");
    const tabFromPath = pathParts[pathParts.length - 1];
    set(selectedTab, [
      "general",
      "connections",
      "models",
      "evaluations",
      "tools",
      "documents",
      "web",
      "code-execution",
      "interface",
      "audio",
      "images",
      "pipelines",
      "db"
    ].includes(tabFromPath) ? tabFromPath : "general");
  });
  legacy_pre_effect(() => get(selectedTab), () => {
    if (get(selectedTab)) {
      scrollToTab(get(selectedTab));
    }
  });
  legacy_pre_effect_reset();
  init();
  var div = root();
  var div_1 = child(div);
  var button = child(div_1);
  var div_2 = sibling(child(button), 2);
  var text2 = child(div_2, true);
  reset(div_2);
  reset(button);
  var button_1 = sibling(button, 2);
  var div_3 = sibling(child(button_1), 2);
  var text_1 = child(div_3, true);
  reset(div_3);
  reset(button_1);
  var button_2 = sibling(button_1, 2);
  var div_4 = sibling(child(button_2), 2);
  var text_2 = child(div_4, true);
  reset(div_4);
  reset(button_2);
  var button_3 = sibling(button_2, 2);
  var div_5 = child(button_3);
  var node = child(div_5);
  DocumentChartBar(node, {});
  reset(div_5);
  var div_6 = sibling(div_5, 2);
  var text_3 = child(div_6, true);
  reset(div_6);
  reset(button_3);
  var button_4 = sibling(button_3, 2);
  var div_7 = sibling(child(button_4), 2);
  var text_4 = child(div_7, true);
  reset(div_7);
  reset(button_4);
  var button_5 = sibling(button_4, 2);
  var div_8 = sibling(child(button_5), 2);
  var text_5 = child(div_8, true);
  reset(div_8);
  reset(button_5);
  var button_6 = sibling(button_5, 2);
  var div_9 = sibling(child(button_6), 2);
  var text_6 = child(div_9, true);
  reset(div_9);
  reset(button_6);
  var button_7 = sibling(button_6, 2);
  var div_10 = sibling(child(button_7), 2);
  var text_7 = child(div_10, true);
  reset(div_10);
  reset(button_7);
  var button_8 = sibling(button_7, 2);
  var div_11 = sibling(child(button_8), 2);
  var text_8 = child(div_11, true);
  reset(div_11);
  reset(button_8);
  var button_9 = sibling(button_8, 2);
  var div_12 = sibling(child(button_9), 2);
  var text_9 = child(div_12, true);
  reset(div_12);
  reset(button_9);
  var button_10 = sibling(button_9, 2);
  var div_13 = sibling(child(button_10), 2);
  var text_10 = child(div_13, true);
  reset(div_13);
  reset(button_10);
  var button_11 = sibling(button_10, 2);
  var div_14 = sibling(child(button_11), 2);
  var text_11 = child(div_14, true);
  reset(div_14);
  reset(button_11);
  var button_12 = sibling(button_11, 2);
  var div_15 = sibling(child(button_12), 2);
  var text_12 = child(div_15, true);
  reset(div_15);
  reset(button_12);
  reset(div_1);
  var div_16 = sibling(div_1, 2);
  var node_1 = child(div_16);
  {
    var consequent = ($$anchor2) => {
      General($$anchor2, {
        saveHandler: async () => {
          toast.success($i18n().t("Settings saved successfully!"));
          await tick();
          await config.set(await getBackendConfig());
        }
      });
    };
    var alternate_11 = ($$anchor2) => {
      var fragment_1 = comment();
      var node_2 = first_child(fragment_1);
      {
        var consequent_1 = ($$anchor3) => {
          Connections($$anchor3, {
            $$events: {
              save: () => {
                toast.success($i18n().t("Settings saved successfully!"));
              }
            }
          });
        };
        var alternate_10 = ($$anchor3) => {
          var fragment_3 = comment();
          var node_3 = first_child(fragment_3);
          {
            var consequent_2 = ($$anchor4) => {
              Models($$anchor4, {});
            };
            var alternate_9 = ($$anchor4) => {
              var fragment_5 = comment();
              var node_4 = first_child(fragment_5);
              {
                var consequent_3 = ($$anchor5) => {
                  Evaluations($$anchor5, {});
                };
                var alternate_8 = ($$anchor5) => {
                  var fragment_7 = comment();
                  var node_5 = first_child(fragment_7);
                  {
                    var consequent_4 = ($$anchor6) => {
                      Tools($$anchor6, {});
                    };
                    var alternate_7 = ($$anchor6) => {
                      var fragment_9 = comment();
                      var node_6 = first_child(fragment_9);
                      {
                        var consequent_5 = ($$anchor7) => {
                          Documents($$anchor7, {
                            $$events: {
                              save: async () => {
                                toast.success($i18n().t("Settings saved successfully!"));
                                await tick();
                                await config.set(await getBackendConfig());
                              }
                            }
                          });
                        };
                        var alternate_6 = ($$anchor7) => {
                          var fragment_11 = comment();
                          var node_7 = first_child(fragment_11);
                          {
                            var consequent_6 = ($$anchor8) => {
                              WebSearch($$anchor8, {
                                saveHandler: async () => {
                                  toast.success($i18n().t("Settings saved successfully!"));
                                  await tick();
                                  await config.set(await getBackendConfig());
                                }
                              });
                            };
                            var alternate_5 = ($$anchor8) => {
                              var fragment_13 = comment();
                              var node_8 = first_child(fragment_13);
                              {
                                var consequent_7 = ($$anchor9) => {
                                  CodeExecution($$anchor9, {
                                    saveHandler: async () => {
                                      toast.success($i18n().t("Settings saved successfully!"));
                                      await tick();
                                      await config.set(await getBackendConfig());
                                    }
                                  });
                                };
                                var alternate_4 = ($$anchor9) => {
                                  var fragment_15 = comment();
                                  var node_9 = first_child(fragment_15);
                                  {
                                    var consequent_8 = ($$anchor10) => {
                                      Interface($$anchor10, {
                                        $$events: {
                                          save: () => {
                                            toast.success($i18n().t("Settings saved successfully!"));
                                          }
                                        }
                                      });
                                    };
                                    var alternate_3 = ($$anchor10) => {
                                      var fragment_17 = comment();
                                      var node_10 = first_child(fragment_17);
                                      {
                                        var consequent_9 = ($$anchor11) => {
                                          Audio($$anchor11, {
                                            saveHandler: () => {
                                              toast.success($i18n().t("Settings saved successfully!"));
                                            }
                                          });
                                        };
                                        var alternate_2 = ($$anchor11) => {
                                          var fragment_19 = comment();
                                          var node_11 = first_child(fragment_19);
                                          {
                                            var consequent_10 = ($$anchor12) => {
                                              Images($$anchor12, {
                                                $$events: {
                                                  save: () => {
                                                    toast.success($i18n().t("Settings saved successfully!"));
                                                  }
                                                }
                                              });
                                            };
                                            var alternate_1 = ($$anchor12) => {
                                              var fragment_21 = comment();
                                              var node_12 = first_child(fragment_21);
                                              {
                                                var consequent_11 = ($$anchor13) => {
                                                  Database($$anchor13, {
                                                    saveHandler: () => {
                                                      toast.success($i18n().t("Settings saved successfully!"));
                                                    }
                                                  });
                                                };
                                                var alternate = ($$anchor13) => {
                                                  var fragment_23 = comment();
                                                  var node_13 = first_child(fragment_23);
                                                  {
                                                    var consequent_12 = ($$anchor14) => {
                                                      Pipelines($$anchor14, {
                                                        saveHandler: () => {
                                                          toast.success($i18n().t("Settings saved successfully!"));
                                                        }
                                                      });
                                                    };
                                                    if_block(
                                                      node_13,
                                                      ($$render) => {
                                                        if (get(selectedTab) === "pipelines") $$render(consequent_12);
                                                      },
                                                      true
                                                    );
                                                  }
                                                  append($$anchor13, fragment_23);
                                                };
                                                if_block(
                                                  node_12,
                                                  ($$render) => {
                                                    if (get(selectedTab) === "db") $$render(consequent_11);
                                                    else $$render(alternate, false);
                                                  },
                                                  true
                                                );
                                              }
                                              append($$anchor12, fragment_21);
                                            };
                                            if_block(
                                              node_11,
                                              ($$render) => {
                                                if (get(selectedTab) === "images") $$render(consequent_10);
                                                else $$render(alternate_1, false);
                                              },
                                              true
                                            );
                                          }
                                          append($$anchor11, fragment_19);
                                        };
                                        if_block(
                                          node_10,
                                          ($$render) => {
                                            if (get(selectedTab) === "audio") $$render(consequent_9);
                                            else $$render(alternate_2, false);
                                          },
                                          true
                                        );
                                      }
                                      append($$anchor10, fragment_17);
                                    };
                                    if_block(
                                      node_9,
                                      ($$render) => {
                                        if (get(selectedTab) === "interface") $$render(consequent_8);
                                        else $$render(alternate_3, false);
                                      },
                                      true
                                    );
                                  }
                                  append($$anchor9, fragment_15);
                                };
                                if_block(
                                  node_8,
                                  ($$render) => {
                                    if (get(selectedTab) === "code-execution") $$render(consequent_7);
                                    else $$render(alternate_4, false);
                                  },
                                  true
                                );
                              }
                              append($$anchor8, fragment_13);
                            };
                            if_block(
                              node_7,
                              ($$render) => {
                                if (get(selectedTab) === "web") $$render(consequent_6);
                                else $$render(alternate_5, false);
                              },
                              true
                            );
                          }
                          append($$anchor7, fragment_11);
                        };
                        if_block(
                          node_6,
                          ($$render) => {
                            if (get(selectedTab) === "documents") $$render(consequent_5);
                            else $$render(alternate_6, false);
                          },
                          true
                        );
                      }
                      append($$anchor6, fragment_9);
                    };
                    if_block(
                      node_5,
                      ($$render) => {
                        if (get(selectedTab) === "tools") $$render(consequent_4);
                        else $$render(alternate_7, false);
                      },
                      true
                    );
                  }
                  append($$anchor5, fragment_7);
                };
                if_block(
                  node_4,
                  ($$render) => {
                    if (get(selectedTab) === "evaluations") $$render(consequent_3);
                    else $$render(alternate_8, false);
                  },
                  true
                );
              }
              append($$anchor4, fragment_5);
            };
            if_block(
              node_3,
              ($$render) => {
                if (get(selectedTab) === "models") $$render(consequent_2);
                else $$render(alternate_9, false);
              },
              true
            );
          }
          append($$anchor3, fragment_3);
        };
        if_block(
          node_2,
          ($$render) => {
            if (get(selectedTab) === "connections") $$render(consequent_1);
            else $$render(alternate_10, false);
          },
          true
        );
      }
      append($$anchor2, fragment_1);
    };
    if_block(node_1, ($$render) => {
      if (get(selectedTab) === "general") $$render(consequent);
      else $$render(alternate_11, false);
    });
  }
  reset(div_16);
  reset(div);
  template_effect(
    ($0, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12) => {
      set_class(button, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 lg:flex-none flex text-right transition ${get(selectedTab) === "general" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text2, $0);
      set_class(button_1, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "connections" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_1, $1);
      set_class(button_2, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "models" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_2, $2);
      set_class(button_3, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "evaluations" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_3, $3);
      set_class(button_4, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "tools" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_4, $4);
      set_class(button_5, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "documents" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_5, $5);
      set_class(button_6, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "web" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_6, $6);
      set_class(button_7, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "code-execution" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_7, $7);
      set_class(button_8, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "interface" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_8, $8);
      set_class(button_9, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "audio" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_9, $9);
      set_class(button_10, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "images" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_10, $10);
      set_class(button_11, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "pipelines" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_11, $11);
      set_class(button_12, 1, `px-0.5 py-1 min-w-fit rounded-lg flex-1 md:flex-none flex text-left transition ${get(selectedTab) === "db" ? "" : " text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white"}`);
      set_text(text_12, $12);
    },
    [
      () => ($i18n(), untrack(() => $i18n().t("General"))),
      () => ($i18n(), untrack(() => $i18n().t("Connections"))),
      () => ($i18n(), untrack(() => $i18n().t("Models"))),
      () => ($i18n(), untrack(() => $i18n().t("Evaluations"))),
      () => ($i18n(), untrack(() => $i18n().t("External Tools"))),
      () => ($i18n(), untrack(() => $i18n().t("Documents"))),
      () => ($i18n(), untrack(() => $i18n().t("Web Search"))),
      () => ($i18n(), untrack(() => $i18n().t("Code Execution"))),
      () => ($i18n(), untrack(() => $i18n().t("Interface"))),
      () => ($i18n(), untrack(() => $i18n().t("Audio"))),
      () => ($i18n(), untrack(() => $i18n().t("Images"))),
      () => ($i18n(), untrack(() => $i18n().t("Pipelines"))),
      () => ($i18n(), untrack(() => $i18n().t("Database")))
    ]
  );
  event("click", button, () => {
    goto("/admin/settings/general");
  });
  event("click", button_1, () => {
    goto("/admin/settings/connections");
  });
  event("click", button_2, () => {
    goto("/admin/settings/models");
  });
  event("click", button_3, () => {
    goto("/admin/settings/evaluations");
  });
  event("click", button_4, () => {
    goto("/admin/settings/tools");
  });
  event("click", button_5, () => {
    goto("/admin/settings/documents");
  });
  event("click", button_6, () => {
    goto("/admin/settings/web");
  });
  event("click", button_7, () => {
    goto("/admin/settings/code-execution");
  });
  event("click", button_8, () => {
    goto("/admin/settings/interface");
  });
  event("click", button_9, () => {
    goto("/admin/settings/audio");
  });
  event("click", button_10, () => {
    goto("/admin/settings/images");
  });
  event("click", button_11, () => {
    goto("/admin/settings/pipelines");
  });
  event("click", button_12, () => {
    goto("/admin/settings/db");
  });
  append($$anchor, div);
  pop();
  $$cleanup();
}
export {
  Settings as S
};
